//>>built
define("epi-cms/widget/SelectableMediaComponent",["dojo/_base/declare","dojo/dom-style","dojo/Evented","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/component/Media"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_a,_7,_3],{componentId:"SelectableMediaComponent",root:_9.rootPage,additionalTreeClass:"",postMixInProperties:function(){this.inherited(arguments);this.model.containedTypes=this.allowedTypes;this.model.changeContextOnItemSelection=false;this.model.treeStoreModel.forThisFolderEnabled=this._currentContext.currentMode!=="create";this.own(_4.subscribe("/epi/cms/upload",this._focusGrid.bind(this)));},postCreate:function(){this.inherited(arguments);this.list.set("selectionMode","single");this.searchResultList.set("selectionMode","single");this.resize({h:370,w:680,l:0,t:0});this.tree.set({region:"left",splitter:true});_2.set(this.tree.domNode,"width","250px");this.listContainer.set({region:"center",splitter:false});this.own(this.model.selection.watch("data",this._dataChanged.bind(this)));},setInitialValue:function(){_5(this.getCurrentContent()).then(function(_b){var _c;if(this._currentContext.currentMode==="create"){_c=_9.globalAssetsFolder;}else{_c=new _8(_b.assetsFolderLink).createVersionUnspecificReference().toString();}this.set("value",_c);}.bind(this));},_getValueAttr:function(){return this.model.selection.data[0].data.contentLink;},_setValueAttr:function(_d){this._set("value",_d);if(_d){this.model.selectItemsByContentReference(_d,true);this._focusGrid();}else{this.model.set("treePaths",null);}},_focusGrid:function(){this._focusManager.focus(this.list.grid.domNode);},_dataChanged:function(_e,_f,_10){if(!_10||_10.length!==1||!_10[0].data||!this.allowedTypes.some(function(_11){return _6.isBaseTypeIdentifier(_10[0].data.typeIdentifier,_11);})){this.emit("data-changed",null);return;}var _12=_10[0].data.contentLink;this.emit("data-changed",_12);},contextChanged:function(){this.emit("close-diaog");}});});