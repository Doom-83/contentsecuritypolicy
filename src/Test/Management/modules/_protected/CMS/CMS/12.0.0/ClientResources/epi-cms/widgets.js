//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/NumberSpinner","dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/compare/views/AllPropertiesCompareView","epi-cms/compare/views/CompareView","epi-cms/compare/views/SideBySideCompareView","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/VersionsComponent","epi-cms/content-approval/ApprovalComponent","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/ContentPreview","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/project/Overview","epi-cms/project/ProjectChangesComponent","epi-cms/project/ProjectComponent","epi-cms/project/ProjectModeToolbar","epi-cms/version/LanguageSelector","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlMediaSelector","epi-cms/widget/UrlSelector"],1);},"dijit/form/NumberSpinner":function(){define("dijit/form/NumberSpinner",["dojo/_base/declare","dojo/_base/event","dojo/keys","./_Spinner","./NumberTextBox"],function(_1,_2,_3,_4,_5){return _1("dijit.form.NumberSpinner",[_4,_5.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(_6,_7){var tc=this.constraints,v=isNaN(_6),_8=!isNaN(tc.max),_9=!isNaN(tc.min);if(v&&_7!=0){_6=(_7>0)?_9?tc.min:_8?tc.max:0:_8?this.constraints.max:_9?tc.min:0;}var _a=_6+_7;if(v||isNaN(_a)){return _6;}if(_8&&(_a>tc.max)){_a=tc.max;}if(_9&&(_a<tc.min)){_a=tc.min;}return _a;},_onKeyPress:function(e){if(this.disabled||this.readOnly){return;}if((e.charOrCode==_3.HOME||e.charOrCode==_3.END)&&!(e.ctrlKey||e.altKey||e.metaKey)&&typeof this.get("value")!="undefined"){var _b=this.constraints[(e.charOrCode==_3.HOME?"min":"max")];if(typeof _b=="number"){this._setValueAttr(_b,false);}_2.stop(e);}}});});},"dijit/form/NumberTextBox":function(){define("dijit/form/NumberTextBox",["dojo/_base/declare","dojo/_base/lang","dojo/number","./RangeBoundTextBox"],function(_c,_d,_e,_f){var _10=_c("dijit.form.NumberTextBoxMixin",null,{pattern:_e.regexp,value:NaN,editOptions:{pattern:"#.######"},_formatter:_e.format,postMixInProperties:function(){this.inherited(arguments);this._set("type","text");},_setConstraintsAttr:function(_11){var _12=typeof _11.places=="number"?_11.places:0;if(_12){_12++;}if(typeof _11.max!="number"){_11.max=9*Math.pow(10,15-_12);}if(typeof _11.min!="number"){_11.min=-9*Math.pow(10,15-_12);}this.inherited(arguments,[_11]);if(this.focusNode&&this.focusNode.value&&!isNaN(this.value)){this.set("value",this.value);}},_onFocus:function(){if(this.disabled||this.readOnly){return;}var val=this.get("value");if(typeof val=="number"&&!isNaN(val)){var _13=this.format(val,this.constraints);if(_13!==undefined){this.textbox.value=_13;}}this.inherited(arguments);},format:function(_14,_15){var _16=String(_14);if(typeof _14!="number"){return _16;}if(isNaN(_14)){return "";}if(!("rangeCheck" in this&&this.rangeCheck(_14,_15))&&_15.exponent!==false&&/\de[-+]?\d/i.test(_16)){return _16;}if(this.editOptions&&this.focused){_15=_d.mixin({},_15,this.editOptions);}return this._formatter(_14,_15);},_parser:_e.parse,parse:function(_17,_18){var v=this._parser(_17,_d.mixin({},_18,(this.editOptions&&this.focused)?this.editOptions:{}));if(this.editOptions&&this.focused&&isNaN(v)){v=this._parser(_17,_18);}return v;},_getDisplayedValueAttr:function(){var v=this.inherited(arguments);return isNaN(v)?this.textbox.value:v;},filter:function(_19){return (_19==null||_19==="")?NaN:this.inherited(arguments);},serialize:function(_1a,_1b){return (typeof _1a!="number"||isNaN(_1a))?"":this.inherited(arguments);},_setBlurValue:function(){var val=_d.hitch(_d.mixin({},this,{focused:true}),"get")("value");this._setValueAttr(val,true);},_setValueAttr:function(_1c,_1d,_1e){if(_1c!==undefined&&_1e===undefined){_1e=String(_1c);if(typeof _1c=="number"){if(isNaN(_1c)){_1e="";}else{if(("rangeCheck" in this&&this.rangeCheck(_1c,this.constraints))||this.constraints.exponent===false||!/\de[-+]?\d/i.test(_1e)){_1e=undefined;}}}else{if(!_1c){_1e="";_1c=NaN;}else{_1c=undefined;}}}this.inherited(arguments,[_1c,_1d,_1e]);},_getValueAttr:function(){var v=this.inherited(arguments);if(isNaN(v)&&this.textbox.value!==""){if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+_e._realNumberRegexp(_d.mixin({},this.constraints))+"$").test(this.textbox.value))){var n=Number(this.textbox.value);return isNaN(n)?undefined:n;}else{return undefined;}}else{return v;}},isValid:function(_1f){if(!this.focused||this._isEmpty(this.textbox.value)){return this.inherited(arguments);}else{var v=this.get("value");if(!isNaN(v)&&this.rangeCheck(v,this.constraints)){if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)){return true;}else{return this.inherited(arguments);}}else{return false;}}}});var _20=_c("dijit.form.NumberTextBox",[_f,_10],{baseClass:"dijitTextBox dijitNumberTextBox"});_20.Mixin=_10;return _20;});},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_21,_22,_23,_24,_25,_26,_27,_28,_29){return _21([_28],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_23.after(this.getContentDataStore(),"notify",function(_2a,id){this.itemChanged(id,_2a);}.bind(this),true));},getContentDataStore:function(){if(!this.contentDataStore){var _2b=_26.resolve("epi.storeregistry");this.contentDataStore=_2b.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _2c=new _24();_25(this.getCurrentContext(),_22.hitch(this,function(ctx){if(!this._isContentContext(ctx)){_2c.reject({message:"Not a content data",context:ctx});return;}_25(this.getContentDataStore().get(ctx.id),function(_2d){_2c.resolve(_2d);});}));return _2c.promise;},contextChanged:function(ctx,_2e){this.inherited(arguments);if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}var _2f=(_2e&&_2e.forceContextChange?_2e.forceContextChange:false);if(!_2f&&this._isSameAsCurrentContentContext(ctx)){return;}this._currentContentContext=ctx;this.contentContextChanged(ctx,_2e);},contextUpdated:function(ctx,_30){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_30);},contentContextChanged:function(ctx,_31){},contentContextUpdated:function(ctx,_32){},itemChanged:function(id,_33){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_34,_35){var _36=new _27(_34),_37=new _27(_35);if(this.ignoreVersionWhenComparingLinks&&_36.getType()==="epi.cms.contentdata"&&_37.getType()==="epi.cms.contentdata"&&_29.compareIgnoreVersion(_36.getId(),_37.getId())){return true;}else{if(_34===_35){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_38,epi){var _39=_38(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_3a){if(_3a){this._parse(_3a);}},_parse:function(_3b){if(typeof _3b==="object"){this.id=parseInt(_3b.ID||_3b.id||_3b.iD||_3b.Id||0,10);this.workId=parseInt(_3b.WorkID||_3b.workId||0,10);this.providerName=_3b.ProviderName||_3b.providerName||null;}else{if(typeof _3b==="string"){if(_3b==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _3c=_3b.split("_");this.id=parseInt(_3c[0],10);this.workId=parseInt(_3c[1],10)||0;this.providerName=_3c[2]||"";}}else{if(typeof _3b==="number"){this.id=_3b;this.workId=0;this.providerName="";}}}if(isNaN(this.id)){throw new Error("The id parameter of a content reference must be an integer");}if(isNaN(this.workId)&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _3d=String(this.id);if(this.workId!==0){_3d+="_"+this.workId;}if(this.providerName){_3d+=(this.workId===0?"__":"_")+this.providerName;}return _3d;},createVersionUnspecificReference:function(){return new _39({id:this.id,providerName:this.providerName});}});_39.isContentReference=function(_3e){try{return !!(new _39(_3e));}catch(error){return false;}};_39.toContentReference=function(obj){if(obj instanceof _39){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _39(obj);}}return _39.empty;};_39.tryConvert=function(_3f,_40){if(_3f instanceof _39){return _3f;}try{return new _39(_3f);}catch(error){return _40!==undefined?_40:_39.empty;}};_39.compareIgnoreVersion=function(_41,_42){var c1=_39.toContentReference(_41);var c2=_39.toContentReference(_42);var _43=c1.createVersionUnspecificReference();var _44=c2.createVersionUnspecificReference();return epi.areEqual(_43,_44);};_39.empty=new _39({id:-1,workId:-1});_39.emptyContentReference=_39.empty;return _39;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/shell/request/mutators","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi/shell/StickyViewSelector","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/ContentRepositoryDescriptorService","epi-cms/conversion/ContentFragmentConverter","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/configurableQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/project/ProjectActivitiesQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/compare/command/CompareCommandProvider","epi-cms/notification/command/NotificationCommandProvider","epi-cms/command/ViewSettingsCommandProvider","epi-cms/content-activity/command/ContentActivityCommandProvider","epi-cms/contentediting/ContentHierarchyService","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/content-approval/ApprovalService","epi-cms/project/ProjectService","epi-cms/activity/ActivityService","epi-cms/notification/NotificationService","epi-cms/project/request/projectMode","epi-cms/request/contentLanguage","epi-cms/project/ProjectModeRequestInterceptor","epi-cms/project/ProjectItemQueryEngine","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/project/ProjectViewSetting","epi-cms/widget/ContentTypeService","epi-cms/Profile"],function(_45,_46,_47,_48,epi,_49,_4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52,_53,_54,_55,_56,_57,_58,_59,_5a,_5b,_5c,_5d,_5e,_5f,_60,_61,_62,_63,_64,_65,_66,_67,_68,_69,_6a,_6b,_6c,_6d,_6e,_6f,_70,_71,_72,_73,_74,_75,_76,_77,_78,_79,_7a){return _46([_49],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_7b){this._settings=_7b;},initialize:function(){this.inherited(arguments);_4b.add(_6c);_4b.add(_6d);_46.safeMixin(_53,this._settings);var _7c=_4a.resolve("epi.shell.Profile");return _48(_7c.getContentLanguage()).then(_47.hitch(this,function(_7d){_53.currentContentLanguage=_7c.contentLanguage=_7d;if(_53.enableStickyView){_52.enable();}else{_52.disable();}this.registerDependency("epi.cms.BackContextHistory",new _54());this.registerDependency("epi.cms.ContextSynchronizer",new _55(),undefined,function(_7e){_7e.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_70);this._hashWrapper=_4a.resolve("epi.shell.HashWrapper");var _7f=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",new _56(this._settings.contentRepositoryDescriptors));_7f.registerRoute("epi.cms.contentdata",_47.hitch(this,this._redirectContentDataContext));_7f.registerRoute("epi.cms.project",_47.hitch(this,this._redirectContext));_7f.registerRoute("epi.cms.approval",_47.hitch(this,this._redirectContext));this._initializeEditorFactory();this._initializeStores();this.registerDependency("epi.cms.ApprovalService",new _68());this.registerDependency("epi.cms.ProjectService",new _69());this.registerDependency("epi.cms.ActivityService",new _6a());this.registerDependency("epi.cms.NotificationService",new _6b());this.registerDependency("epi.cms.ContentHierarchyService",new _64());this._projectModeRequestInterceptor=new _6e();this.registerDependency("epi.cms.ContentTypeService",new _79());this._setupConverters();this._setupViewSettings(_7f);var _80=new _63();this.registerDependency("contentActivityCommandProvider",_80);var _81=_4a.resolve("epi.globalcommandregistry");_81.registerProvider("epi.cms.publishmenu",new _73());_81.registerProvider("epi.cms.globalToolbar",new _5f());_81.registerProvider("epi.cms.globalToolbar",new _60());_81.registerProvider("epi.cms.globalToolbar",new _62());_81.registerProvider("epi.cms.globalToolbar",new _61());_81.registerProvider("epi.cms.globalToolbar",_80);this._setupInUseNotificationManager(_81);}));},_redirectContentDataContext:function(_82,_83,uri){if(_51.viewName==="/episerver/dashboard"){var _84=_4c.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_84=_84.substring(0,_84.length-1);var _85=_84+"#"+this._hashWrapper.extractHash(_82,_83);this._redirect(_85);}else{if(_82.hasSiteChanged){var _86=_82.fullHomeUrl+"#"+this._hashWrapper.extractHash(_82,_83);this._redirect(_86);}else{if(_83&&_83.trigger==="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_82,_83);}}},_redirectContext:function(_87,_88){this._hashWrapper.onContextChange(_87,_88);},_redirect:function(url){window.location=url;},_setupConverters:function(){var _89=new _58(),_8a=new _59(),_8b=new _57(),_8c=new _5a(),_8d=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _8d){var _8e=_8d[key];if(_8e.linkableTypes){_8e.linkableTypes.forEach(function(_8f){_4d.registerConverter(_8f,_8f+".link",_89);_4d.registerConverter(_8f+".fragment",_8f+".link",_89);_4d.registerConverter(_8f,"link",_89);});}}for(key in _50._uiDescriptors){var _90=_50._uiDescriptors[key].descriptor;_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".reference",_8a);_4d.registerConverter(_90.typeIdentifier+".fragment",_90.typeIdentifier+".reference",_8a);_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".light",_89);_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".fragment",_8b);}_89.registerDefaultConverters(_4d);_8c.registerDefaultConverters(_4d);},_setupViewSettings:function(_91){var _92=new _67({viewSettings:[new _75(),new _77(),new _74(),new _78(_91),new _76(_91)]});this.registerDependency("epi.viewsettingsmanager",_92);},_initializeStores:function(){var _93=this.resolveDependency("epi.storeregistry"),_94,_95,_96;_94=_93.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_95=_93.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_5c});_96=_93.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_5d});_93.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_93.create("epi.cms.category",this._getRestPath("categories"));_93.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_94);_93.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_93.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_93.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_93.create("epi.cms.displaychannels",this._getRestPath("channel"));_93.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_93.create("epi.cms.project",this._getRestPath("project"),{queryEngine:_5c,realtimeInfo:{subscriptionKey:"/episerver/cms/project"}});_93.create("epi.cms.project.item",this._getRestPath("project-item"),{queryEngine:_6f,realtimeInfo:{subscriptionKey:"/episerver/cms/project-item"}});_93.create("epi.cms.activities",this._getRestPath("activities"),{queryEngine:_5e,realtimeInfo:{subscriptionKey:"/episerver/cms/activity"}});_93.create("epi.cms.activities.comments",this._getRestPath("activities-comments"),{realtimeInfo:{subscriptionKey:"/episerver/cms/activity-comment"}});_93.create("epi.cms.contenttype",this._getRestPath("contenttype")).query();_93.create("epi.cms.notification",this._getRestPath("notification"),{queryEngine:_5c,realtimeInfo:{subscriptionKey:"/episerver/cms/notification"}});_93.create("epi.cms.notification.users",this._getRestPath("notification-users"),{idProperty:"userName"});_93.create("epi.cms.personalized.content",this._getRestPath("personalized-content"),{idProperty:"id"});_93.add("epi.cms.approval.definition",new _4f(new _4e({idProperty:"contentLink",target:this._getRestPath("approval-definition"),preventCache:true})));_93.add("epi.cms.approval",new _4f(new _4e({target:this._getRestPath("approval"),preventCache:true})));_93.add("epi.cms.languagesettings",new _4f(new _4e({idProperty:"contentLink",target:this._getRestPath("languagesettings"),preventCache:true})));_93.add("epi.cms.accessrights",new _4f(new _4e({idProperty:"contentLink",target:this._getRestPath("accessrights"),preventCache:true})));_93.add("epi.cms.contentreferences",new _4f(new _4e({target:this._getRestPath("contentreferences"),idProperty:"contentLink",preventCache:true})));_93.add("epi.cms.referenced-content",new _4f(new _4e({target:this._getRestPath("referenced-content"),idProperty:"contentLink",preventCache:true})));_93.add("epi.cms.content.search",new _4f(new _4e({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_94.addDependentStore(_95,{refreshOnPatch:true,refresh:function(_97){setTimeout(function(){var id=_94.getIdentity(_97);var _98=new _5b(id).createVersionUnspecificReference().toString();_95.refresh(_98);});}});_94.addDependentStore(_96,{transformDelegate:function(_99){if(_99.capabilities&&!_99.capabilities.versionable){return null;}if(!_99.properties){return null;}var _9a={pageChangedBy:"savedBy",pageSaved:"savedDate",pageLanguageBranch:"language",pageName:"name",name:"name",icontent_name:"name"};var _9b=_47.mixin({},_99);for(var p in _9a){if(p in _9b.properties){_9b[_9a[p]]=_9b.properties[p];}}return _9b;}});},_getRestPath:function(_9c){return _4c.getRestPath({moduleArea:"cms",storeName:_9c});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _9d=new _65();_9d.registerEditorWrapper("inline","epi-cms/contentediting/InlineEditorWrapper",function(_9e,_9f){});_9d.registerEditorWrapper("richtextinline","epi-cms/contentediting/RichTextInlineEditorWrapper",function(_a0,_a1){});_9d.registerEditorWrapper("flyout","epi-cms/contentediting/FlyoutEditorWrapper",function(_a2,_a3){});_9d.registerEditorWrapper("floating","epi-cms/contentediting/FloatingEditorWrapper",function(_a4,_a5){});_9d.registerEditorWrapper("contenteditable","epi-cms/contentediting/ContentEditableWrapper",function(_a6,_a7){});_9d.registerEditorWrapper("legacyProperty","epi-cms/contentediting/DialogEditorWrapper",function(_a8,_a9){_a8.closeOnChange=true;_a8.showButtons=false;});return _9d;});},_setupInUseNotificationManager:function(_aa){var _ab=new _66();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_ab);_aa.registerProvider("epi.cms.publishmenu",new _72());_aa.registerProvider("epi.cms.contentdetailsmenu",new _71());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/store/Memory","epi/shell/ContextHistory","epi/shell/ViewSettings"],function(_ac,_ad,_ae,_af,_b0,_b1){return _ac([_b0],{createStore:function(){return new _af({data:[],idProperty:"uri"});},onContextChanged:function(_b2,_b3,_b4){if(_b3&&_b3.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},closeAndNavigateBack:function(_b5){var _b6=this._getLastItem();var _b7=this.store.data.filter(function(_b8){return _b6.typeIdentifier&&(_b6.typeIdentifier===_b8.typeIdentifier);});_b7.forEach(function(_b9){var _ba=this.store.getIdentity(_b9);this.store.remove(_ba);},this);var _bb=this._getLastItem();var uri=_bb&&_bb.uri?{uri:_bb.uri}:{uri:_b1.settings.defaultContext};_ae.publish("/epi/shell/context/request",uri,{sender:_b5});},getPrevious:function(){var _bc=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_bc&&_bc.length>1)?_bc[1]:null;},_updateStore:function(_bd){var _be=this._getLastItem();if(_be&&_be.uri===_bd.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){var _bf=this.store.query({},{sort:[{attribute:"dateAdded",descending:true}]});return _bf[0];}return null;},_removeLastItem:function(){var _c0=this._getLastItem();if(_c0){this.store.remove(this.store.getIdentity(_c0));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_c1,_c2,_c3,_c4,_c5,_c6){return _c1([_c5],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_c3.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_c7){var _c8=_c7.contentLink;_c4(this.getCurrentContext(),function(_c9){if(_c9&&_c6.compareIgnoreVersion(_c9.id,_c8)){var _ca={uri:"epi.cms.contentdata:///"+_c8};if(_c9.languageContext){_ca.epslanguage=_c9.languageContext.preferredLanguage;}_c3.publish("/epi/shell/context/updateRequest",_ca);}});},destroy:function(){_c3.unsubscribe(this._subscribeHandle);}});});},"epi-cms/ContentRepositoryDescriptorService":function(){define("epi-cms/ContentRepositoryDescriptorService",["epi/assign"],function(_cb){function _cc(_cd){_cb(this,_cd);};_cc.prototype.get=function(key){return !key?null:this[key.toLowerCase()];};_cc.prototype.list=function(){return Object.keys(this);};return _cc;});},"epi-cms/conversion/ContentFragmentConverter":function(){define(["dojo/_base/declare"],function(_ce){return _ce([],{convert:function(_cf,_d0,_d1){if(!_d1){return null;}return {contentLink:_d1.contentLink,name:_d1.name,typeIdentifier:_d1.typeIdentifier,id:_d1.id};}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_d2,_d3,_d4,_d5,_d6,_d7){return _d2(null,{_contentStore:null,constructor:function(_d8){_d3.mixin(this,_d8);this._contentStore=this._contentStore||_d5.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_d9){},convert:function(_da,_db,_dc){if(!_dc||(!_dc.contentLink&&!_dc.uri)){return null;}var _dd=_dc.contentLink||new _d6(_dc.uri).getId();if(!_dd){return null;}_dd=new _d7(_dd).createVersionUnspecificReference().toString();return _d4(this._contentStore.get(_dd),function(_de){return {url:_de.publicUrl,previewUrl:_de.previewUrl,permanentUrl:_de.permanentLink,text:_de.name,typeIdentifier:_de.typeIdentifier};});}});});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_df,_e0,_e1,_e2,_e3,_e4){return _df(null,{convert:function(_e5,_e6,_e7){if(!_e7||(!_e7.uri&&!_e7.contentLink)){return null;}var _e8;if(_e7.uri){var uri=new _e3(_e7.uri);_e8=uri.getId();}else{_e8=_e7.contentLink;}return new _e4(_e8).createVersionUnspecificReference().toString();}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare"],function(_e9){return _e9(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_ea){_ea.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_eb,_ec,_ed){if(_ed&&_eb===this.sourceDataType&&_ec===this.targetDataType){return new Date(_ed);}return null;}});});},"epi-cms/store/configurableQueryEngine":function(){define(["epi/shell/store/queryUtils"],function(_ee){return function(_ef,_f0){_f0=_f0||{};return _ee.createEngine(_ef,_f0);};});},"epi/shell/store/queryUtils":function(){define("epi/shell/store/queryUtils",[],function(){function _f1(_f2){return _f2 instanceof Array&&_f2.length>0;};var _f3={createFilter:function(_f4,_f5){var _f6;_f5=_f5||{};switch(typeof _f4){case "object":case "undefined":_f6=function(_f7){return !_f4||Object.keys(_f4).every(function(key){var _f8=_f5.ignore,_f9=_f5.comparers&&_f5.comparers[key],_fa=_f4[key];if(_f8&&_f8.indexOf(key)!==-1){return true;}if(_f9){return _f9(_fa,_f7);}return _fa===_f7[key];});};break;default:throw new Error("Can not query with a "+typeof _f4);}return _f6;},createSorter:function(_fb){if(!_f1(_fb)){throw new Error("Argument must be an array containing sortOptions");}return function(a,b){var _fc,_fd;for(var _fe,i=0;(_fe=_fb[i]);i++){_fc=a[_fe.attribute];_fd=b[_fe.attribute];if(typeof _fc==="string"&&typeof _fd==="string"){_fc=_fc.toLowerCase();_fd=_fd.toLowerCase();}if(_fc!==_fd){return _fe.descending===(_fc>_fd)?-1:1;}}return 0;};},createExecuter:function(_ff,_100,_101,_102){var _103=_101||0,end=_102?_103+_102:Infinity;return function(_104){var _105;_104=_ff?_104.filter(_ff):_104.slice(0);_100&&_104.sort(_100);if(_101||_102){_105=_104.length;_104=_104.slice(_103,end);_104.total=_105;}return _104;};},createEngine:function(_106,_107){var _108,_109,_10a;_107=_107||{};_108=_f3.createFilter(_106,_107);_109=_f1(_107.sort)?_f3.createSorter(_107.sort):null;_10a=_f3.createExecuter(_108,_109,_107.start,_107.count);_10a.matches=_108;return _10a;}};return _f3;});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_10b,_10c){return function(_10d,_10e){switch(typeof _10d){case "object":case "undefined":var _10f=_10d;_10d=function(_110){for(var key in _10f){var _111=_10f[key],_112=_111.toString();if(_112!==_110[key]&&(!_10c.isContentReference(_112)||!_10c.compareIgnoreVersion(_112,_110[key]))){return false;}}return true;};break;case "string":if(!this[_10d]){throw new Error("No filter function "+_10d+" was found in store");}_10d=this[_10d];break;case "function":break;default:throw new Error("Can not query with a "+typeof _10d);}function _113(_114){var _115=_10b.filter(_114,_10d);if(_10e&&_10e.sort){_115.sort(function(a,b){for(var sort,i=0;(sort=_10e.sort[i]);i++){var _116=a[sort.attribute];var _117=b[sort.attribute];if(_116!==_117){return sort.descending===(_116>_117)?-1:1;}}return 0;});}if(_10e&&(_10e.start||_10e.count)){var _118=_115.length;_115=_115.slice(_10e.start||0,(_10e.start||0)+(_10e.count||Infinity));_115.total=_118;}return _115;};_113.matches=_10d;return _113;};});},"epi-cms/project/ProjectActivitiesQueryEngine":function(){define(["dojo/_base/lang","epi/shell/store/queryUtils"],function(lang,_119){return function(_11a,_11b){_11b=lang.mixin({comparers:{projectId:function(_11c,_11d){return !_11d.projectId||_11c===_11d.projectId;},contentReferences:function(_11e,_11f){return _11e&&_11e.some(function(_120){return _120===_11f.contentLink;});}}},_11b);return _119.createEngine(_11a,_11b);};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable","dijit/form/ToggleButton","epi/dependency","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_121,_122,lang,_123,_124,_125,_126,_127,_128,_129,_12a,_12b){var _12c=_122([_127,_124],{iconClass:"epi-iconTree",tooltip:_12b.toolbar.buttons.togglenavigationpane,label:_12b.toolbar.buttons.togglenavigationpane,order:-10000,canExecute:true,constructor:function(){this.own(_123.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",lang.hitch(this,function(_12d){this.set("active",_12d);})));},_execute:function(){_123.publish("/epi/layout/pinnable/navigation/toggle");}});var _12e=_122([_127,_124],{iconClass:"epi-iconFolder",tooltip:_12b.toolbar.buttons.toggleassetspane,label:_12b.toolbar.buttons.toggleassetspane,order:10000,canExecute:true,constructor:function(){this.own(_123.subscribe("/epi/layout/pinnable/tools/visibilitychanged",lang.hitch(this,function(_12f){this.set("active",_12f);})));},_execute:function(){_123.publish("/epi/layout/pinnable/tools/toggle");}});return _122([_12a],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_126.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_128.viewName;this._addLeadingCommands();this._addCreateCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _12c(),{widget:_125,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _130=this.viewName;var _131=[];var _132=function(view){return view===_130;};for(var _133 in this.contentRepositoryDescriptors){var _134=this.contentRepositoryDescriptors[_133];if(_121.some(_134.mainViews,_132)){_131.push(_134);}}_121.forEach(_131,function(_135){_121.forEach(_135.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _129({creatingTypeIdentifier:type});},_addTrailingCommands:function(){this.addToTrailing(new _12e(),{widget:_125,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_136,_137,lang,_138,on,_139,when,_13a,_13b,_13c,_13d,_13e,_13f,_140,_141,_142,_143,_144){return _137([_13b,_140],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,confirmActionText:_144.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,autoPublish:false,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,allowedTypes:null,restrictedTypes:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _145=_13a.resolve("epi.storeregistry");this.contentStore=this.contentStore||_145.get("epi.cms.content.light");this.contextService=this.contextService||_13a.resolve("epi.shell.ContextService");this.contentTypeStore=this.contentTypeStore||_145.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_13a.resolve("epi.cms.contentRepositoryDescriptors");var _146,_147=function(type){return type===this.creatingTypeIdentifier;};for(var _148 in this.contentRepositoryDescriptors){var _149=this.contentRepositoryDescriptors[_148];if(_136.some(_149.containedTypes,_147,this)){_146=_149;break;}}if(_146){var _14a=_13c.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_14a?_14a:[this.creatingTypeIdentifier];this.roots=this.roots||_146.roots;}this.modelContent=new _142({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_146.preventContextualContentFor;this.label=this.label||_13c.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_13c.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_13c.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_13c.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},contextChanged:function(ctx,_14b){this.set("isAvailable",this._isContentContext(ctx));this.inherited(arguments);},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_14c){if(!_14c){return;}when(this.contextService.query({uri:"epi.cms.contentdata:///"+_14c.contentLink}),lang.hitch(this,function(_14d){if(!_14d){return;}var _14e=_14d.languageContext;var _14f=!_14e||(_14e.hasTranslationAccess&&_14e.isPreferredLanguageAvailable);var _150=_13e.compareIgnoreVersion(_14c.contentLink,_13f.wastebasketPage);var _151=!(_150||_14c.isDeleted)&&_14f&&_143.isActionAvailable(_14c,_143.action.Create,_143.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_14c.contentLink),lang.hitch(this,function(_152){var _153=this._isContentTypeAllowedAsChildToCurrentContext(_152,_14c);if((!_153&&!this.createAsLocalAsset)||!_151){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_14c);}}));}));}));},_getAvailableContentTypes:function(_154){return this.contentTypeStore.query({query:"getavailablecontenttypes",localAsset:this.createAsLocalAsset,parentReference:_154});},_isContentTypeAllowedAsChildToCurrentContext:function(_155,_156){var _157=_136.some(_155,function(_158){return _13c.isBaseTypeIdentifier(_158.typeIdentifier,this.creatingTypeIdentifier);},this);var _159=_136.some(this.containerTypeIdentifiers,function(type){return _13c.isBaseTypeIdentifier(_156.typeIdentifier,type);});return _157&&_159;},_createDialog:function(){this.selector=new _141({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _13d({confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});this.selector.on("change",lang.hitch(this,this._setDialogButtonState));this.dialog.own(_138.after(this.dialog,"hide",lang.hitch(this,function(_15a){this.hideDeferred=_15a;})));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _15b=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_15b),lang.hitch(this,function(_15c){this._switchView(_15c);}));}));},_switchView:function(_15d){when(this.getCurrentContent(),lang.hitch(this,function(_15e){var _15f=this.isPseudoContextualRoot(_15d)||this.createAsLocalAsset;_139.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_15f?_15e:_15d,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_15f,treatAsSecondaryView:this.createAsLocalAsset,view:_13c.getValue(this.creatingTypeIdentifier,"createView"),autoPublish:this.autoPublish,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});}));},_setDialogButtonState:function(_160){if(!_160){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_160),lang.hitch(this,function(_161){when(this.isPseudoContextualRoot(_161)?this.contextService.query({uri:"epi.cms.contentdata:///"+this._currentContext.id}):_161,lang.hitch(this,function(_162){var _163=_143.hasLanguageAccess(_162),_164=_163&&_143.hasAccess(_161.accessMask,_143.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_164);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference"],function(_165,_166,lang,when,_167,_168,_169,_16a,_16b){return _166([_167],{_commandDecorator:null,postscript:function(){this.inherited(arguments);this._commandDecorator=this._commandDecorator||new _16a();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_16c){var _16d=this.inherited(arguments),_16e=this.isContextualContent(_16c);return _16d!=null?!!(_16d||_16e):!!(_16c&&_16e);},isContextualContent:function(_16f){return this.isContextualRoot(_16f)||this.isPseudoContextualRoot(_16f);},isContextualRoot:function(_170){return _170.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_171){var _172=_16b.toContentReference(_171.contentLink);return !_172.providerName&&_172.id==this._getPseudoContextualContent();},hasContextual:function(_173){if(!(_173 instanceof Array)||_173.length<=0){return false;}return _165.some(_173,this.isContextualContent,this);},canHaveContextualContent:function(_174){var _175=_16b.toContentReference(_174.contentLink);return !_165.some(this.notSupportContextualContents,function(id){return !_175.providerName&&_175.id==id;});},getContextualRoot:function(_176){if(typeof _176!=="object"){return null;}var _177=lang.clone(_176);_177.name=this.getContextualRootName(_177);if(this.isPseudoContextualRoot(_177)){_177.hasChildren=false;}return _177;},getContextualRootName:function(_178){var _179=_178&&_178.ownerTypeIdentifier,_17a=_179||(this._currentContext&&this._currentContext.dataType)||"",_17b=_168.getResourceValue(_17a,"name",true);var _17c=_168.getResourceValue(_17a,"forthis",false);return _17b?lang.replace(_17c,[_17b]):_17c;},decoratePseudoContextualCommands:function(_17d){when(this.getCurrentContent()).then(lang.hitch(this,function(_17e){this._commandDecorator.decorateCommands(_17d,_17e,lang.hitch(this,this.isPseudoContextualRoot));})).otherwise(function(){});},_getPseudoContextualContent:function(){return _169.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_17f,_180,lang,_181,_182,_183,_184){return _180(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_185,_186,_187){this._clearContextualCommandHandlers();if(!(_185 instanceof Array)||_185.length<=0||typeof _186!=="object"){return;}this._decorateCommands(_185,_186,_187);},_decorateCommands:function(_188,_189,_18a){_17f.forEach(_188,function(_18b){if(!this._isValidCommand(_18b)){return;}if(typeof _18a==="function"&&!_18a(this._getCommandModel(_18b))){return;}this._onAroundCommandExecute(_18b,_189);},this);},_getCommandModel:function(_18c){if(_18c.model&&_18c.model instanceof Array){if(_18c.model.length===1){return _18c.model[0];}return null;}return _18c.isInstanceOf(_184)?_18c.get("selectionData"):_18c.model;},_onAroundCommandExecute:function(_18d,_18e){var self=this;self._contextualCommandHandlers.push(_181.around(_18d,"execute",function(_18f){return function(){var _190=self._decorateCommandBeforeExecute(_18d,_18e);_18f.apply(_18d,arguments);self._restoreCommandAfterExecute(_18d,_190);};}));},_decorateCommandBeforeExecute:function(_191,_192){var _193=this._decorateCommand(_191);if(this._isNormalCommand(_191)){lang.mixin(_193,this._decorateNormalCommand(_191,_192));}else{if(_191.isInstanceOf(_184)){lang.mixin(_193,this._decorateSelectionCommand(_191,_192));}}_191.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _193;},_decorateCommand:function(_194){var _195={createAsLocalAsset:_194.get("createAsLocalAsset")};_194.isInstanceOf(_182)&&_194.unwatchModelChange();_194.isInstanceOf(_183)&&_194.unwatchClipboardChange();_194.isInstanceOf(_184)&&_194.unwatchSelectionChange();return _195;},_decorateNormalCommand:function(_196,_197){var _198={model:_196.get("model")};_196.set("model",_197);return _198;},_decorateSelectionCommand:function(_199,_19a){var _19b={data:_199.get("selectionData")};var _19c=_199.get("model");if(_19c&&typeof _19c.refreshRoots=="function"){_199.onRefreshSelection=function(){return _19c.refreshRoots();};}_199.selection.set("data",[{data:_19a,type:_199.get("selectionType")}]);return _19b;},_restoreCommandAfterExecute:function(_19d,_19e){this._restoreCommand(_19d,_19e);if(this._isNormalCommand(_19d)){this._restoreNormalCommand(_19d,_19e);return;}if(_19d.isInstanceOf(_184)){this._restoreSelectionCommand(_19d,_19e);}},_restoreCommand:function(_19f,_1a0){_19f.set("createAsLocalAsset",_1a0.createAsLocalAsset);_19f.isInstanceOf(_182)&&_19f.watchModelChange();_19f.isInstanceOf(_183)&&_19f.watchClipboardChange();_19f.isInstanceOf(_184)&&_19f.watchSelectionChange();},_restoreNormalCommand:function(_1a1,_1a2){_1a1.set("model",_1a2.model);},_restoreSelectionCommand:function(_1a3,_1a4){_1a3.selection.set("data",[{data:_1a4.data,type:_1a3.get("selectionType")}]);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_17f.forEach(this._contextualCommandHandlers,function(_1a5){typeof _1a5.remove==="function"&&_1a5.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_1a6){return !(_1a6.isInstanceOf(_184)||_1a6.isInstanceOf(_183));},_isValidCommand:function(_1a7){return !!(_1a7&&_1a7.isInstanceOf(_182)&&this._getCommandModel(_1a7));}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_1a8,lang){return _1a8(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_1a9,lang){return _1a9(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_getSingleSelectionData:function(){var _1aa=this._getSelectionData();return _1aa&&(this.selection.data.length===1)?_1aa.data:null;},_selectionDataGetter:function(){var _1ab=this._getSelectionData();return _1ab&&_1ab.type==="epi.cms.contentdata"?_1ab.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/when","dijit/layout/_LayoutWidget","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/SearchBox","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_1ac,_1ad,lang,_1ae,when,_1af,epi,_1b0,_1b1,_1b2,_1b3,_1b4,_1b5,_1b6,_1b7){return _1ad([_1af,_1b5],{_contentRef:null,res:_1b7,baseClass:"epi-content-selector-dialog",roots:null,typeIdentifiers:null,showButtons:true,model:null,allowedTypes:null,restrictedTypes:null,canSelectOwnerContent:true,multiRootsMode:false,_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,showSearchBox:true,searchArea:null,_searchBox:null,buildRendering:function(){this.inherited(arguments);var _1b8=this._getTypesToDisplay(),_1b9=this.model,_1ba=this.roots||(_1b9&&_1b9.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_1b9||this.showContextualContent){_1b9=new _1b3({roots:_1ba,typeIdentifiers:_1b8,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_1b9.set("view","contentselector");if(this.showSearchBox&&this.searchArea){this._searchBox=new _1b4({innerSearchBoxClass:"epi-search--full-width",triggerContextChange:false,parameters:{allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes},onItemAction:lang.hitch(this,function(item){if(item&&item.metadata&&this._checkAcceptance(item.metadata.typeIdentifier)){this.set("value",item.metadata.id);this.onChange(item.metadata.id);}})});this._searchBox.set("area",this.searchArea);this._searchBox.set("searchRoots",this.roots);var _1bb=this._searchBox;_1b9.getRoots(true).then(function(_1bc){_1bb.set("searchRoots",_1bc.join(","));});this.addChild(this._searchBox);}this.tree=new _1b2({roots:_1ba,typeIdentifiers:_1b8,allowManipulation:false,model:_1b9,allowedTypes:lang.clone(this.allowedTypes),restrictedTypes:lang.clone(this.restrictedTypes),disableRestrictedTypes:true,expandExtraNodeItems:_1b1.startPage});this.addChild(this.tree);this.connect(this.tree,"onClick","_onTreeNodeClick");},layout:function(){this.inherited(arguments);var _1bd=this._contentBox.h;if(this._searchBox){_1bd-=_1ae.getMarginBox(this._searchBox.domNode).h;}var _1be=_1ae.getMarginBox(this.tree.domNode);_1be.h=_1bd;_1ae.setMarginBox(this.tree.domNode,_1be);},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _1bf=this.contentRepositoryDescriptors||_1b6.resolve("epi.cms.contentRepositoryDescriptors");var _1c0,_1c1=function(type){return _1b0.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _1c2 in _1bf){var _1c3=_1bf[_1c2];if(_1ac.some(_1c3.containedTypes,_1c1,this)){_1c0=_1c3;break;}}return _1c0.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _1c4=[];this._getContainerTypesRecursive(this.allowedTypes,_1c4);this._typesToDisplay=_1c4;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_1c5,_1c6,_1c7){if(!_1c7){_1c7=[];}_1ac.forEach(_1c5,lang.hitch(this,function(type){if(_1ac.indexOf(_1c7,type)===-1){_1c7.push(type);if(_1ac.indexOf(_1c6,type)===-1){_1c6.push(type);}var _1c8=_1b0.getValue(type,"containerTypes");if(_1c8){this._getContainerTypesRecursive(_1c8,_1c6,_1c7);}}}));},_setValueAttr:function(_1c9){if(_1c9){this._contentRef=_1c9;var _1ca=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_1ca,true);}));}else{if(!epi.isEmpty(_1ca)){this.tree.selectContent(_1ca,true);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_setAllowedTypesAttr:function(_1cb){this._typesToDisplay=null;this._set("allowedTypes",_1cb);},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_1b7.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_1cc){var _1cd=_1cc.contentLink;if(!this._checkAcceptance(_1cc.typeIdentifier)){this.tree.lastFocused.setSelected(false);_1cd=null;}this.set("value",_1cd);this.onChange(this.get("value"));},_checkAcceptance:function(_1ce){var _1cf=_1b0.getValidAcceptedTypes([_1ce],this.allowedTypes,this.restrictedTypes);return !!_1cf.length;},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_1d0){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","dijit/registry","epi/dependency","epi/shell/DestroyableByKey","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel"],function(_1d1,_1d2,_1d3,lang,_1d4,_1d5,_1d6,_1d7,_1d8,keys,_1d9,_1da,_1db,when,_1dc,_1dd,_1de,_1df,_1e0,Tree,_1e1,_1e2,_1e3,_1e4,_1e5){return _1d3([Tree,_1d8,_1de],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,disableRestrictedTypes:false,dndSource:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}this.own(this.model);if(this.allowManipulation){this.dndController=this.dndSource||_1df;this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_1e3;this.own(_1d6.around(this.model,"pasteItems",this._aroundPasteItem.bind(this)));if(this.allowedTypes){var _1e6=_1d1.some(this.allowedTypes,function(item){return item==="episerver.core.contentfolder";});if(!_1e6){this.allowedTypes.push("episerver.core.contentfolder");}}},getItemType:function(item){return _1e0.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_1e7){return _1e4(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_1d6.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_1e8,_1e9){var _1ea=this.getNodesByItem(_1e8)[0];if(_1ea){_1d5.set(_1ea.domNode,{display:_1e9===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _1eb=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _1d9(_1d1.map(_1eb,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _1ec=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _1ed=_1d1.map(_1ec,function(item){return this.tree.getNodesByItem(item)[0];},this);_1ed=_1d1.filter(_1ed,Boolean);return _1d9(_1d1.map(_1ed,this.tree._expandNode,this));},_aroundPasteItem:function(_1ee){return function(_1ef,_1f0){if(_1f0.isWastebasket){return _1ee.apply(this.model,arguments);}var _1f1=this.get("selectedNode");if(!_1f1){return _1ee.apply(this.model,arguments);}_1f1.markProcessing();return _1ee.apply(this.model,arguments).then(function(){if(!_1f1.isExpanded){_1f1.expand();}}).always(function(){_1f1.unmarkProcessing();});}.bind(this);},checkItemAcceptance:function(_1f2,_1f3,_1f4){var _1f5=_1dc.getEnclosingWidget(_1f2),_1f6=_1f5&&_1f5.item;if(!_1f6){return false;}return this.model.checkItemAcceptance(_1f6,_1f3);},_setAllowManipulationAttr:function(_1f7){this._set("allowManipulation",_1f7);if(_1f7){this.dndController=this.dndSource||_1df;}},_createTreeModel:function(){return new _1e5({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_1f8){function _1f9(node,_1fa){_1d1.forEach(node.getChildren(),function(_1fb){_1fa.push(_1fb.item);_1f9(_1fb,_1fa);});return _1fa;};if(_1f8){var _1fc=this._itemNodesMap[this.model.getIdentity(item)];if(_1fc){_1d1.forEach(_1fc,function(_1fd){_1d1.forEach(_1f9(_1fd,[]).reverse(),function(_1fe){this._onItemDelete(_1fe);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_1ff){this._set("typeIdentifiers",_1ff);if(this.model){this.model.typeIdentifiers=_1ff;}},getTooltip:function(item){var _200=this.model.getTooltip||this.model.getLabel;var _201=new _1e1(item.contentLink),_202=_200?_200(item):this.inherited(arguments);return _202?_1e2.title(_202,_201.id,item.contentTypeName):_202;},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _203=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_203);},getIconClass:function(item,_204){if(!item){return this.inherited(arguments);}var _205=_1e0.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_205);}var _206=_1e0.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_204&&!item.isSubRoot&&_206){_205=_205+"Open";}return _205+this._getItemDisableStyle(item);},getLabelClass:function(item,_207){return this._getItemDisableStyle(item);},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getItemDisableStyle:function(item){if(this.disableRestrictedTypes){return this._isItemRestricted(item)?" is-disabled ":"";}return "";},_isItemRestricted:function(item){var _208=_1e0.getValidAcceptedTypes([item.typeIdentifier],this.allowedTypes,this.restrictedTypes);return !_208.length;},_getTargetPath:function(_209){var _20a=this.model,_20b=new _1d7();_20a.getAncestors(_209,function(_20c){_20c.push(_209);var _20d=_1d1.map(_20c,function(item){return _20a.getIdentity(item).toString();});if(typeof _20a.filterAncestors==="function"){_20d=_20a.filterAncestors(_20d);}_20b.resolve(_20d);});return _20b.promise;},_isValidTargetContent:function(_20e){if(!_20e){return false;}return !_20e.isDeleted&&!_20e.isWastebasket;},_onSelect:function(id,_20f,_210){var _211=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{selectedContent:_211});this.selectContent(id,_20f,true,_210).then(lang.hitch(this,function(){_211=this.get("selectedNode");if(_211&&_211.item&&_211.item.contentLink){this.emit("select",_211.item,_211);}}));},selectContent:function(_212,_213,_214,_215){var self=this,_216=self.model,_217=new _1d7(),_218=function(_219){self._preparePathNodes(_219);self._setRecursivePaths(_219,_217,_213,_215);};when(_216.store.get(_212),function(_21a){if(!self._isValidTargetContent(_21a)){self.set("paths",[]);_217.resolve(null);}else{self._getTargetPath(_21a).then(function(_21b){self._onSetTargetPath();_218(_21b);});}});return _217.promise;},_onSetTargetPath:function(){if(!this.handleSelection){return;}var _21c=this.get("selectedNode");if(_21c){_21c=this.getNodesByItem(_21c.item)[0];if(_21c){this.model.set("previousSelection",{selectedContent:_21c,selectedAncestors:_21c.getTreePath()});}}},_preparePathNodes:function(_21d){},_setRecursivePaths:function(_21e,_21f,_220,_221){if(!_21e||_21e.length===0){return;}this.set("paths",[_21e]).then(lang.hitch(this,function(){var _222=this.get("selectedNode");if(!_222){this._setRecursivePaths(_21e.slice(0,-1),_21f,_220,_221);return;}if(_220){this.focus();}if(_221){_221(_222);}_21f.resolve(_222);},_21f.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_1d2.isCopyKey(e)){var _223=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_223){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.metaKey){return;}if(e.shiftKey&&e.keyCode===keys.F10){this.emit("showContextMenu",e);e.preventDefault();return;}if(e.shiftKey){return;}if(e.keyCode===keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_1db("ie")){_1d1.forEach(_1da(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_1d4.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/declare","./multiDndSource"],function(_224,_225){return _224([_225],{singular:true,userSelect:function(node){this.inherited(arguments,[node,false,false]);}});});},"epi/shell/dnd/tree/multiDndSource":function(){define("epi/shell/dnd/tree/multiDndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin","epi/shell/TypeDescriptorManager"],function(_226,_227,_228,_229,_22a,_22b,lang,on,_22c,_22d,_22e,when,_22f,_230,_231){return _228([_22f,_230],{generateText:false,singular:false,constructor:function(){var _232=this.reject;if(_232){var _233=[];for(var key in this.accept){_233.push(key);}this.accept={};_233=_231.removeIntersectingTypes(_233,this.reject);_226.forEach(_233,function(_234){this.accept[_234]=1;},this);for(var i=0;i<_232.length;++i){this.accept[_232[i]]=0;}}var _235=_22e.manager();this._startDragHandle=_229.before(_235,"startDrag",this._beforeStartDrag.bind(this));},destroy:function(){this.inherited(arguments);this._startDragHandle.remove();delete this._startDragHandle;},_beforeStartDrag:function(_236,_237,copy){if(_236!==this){return arguments;}var _238=this.getSelectedTreeNodes();if(!_238.length){return arguments;}_238=_238.map(function(_239){return _239.domNode;});return [_236,_238,copy];},deleteSelectedNodes:function(){},onDndDrop:function(_23a,_23b,copy,_23c){if(this.containerState==="Over"){var tree=this.tree,_23d=tree.model,_23e=this.targetAnchor;this.isDragging=false;var _23f;var _240=(_23e&&_23e.item)||tree.item;if(this.dropPosition==="Before"||this.dropPosition==="After"){_240=(_23e.getParent()&&_23e.getParent().item)||tree.item;_23f=_23e.getIndexInParent();if(this.dropPosition==="After"){_23f=_23e.getIndexInParent()+1;}}var _241=this.itemCreator(_23b,_23e.rowNode,_23a,_23c);if(_23a===this){if(_23d.pasteItems){var _242=_241.map(function(item){if(item.dndData){return item.dndData.data;}return item;});_23d.pasteItems(_242,_240,copy,_23f);}else{_226.forEach(_241,function(item){if(item.dndData){var _243=item.dndData.options;var _244=_243?_243.oldParentItem:null;var _245=_243?_243.indexInParent:0;if(typeof _23f=="number"){if(_240===_244&&_245<_23f){_23f-=1;}}_23d.pasteItem(item.dndData.data,_244,_240,copy,_23f);}});}}else{if(_23d.newItems){_23d.newItems(_241,_240,_23f);}else{_226.forEach(_241,function(item){_23d.newItem(item,_240,_23f);});}}if(!_23a.isDragging&&!_23c.isDragging){this.onDndEnd();}}if(this===_23c&&_23a!==_23c&&!copy&&_23a.onDndItemRemoved){var _246=_226.map(_23b,function(node){return this._getDndData(_23a.getItem(node.id),this.accept,false);},this);_23a.onDndItemRemoved(_246,_23a,_23b,copy,_23c);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_247){this.inherited(arguments);var m=_22e.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,this.dropPosition.toLowerCase()),function(_248){m.canDrop(_248);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}.bind(this),500);}},onDndEnd:function(){},onDndItemRemoved:function(_249,_24a,_24b,copy,_24c){},itemCreator:function(_24d,_24e,_24f,_250){return _226.map(_24d,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_24f.getItem(node.id),this.accept,this===_24f)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _251=item.data.getParent();opts.oldParentItem=_251?_251.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _252=_22a.contains(e.target,"dojoDndContainerOver");var _253=_22a.contains(e.target,"dijitTreeContainer");if(_252||_253){return;}this.inherited(arguments);},onMouseUp:function(e){if(this.current){var id=this.current.id;if(!this.singular&&!e.shiftKey&&this.selection[id]&&_22a.contains(e.target,"epi-iconContextMenu")){this._doDeselect=false;}}this.inherited(arguments);},checkAcceptance:function(_254,_255){if(this.readOnly){return false;}var _256=_226.map(_255,function(node){return _254.getItem(node.id);});return this._checkAcceptanceForItems(_256,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_257,_258,_259,_25a,_25b,lang,on,_25c,_25d,_25e,_25f){var _260=_259("dijit.tree.dndSource",_25f,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_261){if(!_261){_261={};}lang.mixin(this,_261);var type=_261.accept instanceof Array?_261.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_25a.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_25a.add(this.node,"dojoDndTarget");}this.topics=[_25d.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_25d.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_25d.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_25d.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_262){return this.copyOnly||_262;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_263){var m=_25e.manager(),_264=this.targetAnchor,_265=this.current,_266=this.dropPosition;var _267="Over";if(_265&&this.betweenThreshold>0){if(!this.targetBox||_264!=_265){this.targetBox=_25b.position(_265.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_267="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_267="After";}}}if(_263||_265!=_264||_267!=_266){if(_264){this._removeItemClass(_264.rowNode,_266);}if(_265){this._addItemClass(_265.rowNode,_267);}if(!_265){m.canDrop(false);}else{if(_265==this.tree.rootNode&&_267!="Over"){m.canDrop(false);}else{var _268=false;if(m.source==this){for(var _269 in this.selection){var _26a=this.selection[_269];if(_26a.item===_265.item){_268=true;break;}}}if(_268){m.canDrop(false);}else{if(this.checkItemAcceptance(_265.rowNode,m.source,_267.toLowerCase())&&!this._isParentChildDrop(m.source,_265.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_265;this.dropPosition=_267;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_25e.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _26b=this.getSelectedTreeNodes();if(_26b.length){if(_26b.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_26b[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_26b=r;}_26b=_257.map(_26b,function(n){return n.domNode;});m.startDrag(this,_26b,this.copyState(_258.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_26c){if(this!=_26c){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_25e.manager();m.canDrop(false);}}},onDndStart:function(_26d,_26e,copy){if(this.isSource){this._changeState("Source",this==_26d?(copy?"Copied":"Moved"):"");}var _26f=this.checkAcceptance(_26d,_26e);this._changeState("Target",_26f?"":"Disabled");if(this==_26d){_25e.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_270){return _257.map(_270,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_271,_272,copy){if(this.containerState=="Over"){var tree=this.tree,_273=tree.model,_274=this.targetAnchor;this.isDragging=false;var _275;var _276;var _277;_275=(_274&&_274.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_275=(_274.getParent()&&_274.getParent().item)||tree.item;_276=_274.getIndexInParent();if(this.dropPosition=="After"){_276=_274.getIndexInParent()+1;_277=_274.getNextSibling()&&_274.getNextSibling().item;}else{_277=_274.item;}}else{_275=(_274&&_274.item)||tree.item;}var _278;_257.forEach(_272,function(node,idx){var _279=_271.getItem(node.id);if(_257.indexOf(_279.type,"treeNode")!=-1){var _27a=_279.data,_27b=_27a.item,_27c=_27a.getParent().item;}if(_271==this){if(typeof _276=="number"){if(_275==_27c&&_27a.getIndexInParent()<_276){_276-=1;}}_273.pasteItem(_27b,_27c,_275,copy,_276,_277);}else{if(_273.isItem(_27b)){_273.pasteItem(_27b,_27c,_275,copy,_276,_277);}else{if(!_278){_278=this.itemCreator(_272,_274.rowNode,_271);}_273.newItem(_278[idx],_275,_276,_277);}}},this);this.tree._expandNode(_274);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_25e.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_25e.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_27d,_27e){if(!_27d.tree||_27d.tree!=this.tree){return false;}var root=_27d.tree.domNode;var ids=_27d.selection;var node=_27e.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _260;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_27f,_280,lang,dom,_281,Tree){return _280(Tree,{dndParams:["accept","reject"].concat(Tree.prototype.dndParams),postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_282){var _283=this.model.getIdentity(_282),_284=this._itemNodesMap[_283];if(_284){if(_27f.some(_284,function(node){return node.state==="LOADED";})){this.model.getChildren(_282,lang.hitch(this,function(_285){_27f.forEach(_284,function(_286){_286.setChildItems(_285);});_27f.forEach(_285,function(_287){this.model.onChange(_287);this._onChildrenReload(_287);},this);}));}else{_27f.forEach(_284,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _288=null;if(_281.curNode&&dom.isDescendant(_281.curNode,this.domNode)){_288=_281.curNode;}this.inherited(arguments);if(_288){if(dom.isDescendant(_288,this.domNode)){_288.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","epi/string","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/i18n!epi/cms/nls/episerver.shared.header"],function(lang,_289,_28a,_28b,_28c,_28d,misc,_28e,_28f,_290,_291,_292){var _293={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_294){var _295="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _294?lang.replace(_295,[_294,new Date().getTime()]):"";},contentIcon:function(_296,_297){return misc.icon(_293.contentIconClass(_296,_297));},contentIconClass:function(_298,_299){var _29a=_28e.getValue(_298,"iconClass");var _29b=_29a+" epi-objectIcon";if(_299){_29b+=" "+_299;}return _29b;},contentTypeDescription:function(_29c){return _28e.getResourceValue(_29c,"name",false);},languageBranch:function(_29d){return _29d?"<span class=\"epi-missingLanguageIndicator\">"+_29d.language+"</span>":"";},menu:function(_29e){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_29e);},path:function(path,_29f){if(path&&path.length){_29f=_29f||{};var _2a0=path.join(" > ");var _2a1=_29f.skipEncode?_2a0:misc.attributeEncode(_2a0);path=_28c.truncateMiddle(path,40,"…");var text=path.map(function(_2a2){return _29f.skipEncode?_2a2:misc.htmlEncode(_2a2);}).join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");return lang.replace("<span class=\"{className} dojoxEllipsis\" title=\"{title}\">{text}</span>",{className:_29f.skipDefaultClass?"":"dgrid-column-treePath",title:_2a1,text:text});}return "";},userName:function(_2a3){return _28b.toUserFriendlyHtml(_2a3);},localizedDate:function(date){return _28a.toUserFriendlyHtml(date);},friendlyBoolean:function(_2a4){var _2a5=_2a4?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_2a5+"\" />";},versionStatus:function(_2a6){return _28f.getVersionStatus(_2a6);},commonDraft:function(item,_2a7,node){if(item.isCommonDraft){node.innerHTML="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\" title=\""+_291.primarydraft+"\"></span>";}node.innerHTML+=_293.versionStatus(_2a7);},visibleLink:function(_2a8,_2a9){if(!_2a8){return "";}var text=!_2a9?misc.htmlEncode(_2a8):_2a8;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_2aa,_2ab){if(!_2aa){return "";}var text=!_2ab?misc.htmlEncode(_2aa):_2aa;return "<span class=\"epi-secondaryText\">"+text+"</span>";},title:function(name,_2ac,_2ad){return name+", "+_292.id+": "+_2ac+" ("+_292.type+": "+_2ad+")";},contentItemFactory:function(_2ae,_2af,_2b0,_2b1,_2b2,_2b3,_2b4,_2b5){return function(_2b6,_2b7,node,_2b8){var _2b9,_2ba,text,_2bb,_2bc,_2bd,_2be,_2bf;function get(name){if(typeof _2b7.get==="function"){return _2b7.get(name);}return _2b7[name];};function _2c0(_2c1){if(_2c1){if(typeof _2c1==="function"){return _2c1(_2b7);}else{return get(_2c1);}}return _2b6;};_2bd=typeof _2b6==="string";_2ba=_2c0(_2b0||(_2bd?false:"typeIdentifier"));text=_2c0(_2ae||(_2bd?false:"text"));_2bb=_2c0(_2af||(_2bd?false:"title"));_2bc=(_2b3&&_2c0(_2b3))||_2b7.missingLanguageBranch;_2be=_2b2&&_2c0(_2b2);_2bf=_2b5?_2b7.status:null;_2b9=_293.contentItem(_2ba,_2bc,text,_2bb,_2b1,_2be,_2b4,_2bf);node.innerHTML=_2b9;if(node.nodeName!=="TD"&&_2bc){_289.add(node,"epi-ct-missingLanguageRow");}return _2b9;};},contentItem:function(_2c2,_2c3,text,_2c4,_2c5,_2c6,_2c7,_2c8){var menu=(_2c5&&_2c5.hasMenu)?_293.menu(_2c5.settings):"",_2c9=_293.languageBranch(_2c3);_2c7=(_2c7===null||_2c7===undefined)?true:_2c7;_2c4=_2c7?misc.attributeEncode(_2c4||text):(_2c4||text);text=_2c7?misc.htmlEncode(text):text;var _2ca="";if(_2c8){_2ca=_293._statusIcon(_2c8);}return (_2c6?_293.thumbnail(_2c6):_293.contentIcon(_2c2))+menu+_2ca+_2c9+misc.ellipsis(text,_2c4);},_statusIcon:function(_2cb){if(_2cb===_28f.versionStatus.Published){return "";}var _2cc=new _290({contentStatus:_2cb});var _2cd={cssClass:_2cc.statusIcon&&_2cc.statusIcon.join(" "),message:_2cc.statusMessage};return lang.replace("<span class=\"dijitIcon epi-statusIcon {cssClass}\" title=\"{message}\">&nbsp;</span>",_2cd);}};_28d.addFormatter("contentIcon",_293.contentIcon);_28d.addFormatter("userName",_293.userName);_28d.addFormatter("versionStatus",_293.versionStatus);_28d.addFormatter("localizedDate",_293.localizedDate);_28d.addFormatter("contentItem",_293.contentItemFactory,true);return _293;});},"epi/username":function(){define("epi/username",["dojox/html/entities","epi/dependency","epi/i18n!epi/shell/ui/nls/episerver.shared.text"],function(_2ce,_2cf,_2d0){return {toUserFriendlyString:function(_2d1,_2d2,_2d3,_2d4,_2d5){if(!_2d2){_2d2=this._getCurrentUsername();}var _2d6=_2d4?"":_2d0.installer,_2d7=_2d5?_2d0.yousubject:_2d0.youobject,_2d8=_2d1&&_2d2.toLowerCase()===_2d1.toLowerCase()?_2d7:_2d1||_2d6;if(_2d3){_2d8=_2d8.charAt(0).toUpperCase()+_2d8.slice(1);}return _2d8;},toUserFriendlyHtml:function(_2d9,_2da,_2db,_2dc,_2dd){var _2de=this.toUserFriendlyString(_2d9,_2da,_2db,_2dc,_2dd);if(_2de===""){return _2de;}return "<span class='epi-username'>"+_2ce.encode(_2de)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _2df=_2cf.resolve("epi.shell.Profile");this.currentUsername=_2df.get("userName");}return this.currentUsername;}};});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_2e0,_2e1,when,Grid,_2e2){var _2e3=_2e0(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _2e4;_2e1.forEach(this.subRows,function(_2e5){_2e1.forEach(_2e5,function(_2e6){_2e4=[];_2e1.forEach(_2e3.shorthands,function(_2e7){var _2e8=_2e6[_2e7],_2e9=_2e3.formatters[_2e7];if(_2e8){if(_2e9){_2e4.push(_2e9.isFactory?_2e9.handler(_2e8):_2e9.handler);}else{throw new Error("Formatter with key "+_2e7+" not found");}}});if(_2e6.formatters){this._findFormatters(_2e6.formatters,_2e4);}if(_2e4.length>0){_2e6=_2e2(_2e6,_2e4);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_2ea,row){return data;}];}}},renderRow:function(_2eb,_2ec){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_2ec]),data=this.field?_2eb[this.field]:_2eb,_2ed=this._resolvedFormatters,i=-1;function _2ee(_2ef){var _2f0=_2ed[i],_2f1;if(_2f0){row.innerHTML=_2ef;data=_2ef;}i++;if(_2ed.length>i){_2f0=_2ed[i];_2f1=_2f0(data,_2eb,row);when(_2f1,_2ee);}};if(_2ed.length>0){_2ee();}return row;},_findFormatters:function(_2f2,_2f3){_2f3=_2f3||[];_2e1.forEach(_2f2,function(_2f4){var type=typeof _2f4,item,_2f5;if(type==="string"){item=_2e3.formatters[_2f4];if(item){_2f5=item.isFactory?item.handler():item.handler;_2f5.allParameters=item.allParameters;}}else{if(type==="function"){_2f5=_2f4;}}if(_2f5){_2f3.push(_2f5);}else{throw new Error("Formatter with key "+_2f4+"not found");}});return _2f3;}});_2e3.formatters={};_2e3.shorthands=[];_2e3.addFormatter=function(name,_2f6,_2f7,_2f8){_2e3.formatters[name]={handler:_2f6,isFactory:!!_2f7};if(_2f8){_2e3.shorthands.push(name);}};return _2e3;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_2f9){return function(_2fa,_2fb){var _2fc=_2fa.renderCell;_2fa.formatters=_2fb||_2fa.formatters;if(_2fa.formatters&&_2fa.formatters.length>0){_2fa.renderCell=function(_2fd,_2fe,cell,_2ff){_2f9.forEach(_2fa.formatters,function(_300){_2fe=_300(_2fe,_2fd,cell,_2ff);});if(_2fe){cell.innerHTML=_2fe;}};}return _2fc?_2fc.call(_2fa):_2fa;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_301,lang,_302,_303,_304){var _305={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _302.encode(text);},attributeEncode:function(text){return _302.encode(text,_305._attributeEncodeMap);},ellipsis:function(text,_306){if(!_306||!lang.isString(_306)){_306=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_306,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_303.addFormatter("htmlEncode",_305.htmlEncode,false,true);_303.addFormatter("icon",function(icon){return function(_307){return _305.icon(icon,_307);};},true,true);_303.addFormatter("ellipsis",_305.ellipsis,false,true);_303.addFormatter("ellipsisNoTooltip",_305.ellipsisNoTooltip,false,true);return _305;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _308={},_309;if(res){_308={0:res.notcreated,1:res.rejected,2:res.checkedout,3:res.checkedin,4:res.published,5:res.previouslypublished,6:res.delayedpublish,7:res.awaitingapproval,100:res.expired};}_309={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,AwaitingApproval:7,Expired:100},versionLocalizations:_308,getVersionStatus:function(_30a){return this.versionLocalizations[_30a];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,RequestApproval:5,CheckOut:6,Schedule:7,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_30b,_30c,_30d,_30e,_30f){return _309.hasAccessToAction(_30b,_30c,_30d,_30e,_30f)&&_309.canPerformAction(_30b,_30c);},hasAccessToAction:function(_310,_311,_312,_313,_314){var _315;if(!_310){return false;}if(!_313&&_310.capabilities&&_310.capabilities.language&&_310.missingLanguageBranch&&_310.missingLanguageBranch.isTranslationNeeded){return false;}if(_312&&!_309.hasProviderCapability(_310.providerCapabilityMask,_312)){return false;}_315=_314?_310.accessRights:_310.accessMask;return _309.hasAccess(_315,_309.accessLevel[_311]);},canPerformAction:function(_316,_317){var _318=_316.status,_319=_309.versionStatus;if(_318===_319.DelayedPublish&&(_317===_309.action.Edit||_317===_309.action.Publish)){return false;}if(_317===_309.action.Publish){return !(_318===_319.Published||_318===_319.Expired);}if(_317===_309.action.CheckIn){return _318===_319.CheckedOut||_318===_319.Rejected;}if(_317===_309.action.Edit){var _31a=(_318===_319.Published&&!_316.isCommonDraft)||(_318===_319.Expired&&!_316.isCommonDraft)||_318===_319.PreviouslyPublished||(_318===_319.CheckedIn&&!_316.isPartOfAnotherProject)||_318===_319.DelayedPublish||_318===_319.AwaitingApproval;return !(_31a||_316.isDeleted||_316.isWastebasket);}return true;},hasAccess:function(_31b,_31c){return (_31b&_31c)===_31c;},hasLanguageAccess:function(item){if(!item){return false;}var _31d=item.languageContext||item.missingLanguageBranch||item;return !_31d||(_31d.hasTranslationAccess&&_31d.isPreferredLanguageAvailable);},getPermissionMap:function(_31e){var map={};for(var al in _309.accessLevel){map[al]=_309.hasAccess(_31e,_309.accessLevel[al]);}return map;},hasProviderCapability:function(_31f,_320){return (_31f&_320)===_320;}};return _309;});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_321,_322,_323,lang,when,all,_324,_325,_326,_327,_328,_329){return _322([_324,_327],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,contentLink:null,constructor:function(){this._statusIconMap={0:["epi-statusIndicatorIcon","epi-statusIndicator0"],1:["epi-statusIndicatorIcon","epi-statusIndicator1"],2:["epi-statusIndicatorIcon","epi-statusIndicator2"],3:["epi-statusIndicatorIcon","epi-statusIndicator3"],4:["epi-statusIndicatorIcon","epi-statusIndicator4"],5:["epi-statusIndicatorIcon","epi-statusIndicator5"],6:["epi-statusIndicatorIcon","epi-statusIndicator6"],7:["epi-statusIndicatorIcon","epi-statusIndicator7"],100:["epi-statusIndicatorIcon","epi-statusIndicator100"]};this._statusMessageMap={0:_329.notcreated,1:_329.rejected,2:_329.checkedout,3:_329.checkedin,4:_329.published,5:_329.previouslypublished,6:_329.delayedpublish,7:_329.awaitingapproval,100:_329.expired};},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_325.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_32a){if(_32a&&_32a.status!==undefined){this.set("content",_32a);}}));}));},_contentLinkSetter:function(_32b){if(!_32b){return;}this.contentLink=_32b;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_32c){this.content=_32c;this.set("contentStatus",_32c.status);},_contentStatusSetter:function(_32d){this.contentStatus=_32d;if(!_32d){return;}this.set("statusIcon",this._statusIconMap[_32d]);return when(this._getStatusMessage(),lang.hitch(this,function(_32e){return this.set("statusMessage",_32e);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _329.versionnotfound;}if(this.get("isTranslationNeeded")){return _328.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageMap[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _32f=this.get("missingLanguageBranch");if(this.get("isDeleted")||_32f&&_32f.reason===6){return false;}return this.get("contentStatus")===_326.versionStatus.Published;}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_330,_331,all,_332,_333){return {getMissingLanguageMessage:function(_334){if(!_334||!_334.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_332.resolve("epi.storeregistry").get("epi.cms.language");var def=new _331();var _335=_334.missingLanguageBranch;all([this._languageStore.get(_335.preferredLanguage),this._languageStore.get(_335.language)]).then(lang.hitch(this,function(_336){var _337=_335.reason;var _338="languagenotifications.";if(_337===6){_338+="missing";}else{if(_337===3||_337===5){_338+="replacement";}else{if(_337===4){_338+="fallback";}}}var _339=_333.getResourceValue(_334.typeIdentifier,_338);_339=lang.replace(_339,[_336[0].name,_336[1].name]);def.resolve(_339);}),function(){def.resolve("");});return def;}};});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_33a,_33b,_33c,_33d,Tree,_33e,_33f,_340,_341){return _33a([Tree._TreeNode,_33e,_340],{templateString:_341,buildRendering:function(){this.inherited(arguments);_33b.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _342=_33c.create("img",{src:item.thumbnailUrl+_33d.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_342);_33b.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _343=1;if("dojoxFFEllipsisDelay" in d.config){_343=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_343)){_343=1;}}try{var _344=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _345=document.createElementNS(sNS,"description");_345.setAttribute("crop","end");xml.appendChild(_345);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _346=d.create;var dd=d.doc;var dp=d.place;var _347=_346("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _348=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_348(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_348(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _349=r.endContainer.childNodes[r.endOffset-1];if(_349.nodeType==3){r.setEnd(_349,_349.length-1);}else{if(_349.childNodes.length){r.setEnd(_349,_349.childNodes.length);_348(r);return;}else{r.setEndBefore(_349);_348(r);return;}}}else{r.setEndBefore(r.endContainer);_348(r);return;}}}};var _34a=function(n){var c=_346("div",{className:"dojoxEllipsisContainer"});var e=_346("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_347.cloneNode(true);var ns=n.style;var es=e.style;var _34b;var _34c=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _34d=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_34d=Math.max(Math.round(e.textContent.length*pct)-1,1);}_348(r,_34d);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_34c;_34c();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_344&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_344(n);}else{_34a(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _34e=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_34e);},_343);};_34e();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_34f,_350){var _351={};lang.setObject("dojo.colors",_351);var _352=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_34f.fromRgb=function(_353,obj){var m=_353.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_350.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _34f.fromArray(a,obj);}return _34f.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_352(m1,m2,H+1/3)*256,_352(m1,m2,H)*256,_352(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _34f.fromArray(a,obj);}}return null;};var _354=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_34f.prototype.sanitize=function(){var t=this;t.r=Math.round(_354(t.r,0,255));t.g=Math.round(_354(t.g,0,255));t.b=Math.round(_354(t.b,0,255));t.a=_354(t.a,0,1);return this;};_351.makeGrey=_34f.makeGrey=function(g,a){return _34f.fromArray([g,g,g,a]);};lang.mixin(_34f.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _34f;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_355,lang,when,_356,_357,_358,_359){return _355(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicatorForItem:function(item){var _35a=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_35a.language||"";when(_359.getMissingLanguageMessage(item),lang.hitch(this,function(_35b){_356.set(this.iconNodeLanguage,"title",_35b||"");}));}_357.add(this.rowNode,this._missingLanguageCssClass);},_addLanguageIndicator:function(){this._addLanguageIndicatorForItem(this.item);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_358.empty(this.iconNodeLanguage);_356.remove(this.iconNodeLanguage,"title");}_357.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \r\n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/DialogService","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_35c,lang,_35d,_35e,_35f,when,json,_360,_361,_362,_363,_364,_365,_366,res,_367){return function(_368){var _369=function(_36a){return _36a&&typeof _36a=="function";};var _36b=function(_36c,_36d){_364.alert(_362.toHTML(_36c)).then(function(){if(_369(_36d)){_36d();}});};var _36e=function(_36f,_370){return when(_370).then(function(_371){return _364.confirmation({description:_362.toHTML(_371),title:_36f});});};var _372=function(_373,_374){when(_373,function(_375){if(_375&&(_375.message||_375.statusDescription)){var _376=_375.message||_375.statusDescription;_36b(_376,_374);}else{if(_369(_374)){_374();}}},function(e){_36b(_360.encode(json.fromJson(e.xhr.responseText)));});return _373;};var _377=function(_378,_379,copy,_37a,_37b,_37c){var _37d=_378[0],_37e=_378.length>1?"move.multiple.":"move.single.";var _37f=_378.every(function(_380){return _380.typeIdentifier===_37d.typeIdentifier;})?_37d.typeIdentifier:"episerver.core.icontentdata";var _381=_363.getResourceValue(_37f,_37e+"title");var _382=null;if(_379.isWastebasket){_382=_366({contentItems:_378});}else{if(_37a!==undefined&&(_379.properties.pageChildOrderRule!==_365.sortOrder.Index)){var _383,_384;if(copy){_37e=_378.length>1?"copy.multiple.":"copy.single.";_384=_363.getResourceValue(_37f,_37e+"title");_383=_35f.substitute(res.changepeerorderconfirmationcopy,[_368.getLabel(_379)]);}else{_384=_381;_383=_35f.substitute(res.changepeerorderconfirmation,[_368.getLabel(_379)]);}_382=_36e(_384,_383);}else{if(!copy){if(_378.some(function(item){return !_368.canCut(item);})){_36b(_363.getResourceValue(_37f,"moverequiresdeleteaccess"),function(){return false;});return false;}var _385="{0}<br/><br/>{1}",_386=lang.replace(_363.getResourceValue(_37f,_37e+"confirmation"),[_378.length]),_387=lang.replace(_385,[_386,_363.getResourceValue(_37f,"movedescription")]);var _388=_361.resolve("epi.cms.ProjectService");if(_388.isProjectModeEnabled){_387=lang.replace(_385,[_387,_367.moveconfirmation]);}_382=_36e(_381,_387);}else{if(!_368.canCopy(_37d)){_36b(_363.getResourceValue(_37f,"copynotsupported"));return false;}}}}return when(_382,function(){return _37b.apply(_368,_37c);},function(){return false;});};_35d.around(_368,"pasteItem",function(_389){return function(_38a,_38b,_38c,copy,_38d){return _377([_38a],_38c,copy,_38d,_389,arguments);};});_35d.around(_368,"pasteItems",function(_38e){return function(_38f,_390,copy,_391){return _377(_38f,_390,copy,_391,_38e,arguments);};});_35d.after(_368,"pasteItem",function(_392){return _392&&_372(_392);});_35d.after(_368,"remove",function(_393){return _393&&_372(_393);});return _368;};});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojox/html/entities","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_394,_395,epi,_396,_397,_398,_399,_39a){var _39b=function(_39c){var _39d=new _394(),_39e=_39c.contentItems,_39f=_39e[0],_3a0=new _398({target:document.body,zIndex:999}).placeAt(document.body);_3a0.show(50,0);var mode=_39c.mode||_39b.mode.confirm,_3a1=mode===_39b.mode.confirm,_3a2=new _399({contentItems:_39e,mode:mode});var _3a3=_3a2.watch("numberOfReferences",function(_3a4,_3a5,_3a6){_3a3.remove();var _3a7=_39e.length===1;var _3a8;var _3a9=_3a7?"movetotrashsingleitemdescription":"movetotrashdescription";if(_3a1){_3a8=_396.getResourceValue(_39f.typeIdentifier,_3a9);_3a8=lang.replace(_3a8,[_3a7?_395.encode(_39f.name):_39e.length]);}else{_3a8=_396.getResourceValue(_39f.typeIdentifier,"referencesdescription");_3a8=lang.replace(_3a8,[_395.encode(_39f.name)]);}var _3aa=_39c.title;if(!_3aa){var _3ab=_3a1?(_3a7?"movetotrashsingleitem":"movetotrash"):"references";_3aa=_396.getResourceValue(_39f.typeIdentifier,_3ab);}var _3ac=new _397({focusActionsOnLoad:true,defaultActionsVisible:_3a1,dialogClass:"epi-dialog-contentReferences",title:_3aa,description:_3a8,cancelActionText:epi.resources.action.cancel,confirmActionText:_3a6===0?_39a.buttons.movetotrash:_39a.buttons.movetotrashanyway,setFocusOnConfirmButton:_3a6===0});if(!_3a1){_3ac.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_3ac.onCancel});}_3ac.connect(_3ac,"onExecute",_39d.resolve);_3ac.connect(_3ac,"onCancel",_39d.cancel);_3ac.set("content",_3a2);var _3ad=_3a2.on("viewReference",function(){_3ac.hide();_3ad.remove();});_3a0.hide();var _3ae=_3a2.grid.on("dgrid-refresh-complete",function(){_3ae.remove();_3ac.show();}.bind(this));});_3a2.startup();return _39d.promise;};_39b.mode={confirm:"confirm",show:"show"};return _39b;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/dependency","dgrid/tree","./_GridWidgetBase","./viewmodel/ContentReferencesViewModel","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_3af,lang,_3b0,_3b1,_3b2,keys,when,_3b3,_3b4,tree,_3b5,_3b6,_3b7,_3b8,_3b9,_3ba,_3bb,_3bc){return _3af([_3b5,_3b7,_3b8,_3b9,_3ba],{res:_3bc,templateString:_3bb,storeKeyName:"epi.cms.referenced-content",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,modelBindingMap:{notification:["notification"],notificationBarStyle:["notificationBarStyle"],numberOfReferences:["numberOfReferences"],showToolbar:["showToolbar"],showGrid:["showGrid"],totalLinks:["totalLinks"]},constructor:function(_3bd){this.model=lang.mixin(new _3b6(),_3bd);this.own(this.model);},_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_3be){switch(_3be){case 1:_3b0.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_3b0.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setShowToolbarAttr:function(_3bf){_3b2.set(this.captionPanelNode,"display",_3bf?"":"none");},_setShowGridAttr:function(_3c0){_3b2.set(this.grid.domNode,"visibility",_3c0?"visible":"hidden");},postMixInProperties:function(){this.inherited(arguments);this.store=this.model.getUpdatedStore(this.store);},buildRendering:function(){var _3c1=this._getLinkTemplate();var _3c2=lang.mixin({columns:{name:tree({renderCell:lang.hitch(this,"_renderContentItem"),shouldExpand:function(){return true;}}),language:{className:"epi-width10",renderCell:function(obj,_3c3,node){if(!_3c3){return;}when(_3b4.resolve("epi.shell.Profile").getContentLanguage(),function(_3c4){if(_3c3!==_3c4){node.textContent=_3c3;}});}},treePath:{className:"epi-width50",formatter:function(_3c5){return _3b3.path(_3c5,{skipEncode:true,skipDefaultClass:true});}},uri:{className:"epi-width10",label:" ",formatter:function(_3c6){return _3c6?_3c1:"";},sortable:false}},store:this.store,query:{ids:this.model.contentItems.map(function(_3c7){return _3c7.contentLink;})},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_3c2,this.gridNode);_3b0.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode==="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-uri a:click",lang.hitch(this,"_onChangeContext"));},fetchData:function(){this.grid.refresh();},_onChangeContext:function(e){var row=this.grid.row(e),_3c8={uri:row.data.uri};if(_3c8.uri){this._requestNewContext(_3c8,{sender:this});this.emit("viewReference");}},_getLinkTemplate:function(){var node=_3b1.create("a",{"class":"epi-visibleLink",innerHTML:_3bc.view.label,title:_3bc.view.tooltip});return node.outerHTML;}});});},"dgrid/tree":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_3c9,_3ca,_3cb,_3cc,on,_3cd,has,Grid,_3ce,put){function _3cf(_3d0,_3d1,_3d2,_3d3){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_3d1){cls+=".ui-icon.ui-icon-triangle-1-"+(_3d2?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(_3d0*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _3d4(_3d5){var _3d6=this,_3d7=this.style.height;if(_3d7){this.style.display=_3d7=="0px"?"none":"block";}if(_3d5){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_3d6,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_3d8){var _3d9=_3d8.renderCell||Grid.defaultRenderCell;var _3da,_3db;if(!_3d8){_3d8={};}_3d8.shouldExpand=_3d8.shouldExpand||function(row,_3dc,_3dd){return _3dd;};_3cd.after(_3d8,"init",function(){var grid=_3d8.grid,_3de=".dgrid-content .dgrid-column-"+_3d8.id,_3df=[];grid.cleanEmptyObservers=false;if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_3d8.renderExpando){_3d8.renderExpando=_3cf;}_3df.push(grid.on(_3d8.expandOn||".dgrid-expando-icon:click,"+_3de+":dblclick,"+_3de+":keydown",function(_3e0){var row=grid.row(_3e0);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(_3e0.type!="keydown"||_3e0.keyCode==32)&&!(_3e0.type=="dblclick"&&_3db&&_3db.count>1&&row.id==_3db.id&&_3e0.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(_3e0.target.className.indexOf("dgrid-expando-icon")>-1){if(_3db&&_3db.id==grid.row(_3e0).id){_3db.count++;}else{_3db={id:grid.row(_3e0).id,count:1};}}}));if(has("touch")){_3df.push(grid.on(_3ce.selector(_3de,_3ce.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_3df.push(_3cd.after(grid,"insertRow",function(_3e1){var row=this.row(_3e1),_3e2=_3d8.shouldExpand(row,_3da,this._expanded[row.id]);if(_3e2){this.expand(_3e1,true,true);}return _3e1;}));_3df.push(_3cd.before(grid,"removeRow",function(_3e3,_3e4){var _3e5=_3e3.connected;if(_3e5){_3cc(">.dgrid-row",_3e5).forEach(function(_3e6){grid.removeRow(_3e6,true);});if(!_3e4){put(_3e5,"!");}}}));if(_3d8.collapseOnRefresh){_3df.push(_3cd.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_3e7){var _3e8=_3e7.connected;return _3e7.offsetHeight+(_3e8?_3e8.offsetHeight:0);};grid.expand=function(_3e9,_3ea,_3eb){var row=_3e9.element?_3e9:grid.row(_3e9),_3ec=has("transitionend"),dfd=new _3cb(),_3ed=dfd.promise;dfd.resolve();_3e9=row.element;_3e9=_3e9.className.indexOf("dgrid-expando-icon")>-1?_3e9:_3cc(".dgrid-expando-icon",_3e9)[0];_3eb=_3eb||_3d8.enableTransitions===false;if(_3e9&&_3e9.mayHaveChildren&&(_3eb||_3ea!==!!this._expanded[row.id])){var _3ee=_3ea===undefined?!this._expanded[row.id]:_3ea;put(_3e9,".ui-icon-triangle-1-"+(_3ee?"se":"e")+"!ui-icon-triangle-1-"+(_3ee?"e":"se"));var _3ef=row.element,_3f0=_3ef.connected,_3f1,_3f2,_3f3={originalQuery:this.query};if(!_3f0){_3f0=_3f3.container=_3ef.connected=put(_3ef,"+div.dgrid-tree-container");var _3f4=function(_3f5){return grid.store.getChildren(row.data,_3f5);};if(_3d8.allowDuplicates){_3f3.parentId=row.id;}if("level" in _3e9){_3f4.level=_3e9.level;}_3ed=_3ed.then(function(){if(grid.renderQuery){return grid.renderQuery(_3f4,_3f3);}var _3f6=put(_3f0,"div");var rows=grid.renderArray(_3f4(_3f3),_3f6,"level" in _3f4?{queryLevel:_3f4.level}:{});_3cb.when(rows,function(){put(_3f6,"!");});return rows;});if(_3ec){on(_3f0,_3ec,_3d4);}else{_3d4.call(_3f0);}}_3f0.hidden=!_3ee;_3f1=_3f0.style;if(!_3ec||_3eb){_3f1.display=_3ee?"block":"none";_3f1.height="";}else{if(_3ee){_3f1.display="block";_3f2=_3f0.scrollHeight;_3f1.height="0px";}else{put(_3f0,".dgrid-tree-resetting");_3f1.height=_3f0.scrollHeight+"px";}setTimeout(function(){put(_3f0,"!dgrid-tree-resetting");_3f1.height=_3ee?(_3f2?_3f2+"px":"auto"):"0px";});}if(_3ee){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}return _3ed;};_3cd.after(_3d8,"destroy",function(){_3ca.forEach(_3df,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_3d8.renderCell=function(_3f7,_3f8,td,_3f9){var grid=_3d8.grid,_3fa=Number(_3f9&&_3f9.queryLevel)+1,_3fb=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_3f7),_3fc=_3f9.parentId,_3fd,node;_3fa=_3da=isNaN(_3fa)?0:_3fa;_3fd=_3d8.renderExpando(_3fa,_3fb,grid._expanded[(_3fc?_3fc+"-":"")+grid.store.getIdentity(_3f7)],_3f7);_3fd.level=_3fa;_3fd.mayHaveChildren=_3fb;node=_3d9.call(_3d8,_3f7,_3f8,td,_3f9);if(node&&node.nodeType){put(td,_3fd);put(td,node);}else{td.insertBefore(_3fd,td.firstChild);}};return _3d8;};tree.defaultRenderExpando=_3cf;return tree;});},"epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_3fe,lang,_3ff,_400,keys,_401,when,_402,_403,_404,_405,epi,_406,_407,_408,_409,_40a,_40b,_40c,DnD,_40d,_40e,_40f){return _3fe([_405,_40b],{_gridClass:_3fe([_403,_409,_404,DnD,_402,_40e]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",forceContextReload:false,selectionMode:"single",selection:null,postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:this.get("selectionMode"),dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _410=_40f.resolve("epi.storeregistry");this.store=_410.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _411=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_411);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_411);this.grid.addKeyHandler(keys.SPACE,_411);}}this.grid.on("dgrid-select, dgrid-deselect",lang.hitch(this,"_onSelectionChanged"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_3ff.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){var _412=(item instanceof _40c?item:new _40c(item.id)).createVersionUnspecificReference().toString();this.grid.select(_412);}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){this._onChangeContextInternal(e);},_onChangeContextInternal:function(e){var row=this.grid.row(e),uri=row.data.uri,_413={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_413,{sender:this,forceReload:this.forceContextReload});},_onSelectionChanged:function(e){var _414=[];for(var id in this.grid.selection){if(this.grid.selection[id]){var row=this.grid.row(id);_414.push(row.data);}}this.set("selection",_414);this.emit("selectionChanged",{selection:_414});this._onSelect(e);},_onSelect:function(e){},_onError:function(e){var _415=this.grid.errorMessage;var _416=e.error;if(_416.status&&_416.status===403){_415=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_415);},_requestNewContext:function(_417,_418){_401.publish("/epi/shell/context/request",_417,_418);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_419){var _41a=row.data.uri;return _419&&this._compareUris(_41a,_419.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_41b){if(_41b){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_41c,_41d){this.inherited(arguments);if(_41c.type!=="epi.cms.contentdata"){return;}if(!_41d||_41d.sender!==this){this.onContextChanged(_41c);}},onContextChanged:function(_41e){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_41f){this.grid.cleanup();this.grid.contentNode.innerHTML=_41f||"";},contextChangeFailed:function(_420,_421,_422){this.inherited(arguments);if(_422&&_422.sender===this){this._selectActiveItem();}},_renderContentItem:function(_423,_424,node,_425){node.innerHTML=_40d.contentItem(_423.typeIdentifier,_423.missingLanguageBranch,_424);},_localizeDate:function(_426){return _40d.localizedDate(_426);},_createUserFriendlyUsername:function(name){return _40d.userName(name);},_dndNodeCreator:function(item,hint){var _427=_40a.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_427&&this.dndTypes){_427=this.dndTypes;}var node=_400.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_427,data:item};},_aroundInsertRow:function(_428){return lang.hitch(this,function(_429,_42a,_42b,i,_42c){var row=_428.apply(this.grid,arguments);var _42d=this.get("currentItem");if(_42d){var _42e=(_42d instanceof _40c?_42d:new _40c(_42d.id)).createVersionUnspecificReference().toString();if(_42e===_429.contentLink){this.select(_42d);}}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_42f){return {id:_40c.tryConvert(_42f.id,_42f).id};});},_setSelectionModeAttr:function(_430){if(this.grid){this.grid.set("selectionMode",_430);}this._set("selectionMode",_430);}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_431,lang,_432,_433,_434,_435,_436,put){var _437=_431(_433,{_legalMouseDown:function(evt){var _438=this.inherited(arguments);return _438&&evt.target!==this.grid.bodyNode;},getSelectedNodes:function(){var grid=this.grid;var _439=this.inherited(arguments);if(!grid.selection||Object.keys(grid.selection).length===0){if(_439.length){grid.select(_439[0]);}return _439;}var _43a=false;var _43b=new _432();for(var id in grid.selection){if(grid.row(id).element!==_439[0]){_43b.push(grid.row(id).element);}else{_43a=true;_43b.push(_439[0]);}}if(_43a){return _43b;}grid.clearSelection();if(_439.length){grid.select(_439[0]);}return _439;},destroy:function(){this.grid=null;this.inherited(arguments);}});return _431([],{dndSourceTypes:null,dndParams:null,dndConstructor:_437,dndDisabled:false,dndFormatSuffix:null,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},destroy:function(){this.inherited(arguments);this.dndSource&&this.dndSource.destroy();this.dndParams=this.dndSource=null;},insertRow:function(_43c){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_43c,type:this._getDndType(_43c),options:opts});return row;},_getDndType:function(_43d){var _43e=_436.getAndConcatenateValues(_43d.typeIdentifier,"dndTypes");if((!_43e||_43e.length<=0)&&this.dndSourceTypes){_43e=this.dndSourceTypes;}if(this.dndFormatSuffix){_43e=_43e.map(lang.hitch(this,function(type){return type+"."+this.dndFormatSuffix;}));}return _43e;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new this.dndConstructor(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _43f,node;_43f=this._getDndType(item);if(!_43f&&this.dndTypes){_43f=this.dndTypes;}node=_434.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_43f,data:item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/query","dgrid/extensions/DijitRegistry","epi/shell/DestroyableByKey","epi/shell/widget/ContextMenu","epi-cms/extension/events"],function(_440,_441,_442,_443,on,_444,_445,_446,_447,_448){return _440([_446,_445],{contextMenu:null,commandCategory:"context",stopPropagation:false,_contextMenuClass:"epi-iconContextMenu",postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _447({category:this.commandCategory,popupParent:this});this.own(this.contextMenu,this.on("."+this._contextMenuClass+":click",this._contextMouseHandler.bind(this)),this.on(on.selector(".dgrid-row",_448.keys.shiftf10),this._contextKeyHandler.bind(this)));},startup:function(){this.inherited(arguments);this.contextMenu.startup();},onContextMenuClick:function(e){if(this.selection){this.select(e.target);}on.emit(e.target,"dgrid-contextmenu",{bubbles:true});this.contextMenu.scheduleOpen(this.domNode,null,{x:e.pageX,y:e.pageY});},_extendedSelectionHandler:function(e,_449){var _44a=new RegExp("\\b"+this._contextMenuClass+"\\b");if(_44a.test(e.target.className)&&this.isSelected(_449)){return;}this.inherited(arguments);},_isNodeVisible:function(_44b){if(!_44b){return false;}var _44c=_443.get(_44b);return _44c.display!=="none"&&_44c.visibility!=="hidden";},_contextMouseHandler:function(e){if(this.stopPropagation){e.stopImmediatePropagation();e.stopPropagation();}this.onContextMenuClick(e);},_contextKeyHandler:function(e){var _44d=_444("."+this._contextMenuClass,e.target)[0],_44e;if(!this._isNodeVisible(_44d)){return;}e.stopPropagation();e.preventDefault();_44e=_442.position(_44d);this.onContextMenuClick({target:_44d,pageX:_44e.x,pageY:_44e.y});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dojo/aspect","dojo/dom-geometry","dijit/Menu","dijit/popup","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_44f,_450,_451,Menu,_452,_453,_454,_455,_456){var _457;_450.before(_452,"open",function(args){var _458=args.popup;if(_458&&_458 instanceof _457&&_458.popupParent){args.parent=_458.popupParent;return [args];}});return _457=_44f([Menu,_453],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _459={builder:new _455(),target:this,category:this.category},_45a;var _45b=[_459,{builder:new _456(),target:this,category:"menuWithSeparator"},{builder:new _455(),target:this,category:"popup"}];_45a=new _454({configuration:_45b,commandSource:this});_45a.build();},scheduleOpen:function(_45c,_45d,_45e,_45f){this._scheduleOpen(_45c,_45d,_45e,_45f);},forceOpen:function(e){if(!e.target||!e.target.parentElement){return;}var _460=e.target.parentElement.querySelector(".epi-iconContextMenu");if(!_460){return;}e.stopPropagation();e.preventDefault();var _461=_451.position(_460);this.scheduleOpen(_460,null,{x:_461.x,y:_461.y});}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_462,_463,lang,on,_464,_465){return _463([_465],{_addToContainer:function(_466,_467){this.inherited(arguments,[_466,_467]);var _468=new _464({_command:{order:_466._command.order}});this.inherited(arguments,[_468,_467]);},_onBeforeChildDestroy:function(_469,_46a){var _46b=this._getChildren(_469);if(_46a<_46b.length-1){var _46c=_46b[_46a+1];if(_469&&_469.declaredClass){_469.removeChild(_46c);}_46c.destroy();}}});});},"epi-cms/extension/events":function(){define(["dojo/keys","dojo/on"],function(keys,on){function _46d(e){return e.keyCode===keys.DELETE;};function _46e(e){return e.shiftKey;};function _46f(e){return e.keyCode===keys.F10;};function _470(e){return _46e(e)&&_46f(e);};function _471(type,_472){var _473=function(node,_474){return on(node,type,function(evt){if(_472){return _472(evt,_474);}return _474.call(this,evt);});};return _473;};return {selector:on.selector,contextmenu:_471("contextmenu",function(e,_475){_475.call(this,e);}),keys:{shiftf10:_471("keyup",function(e,_476){if(_470(e)){_476.call(this,e);}}),del:_471("keydown",function(e,_477){if(_46d(e)){_477.call(this,e);}})}};});},"epi-cms/widget/viewmodel/ContentReferencesViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/store/util/QueryResults","dojo/when","epi/shell/TypeDescriptorManager","dojo/Stateful","dijit/Destroyable","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(_478,lang,_479,_47a,when,_47b,_47c,_47d,_47e){return _478([_47c,_47d],{contentItems:null,mode:null,notification:null,notificationBarStyle:null,numberOfReferences:null,showToolbar:null,showGrid:null,totalLinks:null,getUpdatedStore:function(_47f){var _480=lang.delegate(_47f,{getChildren:function(_481){return new _47a(_481.references);},mayHaveChildren:function(_482){return !!_482.references&&_482.references.length>0;}});this.own(_479.after(_480,"query",function(_483){when(_483).then(this._afterStoreQuery.bind(this));return _483;}.bind(this)));return _480;},_afterStoreQuery:function(_484){var _485=this._getReferencesCount(_484);this._updateReferenceProperties(_485);this.set("showToolbar",_485>0);this.set("showGrid",_485>0);},_getReferencesCount:function(_486){return _486.reduce(function(_487,_488){return _487+_488.references.length;},0);},_updateReferenceProperties:function(_489){var _48a=this.contentItems,_48b=_48a[0],_48c=_489>0,_48d=_48a.length===1,_48e=_48a.some(function(item){return item.hasChildren;}),_48f=_48a.some(function(item){return !!item.publicUrl;});var _490=function(_491,_492){_491="reference."+(_48d?"single":"multiple")+"."+_491;var text=_47b.getResourceValue(_48b.typeIdentifier,_491);this.set("notification",text);this.set("notificationBarStyle",_492);}.bind(this);if(_48c){_490(_48e?"usedwithchildren":"used",2);}else{if(_48f){_490(_48e?"publicwithchildren":"public",2);}else{_490(_48e?"notusedwithchildren":"notused",_48e?2:1);}}if(_48c){var _493=_489===1?_47e.totallink:_47e.totallinks;var _494=lang.replace(_493,[_489]);this.set("totalLinks",_494);}this.set("numberOfReferences",_489);}});});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:fetchData\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi/epi","epi-cms/widget/ContentTreeStoreModel"],function(_495,_496,lang,_497,when,epi,_498){return _496([_498],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_499){var _49a=this.inherited(arguments);return _49a||!!(_499&&this.roots&&(_495.indexOf(this.roots,this.getIdentity(_499))>=0));},getRoot:function(_49b){_49b(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_49c,_49d,_49e){if(_49c===this.root){var _49f=_495.map(this.roots,function(item){return this.store.get(item);},this);when(_497(_49f),_49d,_49e);}else{this.inherited(arguments);}},getAncestors:function(item,_4a0){if(this.roots.some(function(_4a1){return this.getIdentity(item)===_4a1;},this)){_4a0([this.root]);return;}var root=this.root,_4a2=lang.hitch(this,function(_4a3){if(_495.some(this.roots,function(_4a4){return this.getIdentity(_4a3[0])===_4a4;},this)){_4a3.unshift(root);}_4a0(_4a3);});this.inherited(arguments,[item,_4a2]);},getIdentity:function(item){return epi.areEqual(item,this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_4a5,_4a6,_4a7,lang,_4a8,_4a9,_4aa,_4ab,when,_4ac,epi,_4ad,_4ae,_4af,_4b0,_4b1,_4b2,_4b3,_4b4,_4b5){return _4a7([_4a8,_4b4,_4b5,_4af],{store:null,service:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,autoSelectPastedItem:true,constructor:function(args){_4a7.safeMixin(this,args);this._observers={};this.store=this.store||_4ad.resolve("epi.storeregistry").get(this._defaultDataStoreName);this.service=this.service||_4ad.resolve("epi.cms.ContentHierarchyService");this._queryOptions=lang.mixin({ignore:["query"],comparers:{typeIdentifiers:lang.hitch(this,function(_4b6,_4b7){return _4a5.some(_4b6,lang.hitch(this,function(item){return item===_4b7.typeIdentifier||_4ae.isBaseTypeIdentifier(_4b7.typeIdentifier,item);}));}),referenceId:function(_4b8,_4b9){return _4b3.compareIgnoreVersion(_4b8,_4b9.parentLink);},allLanguages:function(_4ba,_4bb){if(_4ba||!_4bb.currentLanguageBranch){return true;}return epi.areEqual(_4b1.currentContentLanguage,_4bb.currentLanguageBranch.languageId);},references:function(_4bc,_4bd){return _4bc.some(function(_4be){return _4b3.compareIgnoreVersion(_4be,_4bd.parentLink);});}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _4bf=_4a6.subscribe("/epi/cms/contentdata/updated",this,function(_4c0){var _4c1=new _4b3(_4c0.contentLink).createVersionUnspecificReference().toString();this.store.refresh(_4c1).then(lang.hitch(this,function(){if(_4c0.recursive){this.onItemChildrenReload(_4c0);}}));});var _4c2=_4a6.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _4c3=_4a9.after(this.store,"notify",lang.hitch(this,function(item,id){this.onChange(item);}),true);this._handles=[_4bf,_4c2,_4c3];},destroy:function(){for(var id in this._observers){if(this._observers[id]){this._observers[id].remove();this._observers[id]=null;}}if(this._handles){_4a5.forEach(this._handles,function(_4c4){_4c4.remove();});this._handles=null;}},isSupportedType:function(_4c5){return _4a5.some(this.typeIdentifiers,function(type){return type===_4c5||_4ae.isBaseTypeIdentifier(_4c5,type);});},_showAllLanguagesSetter:function(_4c6){this.showAllLanguages=_4c6;this.onItemChildrenReload(this.root);},getRoot:function(_4c7,_4c8){if(lang.isArray(this.root)){_4c7({});}else{when(this.store.get(this.root),_4c7,_4c8);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_4c9,_4ca){var id=this.getIdentity(_4c9),_4cb=this._observers[id],_4cc=id===this.root,_4cd=_4cc&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_4ce=this._createQuery({referenceId:id,query:_4cd}),_4cf=this.store.query(_4ce,this._queryOptions);if(_4cb){_4cb.remove();delete this._observers[id];}this._observers[id]=_4cf.observe(function(item,_4d0,_4d1){when(this.store.query(_4ce,this._queryOptions),this.onChildrenChange.bind(this,_4c9));}.bind(this),true);when(_4cf,_4ca);},_getSortSettings:function(_4d2){if(!_4d2){return {};}if(_4d2 instanceof String){_4d2=[_4d2];}var _4d3,_4d4=[];_4d2.map(function(type){_4d3=_4ae.getValue(type,"sortKey");if(_4d3){_4d4.push(_4d3.sortDescending?{attribute:_4d3.columnName,descending:true}:{attribute:_4d3.columnName});}});return _4d4;},_createQuery:function(_4d5,_4d6){var _4d7=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _4d8=this.showAllLanguages?{allLanguages:true}:{},_4d9=_4d6?{}:{typeIdentifiers:_4d7};var _4da=lang.mixin(_4d5,_4d9,_4d8);return _4da;},_createChildrenQuery:function(_4db,_4dc){var _4dd=lang.mixin(_4db,{query:"getchildren"});return this._createQuery(_4dd,_4dc);},move:function(_4de,_4df){var _4e0=_4de.map(function(item){return item.data;});return this.pasteItems(_4e0,_4df,false);},remove:function(_4e1){_4e1=_4e1.map(function(item){return item.data;});var _4e2=_4e1.map(function(item){return this.store.remove(item.contentLink);},this);return _4ab(_4e2).then(lang.hitch(this,function(){this.onDeleted(_4e1);}));},copy:function(_4e3,_4e4){var _4e5=_4e3.map(function(item){return item.data;});return this.pasteItems(_4e5,_4e4,true);},pasteItems:function(_4e6,_4e7,copy,_4e8){var _4e9=copy?"copy":"move",ids,_4ea=[],_4eb;ids=_4e6.map(this.getIdentity,this);return when(this.getCurrentContext()).then(function(ctx){return this._isNodeAContextAncestor(ids,ctx).then(function(_4ec){_4eb=_4ec;return _4ec;});}.bind(this)).then(function(){return this.service[_4e9](ids,this.getIdentity(_4e7),this.createAsLocalAsset,_4e8);}.bind(this)).then(function(_4ed){return _4ab(_4e6.map(function(item){var _4ee=_4ed.extraInformation[item.contentLink].extraInformation||item.contentLink;var _4ef=_4b3.toContentReference(_4ee).createVersionUnspecificReference().toString();return this.store.get(_4ef);},this));}.bind(this)).then(function(_4f0){if(_4e7.isWastebasket){this._handleSelect(_4e6,_4eb);}else{_4ac.publish("/epi/cms/contentdata/childrenchanged",_4e7.contentLink);var _4f1=[];_4e6.forEach(function(_4f2){if(_4f1.indexOf(_4f2.parentLink)===-1){_4ac.publish("/epi/cms/contentdata/childrenchanged",_4f2.parentLink);_4f1.push(_4f2.parentLink);}});}this._handleDelete(_4f0);_4f0.forEach(function(item){this._onPasteComplete(item,item.isDeleted,null,_4e7);},this);_4ea=_4f0.filter(function(item){return _4e6.some(function(_4f3){return (_4f3.contentLink===item.contentLink)&&(_4f3.parentLink===item.parentLink);});});if(this.createAsLocalAsset===true){_4ac.publish("/epi/cms/action/createlocalasset");}}.bind(this)).then(function(){if(_4ea.length>0){this.onPasteItemsFailed(_4ea);}}.bind(this));},pasteItem:function(_4f4,_4f5,_4f6,copy,_4f7){return this.pasteItems([_4f4],_4f6,copy,_4f7).then(function(_4f8){return _4f8.extraInformation[_4f4.contentLink];});},onPasteComplete:function(){},_onPasteComplete:function(item,_4f9,_4fa,_4fb){this.onPasteComplete();this._selectItemOnPasteComplete(item,_4f9,_4fa,_4fb);},_selectItemOnPasteComplete:function(item,_4fc,_4fd,_4fe){if(this.autoSelectPastedItem&&item&&item.contentLink&&!_4fc){this.onSelect(item.contentLink,true);}},newItem:function(item,_4ff){this.newItems([item],_4ff);},newItems:function(_500,_501){var _502=_500.map(function(item){return item.dndData.data;});this._pasteNewItems(_502,_501);},_pasteNewItems:function(_503,_504){this.pasteItems(_503,_504,false);},_updateItemChanged:function(_505){when(this.store.refresh(_505),lang.hitch(this,function(_506){this._childrenChanged(_506);}));},_childrenChanged:function(_507){var dfd=new _4aa();this.getChildren(_507,lang.hitch(this,function(_508){this.onChildrenChange(_507,_508);dfd.resolve(_508);}));return dfd;},_isNodeAContextAncestor:function(_509,_50a){var dfd=new _4aa(),_50b=_509.some(function(_50c){return _4b3.compareIgnoreVersion(_50c,_50a.id);});if(_50b){dfd.resolve(true);}else{this.getAncestors(_50a,function(_50d){var _50e=_50d.some(function(_50f){return _509.indexOf(_50f.contentLink)>-1;});dfd.resolve(_50e);});}return dfd.promise;},_handleSelect:function(_510,_511){var _512,_513;if(_511){_512=_510[0];if(_512.capabilities.isPage){_513=_510.length===1&&_512;this.onSelect(_513?_513.parentLink:_4b1.startPage,true);return;}_4ac.publish("/epi/shell/context/request",{uri:_4b0.settings.defaultContext});}var _514=_510.filter(function(_515){return this.isSupportedType(_515.typeIdentifier);}.bind(this));if(_514.length===1){this.onSelect(_514[0].parentLink,true);}else{if(_514.length>1){this.onSelect(_4b1.globalAssetsFolder,true);}}},checkItemAcceptance:function(_516,_517){var _518=_517.getSelectedNodes?_517.getSelectedNodes():_517.getSelectedTreeNodes();var _519=_518.map(function(node){var item=_517.getItem(node.id);var data=item.data;if(data.dndData){data=data.dndData;}return this.canPaste(data,_516);},this);return _4ab(_519).then(function(_51a){return _51a.every(function(_51b){return _51b;});});},_handleDelete:function(_51c){var _51d=_51c.filter(function(item){return item.isDeleted;});if(_51d.length>0){_51d.forEach(function(item){var id=this.getIdentity(item),_51e=this._observers[id];if(_51e){_51e.remove();delete this._observers[id];}this.onDelete(item,true);},this);this.onDeleted(_51d);}},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_51f){var _520=_4ae.getValue(item.typeIdentifier,"iconClass");if(!_520){return _51f;}var _521="";switch(parseInt(item.contentLink,10)){case _4b1.globalAssetsFolder:_521="AllSites";break;case _4b1.siteAssetsFolder:_521="ThisSite";break;default:break;}return (_521===""&&_520===_51f)?_520:(_51f+" "+_520+_521);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _522=new _4aa();this.getAncestors(item,lang.hitch(this,function(_523){_522.resolve(this.getIdentity(_523[0])===this.root.id);}));return _522.promise;},canCopy:function(item){if(!item){return false;}var _524=item.contentLink,_525=_524===this.root||(_4a5.indexOf(this.notAllowToCopy,_524)>=0);return !_525&&_4b2.hasAccess(item.accessMask,_4b2.accessLevel.Read)&&_4b2.hasProviderCapability(item.providerCapabilityMask,_4b2.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _526=item.contentLink,_527=_526===this.root||(_4a5.indexOf(this.notAllowToDelete,_526)>=0);return !_527&&_4b2.isActionAvailable(item,_4b2.action.Delete,_4b2.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _528=item.contentLink,_529=_528===this.root||(_4a5.indexOf(this.notAllowToDelete,_528)>=0);return !_529&&_4b2.isActionAvailable(item,_4b2.action.Delete,_4b2.providerCapabilities.Delete,true);},canPaste:function(item,_52a,_52b){if(!item||!_52a){return false;}var _52c=_52b&&_52a.isWastebasket,_52d=!_52b&&(this.getIdentity(item)===this.getIdentity(_52a)),_52e=!_52b&&(item.parentLink===this.getIdentity(_52a)),_52f=_4b2.isActionAvailable(_52a,_4b2.action.Create,_4b2.providerCapabilities.Create,true);return !_52a.isDeleted&&!_52c&&!_52d&&!_52e&&_52f;},canEdit:function(item){if(!item){return false;}var _530=item.contentLink,_531=_530===this.root;return !_531&&_4b2.hasAccess(item.accessMask,_4b2.accessLevel.Edit);},onItemChildrenReload:function(_532){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_533){},onSelect:function(_534,_535,_536){},onPasteItemsFailed:function(_537){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_538,lang,_539){return _538([_539],{isTypeOfRoot:function(_53a){return !!(_53a&&(this.isRoot(_53a)||_53a.isSubRoot));},isRoot:function(_53b){return !!(_53b&&this.root&&_53b===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_53c,_53d,lang,_53e,all,when){return _53d([],{parentProperty:"parentLink",store:null,constructor:function(_53f){_53d.safeMixin(this,_53f);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_540,_541){var _542=this.store.getIdentity(_540),_543=this.store.getIdentity(_541),_544=this.getParentIdentity(_541);if(_542==_543||(_541.parentLink&&_540.contentLink==_541.parentLink)){return true;}if(_544){return false;}return when(this.store.get(_544),lang.hitch(this,function(_545){return this.isAncestor(_540,_545);}));},getAncestors:function(item,_546){if(!this.store){_546([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_547){when(this._getAncestors([_547]),_546);}));},_getAncestors:function(_548){if(this._hasRoot(_548)){return _548.slice(0,-1);}var _549=this.getParentIdentity(_548[0]);if(!_549){return _548.slice(0,-1);}return when(this.store.get(_549),lang.hitch(this,function(_54a){if(_54a){_548.unshift(_54a);return this._getAncestors(_548);}return _548.slice(0,-1);}));},_hasRoot:function(_54b){var _54c=this.roots||[this.root];if(!_54b.length||!_54c.length||typeof this.getIdentity!=="function"){return false;}var _54d=this.getIdentity(_54b[0]);return _53c.some(_54c,function(root){return root==_54d;},this);},refreshAncestors:function(item,_54e){var _54f=this.store,_550=new _53e(),_551=[],_552=[];this.getAncestors(item,function(_553){_53c.forEach(_553,function(_554){if(!_54e||_54e(_554)){_551.push(when(_54f.refresh(_54f.getIdentity(_554)),function(item){_552.push(item);}));}});all(_551).then(function(){_550.resolve(_552);});});return _550.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_555,_556,lang,_557,_558,json,_559,when,_55a,_55b,_55c,_55d){return _556(_558,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this.inherited(arguments);this._setupStore();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_55a.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_55e=new _557();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_55e.resolve(item);},function(e){_55e.reject(e);});},function(e){_55e.reject(e);});return _55e;},add:function(item,_55f){var self=this;var def=new _557();when(self.updateableStore.add(item),function(_560){var id=self.getContentId(_560),_561=self.getParentIdentity(item),_562=null;when(self.updateableStore.get(id),function(_563){if(self.getParentIdentity(_563)!==_561){_562=typeof _55f=="function"&&_55f();}when(_562).then(self.updateableStore.updateDependentStores.bind(this,_563)).then(function(){when(self._childrenChanged(_561),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_563);});});});});});return def.promise;},patch:function(id,_564){var self=this,_565=new _557(),_566={id:id,properties:{}};for(var key in _564){if(_564.hasOwnProperty(key)){_566.properties[this._convertPropertyName(key)]=json.stringify(_564[key]);}}when(self.updateableStore.patch(_566,{id:_566.id}),function(item){if(item&&item.successful){var _567={contentLink:id,properties:_566.properties,capabilities:{supportsVersions:false}};lang.mixin(_567,_564);when(self.updateableStore.patchCache(_567),_565.resolve,_565.reject);}else{return _565.reject(item&&item.validationErrors);}});return _565;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_568){var self=this,_569=new _557(),_56a;function _56b(item){var id=self.getIdentity(item),_56c=self.getParentIdentity(item);if(_56c===self.root||id===self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _569.resolve();}when(self.refreshAncestors(_568,_56b),function(_56d){if(!(_56d instanceof Array)||_56d.length===0){_569.resolve();return;}_56d.reverse();var _56e=_555.some(_56d,function(item){if(item.missingLanguageBranch){_56a=self.getLabel(item);return true;}return false;});when(self.store.get(_568),function(_56f){if(_56e&&_56f&&!_56f.missingLanguageBranch){self.emit("translationFailed",_56a);}_569.resolve();});});return _569;},getContentId:function(_570){return _55d.toContentReference(_570).id.toString();}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_571,_572,lang,_573,_574,_575,_576,when,_577,_578,_579,_57a){return _572([_57a,_578],{previousSelection:null,forThisFolderEnabled:true,postscript:function(){this.inherited(arguments);this._handles.push(_576.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_576.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_573.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_573.around(this,"pasteItems",lang.hitch(this,this._aroundPasteItems)));this._handles.push(_573.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contextChanged:function(_57b,_57c){this.inherited(arguments);this.refreshRoots();},getChildren:function(_57d,_57e,_57f){if(_57d===this.root){when(this._getRootItems(),_57e,_57f);}else{if(this.isPseudoContextualRoot(_57d)){_57e([]);return;}this.inherited(arguments);}},getAncestors:function(item,_580){var _581=this.getInherited(arguments),_582=_580;when(this.getCurrentContent()).then(lang.hitch(this,function(_583){var _584=this.roots.concat(_583.assetsFolderLink),_585=lang.hitch(this,function(_586){var _587;for(var i=_586.length-1;i>=0;i--){_587=_586[i];if(this.isContextualRoot(_587)){_586[i]=this.getContextualRoot(_587);}if(_571.indexOf(_584,this.getIdentity(_587))>=0){_586=_586.slice(i);_586.unshift(this.root);_580(_586);return;}}_580([this.root]);});if(_571.indexOf(_584,this.getIdentity(item))>=0){_580([this.root]);}_582=_585;})).always(lang.hitch(this,function(){_581.apply(this,[item,_582]);}));},getObjectIconClass:function(_588,_589){var _58a=this._currentContext&&this._currentContext.dataType;if(!_58a){return this.inherited(arguments);}var _58b=_577.getValue(_58a,"iconClass");return this.isContextualContent(_588)?(_58b?_589+" "+_58b+"Contextual":_589):this.inherited(arguments);},onToggleContentDisplay:function(_58c,_58d){},onRefreshRoots:function(_58e){},refreshRoots:function(_58f){if(_58f===this){return true;}var self=this;return when(self._getRootItems(),function(_590){self.onChildrenChange(self.root,_590);});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_591,_592){var self=this,_593=this.inherited(arguments),_594=new _574();if(_592){_594.resolve(_593);}else{self.getAncestors(_591,function(_595){var _596=self.isContextualContent(_591)||self.hasContextual(_595);if(_596){when(self.getCurrentContent()).then(function(_597){if(_579.compareIgnoreVersion(item.contentLink,_597.contentLink)){_594.resolve(false);}else{self.getAncestors(_597.contentLink,function(_598){var _599=_571.some(_598,function(_59a){return item.contentLink===_59a.contentLink;},this);_594.resolve(_599?false:_593);});}}).otherwise(function(){_594.resolve(false);});}else{_594.resolve(_593);}});}return _594.promise;},filterAncestors:function(_59b){if(!(_59b instanceof Array)){return _59b;}var _59c=_59b.indexOf(this._getPseudoContextualContent().toString());if(_59c!==-1&&_59c<_59b.length-1){_59b.splice(_59c,1);}return _59b;},isContextualContent:function(item){return !!item&&this.isSupportedType(item.typeIdentifier)&&this.inherited(arguments);},_toggleContextualContent:function(_59d){when(this.getCurrentContent(),lang.hitch(this,function(_59e){this.onToggleContentDisplay(_59e.assetsFolderLink,!_59d);this._setSelection(null);}));},_setSelection:function(_59f){var _5a0=this.roots.length>0?this.roots[0].toString():(!_59f?null:_59f.assetsFolderLink),_5a1=_59f!=null?_59f.contentLink:_5a0,_5a2=this.get("previousSelection"),_5a3=this.get("previousContextualSelection"),_5a4=_5a3&&_5a3.selectedContent,_5a5=new _574();if(!(_5a1&&_5a2)){_5a5.resolve();return _5a5.promise;}var _5a6=false,_5a7=_5a2.selectedContent,_5a8=_5a2.selectedAncestors,_5a9=_5a7.item&&!_5a7.item.contentLink;var _5aa=function(){_5a5.resolve();};if(_5a9||this.hasContextual(_5a8)){this.onSelect(_5a1,_5a6,_5aa);}else{if(_5a7.item.contentLink===_5a0&&_5a4&&_5a4.item&&_5a4.item.contentLink){this.onSelect(_5a4.item.contentLink,_5a6,_5aa);}else{_5a5.resolve();}}return _5a5.promise;},getRoots:function(_5ab){var def=new _574();var _5ac=this._getPseudoContextualContent().toString();var _5ad=function(_5ae){if(!_5ab){return true;}return _5ae!==_5ac;};var _5af=function(_5b0){return _5b0.contentLink;};when(this._getRootItems(),function(_5b1){def.resolve(_5b1.map(_5af).filter(_5ad));},def.reject);return def.promise;},_getRootItems:function(){var self=this,_5b2=self.store,_5b3=_571.map(self.roots,function(item){return _5b2.get(item);});var _5b4=when(_575([self.getCurrentContent(),self.getCurrentContext()]),function(_5b5){var _5b6=_5b5[0],_5b7=_5b5.length>1?_5b5[1]:null;var _5b8=new _579(_5b6.contentLink).createVersionUnspecificReference().toString();return when(_5b2.get(_5b8),function(_5b9){var _5ba=_5b7&&_5b7.currentMode==="create";if((_5ba&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_5b9)||!self.forThisFolderEnabled){return null;}var _5bb=_5b9.assetsFolderLink;if(_5bb){var _5bc=function(_5bd){return when(_5b2.get(_5bd),function(_5be){var _5bf={id:_5be.contentLink,typeIdentifiers:self.typeIdentifiers,allLanguages:self.showAllLanguages};return when(_5b2.query(_5bf),function(_5c0){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_5c0.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_5c0)){return self.getContextualRoot(_5c0);}else{return when(self.onRefreshRoots(_5c0),function(){return self._modifyContentAccess(_5c0,_5b9);});}});});};if(_5bb===self._getPseudoContextualContent().toString()){return when(_5b2.refresh(_5b8),function(_5c1){return _5bc(_5c1.assetsFolderLink);});}else{return _5bc(_5bb);}}return null;});},function(){return null;});_5b3.push(_5b4);return when(_575(_5b3),function(_5c2){return _571.filter(_5c2,Boolean);});},_aroundPasteItem:function(_5c3){var self=this;return function(_5c4,_5c5,_5c6,copy,_5c7){var _5c8=_5c6,_5c9=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_5ca){if(!_5c9){_5c9=self.isPseudoContextualRoot(_5c8);self.set("createAsLocalAsset",_5c9);}_5c9&&(_5c8=_5ca);}).always(function(){return when(_5c3.apply(self,[_5c4,_5c5,_5c8,copy,_5c7]),function(_5cb){if(_5c9){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_576.publish("/epi/cms/action/createlocalasset",self);return _5cb;});}else{return _5cb;}});});};},_aroundPasteItems:function(_5cc){var self=this;return function(_5cd,_5ce,copy,_5cf){var _5d0=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_5d1){if(!_5d0){_5d0=self.isPseudoContextualRoot(_5ce);self.set("createAsLocalAsset",_5d0);}_5d0&&(_5ce=_5d1);}).always(function(){return when(_5cc.apply(self,[_5cd,_5ce,copy,_5cf]),function(_5d2){if(_5d0){self.set("createAsLocalAsset",false);}else{return _5d2;}});});};},_afterStoreGet:function(_5d3){var self=this;return when(_5d3,function(_5d4){return when(self.getCurrentContent(),function(_5d5){return self._modifyContentAccess(_5d4,_5d5);},function(_5d6){return _5d4;});});},_modifyContentAccess:function(_5d7,_5d8){if(this.isContextualContent(_5d7)){var _5d9=this.getContextualRoot(_5d7);return this.isPseudoContextualRoot(_5d7)?lang.mixin(_5d9,{isPreferredLanguageAvailable:_5d8.isPreferredLanguageAvailable,hasTranslationAccess:_5d8.hasTranslationAccess,accessMask:_5d8.accessRights,ownerContentLink:_5d8.contentLink}):_5d9;}return _5d7;}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/when","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_5da,_5db,json,lang,when,_5dc,_5dd,_5de,_5df){return _5da([_5dd],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,innerSearchBoxClass:"",parameters:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _5de();when(this._searchManager.getStore(),lang.hitch(this,function(_5e0){this._searchBox=new _5df({baseClass:this.innerSearchBoxClass,searchAttr:"searchQuery",store:_5e0});var _5e1=lang.mixin({filterOnDeleted:true},this.parameters);lang.mixin(this._searchBox.query,{parameters:json.toJson(_5e1)});this._searchBox.on("select",lang.hitch(this,function(_5e2){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_5e2);}));this.set("filterOnCulture",false);_5dc.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_5e3){this._set("area",_5e3);if(this._searchBox){when(this._searchManager.getProviderQuery(_5e3),lang.hitch(this,function(_5e4){lang.mixin(this._searchBox.query,_5e4);}));}},_setSearchRootsAttr:function(_5e5){this._set("searchRoots",_5e5);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_5e5});}},_setFilterOnCultureAttr:function(_5e6){this._set("filterOnCulture",_5e6);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_5e6});}},onItemAction:function(item){if(this.triggerContextChange){var _5e7={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent==="false"){_5e7.epslanguage=item.metadata.languageBranch;}_5db.publish("/epi/shell/context/request",[_5e7,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency"],function(_5e8,_5e9,_5ea,lang,when,all,_5eb){return _5e8(null,{_providersStore:null,_resultsStore:null,constructor:function(_5ec){this._setupStores(_5ec||{});},getProviderQuery:function(area){var _5ed=new _5ea();var _5ee=[];var _5ef=area?area.split(","):[];_5ef.forEach(function(a){_5ee.push(this._getFirstMatchingProvider(a));},this);all(_5ee).then(function(_5f0){_5f0=_5f0.filter(function(p){return p;});if(_5f0.length>0){_5ed.resolve(this._getQuery(_5f0,{}));}else{_5ed.resolve();}}.bind(this));return _5ed;},_getFirstMatchingProvider:function(area){var _5f1=new _5ea();when(this.getProviders(area)).then(function(_5f2){if(_5f2&&_5f2.length>0){_5f1.resolve(_5f2[0]);}else{_5f1.resolve();}});return _5f1.promise;},getProviders:function(area){var _5f3=new _5ea();when(this._providersStore.query({searchArea:area})).then(function(_5f4){if(_5f4&&_5f4.length>0){_5f3.resolve(_5f4);}else{_5f3.resolve();}});return _5f3;},getStore:function(){return this._resultsStore;},search:function(area,_5f5){var _5f6=new _5ea();when(this.getProviders(area)).then(lang.hitch(this,function(_5f7){if(_5f7&&_5f7.length>0){var _5f8=[];_5e9.forEach(_5f7,function(_5f9,_5fa){_5f8.push(this._getData(_5f9,_5f5));},this);var data=[];all(_5f8).then(function(_5fb){_5fb.forEach(function(item){if(lang.isArray(item)){data=data.concat(item);}});_5f6.resolve(data);});}}));return _5f6;},_setupStores:function(_5fc){this._providersStore=_5fc.providersStore||_5eb.resolve("epi.storeregistry").get("epi.shell.searchproviders");this._resultsStore=_5fc.resultsStore||_5eb.resolve("epi.storeregistry").get("epi.shell.searchresults");},_getQuery:function(_5fd,_5fe){var _5ff;if(lang.isArray(_5fd)){_5ff=_5fd.map(function(p){return p.id;}).join(",");}else{_5ff=_5fd.id;}var _600={providerId:_5ff};lang.mixin(_600,_5fe||{});return _600;},_getData:function(_601,_602){var _603=new _5ea();when(this._resultsStore.query(this._getQuery(_601,_602))).then(function(_604){if(_604&&_604.length>0){_603.resolve(_604);}else{_603.resolve();}});return _603.promise;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_605,lang,_606,_607,_608,keys,_609,_60a,_60b,_60c,_60d){return _605([_60b,_608],{res:_60d,autoComplete:false,dropDownClass:_60c,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_60e){if(this.dropDown){this.dropDown.showStandby(false);}}));_607.before(this,"_startSearch",function(_60f,args){this.emit("beforeSearch",{});return [_60f,args];});},_openResultList:function(_610,_611,_612){this.emit("searchComplete",_610);this._fetchHandle=null;this.dropDown.clearResultList();var _613=_610.length>0||_612.start!==0;this.dropDown.showErrorMessage(!_613,this.res.contentnotfound);this.dropDown.showGrid(_613);if(_613){this.dropDown.createOptions(_610,_612,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_606.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_606.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _614=this.id+"_popup",_615=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _615({id:_614,dir:this.dir,textDir:this.textDir});_609.remove(this.textbox,"aria-activedescendant");_609.set(this.textbox,"area-owns",_614);this.dropDown.on("select",lang.hitch(this,function(_616){this.closeDropDown();this.emit("select",_616);}));_60a.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();this._startSearch(key);},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_617,lang,_618,_619,_61a,_61b,_61c){return _617([_61c,_619,_61b],{dropDownClass:_61a,buildRendering:function(){this.inherited(arguments);_618.set(this.textbox,"autocomplete","off");_618.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","epi/debounce","epi","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_61d,lang,_61e,_61f,_620,keys,_621,_622,_623,_624,_625,_626,_627,epi,_628,_629){return _61d([_625],{templateString:_628,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,triggerChangeOnEnter:true,postCreate:function(){this.inherited(arguments);_61e.set(this.clearButton,"title",_629.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,this.clearValue));this.toggleClearButton();this.connect(this,"_onInput",_627(lang.hitch(this,function(_62a){if(this._destroyed){return;}this.toggleClearButton();this._valueChanged(_62a);}),null,this.defaultDelay));this.connect(this.domNode,"onclick","_onClick");},clearValue:function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();},toggleClearButton:function(){_620.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_624.focus(this.textbox);},_onClick:function(){this.focus();},_valueChanged:function(_62b){if(_62b&&_62b.charOrCode){switch(_62b.charOrCode){case keys.ESCAPE:this.clearValue();return;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.TAB:return;}if(!this.triggerChangeOnEnter&&_62b.charOrCode===keys.ENTER){return;}}this.onSearchBoxChange(this.encodeSearchText?_626.encode(this.textbox.value):this.textbox.value);},onSearchBoxChange:function(_62c){}});});},"epi/debounce":function(){define("epi/debounce",["dgrid/util/misc"],function(misc){return misc.debounce;});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_62d,lang,_62e,_62f,_630,_631,_632,_633,_634,_635,_636,_637,_638,_639,_63a,_63b,_63c,_63d,_63e,_63f){return _62d([_633,_634,_62e,_635,_636,_638,_639],{templateString:_63f,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_640=_637.resolve("epi.shell.Profile"),_641=_62d([_63c,_63d,_63e,_63b]),_642=function(item){return item.title;},_643=function(item){return item.metadata.typeIdentifier;},_644=function(item){var _645=self.grid.domNode,_646="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_630.contains(_645,_646))&&_630.add(_645,_646);return item.metadata.thumbnailUrl;},_647=function(item){if(item.metadata&&item.metadata.languageBranch!==_640.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _641({formatters:[_63a.contentItemFactory("title",_642,_643,null,_644,_647,false)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_62f.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_648){var row=this.grid.row(_648);if(row){this._onSelect(row.data);}}));this._standby=new _632({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_631.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_649){this.emit("select",_649);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_64a,_64b,_64c){this.grid.renderArray(_64a);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_64d){this.clearResultList();this.showStandby(false);if(show&&_64d){this.errorMessage.innerHTML=_64d;}_631.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_64e,keys){return _64e(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_64f,_650){return _64f(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_650.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_650.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\r\n    <div data-dojo-attach-point=\"containerNode\">\r\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\r\n    </div>\r\n    <div class=\"dijitReset epi-searchResultListNavigation\">\r\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\r\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\r\n    </div>\r\n</div>","epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_651,lang,_652,_653){return _651([_653],{addToLeading:function(_654,_655){this.addCommand(_654,_655);},addToCenter:function(_656,_657){_657=lang.mixin({category:"center"},_657);this.addCommand(_656,_657);},addToTrailing:function(_658,_659){_659=lang.mixin({category:"trailing"},_659);this.addCommand(_658,_659);},addCommand:function(_65a,_65b){_65b=lang.mixin({iconClass:_65a.iconClass,category:"leading",label:_65a.label,tooltip:_65a.tooltip,showLabel:false,widget:_652,model:_65a},_65b);_65a=lang.delegate(_65a,{settings:_65b});this.add("commands",_65a);},updateCommandModel:function(_65c){this.commands.forEach(function(_65d){_65d.settings.model.set("model",_65c);});}});});},"epi-cms/compare/command/CompareCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","./CompareSettingsModel","./CompareViewSelection","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.compare.command"],function(_65e,_65f,_660,_661,_662,_663,_664){var _665=_65e([_662,_663]);return _65e([_65f],{postscript:function(){this.inherited(arguments);var _666=new _660();var _667={category:"compare"};this.add("commands",new _665({category:"compare",settings:_667,label:_664.togglecompare.label,iconClass:"epi-iconCompare",model:_666,property:"enabled"}));this.add("commands",new _661({category:"compare",settings:_667,model:_666,label:_664.compareviewselection.label,optionsLabel:_664.compareviewselection.label,optionsProperty:"modeOptions",property:"mode"}));}});});},"epi-cms/compare/command/CompareSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi-cms/nls/episerver.cms.compare.mode"],function(_668,lang,_669,_66a,when,_66b,_66c,res){return _668([_66a,_66b],{enabled:false,mode:"allpropertiescompare",_selectedCompareModeProfileKey:"epi.selected-comparemode-id",modeOptions:[{label:res.allpropertiescompare,value:"allpropertiescompare",iconClass:"epi-iconForms"},{label:res.sidebysidecompare,value:"sidebysidecompare",iconClass:"epi-iconLayout"}],constructor:function(){var self=this;this.profile=this.profile||_66c.resolve("epi.shell.Profile");when(this._loadSelectedModeFromProfile(),lang.hitch(this,function(mode){if(mode){this.set("mode",mode);}}));this.own(_669.subscribe("/epi/shell/action/viewchanged",function(type,args,data){var view=data&&(data.viewName||(data.sender&&data.sender.viewName));var _66d=self.modeOptions.some(function(_66e){return _66e.value===view;});self.set("enabled",_66d,false);}),_669.subscribe("/epi/cms/action/switcheditmode",function(){self.set("enabled",false,false);}),_669.subscribe("/epi/cms/action/eyetoggle",function(_66f){if(_66f){self.set("enabled",false,false);_669.publish("/epi/shell/action/changeview/updatestate",{viewName:null});}}));},_enabledSetter:function(_670,_671){if(this.enabled!==_670){this.enabled=_670;(_671!==false)&&this._onChange();}},_modeSetter:function(_672){if(this.mode!==_672){this.mode=_672;this.get("enabled")&&this._onChange();this.profile.set(this._selectedCompareModeProfileKey,_672,{location:"server"});}},_onChange:function(){_669.publish("/epi/shell/action/changeview",this.get("enabled")?this.get("mode"):null,null,{forceReload:true});},_loadSelectedModeFromProfile:function(){return when(this.profile.get(this._selectedCompareModeProfileKey),function(mode){if(!mode){return null;}return mode;});}});});},"epi-cms/compare/command/CompareViewSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand"],function(_673,_674){return _673([_674],{_selectedSetter:function(_675){this.inherited(arguments);this.get("options").some(function(_676){if(_676.value===_675){this.set("iconClass",_676.iconClass);return true;}},this);}});});},"epi/shell/command/OptionCommand":function(){define("epi/shell/command/OptionCommand",["dojo/_base/declare","epi/shell/command/_Command","dijit/Destroyable"],function(_677,_678,_679){return _677([_678,_679],{options:null,optionsLabel:"",optionsProperty:null,selected:null,property:null,_execute:function(){this.model.set(this.property,this.selected);},_onModelChange:function(){var self=this,_67a=this.model;this.set("canExecute",!!_67a);if(_67a){this.set("selected",this.model.get(this.property));this.own(_67a.watch(this.property,function(name,_67b,_67c){self.set("selected",_67c);}));}},_optionsGetter:function(){return this.options||(this.model&&this.optionsProperty&&this.model.get(this.optionsProperty));},_selectedSetter:function(_67d){var _67e=this.selected;this.selected=_67d;if(_67e!==_67d){this.execute();}}});});},"epi-cms/command/_NonEditViewCommandMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable"],function(_67f,lang,_680,_681){return _67f([_681],{constructor:function(){this.own(_680.subscribe("/epi/shell/action/viewchanged",lang.hitch(this,"_viewChanged")));},_viewChanged:function(type,args,data){this.set("isAvailable",type==="epi-cms/contentediting/PageDataController"||type==="epi-cms/compare/views/CompareView");}});});},"epi-cms/notification/command/NotificationCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/notification/NotificationButton","epi-cms/notification/command/ViewNotifications"],function(_682,_683,_684,_685){return _682([_683],{postscript:function(){this.inherited(arguments);var _686={widget:_684,"class":"epi-chromeless"};this.addToTrailing(new _685(),_686);}});});},"epi-cms/notification/NotificationButton":function(){define(["dojo/_base/declare","dojo/on","epi/shell/widget/DeferredDropDownButton","epi/shell/widget/_ButtonBadgeMixin","./NotificationList"],function(_687,on,_688,_689,_68a){return _687([_688,_689],{dropDownPosition:["below-alt","below"],showLabel:false,postMixInProperties:function(){this.inherited(arguments);if(this.modelBindingMap){this.modelBindingMap.badgeValue=["badgeValue"];}this.dropDown=this.dropDown||new _68a();this.own(on(this.dropDown,"change",function(){this.closeDropDown(true);}.bind(this),true));},closeDropDown:function(){this.inherited(arguments);this.dropDown.model.markAllAsRead();}});});},"epi/shell/widget/DeferredDropDownButton":function(){define("epi/shell/widget/DeferredDropDownButton",["dojo/_base/declare","dijit/form/DropDownButton","epi/shell/widget/_HasDeferredDropDown"],function(_68b,_68c,_68d){return _68b([_68c,_68d],{});});},"epi/shell/widget/_HasDeferredDropDown":function(){define("epi/shell/widget/_HasDeferredDropDown",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dijit/_HasDropDown"],function(_68e,lang,_68f,on,_690){return _68e([_690],{_loaded:false,loadEvent:"loaded",isLoaded:function(){return this._loaded&&!!this.dropDown;},loadDropDown:function(){var self=this,_691=this.dropDown,_692=new _68f();on.once(_691,this.loadEvent,function(){self._loaded=true;_692.resolve();});_691.startup();return _692.promise;},loadAndOpenDropDown:function(){var self=this,_693=this.dropDown;if(this.isLoaded()){return new _68f().resolve(this.openDropDown());}return this.loadDropDown().then(function(){self.openDropDown();if(_693.focus){self.defer(lang.hitch(_693,"focus"),1);}});}});});},"epi/shell/widget/_ButtonBadgeMixin":function(){define("epi/shell/widget/_ButtonBadgeMixin",["dojo/_base/declare","dojo/dom-class","dojo/dom-attr"],function(_694,_695,_696){return _694(null,{badgeClass:"epi-badge-node",badgeValue:null,_setBadgeValueAttr:function(_697){this._set("badgeValue",_697);if(_697||_697===0){_695.add(this.iconNode,this.badgeClass);_696.set(this.iconNode,"badge-value",_697);}else{_695.remove(this.iconNode,this.badgeClass);}}});});},"epi-cms/notification/NotificationList":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/keys","dojo/on","./viewmodels/NotificationListViewModel","./notificationFormatter","dojo/text!./templates/NotificationList.html","epi/i18n!epi/cms/nls/episerver.cms.notification.list","dgrid/OnDemandList","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi-cms/dgrid/WithContextMenu","epi-cms/ApplicationSettings","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin"],function(_698,_699,keys,on,_69a,_69b,_69c,res,_69d,_69e,_69f,_6a0,_6a1,_6a2,_6a3,_6a4,_6a5,_6a6,_6a7,_6a8){return _699([_6a6,_6a7,_6a8],{templateString:_69c,_listClass:_699([_69d,_6a1,_69f,_69e,_6a2,_6a0]),_list:null,res:res,postMixInProperties:function(){this.inherited(arguments);_69b.contentLanguage=_6a3.currentContentLanguage;if(!this.model){this.own(this.model=new _69a());}},buildRendering:function(){this.inherited(arguments);this._setupList();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize().then(function(){this._list.startup();this._list.set("store",this.model.store,this.model.query,this.model.queryOptions);this.own(on(this.domNode,_698._keypress,this._onKeypress.bind(this)));this.emit("loaded");}.bind(this));},focus:function(){var _6a9;if(this._list){_6a9=this._list.getScrollPosition();this._list.focus();this._list.scrollTo(_6a9);}},layout:function(){this.inherited(arguments);this._list.resize();},_setupList:function(){var _6aa=this._readNotification.bind(this);this._list=new this._listClass({className:"epi-notification-list__item-list epi-card-list epi-grid-max-height--300",cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,formatters:_69b.card,keepScrollPosition:true,noDataMessage:res.nodatamessage,stopPropagation:true,sort:this.model.queryOptions&&this.model.queryOptions.sort},this.listNode);this._list.contextMenu.addProvider(this.model);this.own(this._list,this._list.on("dgrid-select",this._selected.bind(this)),this._list.on(".dgrid-row:click",_6aa),this._list.addKeyHandler(keys.ENTER,_6aa),on.once(this._list,"dgrid-refresh-complete",this.focus.bind(this)));},_readNotification:function(){this.model.readSelectedNotification();this.emit("change",{});},_selected:function(e){var _6ab=e&&e.rows&&e.rows[0].data;this.model.set("selectedNotification",_6ab);},_onKeypress:function(e){if(e.charOrCode!==keys.TAB){return;}this._list.focus();e.preventDefault();e.stopPropagation();}});});},"epi-cms/notification/viewmodels/NotificationListViewModel":function(){define(["dojo/_base/declare","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/dependency"],function(_6ac,_6ad,_6ae,_6af,when,_6b0,_6b1){return _6ac([_6ae,_6ad,_6b0],{store:null,service:null,query:null,queryOptions:null,selectedNotification:null,postscript:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"posted",descending:true},{attribute:"id",descending:true}]};this.store=this.store||_6b1.resolve("epi.storeregistry").get("epi.cms.notification");this.service=this.service||_6b1.resolve("epi.cms.NotificationService");this.query=this.query||{};},initialize:function(){return when(null);},readSelectedNotification:function(){this.markSelectedNotificationAsRead();this.gotoSelectedNotificationOrigin();},gotoSelectedNotificationOrigin:function(){if(!this.selectedNotification||!this.selectedNotification.link||this.selectedNotification.isExternal){return;}var _6b2=this.selectedNotification.link;_6af.publish("/epi/shell/context/request",{uri:_6b2},{sender:this,forceReload:true});},markSelectedNotificationAsRead:function(){if(!this.selectedNotification){return;}this.service.markAsRead(this.selectedNotification.id).then(this.set.bind(this,"selectedNotification"));},markAllAsRead:function(){this.service.markAllAsRead();}});});},"epi-cms/notification/notificationFormatter":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi/shell/TypeDescriptorManager","epi-cms/dgrid/formatters","epi/shell/dgrid/util/misc","epi/string","dojo/text!./templates/InternalNotification.html","dojo/text!./templates/ExternalNotification.html","epi/i18n!epi/nls/episerver.shared"],function(_6b3,_6b4,_6b5,_6b6,_6b7,misc,_6b8,_6b9,_6ba,_6bb){var _6bc;function _6bd(){function _6be(item){if(!item.contentLanguage){return "";}return item.contentLanguage!==_6bc.contentLanguage?item.contentLanguage:"";};function _6bf(_6c0){if(_6c0.subject){return _6b5.encode(_6c0.subject);}return "";};function _6c1(_6c2){if(_6c2==="projectIcon"){return misc.icon("epi-iconObjectProject epi-objectIcon");}if(_6c2==="featureIcon"){return misc.icon("epi-iconObjectFeature epi-objectIcon");}if(_6c2){var _6c3=_6b6.getValue(_6c2,"iconClass");if(_6c3){return misc.icon(_6c3+" epi-objectIcon");}}return "";};function _6c4(_6c5){return (_6c5&&_6c5.isExternal)?_6ba:_6b9;};return function formatter(_6c6,_6c7,node){var _6c8=_6c4(_6c6);var _6c9=_6be(_6c7);var map={title:_6bf(_6c7),languageBranch:_6b5.encode(_6c9),languageBranchClass:_6c9?"epi-card__language-branch":"epi-card__language-branch--hidden",contentIcon:_6c1(_6c7.iconKey),message:_6b8.toHTML(_6c7.content),postedAt:_6b7.localizedDate(_6c7.posted),additionalEventClass:_6c7.subject?"":"epi-event--no-title",url:_6c6?_6c6.link:""};var _6ca=(_6c7.hasRead?"":" epi-card--unread");_6b3.add(node,"epi-card epi-card--compact"+_6ca);return _6b4.substitute(_6c8,map);};};_6bc={card:[_6bd()]};return _6bc;});},"url:epi-cms/notification/templates/InternalNotification.html":"<div class=\"epi-event ${additionalEventClass}\">\r\n    ${contentIcon}<span class=\"dijitInline epi-floatRight epi-lozenge ${languageBranchClass}\">${languageBranch}</span><h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\r\n    <div class=\"epi-event__message\">${message}</div>\r\n    <div class=\"epi-event__timestamp\">${postedAt}</div>\r\n</div>\r\n","url:epi-cms/notification/templates/ExternalNotification.html":"<div class=\"epi-event ${additionalEventClass}\">\r\n    ${contentIcon}\r\n    <a href=${url} target=\"_blank\">\r\n        <h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\r\n        <div class=\"epi-event__message dojoxEllipsis\">${message}</div>\r\n        <div class=\"epi-event__timestamp\">${postedAt}</div>\r\n    </a>\r\n</div>\r\n","url:epi-cms/notification/templates/NotificationList.html":"<div class=\"epi-notification-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\">${res.header}</span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","epi/shell/dgrid/Focusable":function(){define("epi/shell/dgrid/Focusable",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/focus"],function(_6cb,lang,_6cc,_6cd){return _6cb([],{postCreate:function(){this.inherited(arguments);this._listeners.push(_6cc.around(this,"_restoreFocus",function(_6ce){return function(row){var _6cf=this._removedFocus;_6ce.apply(this,arguments);if(!this._focusedNode){row=row&&this.row(row);var _6d0=row&&row.element&&row.id===_6cf.rowId?row:typeof _6cf.siblingId!=="undefined"&&this.row(_6cf.siblingId);if(_6d0){this._focusedNode=_6d0.element;}}};}));},hasFocus:function(){return this._focusedNode&&this._focusedNode===_6cd.curNode;},isFocusable:function(){return !!this._focusedNode;},focus:function(_6d1){if(typeof _6d1=="string"){_6d1=null;}this.inherited(arguments,[_6d1]);},refresh:function(_6d2){var _6d3=_6d2&&_6d2.refocus,_6d4=function(_6d5){if(this._refocusNode){this.focus(this.row(this._refocusNode).element);this._refocusNode=null;}return _6d5;};if(typeof _6d3==="undefined"){_6d3=this.refocusOnRefresh;}if(_6d3&&this.hasFocus()){this._refocusNode=this.row(this._focusedNode).id;}var _6d6=this.inherited(arguments);if(_6d6){return _6d6.then(_6d4.bind(this));}}});});},"epi-cms/notification/command/ViewNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/dependency","dijit/Destroyable","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_6d7,lang,on,_6d8,_6d9,_6da,res){return _6d7([_6da,_6d9],{iconClass:"epi-iconBell epi-icon--medium",label:"",isAvailable:true,canExecute:true,badgeValue:"",_unreadCount:0,postscript:function(){this.inherited(arguments);this.service=this.service||_6d8.resolve("epi.cms.NotificationService");this.own(this.service.on("notification-updated",function(_6db){if(!_6db.hasRead){this.set("_unreadCount",this._unreadCount+1);}}.bind(this)));this._updateUnreadCount();},_execute:function(){this.set("_unreadCount",0);},_updateUnreadCount:function(){this.service.getUnreadNotificationCount().then(function(_6dc){this.set("_unreadCount",_6dc);}.bind(this));},__unreadCountSetter:function(_6dd){var _6de=_6dd>0?"("+_6dd+")":"";this._unreadCount=_6dd;this.set({badgeValue:_6dd>0?_6dd:null,label:lang.replace(res.viewnotifications,{unreadcount:_6de})});}});});},"epi-cms/command/ViewSettingsCommandProvider":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/ApplicationSettings","epi-cms/command/TogglePreviewMode","epi-cms/command/ToggleViewSettings","epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand","epi-cms/project/ProjectPreviewButton","epi-cms/contentediting/command/LanguageSelection","epi-cms/contentediting/viewmodel/LanguageSettingsModel","./DeviceSelection","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode"],function(_6df,_6e0,_6e1,_6e2,_6e3,_6e4,_6e5,_6e6,_6e7,_6e8,_6e9,_6ea){return _6df([_6e9],{postscript:function(){this.inherited(arguments);var _6eb={category:"view"};this.projectService=this.projectService||_6e0.resolve("epi.cms.ProjectService");var _6ec=new _6e7();this.add("commands",new _6e3({settings:_6eb,category:_6eb.category}));this.add("commands",new _6e6({category:_6eb.category,showLabel:true,settings:_6eb,optionsProperty:"availableLanguages",property:"selectedLanguage",model:_6ec}));if(!_6e1.limitUI){this.add("commands",new _6e4({category:_6eb.category,settings:_6eb}));}this.add("commands",new _6e8({settings:_6eb,category:_6eb.category}));if(!this.projectService.isProjectModeEnabled){this.add("commands",{settings:_6eb,category:_6eb.category,widget:new _6e5({showLabel:false})});}this.add("commands",new _6e2({settings:_6eb,category:_6eb.category,innerText:_6ea.message}));}});});},"epi-cms/command/TogglePreviewMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi-cms/_SidePanelsToggleMixin","dijit/Destroyable"],function(_6ed,lang,_6ee,_6ef,_6f0,_6f1,_6f2,_6f3){return _6ed([_6f0,_6f1,_6f2,_6f3],{iconClass:"epi-iconPreview",tooltip:_6ef.label,label:_6ef.label,canExecute:true,constructor:function(){this.own(_6ee.subscribe("/epi/cms/action/disablepreview",lang.hitch(this,"_deactivate")));},_execute:function(){this.set("active",!this.active);if(this.active){_6ee.publish("/epi/shell/action/changeview","view");this._hideSidePanels();}else{this._restoreSidePanels();_6ee.publish("/epi/shell/action/changeview",null);}},_deactivate:function(){if(this.active){this.set("active",false);this._restoreSidePanels();}},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(view!=="view"){this._deactivate();}}});});},"epi-cms/_SidePanelsToggleMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojo/topic","epi/dependency"],function(_6f4,lang,all,when,_6f5,_6f6){return _6f4([],{_profile:null,_isNavigationVisible:null,_isToolsVisible:null,constructor:function(){if(!this._profile){this._profile=_6f6.resolve("epi.shell.Profile");}this._storePanelVisibility();},_restoreSidePanels:function(){_6f5.publish("/epi/layout/pinnable/navigation/toggle",this._isNavigationVisible);_6f5.publish("/epi/layout/pinnable/tools/toggle",this._isToolsVisible);},_hideSidePanels:function(){this._storePanelVisibility().then(function(){_6f5.publish("/epi/layout/pinnable/navigation/toggle",false);_6f5.publish("/epi/layout/pinnable/tools/toggle",false);});},_storePanelVisibility:function(){return all([when(this._profile.get("navigation"),lang.hitch(this,function(_6f7){this._isNavigationVisible=_6f7?_6f7.visible:false;})),when(this._profile.get("tools"),lang.hitch(this,function(_6f8){this._isToolsVisible=_6f8?_6f8.visible:false;}))]);}});});},"epi-cms/command/ToggleViewSettings":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.viewsetting","epi/shell/command/ToggleCommand","epi/dependency","epi-cms/command/_NonEditViewCommandMixin"],function(_6f9,_6fa,_6fb,_6fc,_6fd,_6fe){return _6f9([_6fc,_6fe],{iconClass:"epi-iconEye",canExecute:true,property:"enabled",label:_6fb.viewsettingbutton,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",_6fd.resolve("epi.viewsettingsmanager"));}},_execute:function(){this.inherited(arguments);_6fa.publish("/epi/cms/action/eyetoggle",this.model.get(this.property));},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(this.active&&view&&view.indexOf("compare")!==-1){this.execute();}}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/OptionCommand","./VisitorGroupViewSettingsModel","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_6ff,_700,_701,_702,res){return _6ff([_701,_700],{iconClass:"epi-iconUsers",model:null,optionsProperty:"options",property:"selectedGroup",optionsLabel:res.header,postscript:function(){this.inherited(arguments);this.set("model",this.model||new _702());this.set("label",this.model.tooltip);this.set("active",!!this.model.selectedGroup);var self=this;this.own(this.model.watch("tooltip",function(_703,_704,_705){self.set("label",_705);}));this.own(this.model.watch("selectedGroup",function(_706,_707,_708){self.set("active",!!_708);}));}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_709,lang,_70a,_70b,when,_70c,_70d,_70e,res){return _709([_70b,_70c],{selectedGroup:null,tooltip:_70e.defaulttooltip,defaultItem:{value:null,label:res.defaultitem},options:[],postscript:function(){this.inherited(arguments);if(!this._store){var _70f=_70d.resolve("epi.storeregistry");this._store=_70f.get("epi.cms.visitorgroup");}if(!this._viewSettingsManager){this._viewSettingsManager=_70d.resolve("epi.viewsettingsmanager");}var _710=this._viewSettingsManager.getSettingProperty("visitorgroup");var self=this;when(this._store.query()).then(function(_711){if(!(_711 instanceof Array)){_711=[];}var _712=_711.map(function(item){return {label:item.name,value:item.id};});_712.unshift(self.defaultItem);self.set("options",_712);self.set("selectedGroup",_710,false);});},_selectedGroupSetter:function(_713,_714){if(this.selectedGroup===_713){return;}this.selectedGroup=_713;this._setTooltip();if(_714===false){return;}_70a.publish("/epi/cms/action/viewsettingvaluechanged","visitorgroup",this.selectedGroup);},_setTooltip:function(){var _715=this._getGroup(this.selectedGroup);if(_715){this.set("tooltip",lang.replace(_70e.tooltip,{visitorgroup:_715.label}));}else{this.set("tooltip",_70e.defaulttooltip);}},_getGroup:function(id){if(id===this.defaultItem.value){return null;}for(var idx in this.options){if(this.options[idx].value===id){return this.options[idx];}}return null;}});});},"epi-cms/project/ProjectPreviewButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/topic","epi/dependency","epi/i18n!epi/nls/episerver.cms.components.project.preview","epi/shell/widget/DeferredDropDownButton","epi-cms/project/ProjectSelectorList"],function(_716,lang,_717,_718,_719,_71a,_71b,_71c,_71d){return _716([_71c],{iconClass:"epi-icon--medium epi-iconProject",baseClass:"",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_71a.resolve("epi.storeregistry").get("epi.cms.project");},buildRendering:function(){this.inherited(arguments);_717.add(this.domNode,["epi-chromeless","epi-mediumButton"]);if(!this.dropDown){this.dropDown=new _71d({baseClass:"dijitMenu",enableDefaultValue:true,defaultValueText:_71b.defaultoption,store:this.store,header:_71b.header,loadStoreOnStartup:true});}},postCreate:function(){this.inherited(arguments);var self=this,_71e=_71a.resolve("epi.viewsettingsmanager").getSettingProperty("project"),_71f=_71e?this.store.get(parseInt(_71e)):new _718().resolve();_71f.then(function(_720){self.dropDown.set("selectedProject",_720);self._updateButtonState(_720);}).always(function(){self.own(self.dropDown.watch("selectedProject",lang.hitch(self,"_selectedProjectChanged")));});},loadAndOpenDropDown:function(){if(this.isLoaded()){return this.inherited(arguments).then(lang.hitch(this,function(){return this.dropDown.refresh();}));}return this.inherited(arguments);},_selectedProjectChanged:function(name,_721,_722){var _723=_722?_722.id:null;_719.publish("/epi/cms/action/viewsettingvaluechanged","project",_723);this._updateButtonState(_722);},_updateButtonState:function(_724){var _725=_71b.defaulttooltip;if(_724){_725=lang.replace(_71b.tooltip,{project:_724.name});}this.set("title",_725);_717.toggle(this.iconNode,"epi-icon--active",!!_724);}});});},"epi-cms/project/ProjectSelectorList":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","dijit/form/RadioButton","dijit/Menu","epi/epi","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ExpandoMenuBuilder","epi/shell/command/builder/OptionsBuilderMixin","epi/datetime","epi/username","./viewmodels/ProjectSelectorListViewModel","dojo/text!./templates/ProjectSelectorList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","dijit/Toolbar"],function(_726,_727,lang,keys,when,_728,_729,_72a,Menu,epi,_72b,_72c,_72d,_72e,_72f,_730,_731,_732,_733,res,_734,_735,_736,_737,_738,put,_739,_73a,misc,_73b,_73c,_73d,_73e){return _726([_73b,_73c,_73d,_73e,_72b],{templateString:_732,store:null,query:null,selectedProject:null,enableDefaultValue:false,defaultValueText:res.preview.defaultoption,header:res.title,loadStoreOnStartup:false,_setHeaderAttr:{node:"headerNode",type:"innerText"},_optionsMenuClass:_726([Menu,_72e]),postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _731());}},buildRendering:function(){this.inherited(arguments);this._setupProjectSortMenu();this.list=new (_726([_734,_735,_737,_736,_739,_73a]))({sort:[{attribute:"created",descending:true}],className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionMode:"exclusive",selectionEvents:"click",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.own(this.list,this.list.on("dgrid-select",lang.hitch(this,"_projectSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.ENTER,lang.hitch(this,"_listEnterKeypress")),this.model.watch("projectSortOrder",lang.hitch(this,"_sortChanged")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(_738.enterRow,lang.hitch(this,"_listMouseover")),this.defaultOption.on("click",lang.hitch(this,"_defaultOptionSelected")),this.defaultOption.on("keypress",lang.hitch(this,"_defaultOptionKeypress")),this.defaultOption.on("mouseover",lang.hitch(this,"_defaultOptionMouseover")));if(this.enableDefaultValue){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_728.add(this.defaultOption.domNode,"dijitHidden");}this.defaultOption.set({iconClass:"dijitRadioIcon",label:_729.encode(this.defaultValueText)});},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();this.list.startup();if(this.loadStoreOnStartup){this.list.set("store",this.store);}},focus:function(){if(this.enableDefaultValue){this.defaultOption.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_73f){var _740=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitRadio"));var _741=put("label.epi-selector-list__title.dojoxEllipsis",put("strong[title=$]",item.name,item.name));var _742=put("div.epi-selector-list__description.dojoxEllipsis",_72f.toUserFriendlyString(new Date(item.created))+", "+_730.toUserFriendlyString(item.createdBy));return put("div",[_740,_741,_742]);},refresh:function(){if(!this._started){return;}if(!this.list.get("store")){this.list.set("store",this.store);}return this.list.refresh().then(lang.hitch(this,function(_743){var _744=this.get("selectedProject"),_745=_744&&_743.some(function(item){if(item.id===_744.id){_744=item;return true;}return false;},this);this.set("selectedProject",_745?_744:null);}));},_projectSelected:function(e){var _746=e&&e.rows&&e.rows[0].data;if(!epi.areEqual(_746,this.get("selectedProject"))){this.set("selectedProject",_746);this.emit("change",{value:_746});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(_747){this.emit("loaded");_728.toggle(this.separatorNode,"dijitHidden",!_747||!this.enableDefaultValue);}));},_defaultOptionSelected:function(){this.set("selectedProject",null);this.emit("change",null);},_defaultOptionKeypress:function(e){var _748;switch(e.keyCode){case keys.DOWN_ARROW:_748=_736.moveFocusHome;break;case keys.PAGE_DOWN:_748=_736.moveFocusPageDown;break;case keys.END:_748=_736.moveFocusEnd;break;default:return;}_748.apply(this.list,[e]);},_defaultOptionMouseover:function(){this.defaultOption.focus();},_listEnterKeypress:function(e){this.list.clearSelection();this.list.select(e);},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_749=list.up(row,1,true);if(row.id===_749.id){this.defaultOption.focus();}},_listNavigateHome:function(){this.defaultOption.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_sortChanged:function(evt){var _74a=this.model[evt];if(this.list.get("sort")!==_74a){this.list.set("sort",_74a);}},_setSelectedProjectAttr:function(_74b){this._set("selectedProject",_74b);this.list.clearSelection();if(_74b){this.list.select(_74b.id);}this._updateView();},_updateView:function(){this.defaultOption.set("checked",!this.selectedProject);},_setupProjectSortMenu:function(){var _74c=[{builder:new _72d({settings:{"class":"epi-flat epi-chromeless",iconClass:"epi-iconSort",showLabel:false,label:res.command.sort.label}}),category:"context",target:this.toolbarGroupNode}];this.own(new _72c({configuration:_74c,commandSource:this.model}));}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_74d,_74e){return _74d(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _74f=this.getConsumer();if(!_74f){return;}this._consumerHandle=_74f.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_74e)){return this;}var _750=this.getParent();while(_750){if(_750.isInstanceOf(_74e)){return _750;}_750=_750.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/builder/ExpandoMenuBuilder":function(){define("epi/shell/command/builder/ExpandoMenuBuilder",["dojo/_base/declare","dojo/_base/lang","../_CommandModelBindingMixin","./ButtonBuilder","epi/shell/widget/ExpandoMenuButton"],function(_751,lang,_752,_753,_754){return _751([_753],{_expandoClass:_751([_754,_752]),_expandoMenu:null,_create:function(_755){var _756,_757;if(_755.widget){return _755.widget;}_756=_755.get("options") instanceof Array;_757=typeof _755.active==="boolean";if(!_756&&_757){return this._expandoMenu=new this._expandoClass(this._createOptions(_755));}return this.inherited(arguments);},_createOptions:function(_758){return lang.mixin({innerText:_758.innerText,showLabel:!!_758.showLabel},this.inherited(arguments));},_addToContainer:function(_759,_75a){if(!(_759 instanceof _754)&&this._expandoMenu){_75a=this._expandoMenu;}this.inherited(arguments,[_759,_75a]);}});});},"epi/shell/widget/ExpandoMenuButton":function(){require({cache:{"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\r\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\r\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\r\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\r\n--></span>\r\n"}});define("epi/shell/widget/ExpandoMenuButton",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/has","dojo/text!./templates/ExpandoMenuButton.html","dijit/registry","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","dijit/_TemplatedMixin","dgrid/util/has-css3","dijit/form/ToggleButton"],function(_75b,lang,_75c,on,_75d,_75e,_75f,_760,has,_761,_762,_763,_764,_765){return _75b([_763,_765,_764],{templateString:_761,label:"",innerText:"",iconClass:"",postCreate:function(){this.inherited(arguments);if(has("css-transitions")){this.own(on(this.expandoNode,has("transitionend"),lang.hitch(this,this._onTransitionEnd)));}},_setLabelAttr:function(_766){this.toggleButton.set("label",_766);this._set("label",_766);},_setInnerTextAttr:function(_767){this._set("innerText",_767);if(_767){this.innerTextNode.textContent=_767;}_75d.toggle(this.innerTextContainerNode,"dijitHidden",!_767);},_setIconClassAttr:function(_768){this._set("iconClass",_768);this._updateToggleButtonIcon();},_setCheckedAttr:function(_769){this.toggleButton.set("checked",_769);this._set("checked",_769);this._updateToggleButtonIcon();this._showChildren(_769);},addChild:function(_76a){if(this.innerTextContainerNode){_75d.add(this.innerTextContainerNode,"dijitHidden");}var li=_760.create("li",{},this.expandoNode);_76a.placeAt(li);},onClick:function(){},onChange:function(val){},getChildren:function(){return _762.findWidgets(this.expandoNode);},_toggleButtonClick:function(){this.onClick();},_toggleButtonChange:function(val){this.set("checked",val);this.onChange(val);},_updateToggleButtonIcon:function(){var _76b=["epi-icon--medium"];if(this.iconClass){_76b.push(this.iconClass);}if(this.checked){_76b.push("epi-icon--active");}this.toggleButton.set("iconClass",_76b.join(" "));},_showChildren:function(show){var node=this.expandoNode;if(show){_75d.toggle(node,"dijitHidden",false);_75f.set(node,"width",this._childrenWidth()+"px");}else{_75f.set(node,"width",this._childrenWidth()+"px");node.offsetWidth;_75f.set(node,"width","0px");}},_onTransitionEnd:function(){var _76c=this.get("checked");_75d.toggle(this.expandoNode,"dijitHidden",!_76c);if(_76c){_75f.set(this.expandoNode,"width","");}},_childrenWidth:function(){var _76d=0;_75c.forEach(this.expandoNode.childNodes,function(_76e){_76d+=_75e.getMarginBox(_76e).w;});return _76d;}});});},"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\r\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\r\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\r\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\r\n--></span>\r\n","epi-cms/project/viewmodels/ProjectSelectorListViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort"],function(_76f,lang,_770,_771,when,_772,_773,_774,_775){return _76f([_771,_772,_770],{namedCommands:null,profile:null,projectSortOrder:null,_commands:null,_sortOrderProfileKey:"epi.project-sort-order",constructor:function(){this.projectSortOrder=[{attribute:"name",descending:false}];},postscript:function(){this.inherited(arguments);this.profile=this.profile||_773.resolve("epi.shell.Profile");this._createCommands();},initialize:function(){return when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _776=this._findSortOption("key",sort)||this.namedCommands.sortProject.options[0];this._changeAttrValue("projectSortOrder",_776.value);}));},getCommands:function(){return this._commands;},_projectSortOrderSetter:function(_777){var _778,key;if(_777===null||(_777&&_777===this.projectSortOrder)){return;}this.projectSortOrder=_777;_778=this._findSortOption("value",_777);key=_778&&_778.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_findSortOption:function(key,term){var _779=this.namedCommands.sortProject.options,_77a=null;term&&_779.some(function(item){if(term===item[key]){_77a=item;return true;}});return _77a;},_createCommands:function(){var _77b=new _774({model:this,category:"context",label:"label",property:"projectSortOrder",options:[{label:_775.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_775.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_775.createddescending,key:"-DateCreated",value:[{attribute:"created",descending:true},{attribute:"name",descending:false}]},{label:_775.createdascending,key:"+DateCreated",value:[{attribute:"created",descending:false},{attribute:"name",descending:false}]}]});this.set("_commands",[_77b]);this.set("namedCommands",{sortProject:_77b});}});});},"url:epi-cms/project/templates/ProjectSelectorList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\"></span>\r\n        </div>\r\n        <div data-dojo-type=\"dijit/Toolbar\" data-dojo-attach-point=\"toolbar\" class=\"epi-flatToolbar\">\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </div>\r\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"defaultOption\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitRadioIcon'\"></button>\r\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","dgrid/util/mouse":function(){define(["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _77c(_77d,type){return function(node,_77e){return on(node,_77d+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _77e.call(this,evt);}});};};return {enterRow:_77c(".dgrid-content .dgrid-row","mouseover"),enterCell:_77c(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_77c(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_77c(".dgrid-content .dgrid-row","mouseout"),leaveCell:_77c(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_77c(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_77c};});},"epi/shell/dgrid/selection/Exclusive":function(){define("epi/shell/dgrid/selection/Exclusive",["dojo/_base/declare"],function(_77f){return _77f([],{_exclusiveSelectionHandler:function(_780,_781){if(this._lastSelected!==_781){this.clearSelection();this.select(_781);this._lastSelected=_781;}}});});},"epi-cms/contentediting/command/LanguageSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_782,_783,_784){return _782([_783],{optionsLabel:_784.contentdetails.existinglanguages,active:false,selected:"",_selectedSetter:function(_785){this.inherited(arguments);if(typeof (_785)=="string"&&_785!==""){this.set("label",_785.toUpperCase());if(_785!==this.model.get("documentLanguage")){this.set("active",true);}else{this.set("active",false);}}}});});},"epi-cms/contentediting/viewmodel/LanguageSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dojo/Deferred","epi/dependency","epi-cms/component/SiteTreeModel"],function(_786,lang,_787,_788,when,_789,_78a,_78b,_78c){return _786([_788],{enabled:false,documentLanguage:"",selectedLanguage:"",availableLanguages:[],profile:null,siteTreeModel:null,postscript:function(){this.inherited(arguments);if(!this.siteTreeModel){var _78d=_78a.resolve("epi.storeregistry"),_78e=_78d.get("epi.cms.sitestructure");this.siteTreeModel=new _78b({store:_78e});}this.profile=this.profile||_78a.resolve("epi.shell.Profile");this.siteTreeModel.getCurrentSite().then(lang.hitch(this,"_setAvailableLanguages")).then(lang.hitch(this,function(){when(this.profile.getContentLanguage(),lang.hitch(this,function(_78f){this.set("documentLanguage",_78f);this.set("selectedLanguage",_78f,false);}));}));},_setAvailableLanguages:function(site){if(site){var def=new _789();this.siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_790){var obj=_790.filter(function(item){return (item.languageId&&item.name);}).map(function(item){return {label:item.name,value:item.languageId};});this.set("availableLanguages",obj);def.resolve();}));return def.promise;}else{return new _789().resolve();}},_enabledSetter:function(_791){if(this.enabled!==_791){this.enabled=_791;_787.publish("/epi/cms/action/eyetoggle",_791);}},_selectedLanguageSetter:function(_792,_793){if(_793!==false){_787.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_792);}}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","dijit/Destroyable","epi/dependency"],function(_794,_795,_796,_797,when,lang,_798,_799,_79a,_79b){return _795([_796,_79a],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_79b.resolve("epi.shell.Profile");this.own(_798.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_79c){this.onItemChildrenReload({siteUrl:_79c.currentSite});}));})));},getRoot:function(_79d,_79e){_79d({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_79f){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_7a0,_7a1){when(this.store.query(lang.mixin({siteUrl:_7a0.url},this.query)),_7a1);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_7a2){this.showAllLanguages=_7a2;this._setQuery({allLanguages:_7a2});},getCurrentSite:function(){var def=new _797();when(this.profile.getContentLanguage(),lang.hitch(this,function(_7a3){if(_7a3){when(this.store.get(),lang.hitch(this,function(_7a4){var _7a5=null;var _7a6=null;_794.some(_7a4,function(site){return _794.some(site.hosts,function(host){if(host==="*"){_7a6=site;return true;}});});var _7a7=this.location.host.toLowerCase();var _7a8=_794.some(_7a4,function(site){return _794.some(site.hosts,function(host){if(_7a7===host.toLowerCase()){_7a5={currentSite:site.url,currentEditLanguageId:site.url+_7a3};return true;}});});if(!_7a8&&_7a6){_7a5={currentSite:_7a6.url,currentEditLanguageId:_7a6.url+_7a3};}if(_7a5){def.resolve(_7a5);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_7a9){var def=new _797();when(this.store.query({siteUrl:_7a9,allLanguages:true}),function(_7aa){def.resolve(_7aa);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _797();when(this.getCurrentSite(),lang.hitch(this,function(_7ab){this.getAllLanguagesForSite(_7ab.currentSite).then(function(_7ac){def.resolve(_7ac);});}),function(_7ad){def.reject(_7ad);});return def;}});});},"epi-cms/command/DeviceSelection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/DestroyableByKey","epi/shell/command/OptionCommand","epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel"],function(_7ae,lang,_7af,_7b0,_7b1){return _7ae([_7b0,_7af],{iconClass:"epi-iconDevice",optionsProperty:"options",canExecute:true,active:false,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",new _7b1());}},_updateFromModel:function(){this.set("label",this.model.get("label"));this.set("active",!!(this.model.get("resolution")||this.model.get("channel")));},_onModelChange:function(){this.inherited(arguments);var _7b2="_ChannelCommandModelWatch";this.destroyByKey(_7b2);if(this.model){this._updateFromModel();this.ownByKey(_7b2,this.model.watch(lang.hitch(this,function(name,_7b3,_7b4){if(["label","resolution","channel"].indexOf(name)!==-1){this._updateFromModel();}})));}}});});},"epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/topic","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/OptionGroup","epi/i18n!epi/cms/nls/episerver.cms.widget"],function(_7b5,lang,_7b6,_7b7,_7b8,_7b9,_7ba,_7bb){return _7b5([_7b6],{resolution:null,channel:null,postscript:function(){this.inherited(arguments);this._updateLabel();if(!this.get("viewSettingsManager")){this.set("viewSettingsManager",_7b8.resolve("epi.viewsettingsmanager"));}if(!this.get("channelStore")){var _7bc=_7b8.resolve("epi.storeregistry");this.set("channelStore",_7bc.get("epi.cms.displaychannels"));}},_resolutionSetter:function(_7bd){if(_7bd!==this.resolution){this.resolution=_7bd;this._onChange();}},_channelSetter:function(_7be){if(_7be!==this.channel){this.channel=_7be;this.set("resolution",this._getDefaultResolutionForChannel(_7be));this._onChange();}},_viewSettingsManagerSetter:function(_7bf){this.viewSettingsManager=_7bf;this.set("resolution",_7bf.getSettingProperty("resolution"));this.set("channel",_7bf.getSettingProperty("epichannel"));},_channelStoreSetter:function(_7c0){this.channelStore=_7c0;this._initialize();},_onChange:function(){this._updateLabel(this.get("resolution"),this.get("channel"));var _7c1=[{key:"resolution",value:this.get("resolution")},{key:"epichannel",value:this.get("channel")}];_7b7.publish("/epi/cms/action/viewsettingvaluechanged",_7c1);},_updateLabel:function(_7c2,_7c3){var _7c4=_7bb.channelbutton.defaulttooltip;if(_7c2||_7c3){_7c4=lang.replace(_7bb.channelbutton.tooltip,{channel:this._getOptionLabel(this._availableChannels,_7c3),resolution:this._getOptionLabel(this._availableResolutions,_7c2)});}this.set("label",_7c4);},_getOptionLabel:function(_7c5,_7c6){var _7c7=this._find(_7c5,function(item){return item.value===_7c6;});return _7c7&&_7c7.label||"";},_initialize:function(){this.channelStore.query({query:"getallregistered"}).then(lang.hitch(this,function(_7c8){this._availableResolutions=this._getAvailableResolutions();this._availableChannels=[{value:null,label:_7bb.channelselector.defaultitem}].concat(_7c8.map(function(_7c9){return {value:_7c9.channelName,label:_7c9.name,resolutionId:_7c9.resolutionId};}));var _7ca=[];if(!_7b9.limitUI){_7ca.push(new _7ba({property:"channel",model:this,label:_7bb.channelselector.header,options:this._availableChannels}));}_7ca.push(new _7ba({property:"resolution",model:this,label:_7bb.resolutionselector.header,options:this._availableResolutions}));this.set("options",_7ca);}));},_getAvailableResolutions:function(){var _7cb=[{value:null,label:_7bb.channelselector.defaultitem}];if(_7b9.displayResolutions){_7cb=_7cb.concat(_7b9.displayResolutions.map(function(r){return {value:r.width+"x"+r.height,label:r.name,id:r.id};}));}return _7cb;},_getDefaultResolutionForChannel:function(_7cc){var _7cd=this._availableResolutions;if(!(_7cc&&lang.isArray(_7cd))){return null;}_7cc=this._find(this._availableChannels,function(c){return c.value===_7cc;});var _7ce=this._find(_7cd,function(r){return (r.id===_7cc.resolutionId);});return _7ce?_7ce.value:null;},_find:function(_7cf,_7d0){var _7d1=null;if(!lang.isArray(_7cf)){return null;}_7cf.some(function(_7d2){if(_7d0(_7d2)){_7d1=_7d2;return true;}});return _7d1;}});});},"epi-cms/content-activity/command/ContentActivityCommandProvider":function(){define(["dojo/_base/declare","dijit/form/ToggleButton","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/content-activity/command/ContentActivityCommand"],function(_7d3,_7d4,_7d5,_7d6){return _7d3([_7d5],{model:null,postscript:function(){this.inherited(arguments);var _7d7={widget:_7d4,"class":"epi-chromeless epi-mediumButton"};this.addToTrailing(new _7d6({model:this.model,order:-10001}),_7d7);}});});},"epi-cms/content-activity/command/ContentActivityCommand":function(){define(["dojo/_base/declare","epi-cms/project/command/ToggleProjectActivities","epi-cms/command/_NonEditViewCommandMixin"],function(_7d8,_7d9,_7da){return _7d8([_7d9,_7da],{category:"content-activities"});});},"epi-cms/project/command/ToggleProjectActivities":function(){define(["dojo/_base/declare","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.activities.togglecommand.label"],function(_7db,_7dc,_7dd){return _7db([_7dc],{canExecute:true,category:"projectButton",iconClass:"epi-iconBubble",label:_7dd.show,property:"isActivitiesVisible",_activeSetter:function(_7de){this.active=_7de;this.set("label",_7de?_7dd.hide:_7dd.show);}});});},"epi-cms/contentediting/ContentHierarchyService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","epi/dependency","epi/shell/DialogService","epi-cms/core/ContentReference"],function(_7df,lang,when,_7e0,all,_7e1,_7e2,_7e3){return _7df([],{store:null,constructor:function(_7e4){_7df.safeMixin(this,_7e4);this.store=this.store||_7e1.resolve("epi.storeregistry").get("epi.cms.content.light");},move:function(_7e5,_7e6,_7e7,_7e8){return this._execute("MoveMany",_7e5,_7e6,_7e7,_7e8);},copy:function(_7e9,_7ea,_7eb,_7ec){return this._execute("CopyMany",_7e9,_7ea,_7eb,_7ec);},_execute:function(_7ed,_7ee,_7ef,_7f0,_7f1){var _7f2={ids:_7ee instanceof Array?_7ee:[_7ee],targetId:_7ef+"",createAsLocalAsset:_7f0,sortIndex:_7f1};return this.store.executeMethod(_7ed,null,_7f2).then(this._checkForErrors.bind(this)).then(this._handleUpdates.bind(this));},_checkForErrors:function(_7f3){var _7f4=new _7e0(),_7f5=this.store.getAllResponsesWithError(_7f3).map(function(_7f6){return _7f6.message;});if(_7f5.length>0){_7e2.alertWithErrors({},_7f5).then(function(){_7f4.resolve(_7f3);});}else{_7f4.resolve(_7f3);}return _7f4.promise;},_handleUpdates:function(_7f7){var _7f8=this.store,_7f9=this._getUpdatesFromResponse(_7f7);return all(_7f9.map(function(item){var id=_7e3.toContentReference(item.extraInformation).createVersionUnspecificReference().toString();return _7f8.refresh(id,true);})).then(function(_7fa){_7fa.forEach(function(item){_7f8.notify(item,_7f8.getIdentity(item));});return _7f7;});},_getUpdatesFromResponse:function(_7fb){var _7fc=_7fb.extraInformation,_7fd=[];Object.keys(_7fc).forEach(function(id){var item=_7fc[id];if(item.statusCode===200){_7fd.push(item);}});return _7fd;}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_7fe,_7ff,lang,_800){return _7fe(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_801){},onEditorResolved:function(data,_802){},constructor:function(){var _803=_800.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_803&&_803.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_804,_805,_806){this._registeredEditorWrappers[_804]={wrapperClassType:_805,initializer:_806};},_handleContentEditable:function(_807,_808,_809){var _80a="epi-cms/contentediting/editors/ContentEditableEditor";if(_807!==_80a||_808==="contenteditable"){return _807;}var _80b=_809&&_809!==_80a;return _80b?_809:"dijit/form/ValidationTextBox";},_getWrapperAndEditor:function(_80c){var _80d=_80c.wrapperType;var _80e=_80c.editorParams||{};var _80f=_80c.editorWidgetType;if(!_80d){if(_80c.metadata.customEditorSettings&&_80c.metadata.customEditorSettings.uiWrapperType){_80d=_80c.metadata.customEditorSettings.uiWrapperType;}else{_80d=this.defaultWrapperType;}}if(!_80f){if(_80c.metadata.customEditorSettings&&_80c.metadata.customEditorSettings.uiType){_80f=_80c.metadata.customEditorSettings.uiType;}else{if(_80c.metadata.uiType){_80f=_80c.metadata.uiType;}else{_80f="epi/shell/widget/FormContainer";lang.mixin(_80e,{metadata:_80c.metadata,onFieldCreated:function(_810,_811){}});}}}_80f=this._handleContentEditable(_80f,_80d,_80c.metadata.uiType);if(!_80f){throw ("Could not resolve editor widget for property: "+_80c.name);}var data={editorWidgetType:_80f,editorParams:_80e};if(_80c.metadata.customEditorSettings&&_80c.metadata.customEditorSettings.uiParams){lang.mixin(_80e,_80c.metadata.customEditorSettings.uiParams);}var _812=this._registeredEditorWrappers[_80d];if(!_812){throw ("No suitable editor wrapper found for type: "+_80d);}if(_80c.metadata.customEditorSettings&&_80c.metadata.customEditorSettings.uiWrapper){data.wrapperInitializer=null;data.wrapperType=_80c.metadata.customEditorSettings.uiWrapper;}else{data.wrapperInitializer=_812.initializer;data.wrapperType=_812.wrapperClassType;}this.onEditorResolved(data,_80c);if(_80d){return data;}throw ("No suitable editor found");},createEditor:function(_813,node,_814,_815){var def=new _7ff();var _816=this._getWrapperAndEditor(_813);var _817=_816.wrapperType;var _818=_816.editorWidgetType;require([_817,_818],lang.hitch(this,function(_819){var _81a=_815||{};if(_813.metadata){lang.mixin(_81a,_813.metadata.settings);lang.mixin(_81a,_816.editorParams);_81a.selections=_813.metadata.selections;}var _81b={wrapperType:_816.wrapperType,editorWidgetType:_816.editorWidgetType,editorParams:_81a,blockDisplayNode:node,overlayItem:_81a.overlayItem,property:_813,propertyName:_813.name,propertyDisplayName:_813.metadata.displayName,value:_814,contentModel:_813.contentModel};var _81c=new _819(_81b);var _81d=_816.wrapperInitializer;if(_81d){lang.mixin(_81b.editorParams,{parent:_81c});_81d(_81c,_81b);}this.onEditorCreated(_81c.getEditorWidget());def.resolve(_81c);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/username","epi/dependency","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_81e,_81f,when,_820,_821,epi,_822,_823,_824,_825,res){return _81f([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_826){this.inherited(arguments);lang.mixin(this,_826);this._inUseNotificationStore=this.store||_823.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_824.userName;this._messageService=this.messageService||_823.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_827){this.inherited(arguments);if(this.currentModel&&!_825.compareIgnoreVersion(this.currentModel.contentData.contentLink,_827.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_827;_81e.forEach(this._eventHandlers,function(_828){_828.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_821.after(_827,"suspend",lang.hitch(this,this._onViewModelSuspended)),_821.after(_827,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_821.after(_827,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_821.around(_827,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_829){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _82a=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_82a&&_82a.length){return false;}}return _829.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _82b=this.currentModel.contentData;this.removeAutomaticInUseNotification(_82b);},_onPropertyEdited:function(){var _82c=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_82c);},ensureAutomaticInUseNotification:function(_82d){var _82e;_81e.some(_82d.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_82e=item;return true;}},this);if(!_82e){return this.put(this._createNotification(_82d,false),_82d.inUseNotifications);}else{if(_82e.addedManually){return;}else{var _82f=new Date(_82e.modified);if(_820.difference(_82f,new Date(),"minute")>30){return this.put(_82e,_82d.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_830){_81e.forEach(_830.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_830.inUseNotifications);}},this);},_createNotification:function(_831,_832){var _833=(new Date()).toISOString();return {contentLink:_831.contentLink,languageBranch:_831.currentLanguageBranch&&_831.currentLanguageBranch.languageId,addedManually:_832,created:_833,modified:_833};},put:function(_834,_835){_834.modified=(new Date()).toISOString();if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_834),lang.hitch(this,function(_836){var _837;var _838=_81e.some(_835,function(item,_839){if(_836.id===item.id){_837=_839;return true;}return false;});if(_838&&_837>=0){_835[_837]=_836;}else{_835.push(_836);}this._updateDependentStores(_834.contentLink,_835);this._postFlag=false;}));}},remove:function(_83a,_83b){return when(this._inUseNotificationStore.remove(_83a.id),lang.hitch(this,function(){var _83c=_81e.indexOf(_83b,_83a);_83b.splice(_83c,1);this._updateDependentStores(_83a.contentLink,_83b);}));},_updateDependentStores:function(_83d,_83e){var _83f={contentLink:_83d,inUseNotifications:_83e};this._inUseNotificationStore.updateDependentStores(_83f);},togglePermanentEditIndication:function(_840,_841){var _842;var _843=_81e.some(_840.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_842=item;if(item.addedManually){return true;}}},this);if(_843){if(_841&&_842.convertedFromAutomaticNotification){_842.addedManually=false;return this.put(_842,_840.inUseNotifications);}else{return this.remove(_842,_840.inUseNotifications);}}else{if(_842&&_841){_842.convertedFromAutomaticNotification=true;_842.addedManually=true;}else{_842=this._createNotification(_840,true);}return this.put(_842,_840.inUseNotifications);}},updateMessageService:function(_844){var _845=_844.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_845});var _846=this._getManualInUseNotification(_844.inUseNotifications);if(_846){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_844.contentLink,_845,null);}},_getManualInUseNotification:function(_847){var _848;_81e.forEach(_847,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_848=item;}},this);return _848;},currentUserHasInUseNotification:function(_849,_84a){return _81e.some(_849,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_84a||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_84b){var _84c=[];_81e.forEach(_84b,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){var _84d=_822.toUserFriendlyString(item.userName,this._currentUsername);_84c.push(_84d);}},this);return _84c;},hasInUseNotificationWarning:function(_84e){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_84e).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/when","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi/shell/StickyViewSelector"],function(_84f,_850,lang,_851,when,_852,epi,_853,_854,_855,_856){return _84f([_852,_855],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:null,_activeKey:"active",enabled:false,previewParams:null,_stickyViewSelector:null,postscript:function(){this.inherited(arguments);this._stickyViewSelector=this._stickyViewSelector||new _856();this._hashWrapper=this._hashWrapper||_853.resolve("epi.shell.HashWrapper");this.previewParams={};this.viewSettingsHashValue=[];this._viewSettingsMap={};_850.forEach(this.viewSettings,lang.hitch(this,function(_857){if(!this._viewSettingsMap[_857.key]){this._viewSettingsMap[_857.key]=_857;}else{throw "Duplicated view settings key.";}}));this.own(_851.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged)),_851.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged)));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_850.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _858=this._viewSettingsMap[item.type];if(_858){_858.set("enabled",this.get("enabled"));_858.value=item.id;_858.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_859){this._preview=_859;_850.forEach(this.viewSettings,lang.hitch(this,function(_85a){_85a.afterPreviewLoad(_859,this.get("enabled"));}));},getSettingProperty:function(_85b){var _85c=_850.filter(this.viewSettingsHashValue,function(_85d){return _85d.type===_85b;});return _85c.length>0?_85c[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_85e){this.enabled=_85e;var _85f={};_850.forEach(this.viewSettings,lang.hitch(this,function(_860){_860.set("enabled",_85e);_860.beforePreviewLoad(_85f,_85e);}));if(!epi.areEqual(this.previewParams,_85f)){this.previewParams=_85f;}else{_850.forEach(this.viewSettings,lang.hitch(this,function(_861){_861.afterPreviewLoad(this._preview,_85e);}));}},_applyViewSettingValue:function(key,_862){var _863,_864=this._viewSettingsMap[key];if(_864){_863=lang.clone(this.previewParams);_864.value=_862;_864.beforePreviewLoad(_863,true);if(!epi.areEqual(this.previewParams,_863)){this.previewParams=_863;}else{_864.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_865){var self=this;when(this.getCurrentContext()).then(function(_866){if(key!=="viewlanguage"){this._stickyViewSelector.save(_866.hasTemplate,_866.dataType,"onpageedit");}this._commitToHash(function(){var _867=key;if(!(key instanceof Array)){_867=[{key:key,value:_865}];}_867.forEach(function(_868){self._saveProperty(_868.key,_868.value);self._applyViewSettingValue(_868.key,_868.value);});});}.bind(this));},_viewSettingEnabledChanged:function(_869){var self=this;if(_869){when(this.getCurrentContext()).then(function(_86a){this._stickyViewSelector.save(_86a.hasTemplate,_86a.dataType,"onpageedit");this._commitToHash(function(){self._saveProperty(self._activeKey,"true");self.set("enabled",_869);});}.bind(this));}else{this._commitToHash(function(){var _86b=self._hasSetting();self._saveProperty(self._activeKey,_86b?false:null);self.set("enabled",_869);});}},_addProperty:function(_86c,_86d){this.viewSettingsHashValue.push({type:_86c,id:_86d});},_updateProperty:function(_86e,_86f){var _870=-1;_850.forEach(this.viewSettingsHashValue,function(item,_871){if(item.type===_86e){_870=_871;return;}});if(_870>-1){this.viewSettingsHashValue[_870].id=_86f;}else{this._addProperty(_86e,_86f);}},_toObjects:function(url){var _872=[];_850.forEach(url.split("|"),function(item,_873){var uri=new _854(item);_872.push({type:uri.getType(),id:uri.getId()});});return _872;},_deleteProperty:function(_874){var _875=-1;_850.forEach(this.viewSettingsHashValue,function(item,_876){if(item.type===_874){_875=_876;return;}});if(_875>-1){this.viewSettingsHashValue.splice(_875,1);}},_commitToHash:function(_877){var obj=this._hashWrapper.getHash();var _878=[];if(obj&&obj.viewsetting){this.set("viewSettingsHashValue",this._toObjects(obj.viewsetting));}else{this.set("viewSettingsHashValue",[]);}_877();_850.forEach(this.viewSettingsHashValue,function(item,_879){_878.push(item.type+":///"+item.id);});if(_878.length>0){obj.viewsetting=_878.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_87a,_87b){if(this.get("viewSettingsHashValue")){if(_87b!=null){this._updateProperty(_87a,_87b);}else{this._deleteProperty(_87a);}}else{if(_87b!=null){this._updateProperty(_87a,_87b);}}},_loadProperty:function(_87c){var obj=this._hashWrapper.getHash();var _87d=null;if(obj&&obj.viewsetting){var _87e=this._toObjects(obj.viewsetting);var _87f=_850.filter(_87e,function(item){return item.type===_87c;})[0];if(_87f){_87d=_87f.id;}}return _87d;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _850.filter(this.viewSettings,lang.hitch(this,function(_880){return _880.usedForRendering;}));}});});},"epi-cms/content-approval/ApprovalService":function(){define(["dojo/topic","dojo/when","dojo/Deferred","epi/shell/xhr/errorHandler","epi/dependency"],function(_881,when,_882,_883,_884){function _885(_886,_887){this.approvalStore=_886||_884.resolve("epi.storeregistry").get("epi.cms.approval");this.approvalDefinitionStore=_887||_884.resolve("epi.storeregistry").get("epi.cms.approval.definition");};_885.prototype.approvalStore=null;_885.prototype.approvalDefinitionStore=null;_885.prototype.getApproval=function(_888){return when(this.approvalStore.get(_888)).otherwise(function(){return null;});};_885.prototype.approveChanges=function(_889,_88a,_88b){return _883.wrapXhr(this.approvalStore.executeMethod("ApproveChanges",_889,{activeStepIndex:_88a,approveReason:_88b}));};_885.prototype.forceCompleteApproval=function(_88c,_88d){return _883.wrapXhr(this.approvalStore.executeMethod("ForceComplete",_88c,{forceReason:_88d}));};_885.prototype.rejectChanges=function(_88e,_88f,_890){return _883.wrapXhr(this.approvalStore.executeMethod("RejectChanges",_88e,{activeStepIndex:_88f,rejectReason:_890}));};_885.prototype.cancelChanges=function(_891){return _883.wrapXhr(this.approvalStore.executeMethod("CancelChanges",_891.id));};_885.prototype.commentChanges=function(_892,_893){return _883.wrapXhr(this.approvalStore.executeMethod("CommentChanges",_892,{comment:_893}));};_885.prototype.getDefinition=function(_894){return when(this.approvalDefinitionStore.get(_894)).otherwise(function(){return null;});};_885.prototype.getApprovalRelatedDefinition=function(_895){return when(this.approvalDefinitionStore.query({id:_895,getApprovalRelatedDefinition:true})).otherwise(function(){return null;});};_885.prototype.navigateToDefinition=function(_896){_881.publish("/epi/shell/context/request",{uri:"epi.cms.approval:///"+_896},{sender:null});};_885.prototype.hasDefinition=function(_897){return this.getDefinition(_897).then(function(_898){return _898!==null&&_898.id!==0;});};_885.prototype.saveDefinition=function(_899){if(!_899){return new _882().reject();}return _883.wrapXhr(this.approvalDefinitionStore.put(_899));};_885.prototype.deleteDefinition=function(_89a){return _883.wrapXhr(this.approvalDefinitionStore.remove(_89a));};_885.prototype.inheritDefinition=function(_89b){return _883.wrapXhr(this.approvalDefinitionStore.executeMethod("Inherit",_89b));};return _885;});},"epi/shell/xhr/errorHandler":function(){define("epi/shell/xhr/errorHandler",["dojo/_base/declare","dojo/when","dojo/_base/json","dgrid/List","dgrid/extensions/DijitRegistry","epi/shell/DialogService","../widget/dialog/Alert","../widget/dialog/ErrorDialog"],function(_89c,when,json,List,_89d,_89e,_89f,_8a0){var _8a1=_89c([List,_89d]),_8a2;function _8a3(_8a4){if(typeof _8a4==="string"){try{return json.fromJson(_8a4);}catch(e){console.warn("Failed to parse responseText as json",e);}}return {};};_8a2={forXhr:function(_8a5){var data,_8a6,list;if(_8a5.status>=500){_8a0.showXmlHttpError(_8a5,_8a5);}else{data=_8a3(_8a5.responseText);_8a6={description:data.message||_8a5.message};if(data.additionalInformation instanceof Array){list=new _8a1({className:"epi-grid-max-height--300"});list.renderArray(data.additionalInformation);list.startup();_8a6.content=list;}return _89e.alert(_8a6);}},wrapXhr:function(_8a7){_8a7=when(_8a7);_8a7.otherwise(_8a2.forXhr);return _8a7;}};return _8a2;});},"epi/shell/widget/dialog/ErrorDialog":function(){define("epi/shell/widget/dialog/ErrorDialog",["dojo","dijit/Dialog"],function(dojo,_8a8){var _8a9=null;var _8aa="/shell/cms/errordialog/";var _8ab={title:"A background request has failed",reloadtext:"Reload",heading:"An unhandled error has occured in a background request.",description:"The page may not function properly unless it's reloaded. Press the button below to reload the page now."};var _8ac="        <div style=\"padding-bottom:10px; width:600px\">             <h1>${heading}</h1>             <div style=\"background-color:#FFF; border:1px solid #000; padding:3px\">${errorMessage}</div>             <p>${description}</p>             <input type=\"button\" onclick=\"document.location.reload()\" value=\"${reloadtext}\" />         </div>     ";function _8ad(){if(!_8a9){_8a9=new _8a8();}return _8a9;};function _8ae(_8af,_8b0){var _8b1=dojo.create("div",{innerHTML:dojo.string.substitute(_8ac,dojo.mixin({errorMessage:_8af},_8ab))});var _8b2=dojo.create("iframe",{style:"width:100%; height:400px; border:inset 1px #CCC",frameborder:"0",width:"600",height:"400",src:"about:blank"});if(_8b2.attachEvent){var _8b3=function(){_8b2.detachEvent("onload",_8b3);_8b2.contentWindow.document.write(_8b0);};_8b2.attachEvent("onload",_8b3);}else{var _8b4=dojo.connect(_8b2,"load",null,function(){dojo.disconnect(_8b4);_8b2.contentWindow.document.write(_8b0);});}dojo.place(_8b2,_8b1);return _8b1;};var pub={getTextResourceKeys:function(){var _8b5=[];for(var p in _8ab){_8b5.push(_8aa+p);}return _8b5;},setTextResources:function(keys){if(!dojo.isArray(keys)){return;}dojo.forEach(keys,function(item){if(dojo.isString(item.key)&&dojo.isString(item.text)){_8ab[item.key.replace(_8aa,"")]=item.text;}});},showXmlHttpError:function(_8b6,_8b7){var _8b8=_8ad();var _8b9="";var _8ba="";if(_8b7&&_8b7.xhr){_8b9=_8b7.xhr.responseText;}if(dojo.isObject(_8b6)&&dojo.isString(_8b6.message)){_8ba=_8b6.message;}else{_8ba=_8b6;}var _8bb=_8ae(_8ba,_8b9);_8b8.set("title",_8ab.title);_8b8.set("content",_8bb);_8b8.show();}};return pub;});},"epi-cms/project/ProjectService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","dojo/Evented","dojo/aspect","dijit/Destroyable","epi/dependency","epi/shell/xhr/errorHandler","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_8bc,lang,when,_8bd,all,_8be,_8bf,_8c0,_8c1,_8c2,_8c3,_8c4){return _8bc([_8be,_8c0],{isProjectModeEnabled:false,projectItemStore:null,projectStore:null,_currentProjectProfileKey:"epi.current-project-id",constructor:function(_8c5){_8bc.safeMixin(this,_8c5);this.projectItemStore=this.projectItemStore||_8c1.resolve("epi.storeregistry").get("epi.cms.project.item");this.projectStore=this.projectStore||_8c1.resolve("epi.storeregistry").get("epi.cms.project");this.profile=this.profile||_8c1.resolve("epi.shell.Profile");this.isProjectModeEnabled=_8c3.isProjectModeEnabled;this.own(this.projectItemStore.on("update",this._onProjectItemUpdated.bind(this)),this.projectItemStore.on("delete",this._onProjectItemRemoved.bind(this)),this.projectStore.on("update",this._onProjectUpdated.bind(this)),this.projectStore.on("delete",this._onProjectRemoved.bind(this)));},hasScheduledProjectItems:function(_8c6){return _8c2.wrapXhr(this.projectStore.refresh(_8c6)).then(function(_8c7){return _8c7.itemStatusCount.delayedpublish>0||_8c7.itemStatusCount.delayedpublish_nopublishaccess>0;}.bind(this));},getProjectItemsForContent:function(_8c8){if(!(_8c8 instanceof Array)){_8c8=[_8c8];}return when(this.projectItemStore.query({contentLinks:_8c8}));},getProjectItemForContent:function(_8c9){var _8ca=new _8c4(_8c9);if(_8ca.workId===0){return new _8bd().reject("The content link needs to be version specific");}return this.getProjectItemsForContent(_8c9).then(function(_8cb){for(var i=0;i<_8cb.length;i++){if(_8cb[i].contentLink===_8c9){return _8cb[i];}}return null;});},getProjectsForContent:function(_8cc){var self=this;if(!(_8cc instanceof Array)){_8cc=[_8cc];}return this.getProjectItemsForContent(_8cc).then(function(_8cd){if(_8cd.length===0){return new _8bd().resolve([]);}return self.getProjects(_8cd);});},canAddContent:function(_8ce,_8cf,_8d0){var _8d1=_8cf.filter(function(elem,pos){return _8cf.indexOf(elem)===pos;});return this.projectStore.executeMethod("CanAddContent",_8ce,{contentReferences:_8d1,languageId:_8d0});},getProjects:function(_8d2){var _8d3=this.projectStore;var _8d4=_8d2.map(function(_8d5){return _8d3.get(_8d5.projectId);});return all(_8d4);},exists:function(_8d6){return _8c2.wrapXhr(this.projectStore.executeMethod("exists",_8d6));},addProjectItems:function(_8d7,_8d8){_8d8=_8d8.filter(function(_8d9,pos){if(_8c4.isContentReference(_8d9)&&_8d8.indexOf(_8d9)===pos){return true;}});var _8da=this.projectItemStore.executeMethod("addItems",_8d7,{contentLinks:_8d8}).then(function(_8db){_8db.forEach(function(item){this.projectItemStore.notify(item,this.projectItemStore.getIdentity(item));},this);return _8db;}.bind(this));return _8c2.wrapXhr(_8da);},removeProjectItems:function(_8dc){var _8dd=_8dc.map(function(item){return item.id;});return _8c2.wrapXhr(this.projectItemStore.removeRange(_8dd));},markAsReadyForReview:function(_8de,_8df){var args=lang.mixin({projectItems:_8de},_8df);return _8c2.wrapXhr(this.projectItemStore.executeMethod("ReadyForReview","",args));},markAsReadyToPublish:function(_8e0){return _8c2.wrapXhr(this.projectItemStore.executeMethod("ReadyToPublish","",_8e0));},isPartOfDelayedPublishedProject:function(_8e1){return this.getProjectsForContent([_8e1]).then(function(_8e2){return _8e2.some(function(_8e3){return _8e3.status==="delayedpublished";});});},publishProject:function(_8e4,_8e5){var _8e6=this.projectStore;if(isNaN(_8e4)){throw new Error("projectId is not a number");}return _8c2.wrapXhr(_8e6.executeMethod("Publish",_8e4,{delayPublishUntil:_8e5})).then(_8e6.patchCache.bind(_8e6));},reactivateProject:function(_8e7){var _8e8=this.projectStore;if(isNaN(_8e7)){throw new Error("The given project ID is not a number.");}return _8c2.wrapXhr(_8e8.executeMethod("Reactivate",_8e7)).then(_8e8.patchCache.bind(_8e8));},getCurrentProjectId:function(){if(!this.isProjectModeEnabled){return new _8bd().resolve(null);}return when(this.profile.get(this._currentProjectProfileKey));},getCurrentProject:function(){var _8e9=this.projectStore;var that=this;return this.getCurrentProjectId().then(function(_8ea){if(!_8ea){return null;}return when(_8e9.get(_8ea)).otherwise(function(ex){if(ex.status===404){that.setCurrentProject(null);}return null;});});},setCurrentProject:function(_8eb){this.emit("currentProjectChanged",_8eb);return this.profile.set(this._currentProjectProfileKey,_8eb&&_8eb.id,{location:"server"});},_onProjectItemUpdated:function(_8ec){this.emit("project-item-updated",_8ec.target);},_onProjectItemRemoved:function(_8ed){this.emit("project-item-removed",_8ed.id);},_onProjectUpdated:function(_8ee){this.emit("project-updated",_8ee.target);},_onProjectRemoved:function(_8ef){this.emit("project-removed",_8ef.id);}});});},"epi-cms/activity/ActivityService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dijit/Destroyable","epi/dependency"],function(_8f0,lang,_8f1,_8f2,_8f3){return _8f0([_8f1,_8f2],{activityStore:null,activityCommentStore:null,constructor:function(_8f4){_8f0.safeMixin(this,_8f4);this.activityStore=this.activityStore||_8f3.resolve("epi.storeregistry").get("epi.cms.activities");this.activityCommentStore=this.activityCommentStore||_8f3.resolve("epi.storeregistry").get("epi.cms.activities.comments");this.own(this.activityCommentStore.on("update",this._onActivityCommentUpdated.bind(this)));},addMessage:function(_8f5,_8f6,_8f7){var obj={projectId:_8f5,contentLink:_8f6,message:_8f7};return this.activityStore.add(obj);},saveMessage:function(_8f8,_8f9){var obj={id:_8f8,message:_8f9};return this.activityStore.put(obj);},addComment:function(_8fa,_8fb){var obj={activityId:_8fa,message:_8fb};return this.activityCommentStore.add(obj);},saveComment:function(_8fc,_8fd){var obj={id:_8fc,message:_8fd};return this.activityCommentStore.put(obj);},_onActivityCommentUpdated:function(_8fe){this.emit("activity-comment-updated",_8fe.target);}});});},"epi-cms/notification/NotificationService":function(){define(["dojo/_base/declare","dojo/when","dojo/Deferred","dojo/Stateful","dojo/Evented","dijit/Destroyable","epi/shell/xhr/errorHandler","epi/dependency"],function(_8ff,when,_900,_901,_902,_903,_904,_905){return _8ff([_901,_902,_903],{notificationStore:null,postscript:function(){this.inherited(arguments);this.notificationStore=this.notificationStore||_905.resolve("epi.storeregistry").get("epi.cms.notification");this.own(this.notificationStore.on("add",this._onNotificationUpdated.bind(this)),this.notificationStore.on("update",this._onNotificationUpdated.bind(this)));},_onNotificationUpdated:function(_906){this.emit("notification-updated",_906.target);},getUnreadNotificationCount:function(){return _904.wrapXhr(this.notificationStore.executeMethod("GetUnreadCount"));},markAsRead:function(_907){if(!_907){return new _900().reject();}return _904.wrapXhr(this.notificationStore.executeMethod("MarkAsRead",_907)).then(this.notificationStore.refresh.bind(this.notificationStore,_907));},markAllAsRead:function(){return _904.wrapXhr(this.notificationStore.executeMethod("MarkAllAsRead"));}});});},"epi-cms/project/request/projectMode":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_908,when,_909){return {_getCurrentProjectId:function(){var _90a="epi.cms.ProjectService";if(_909.exists(_90a)){var _90b=_909.resolve(_90a);return _90b.getCurrentProjectId();}return when(null);},beforeSend:function(_90c){var _90d=_90c.options;if(_90d.isProfileRequest){return when(_90c);}var _90e=new _908();this._getCurrentProjectId().then(function(_90f){if(_90f){_90d.headers["X-EPiCurrentProject"]=_90f;}}).otherwise(function(err){console.error("Failed to get current project id from project service",err);}).always(function(){_90e.resolve(_90c);});return _90e.promise;}};});},"epi-cms/request/contentLanguage":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_910,when,_911){return {beforeSend:function(_912){var _913=new _910();var _914=_912.options;if(!(_914.preventLocalizationHeader||_914.isProfileRequest)){var _915=_911.resolve("epi.shell.Profile");when(_915.getContentLanguage()).then(function(_916){if(_916){_914.headers["X-EPiContentLanguage"]=_916;}_913.resolve(_912);});return _913.promise;}_913.resolve(_912);return _913.promise;}};});},"epi-cms/project/ProjectModeRequestInterceptor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi/dependency"],function(_917,lang,_918,_919,_91a){return _917([_919],{constructor:function(_91b){_917.safeMixin(this,_91b);this.projectService=this.projectService||_91a.resolve("epi.cms.ProjectService");this.contextService=this.contextService||_91a.resolve("epi.shell.ContextService");this.own(this.contextService.registerRequestInterceptor(lang.hitch(this,this._onInterceptRequest)));},_onInterceptRequest:function(_91c){var dfd=new _918();if(!this.projectService.isProjectModeEnabled){dfd.resolve();}else{this.projectService.getCurrentProject().then(function(_91d){if(_91d){_91c.epiprojects=_91d.id;_91c.epieditmode=true;}}).always(dfd.resolve);}return dfd.promise;}});});},"epi-cms/project/ProjectItemQueryEngine":function(){define(["epi-cms/core/ContentReference","epi/shell/store/queryUtils"],function(_91e,_91f){return function(_920,_921){_921=_921||{};_921.comparers={contentLinks:function(_922,_923){return _922.some(function(link){return _91e.compareIgnoreVersion(link,_923.contentLink);});}};return _91f.createEngine(_920,_921);};});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/shell/command/withConfirmation","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_924,lang,_925,_926,_927,_928,_929,_92a,_92b,_92c,_92d,_92e){var _92f=_924([_925],{model:null,revertToPublished:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_930){lang.mixin(this,_930);this.revertToPublished=_926(new _928(),null,{title:_92e.reverttopublishconfirmation.dialogtitle,heading:_92e.reverttopublishconfirmation.confirmquestion,description:_92e.reverttopublishconfirmation.description});this.translate=new _927();this.createDraft=new _92b();this.sendForReview=new _929();this.publish=new _92a();this.withdraw=new _92c();this.manageExpiration=new _92d();},_modelSetter:function(_931){this.model=_931;this.revertToPublished.set("model",_931);this.translate.set("model",_931);this.createDraft.set("model",_931);this.sendForReview.set("model",_931);this.publish.set("model",_931);this.withdraw.set("model",_931);this.manageExpiration.set("model",_931);}});return new _92f();});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","epi/shell/widget/dialog/Confirmation"],function(_932,lang,when,_933,_934){function _935(_936){var _937=new _933(),_938=new _934(_936);_938.connect(_938,"onAction",function(_939){if(_939){_937.resolve();}else{_937.cancel();}});_938.show();return _937.promise;};return function(_93a,_93b,_93c){var _93d=_93a._execute;_93a._execute=function(){var _93e=new _933();function _93f(){when(_93d.apply(_93a,arguments),_93e.resolve,_93e.cancel);};_93b=_93b||_935;when(_93b(_93c),_93f,_93e.cancel);return _93e;};return _93a;};});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_940,_941,_942,_943){return _940([_943],{label:_942.label,executingLabel:_942.executinglabel,tooltip:_942.title,category:"context",_execute:function(){var _944=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_944.content,languageBranch:_944.language.preferredLanguage};_941.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _945=this._getNormalizedModel(),_946=_945&&_945.language,_947=_945&&_945.content.isDeleted,_948=_946&&_946.isTranslationNeeded&&!_947,_949=_948&&_946.hasTranslationAccess&&_946.isPreferredLanguageAvailable;if(_945&&typeof _945.content.canTranslateContent==="function"){var _94a=_945.content.canTranslateContent();_948=_948&&_94a;_949=_949&&_94a;}this.set("isAvailable",!!_948);this.set("canExecute",!!_949);},_getNormalizedModel:function(){var _94b=this.model;if(_94b){return {content:_94b.contentData||_94b,language:_94b.languageContext||_94b.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_94c,lang,_94d,_94e,_94f){return _94c([_94d],{name:"reverttopublished",tooltip:_94f.reverttopublished.title,label:_94f.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _950=this.model.contentData,_951=_950.status,_952=_94e.versionStatus;var _953=_951===_952.CheckedOut||_951===_952.Rejected;this.set("isAvailable",_953);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_954,_955){var _956=this._getCanExecute(_950,_952);this.set("canExecute",!_955&&_956);}));this.set("canExecute",_953&&this._getCanExecute(_950,_952));},_getCanExecute:function(_957,_958){var _959=_957.publishedBy!==null&&_957.publishedBy!==undefined;var _95a=_957.status!==_958.Published;var _95b=_957.status!==_958.Expired;var _95c=this.model.canChangeContent(_94e.action.Edit);var _95d=_94e.hasAccess(_957.accessMask,_94e.accessLevel.Delete);return _959&&_95a&&_95b&&_95c&&_95d;}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_PropertyWatchCommand"],function(_95e,lang,_95f){return _95e([_95f],{_isChangingContentStatusHandle:null,checkDeleted:true,propertiesToWatch:["isChangingContentStatus"],_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _960=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_960&&!_960.isDeleted));},_onPropertyChanged:function(){this.set("canExecute",this.get("canExecute"));}});});},"epi/shell/command/_PropertyWatchCommand":function(){define("epi/shell/command/_PropertyWatchCommand",["dojo/_base/declare","epi/shell/DestroyableByKey","epi/shell/command/_Command"],function(_961,_962,_963){return _961([_963,_962],{propertiesToWatch:null,_onModelChange:function(){this._watchModelProperty();},_watchModelProperty:function(){var _964=this.model;this.destroyByKey("propertyWatchHandle");if(_964){this._onPropertyChanged();this.propertiesToWatch.forEach(function(_965){this.ownByKey("propertyWatchHandle",_964.watch(_965,this._onPropertyChanged.bind(this)));},this);}else{this.set("canExecute",false);}},_onPropertyChanged:function(){var _966=this.propertiesToWatch.every(function(_967){return !!this.model[_967];},this);this.set("canExecute",_966);}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_968,_969,_96a,_96b,_96c){return _968([_96b],{label:_96c.sendforreview.label,executingLabel:_96c.sendforreview.executinglabel,tooltip:_96c.sendforreview.title,iconClass:"epi-iconCheckmark",action:_96a.saveAction.CheckIn,_execute:function(){_969.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/topic","epi/shell/DestroyableByKey","epi-cms/contentediting/command/_ContentCommandBase"],function(_96d,_96e,_96f,_970){return _96d([_970,_96f],{action:null,canExecute:true,forceReload:false,viewName:null,propertiesToWatch:["hasErrors"],_execute:function(){return this.model.changeContentStatus(this.action).then(this._onContentStatusChange.bind(this));},_onContentStatusChange:function(_971){var _972={uri:"epi.cms.contentdata:///"+_971.id};var _973={sender:this,trigger:"internal",forceContextChange:true,forceReload:this.forceReload};if(this.viewName){_973.viewName=this.viewName;}_96e.publish("/epi/shell/context/request",_972,_973);return _971;},_onPropertyChanged:function(){this.set("canExecute",!this.model.hasErrors);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_974,_975,when,_976,_977,_978,_979,_97a){return _974([_979],{label:_97a.publish.label,executingLabel:_97a.publish.executinglabel,tooltip:_97a.publish.title,iconClass:"epi-iconPublished",action:_978.saveAction.Publish,forceReload:true,_execute:function(){return when(this.inherited(arguments)).then(function(_97b){var _97c=new _977(_97b.oldId).createVersionUnspecificReference().toString();_975.publish("/epi/cms/contentdata/childrenchanged",_97c);});},_onModelChange:function(){this.inherited(arguments);var _97d=this.model.contentData,res=null;switch(_97d.status){case _978.versionStatus.PreviouslyPublished:res=_97a.republish;break;case _978.versionStatus.CheckedOut:if(_97d.isMasterVersion){res=_97a.publish;}else{res=_97a.publishchanges;}break;default:res=_97a.publishchanges;}var _97e=_976.getValue(_97d.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("viewName",_97e);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_97f,_980,_981,_982){return _97f([_980],{name:"createdraft",label:_982.createdraft.label,tooltip:_982.createdraft.title,iconClass:"epi-iconVersions",ignoreContentStatus:false,_execute:function(){this.model.createDraft();},_onModelChange:function(){var _983=this.model.contentData,_984=_983.status,_985=_981.versionStatus,_986,_987;this.inherited(arguments);_986=_981.hasAccessToAction(_983,_981.action.Edit,_981.providerCapabilities.Edit);_987=this.ignoreContentStatus||_984===_985.DelayedPublish||(_984===_985.Published||_984===_985.PreviouslyPublished)&&!_983.isCommonDraft;this.set({canExecute:_986&&_987,isAvailable:_986&&_987});}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_988,_989,_98a,_98b){return _988([_98a],{label:_98b.withdraw.label,tooltip:_98b.withdraw.title,iconClass:"epi-iconPen",action:_989.saveAction.Reject|_989.saveAction.ForceCurrentVersion|_989.saveAction.SkipValidation});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/when","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/DialogService","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_98c,_98d,when,_98e,_98f,_990,_991,_992,_993,_994){return _98d([_991],{label:_993.dialogtitle,tooltip:_993.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",expirationDialogClass:_98e,expirationDialogViewModelClass:_98f,_execute:function(){var _995=this.get("viewModel");var _996=new this.expirationDialogClass({model:_995});_992.dialog({defaultActionsVisible:false,confirmActionText:_994.action.save,content:_996,title:_993.dialogtitle}).then(function(_997){var _998=this.get("model");_998.saveAndPublishProperty("iversionable_expire",_997,_990.saveAction.SkipValidation);}.bind(this));},_onModelChange:function(){var _999=this.get("model");if(!_999||!_999.contentData){this.set("canExecute",false);return;}var _99a=_999.contentData.properties,_99b=_99a.iversionable_expire;var _99c=_999.canChangeContent()&&_990.hasAccess(_999.contentData.accessMask,_990.accessLevel.Publish);this.set("canExecute",false);when(_999.getPropertyMetaData("iversionable_expire")).then(function(_99d){this.set("viewModel",new this.expirationDialogViewModelClass({metadata:_99d,contentLink:_999.contentLink,contentName:_999.contentData.name,value:_99b,minimumExpireDate:_99a.iversionable_startpublish}));this.set("canExecute",_99c);}.bind(this),function(res){if(res&&res.status===409){_992.alert(_994.messages.unexpectederror);}});}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_99e,lang,_99f,_9a0,_9a1,_9a2,_9a3,_9a4,_9a5,_9a6,res,_9a7){return _99e([_9a3,_9a5,_9a2,_9a0,_9a4],{templateString:_9a6,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],infoText:["infoText"],state:["state"],enableSaveButton:["enableSaveButton"],showRemoveButton:["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.set("metadata",this.model.metadata);this.set("value",this.model.value);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_9a8){this.breadcrumb.set("contentLink",_9a8);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_9a9){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_9a9);}},_setShowRemoveButtonAttr:function(_9aa){_99f.set(this.removeButton.domNode,"display",_9aa?"":"none");},_onRemoveButtonClick:function(){var _9ab={stopPublish:null,archiveLink:null};this.set("value",_9ab);this.onChange(_9ab);},onFieldCreated:function(_9ac,_9ad){if(_9ac==="stopPublish"){_9ad.set("minimumValue",this.model.get("minimumExpireDate"));_9ad.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_9ac==="archiveLink"){this._archiveLinkSelector=_9ad;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_9ae){this.inherited(arguments);this.model.set("intermediateValue",_9ae);},getActions:function(){this._actions=[{name:"save",label:_9a7.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.model.save();this.executeDialog(this.model.get("value"));}})},{name:"cancel",label:_9a7.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.model.reset();this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_9af,_9b0,lang,_9b1,_9b2,_9b3,_9b4,_9b5,_9b6,on,when,_9b7,_9b8,_9b9,_9ba,_9bb,_9bc,_9bd,_9be,_9bf){return _9b0([_9bb,_9bf,_9be],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _9c0=_9bc.resolve("epi.storeregistry");this.store=this.store||_9c0.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _9c1=this.getParent(),_9c2=_9c1;while(_9c2&&!_9c2.isLayoutContainer&&_9c2.getParent()){_9c2=_9c2.getParent();}if(_9c2&&_9c2!==_9c1){this._resizeListener=_9b1.after(_9c2,"resize",lang.hitch(this,function(){var _9c3=_9b5.getMarginBox(this.domNode);this.resize(_9c3);}));}},resize:function(_9c4){if(!_9c4&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _9c5=_9b5.getContentBox(this.domNode).w;if(_9c5>this._availableWidth){var _9c6=this._leadingItem?_9b5.getMarginBox(this._leadingItem.domNode).w:0;var _9c7=this._availableWidth-_9c6;this._ellipsisize(0,_9c7);}}));},_setContentLinkAttr:function(_9c8){this._set("contentLink",_9c8);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _9c9=this.get("contentLink"),def=new _9b2(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_9c9){var _9ca=new _9bd(_9c9);var _9cb=_9ca.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_9cb),lang.hitch(this,function(_9cc){this.getAncestors(_9cb,lang.hitch(this,function(_9cd){this._currentContent=_9cc;this._ancestors=_9cd;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _9ce=[],_9cf=null;for(var i=this._ancestors.length-1;i>=0;i--){_9cf=this._ancestors[i];if(!_9cf.parentLink){continue;}_9ce.push(_9cf);if(this.isTypeOfRoot(_9cf)){break;}}_9ce.reverse();var _9d0=_9b5.getContentBox(this.domNode).w;this._availableWidth=_9d0>=0?_9d0:0;_9af.forEach(_9ce,lang.hitch(this,function(_9d1){this._createItem(_9d1,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_9d2,_9d3){var node,_9d4=_9b4.create("li"),_9d5=this.displayAsText||!_9d2.hasTemplate;if(_9d5){node=_9b4.create("span",null,_9d4);}else{node=_9b4.create("a",{href:"#"},_9d4);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_9d2);})));}node.textContent=this.isContextualContent(_9d2)?this.getContextualRootName(_9d2):_9d2.name;if(_9d3){_9b4.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_9d4);}this._addAndLayout(_9d4);},onNodeClick:function(e,_9d6){e.preventDefault();_9b9.publish("/epi/shell/context/request",{uri:_9d6.uri},{sender:this});},_addAndLayout:function(node){var _9d7=new _9ba({},node);this._visibleItems.push(_9d7);this.addChild(_9d7);var _9d8=this._getTotalVisibleItemsSize();if(_9d8>this._availableWidth){this._ensureLeadingItem();while(_9d8>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _9d9=this._visibleItems.splice(0,1)[0];_9b6.set(_9d9.domNode,"display","none");_9d8=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _9da=0;if(this._leadingItem){_9da+=_9b5.getMarginBox(this._leadingItem.domNode).w;}_9af.forEach(this._visibleItems,function(item){_9da+=_9b5.getMarginBox(item.domNode).w;});return _9da;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _9db=_9b4.create("li"),_9dc=_9b4.create("span",{innerHTML:"..."}),_9dd=_9b4.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_9b4.place(_9dc,_9db,"last");_9b4.place(_9dd,_9db,"last");this._leadingItem=new _9ba({},_9db);this.addChild(this._leadingItem,0);},_ellipsisize:function(_9de,_9df){if(_9de>=this._visibleItems.length){return;}var _9e0=this._visibleItems.length-_9de,_9e1=Math.floor(_9df/_9e0),item=this._visibleItems[_9de],_9e2=_9b5.getMarginBox(item.domNode).w;if(_9e2<=_9e1){this._ellipsisize(_9de+1,_9df-_9e2);}else{var _9e3=_9b7(this.displayAsText?"span":"a",item.domNode)[0],_9e4=_9b7("span.epi-breadCrumbsSeparator",item.domNode)[0],_9e5=_9e1-_9b5.getMarginBox(_9e4).w;if(_9e5<0){_9e5=0;}_9b6.set(_9e3,"width",_9e5+"px");_9b3.add(_9e3,"dojoxEllipsis");this._ellipsisize(_9de+1,_9df-_9e1);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_9e6,lang,_9e7,_9e8){var _9e9=_9e6.NodeList;function _9ea(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_9ea(n);}else{text+=n.nodeValue;}}}return text;};function _9eb(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _9ec(html,_9ed){if(typeof html=="string"){html=_9e8.toDom(html,(_9ed&&_9ed.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_9e9,{_placeMultiple:function(_9ee,_9ef){var nl2=typeof _9ee=="string"||_9ee.nodeType?_9e6(_9ee):_9ee;var _9f0=[];for(var i=0;i<nl2.length;i++){var _9f1=nl2[i];var _9f2=this.length;for(var j=_9f2-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_9f0.unshift(item);}if(j==_9f2-1){_9e8.place(item,_9f1,_9ef);}else{_9f1.parentNode.insertBefore(item,_9f1);}_9f1=item;}}if(_9f0.length){_9f0.unshift(0);_9f0.unshift(this.length-1);Array.prototype.splice.apply(this,_9f0);}return this;},innerHTML:function(_9f3){if(arguments.length){return this.addContent(_9f3,"only");}else{return this[0].innerHTML;}},text:function(_9f4){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_9e8.empty(node);node.appendChild(node.ownerDocument.createTextNode(_9f4));}}return this;}else{var _9f5="";for(i=0;node=this[i];i++){_9f5+=_9ea(node);}return _9f5;}},val:function(_9f6){if(arguments.length){var _9f7=lang.isArray(_9f6);for(var _9f8=0,node;node=this[_9f8];_9f8++){var name=node.nodeName.toUpperCase();var type=node.type;var _9f9=_9f7?_9f6[_9f8]:_9f6;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_9e7.indexOf(_9f6,opt.value)!=-1);}else{opt.selected=(opt.value==_9f9);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_9f9);}else{node.value=_9f9;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_9f6=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_9f6=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_9f6.push(opt.value);}}if(!_9f6.length){_9f6=null;}}return _9f6;}},append:function(_9fa){return this.addContent(_9fa,"last");},appendTo:function(_9fb){return this._placeMultiple(_9fb,"last");},prepend:function(_9fc){return this.addContent(_9fc,"first");},prependTo:function(_9fd){return this._placeMultiple(_9fd,"first");},after:function(_9fe){return this.addContent(_9fe,"after");},insertAfter:function(_9ff){return this._placeMultiple(_9ff,"after");},before:function(_a00){return this.addContent(_a00,"before");},insertBefore:function(_a01){return this._placeMultiple(_a01,"before");},remove:_9e9.prototype.orphan,wrap:function(html){if(this[0]){html=_9ec(html,this[0]);for(var i=0,node;node=this[i];i++){var _a02=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_a02,node);}var _a03=_9eb(_a02);_a03.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_9ec(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _a04=_9eb(html);for(var i=0,node;node=this[i];i++){_a04.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_9ec(html,this[0]);for(var i=0;i<this.length;i++){var _a05=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_a05);}}return this;},replaceWith:function(_a06){_a06=this._normalize(_a06,this[0]);for(var i=0,node;node=this[i];i++){this._place(_a06,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_a07){var nl=_9e6(_a07);var _a08=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_a08,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_9e9.prototype.html){_9e9.prototype.html=_9e9.prototype.innerHTML;}return _9e9;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_a09){return _a09(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\r\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\r\n        <div class=\"epi-notificationBarButtonContainer\">\r\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>\r\n","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_a0a,_a0b,_a0c,epi,_a0d,_a0e,_a0f){return _a0a([_a0b],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_intermediateValueSetter:function(_a10){this.intermediateValue=_a10;this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_a10&&_a10.stopPublish){var _a11=_a10.stopPublish instanceof Date?_a10.stopPublish:new Date(_a10.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_a11<_a0d.serverTime()?_a0f.expired:_a0c.substitute(_a0e.expiretimetext,[_a0d.timeToGo(_a11)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_a0e.neverexpiretext);this.set("state","NotExpiring");}},_valueSetter:function(_a12){this.value=_a12;this.set("enableSaveButton",false);},_minimumExpireDateSetter:function(_a13){var date=new Date(_a13);this.minimumExpireDate=_a0d.isDateValid(date)?date:null;this.set("minimumExpireDateMessage",_a0e.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);},reset:function(){this.set("intermediateValue",this.value);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle"],function(dojo,_a14,_a15,_a16){return _a14([_a15],{constructor:function(){this.inherited(arguments);this.add("commands",new _a16());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_a17,_a18,_a19,_a1a){return _a17([_a19],{name:"PermanentInUseNotification",label:_a1a.title,tooltip:_a1a.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_a18.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _a1b=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_a1b,true);this._updateCanExecute();},_onModelChange:function(){var _a1c=this.model.contentData,_a1d=this.inUseNotificationManager.currentUserHasInUseNotification(_a1c.inUseNotifications,true);this.set("active",_a1d);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_a1e,_a1f,_a20,_a21){return _a1e([_a1f],{constructor:function(){this.inherited(arguments);this.add("commands",_a20(new _a21(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_a22,_a23){_a23=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_a23);_a22.options=_a23;return _a22;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_a24,_a25,_a26,_a27,_a28){return _a24([_a27],{name:"IgnoreInUseNotification",label:_a28.ignoreinusenotification.label,tooltip:_a28.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_a26.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _a29=this.model.contentData,_a2a=this.inUseNotificationManager.hasInUseNotificationWarning(_a29.inUseNotifications),_a2b,_a2c;_a2b=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_a2c=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_a2b;this.set("isAvailable",_a2a&&_a2c);},_requestContextChange:function(uri,_a2d){var _a2e={uri:uri};var _a2f={sender:this,forceContextChange:_a2d};_a25.publish("/epi/shell/context/request",_a2e,_a2f);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi/shell/DestroyableByKey","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi-cms/content-approval/command/AbortReview","epi-cms/content-approval/command/ApproveChanges","epi-cms/content-approval/command/CancelReview","epi-cms/content-approval/command/ForceCompleteApproval","epi-cms/content-approval/command/RejectChanges","epi-cms/content-approval/command/ReadyForReview","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi/i18n!epi/nls/episerver.cms.contentapproval.command","epi/i18n!epi/nls/episerver.shell.resources.texts"],function(_a30,_a31,_a32,_a33,_a34,_a35,_a36,_a37,_a38,_a39,_a3a,_a3b,_a3c,_a3d,_a3e,_a3f,_a40,_a41,_a42,_a43,res,_a44,_a45){return _a30([_a32,_a33],{commandMap:null,constructor:function(){this.commandMap={abortreview:_a35(_a31(new _a3e(),null,{title:_a44.abortreview.label,description:_a44.abortreview.description,confirmActionText:_a45.ok,cancelActionText:_a45.cancel})),approvechanges:_a35(new _a3f(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),cancelreview:_a35(_a31(new _a40(),null,{title:_a44.cancelreview.label,description:_a44.cancelreview.description,confirmActionText:_a44.cancelreview.ok,cancelActionText:_a45.cancel})),forcecompleteapproval:_a35(new _a41()),publish:_a35(new _a38(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"epi-success",keepMenuOpen:false,successStatus:res.successfullypublished}),readyforreview:_a35(new _a43(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),readytopublish:_a35(new _a37(),{isMain:true,priority:8000,mainButtonClass:"epi-success",keepMenuOpen:true}),rejectchanges:_a35(new _a42()),removescheduling:_a35(new _a3d()),scheduleforpublish:_a35(new _a3c()),withdraw:_a35(new _a3b(),{resetLabelAfterExecution:false,keepMenuOpen:true})};this.commandMap.abortreview.order=0;this.commandMap.approvechanges.order=100;this.commandMap.forcecompleteapproval.order=200;this.commandMap.rejectchanges.order=300;this.commandMap.publish.order=400;this.commandMap.readyforreview.order=500;this.commandMap.readytopublish.order=600;this.commandMap.removescheduling.order=700;this.commandMap.scheduleforpublish.order=800;this.commandMap.cancelreview.order=900;this.commandMap.withdraw.order=1000;},updateCommandModel:function(_a46){this.destroyByKey("builtinCommands");var _a47=[];_a46.contentData.transitions.forEach(function(_a48){var _a49=this.commandMap[_a48.name];if(_a49){_a47.push(_a49);}},this);var _a4a=new _a34();_a4a.order=1100;_a47.push(_a35(_a4a,{isMain:true,priority:10000,mainButtonClass:"epi-primary"}));this.ownByKey("builtinCommands",_a4a);var _a4b=new _a3a();_a4b.order=1200;_a47.push(_a35(_a4b));this.ownByKey("builtinCommands",_a4b);var _a4c=new _a39();_a4c.order=1300;_a47.push(_a35(_a4c));this.ownByKey("builtinCommands",_a4c);var _a4d=new _a36();_a4d.order=1400;_a47.push(_a35(_a31(_a4d,null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));this.ownByKey("builtinCommands",_a4d);this.set("commands",_a47);this.inherited(arguments);}});});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_a4e,_a4f,_a50,_a51){return _a4e([_a4f],{name:"editcommondraft",label:_a51.editcommondraft.label,tooltip:_a51.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_a50;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _a52=this.model.contentData,_a53=_a52.status,_a54=_a50.versionStatus,_a55=this.contentActionSupport.hasAccess(_a52.accessMask,_a50.accessLevel.Edit),_a56=(_a53===_a54.Published||_a53===_a54.PreviouslyPublished)&&!_a52.isCommonDraft&&_a55&&this.contentActionSupport.hasProviderCapability(_a52.providerCapabilityMask,_a50.providerCapabilities.Edit);this.set("canExecute",_a56&&this.model.canEditCurrentLanguage());this.set("isAvailable",_a56);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","epi/shell/DialogService","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_a57,_a58,_a59,_a5a,_a5b,_a5c,_a5d,_a5e){return _a57([_a59],{label:_a5d.scheduleforpublish.label,tooltip:_a5d.scheduleforpublish.title,iconClass:"epi-iconClock",action:_a5a.saveAction.Schedule,_execute:function(){var _a5f=new _a5c();_a5f.set("contentData",this.model.contentData);var _a60=new _a5b({model:_a5f});return _a58.dialog({content:_a60,title:_a5e.title,defaultActionsVisible:false}).then(function(){return this.model.scheduleForPublish(_a5f.get("dateValue"));}.bind(this)).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/_DialogContentMixin","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/project/ContentReferenceGrid","epi-cms/widget/Breadcrumb"],function(_a61,lang,_a62,_a63,_a64,_a65,_a66,_a67,_a68,_a69,_a6a,_a6b,_a6c){return _a61([_a63,_a64,_a65,_a67,_a66,_a68],{templateString:_a6a,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_a6d){this.breadcrumbNode.set("contentLink",_a6d);},_setScheduleButtonEnabledAttr:function(_a6e){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_a6e);}},_setModelAttr:function(_a6f){this.inherited(arguments);this.referenceGrid.set("model",_a6f);if(_a6f){this.own(_a6f.watch("totalItems",lang.hitch(this,"_onGridItemsChange")));}},modelBindingMap:{title:["title"],dateLabel:["dateLabel"],dateValue:["dateValue"],breadcrumbModel:["breadcrumbModel"],scheduleButtonEnabled:["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _a69(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");this.addActions([{name:"save",label:_a6b.confirmtext,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.dateTimeSelectorChanged(this.dateTimeSelector.get("value"));this.executeDialog();}})},{name:"cancel",label:_a6c.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}]);},_onGridItemsChange:function(_a70,_a71,_a72){var _a73=_a72>0;if(this.referenceGrid){_a62.toggle(this.referenceGrid.domNode,"dijitHidden",!_a73);}this.setActionProperty("save","label",_a73?_a6b.scheduleanyway:_a6b.confirmtext);this.setActionProperty("save","class",_a73?"":"Salt");},dateTimeSelectorChanged:function(_a74){this.model.set("dateValue",_a74);}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_a75,_a76,_a77){return _a75([_a76],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _a78=new Date();_a78.setDate(_a78.getDate()+1);_a78.setHours(12,0,0,0);this.set("dateValue",_a78);},_isPublishedSetter:function(_a79){this.set("dateLabel",_a79?_a77.publishchangeson:_a77.publishon);},_contentDataSetter:function(_a7a){this.set("title",_a7a.name);this.set("isPublished",!_a7a.isPendingPublish);this.set("breadcrumbModel",_a7a.contentLink);var _a7b=new Date(_a7a.properties.iversionable_startpublish);if(!isNaN(_a7b)&&_a7b>new Date()){this.set("dateValue",_a7b);}},_dateValueSetter:function(_a7c){this.dateValue=_a7c;this.set("scheduleButtonEnabled",!!(_a7c&&_a7c>new Date()));}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\r\n    <div data-dojo-attach-point=\"referenceGrid\" data-dojo-type=\"epi-cms/project/ContentReferenceGrid\" class=\"dijitHidden push-margin--top\"></div>\r\n</div>","epi-cms/project/ContentReferenceGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/keys","dojo/on","dojo/when","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/OnDemandGrid","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferenceGrid.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_a7d,lang,_a7e,keys,on,when,_a7f,_a80,_a81,_a82,_a83,_a84,_a85,_a86,_a87,_a88){function _a89(prop){return function(_a8a){if(this._grid){this._grid.set(prop,_a8a);}};};return _a7d([_a7f,_a80,_a81,_a86],{res:_a88,templateString:_a87,model:null,_gridClass:_a7d([_a82,_a83,_a84,_a85]),_grid:null,_loadCompleteEmitted:false,modelBindingMap:{query:["query"],store:["store"],columns:["columns"],notificationText:["notificationText"],resultSummary:["resultSummary"]},_setResultSummaryAttr:{node:"resultSummaryNode",type:"innerText"},_setQueryAttr:_a89("query"),_setColumnsAttr:_a89("columns"),_setStoreAttr:_a89("store"),_setNotificationTextAttr:function(text){var _a8b=text&&text.length;_a7e.toggle(this.notificationBar,"dijitHidden",!_a8b);this.notificationNode.textContent=text||"";},_onRowClicked:function(e){if(this.model&&typeof this.model.onItemClicked==="function"){var data=this._grid.row(e).data;this.model.onItemClicked(data);}},buildRendering:function(){this.inherited(arguments);var _a8c=this.model&&this.model.get("columns");this._grid=new this._gridClass({"class":"epi-plain-grid epi-plain-grid--no-border epi-plain-grid--no-header epi-plain-grid--margin-bottom",columns:_a8c,showHeader:false,cellNavigation:false,selectionMode:"single"},this.gridNode);this._grid.addKeyHandler(keys.ENTER,lang.hitch(this,"_onRowClicked"));this._grid.addKeyHandler(keys.SPACE,lang.hitch(this,"_onRowClicked"));this._grid.on(".dgrid-cell a:click",lang.hitch(this,"_onRowClicked"));this.own(this._grid,on(this._grid,"dgrid-refresh-complete",lang.hitch(this,"_onGridRefreshComplete")));},startup:function(){this.inherited(arguments);this._grid.startup();if(!this._grid.store){this._emitLoadComplete();}},_onGridRefreshComplete:function(data){var _a8d=data.results;when(_a8d.total,lang.hitch(this,function(_a8e){this.model.set("totalItems",_a8e);this._emitLoadComplete();}));},_emitLoadComplete:function(){if(!this._loadCompleteEmitted){this.emit("contentreferencegrid-loading-complete",{});this._loadCompleteEmitted=true;}},_refresh:function(){this._grid.refresh();}});});},"url:epi-cms/project/templates/ContentReferenceGrid.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"notificationBar\" class=\"dijitHidden epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"notificationNode\" class=\"epi-notificationBarText\"></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"resultSummaryNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:_refresh\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_a8f,lang,_a90,_a91,_a92){return _a8f([_a91],{label:_a92.label,tooltip:_a92.title,iconClass:"epi-iconPen",action:_a90.saveAction.CheckOut|_a90.saveAction.ForceCurrentVersion});});},"epi-cms/content-approval/command/AbortReview":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.abortreview","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus"],function(_a93,_a94,_a95,_a96){return _a93([_a96],{label:_a94.label,iconClass:"epi-iconWarning",action:_a95.saveAction.CheckOut|_a95.saveAction.SkipValidation});});},"epi-cms/content-approval/command/ApproveChanges":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.approvechanges"],function(_a97,_a98,_a99){return _a97([_a98],{label:_a99.label,title:_a99.title,dialogPlaceHolder:_a99.placeholder,confirmActionText:_a99.confirmactiontext,executingLabel:_a99.label,executeMethod:"approveChanges",isCommentRequiredPropertyName:"isApproveCommentRequired"});});},"epi-cms/content-approval/command/_ApprovalTransitionWithReasonTextCommand":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","epi/shell/widget/ValidationTextarea","./_ApprovalTransitionCommand","epi-cms/contentediting/command/_CommandWithDialogMixin"],function(_a9a,_a9b,_a9c,_a9d,_a9e,_a9f){return _a9a([_a9e,_a9f],{dialogContentClass:_a9d,dialogClass:"epi-dialog-confirm",executeMethod:null,isCommentRequiredPropertyName:null,dialogPlaceHolder:null,dialogText:null,postscript:function(){this.inherited(arguments);this.dialogContentParams={required:true,intermediateChanges:true,placeHolder:this.dialogPlaceHolder,"class":"epi-textarea--max-height--500"};},_execute:function(){return this._getApprovalDefinition().then(function(_aa0){if(_aa0[this.isCommentRequiredPropertyName]){this._executeDeferred=new _a9b();this.showDialog();return this._executeDeferred.promise;}else{return this._executeServiceMethod();}}.bind(this));},_getApprovalDefinition:function(){return this.approvalService.getApprovalRelatedDefinition(this.model.contentLink);},showDialog:function(){this.inherited(arguments);this._disableActionButton(true);if(this.dialogText&&typeof this.dialogText==="string"){_a9c.place("<p>"+this.dialogText+"</p>",this.dialogContent.domNode,"before");}this._dialog.own(this.dialogContent.on("change",this._onDialogContentChanged.bind(this)));},_onDialogContentChanged:function(_aa1){this._disableActionButton(!_aa1||!(_aa1.trim()));},_disableActionButton:function(_aa2){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",_aa2);},onDialogExecute:function(){this._executeDeferred.resolve(this._executeServiceMethod.call(this,this.dialogContent.value));},onDialogCancel:function(){this._executeDeferred.reject();},_executeServiceMethod:function(_aa3){return this.approvalService[this.executeMethod](this.approval.id,this.approval.activeStepIndex,_aa3).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/content-approval/command/_ApprovalTransitionCommand":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges","epi-cms/contentediting/command/_ChangeContentStatus"],function(_aa4,_aa5,_aa6,_aa7){return _aa4([_aa7],{approval:null,executeMethod:null,postscript:function(){this.inherited(arguments);this.approvalService=this.approvalService||_aa5.resolve("epi.cms.ApprovalService");},_onModelChange:function(){this.set("canExecute",false);if(!this.model){return;}return this.approvalService.getApproval(this.model.contentLink).then(function(_aa8){this.set({canExecute:!!_aa8,approval:_aa8});}.bind(this));},_execute:function(){return this._executeServiceMethod();},_executeServiceMethod:function(){return this.approvalService[this.executeMethod](this.approval).then(this._onContentStatusChange.bind(this));},_onContentStatusChange:function(){this.inherited(arguments,[{id:this.model.contentLink}]);}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(_aa9,_aaa,lang,_aab,when,_aac,_aad,_aae,_aaf){return _aaa([_aac],{res:_aae,title:null,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_aaf.action.ok,cancelActionText:_aaf.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _aad(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_aab.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_aab.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_aab.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_ab0,_ab1){if(!_ab1){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/content-approval/command/CancelReview":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.cancelreview","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_ab2,_ab3,_ab4){return _ab2([_ab4],{label:_ab3.label,iconClass:"epi-iconClose",executeMethod:"cancelChanges"});});},"epi-cms/content-approval/command/ForceCompleteApproval":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.forcecompleteapproval"],function(_ab5,_ab6,_ab7){return _ab5([_ab6],{label:_ab7.label,title:_ab7.title,dialogPlaceHolder:_ab7.placeholder,dialogText:_ab7.description,confirmActionText:_ab7.ok,iconClass:"epi-iconRight",isCommentRequiredPropertyName:"isForcedApproveCommentRequired",_executeServiceMethod:function(_ab8){return this.approvalService.forceCompleteApproval(this.approval.id,_ab8).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/content-approval/command/RejectChanges":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges"],function(_ab9,_aba,_abb){return _ab9([_aba],{label:_abb.label,title:_abb.title,dialogPlaceHolder:_abb.placeholder,confirmActionText:_abb.confirmactiontext,iconClass:"epi-iconStop",executeMethod:"rejectChanges",isCommentRequiredPropertyName:"isDeclineCommentRequired"});});},"epi-cms/content-approval/command/ReadyForReview":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/content-approval/command/_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.requestapproval"],function(_abc,_abd,_abe,_abf){return _abc([_abe],{label:_abf.label,executingLabel:_abf.label,action:_abd.saveAction.RequestApproval,title:_abf.title,dialogPlaceHolder:_abf.placeholder,confirmActionText:_abf.confirmactiontext,isCommentRequiredPropertyName:"isStartCommentRequired",_onModelChange:function(){this._watchModelProperty();},_getApprovalDefinition:function(){return this.approvalService.getDefinition(this.model.contentLink);},_executeServiceMethod:function(_ac0){return this.model.changeContentStatus(this.action).then(function(){if(_ac0){return this.approvalService.getApproval(this.model.contentLink).then(function(_ac1){this.set({canExecute:!!_ac1,approval:_ac1});return this.approvalService.commentChanges(this.approval.id,_ac0);}.bind(this));}}.bind(this)).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_ac2,lang,_ac3){return _ac2([_ac3],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_ac4,_ac5){this.inherited(arguments);if(_ac5&&this.value){_ac4.epichannel=this.value;}else{delete _ac4.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_ac6,_ac7){return _ac6(_ac7,{key:null,value:null,enabled:null,postscript:function(){this._disableObsoleteWarnings=true;this.inherited(arguments);},beforePreviewLoad:function(_ac8,_ac9){},afterPreviewLoad:function(_aca,_acb){}});});},"epi/shell/_StatefulGetterSetterMixin":function(){define("epi/shell/_StatefulGetterSetterMixin",["dojo/_base/declare","dojo/_base/lang","epi/obsolete"],function(_acc,lang,_acd){return _acc(null,{_disableObsoleteWarnings:false,postscript:function(){if(!this._disableObsoleteWarnings){_acd("epi/shell/_StatefulGetterSetterMixin","Use dojo/Stateful custom setters/getters instead");}},get:function(name){var _ace=this._getAttrNames(name);return this[_ace.g]?this[_ace.g]():this[name];},set:function(name,_acf){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _ad0=this._getAttrNames(name);var _ad1=this[_ad0.s];if(lang.isFunction(_ad1)){_ad1.apply(this,Array.prototype.slice.call(arguments,1));}else{this._set(name,_acf);}return this;},_attrPairNames:{},_getAttrNames:function(name){var apn=this._attrPairNames;if(apn[name]){return apn[name];}var uc=name.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();});return (apn[name]={s:"_set"+uc+"Attr",g:"_get"+uc+"Attr",l:uc.toLowerCase()});},_set:function(name,_ad2){var _ad3=this[name];this[name]=_ad2;if(this._watchCallbacks){this._watchCallbacks(name,_ad3,_ad2);}return this;}});});},"epi/obsolete":function(){define("epi/obsolete",[],function(){return function(_ad4,_ad5,_ad6){var _ad7="OBSOLETE: "+_ad4;if(_ad5){_ad7+=" "+_ad5;}if(_ad6){_ad7+=" -- will be removed in version: "+_ad6;}console.warn(_ad7);};});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_ad8,_ad9){return _ad8([_ad9],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_ada,_adb){this.inherited(arguments);if(_ada){var size=_adb?this._getPreviewResolution():null;_ada.set("previewSize",size);_ada.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _adc=this.value;if(_adc){var _add=_adc.split("x");if(_add.length===2){size={w:_add[0],h:_add[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_ade,lang,_adf,_ae0,_ae1){return _ade([_ae0,_ae1],{key:"viewlanguage",usedForRendering:true,isTagItem:false,constructor:function(_ae2){this.own(_ae2.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},_onContextChange:function(_ae3,_ae4){var dfd=new _adf();dfd.resolve();if(this.get("enabled")&&this.value){_ae3.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_ae5,lang,_ae6){return _ae5([_ae6],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_ae7,_ae8){this.inherited(arguments);if(_ae8&&this.value){_ae7.visitorgroupsByID=this.value;}else{delete _ae7.visitorgroupsByID;}}});});},"epi-cms/project/ProjectViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_ae9,lang,_aea,_aeb,_aec){return _ae9([_aeb,_aec],{key:"project",usedForRendering:true,isTagItem:false,constructor:function(_aed){this.own(_aed.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},beforePreviewLoad:function(_aee,_aef){this.inherited(arguments);if(_aef&&this.value){_aee.epiprojects=this.value;}else{delete _aee.epiprojects;}},_onContextChange:function(_af0,_af1){var dfd=new _aea();if(this.get("enabled")&&this.value){_af0.epiprojects=this.value;_af0.epieditmode=true;}dfd.resolve();return dfd.promise;}});});},"epi-cms/widget/ContentTypeService":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(_af2,_af3,lang,when,all,_af4,_af5){return _af2(null,{contentTypeStore:null,_getavailabletypesQuery:"getavailablecontenttypes",constructor:function(){this.contentTypeStore=this.contentTypeStore||_af4.resolve("epi.storeregistry").get("epi.cms.contenttype");},getAcceptedChildTypes:function(_af6,_af7,_af8,_af9,_afa){var _afb=this.contentTypeStore.query({query:this._getavailabletypesQuery,localAsset:_af7,parentReference:_af6,requestedTypes:_af8});return this.filterQueryResult(_afb,_af9,_afa);},filterQueryResult:function(_afc,_afd,_afe){return when(_afc).then(function(_aff){var _b00=_af3.map(_aff,function(type){return type.typeIdentifier;});_b00=_af5.getValidAcceptedTypes(_b00,_afd,_afe);_aff=_af3.filter(_aff,function(type){return _af3.some(_b00,function(_b01){return type.typeIdentifier===_b01;});});return _aff;});}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/when","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,when,_b02,_b03){lang.extend(_b02,{getContentLanguage:function(){return when(this.get("editlanguage"),function(_b04){return _b04||_b03.currentContentLanguage;});},setContentLanguage:function(_b05){return this.set("editlanguage",_b05,{location:"server"});}});return _b02;});},"epi-cms/compare/views/AllPropertiesCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","../viewmodels/AllPropertiesCompareViewModel","../AllPropertiesTransformer","../FormField","epi/shell/widget/FormContainer","epi-cms/contentediting/FormEditing","epi/shell/widget/_ModelBindingMixin"],function(_b06,lang,_b07,when,_b08,_b09,_b0a,_b0b,_b0c,_b0d){return _b06([_b0c,_b0d],{modelBindingMap:{comparison:["comparison"],rightMetadata:["rightMetadata"]},postMixInProperties:function(){this.inherited(arguments);this._groupMap={};this.own(this.model=new _b08({model:this.model}));},removeForm:function(form){var _b0e=form.containerLayout.selectedChildWidget;if(_b0e){this._selectedTabName=_b0e.name.toLowerCase();}this._groupMap={};this._mappingManager.clear();return this.inherited(arguments);},_createForm:function(){return new _b0b(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,metadataTransformer:new _b09({model:this.model}),baseClass:"epi-cmsEditingForm epi-form-container epi-form-container--compare"},this.formSettings));},_setupForm:function(){this.inherited(arguments);var _b0f=this._groupMap[this._selectedTabName];if(_b0f){this._form.containerLayout.selectChild(_b0f);}},_setComparisonAttr:function(_b10){this._set("comparison",_b10);for(var _b11 in this._groupMap){var _b12=this._groupMap[_b11];var _b13=(_b10&&_b10[_b11]&&_b10[_b11].length)||0;this._setGroupTitleWithChanges(_b12,_b13);}},_setRightMetadataAttr:function(_b14){this._set("rightMetadata",_b14);if(!this._started){return;}this._removeAndDestroyForm();this.viewModel&&this._setupForm();},onGroupCreated:function(_b15,_b16,_b17){this.inherited(arguments);if(_b17){return;}var name=_b15.toLowerCase(),_b18=this.comparison;_b16.groupName=_b15;this._groupMap[name]=_b16;this._setGroupTitleWithChanges(_b16,_b18&&_b18[name]&&_b18[name].length);},_setViewModelAttr:function(_b19){this.inherited(arguments);this.model.set("contentViewModel",this.viewModel);},_setGroupTitleWithChanges:function(_b1a,_b1b){var _b1c=_b1a.params.title;if(_b1b){_b1c=lang.replace("{0}<span class=\"epi-compare-tab--has-changes\">{1}</span>",[_b1c,_b1b]);}_b1a.set("title",_b1c);}});});},"epi-cms/compare/viewmodels/AllPropertiesCompareViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi","epi/dependency","epi/string","epi-cms/core/ContentReference","dojo/Stateful","dijit/Destroyable"],function(_b1d,lang,_b1e,when,epi,_b1f,_b20,_b21,_b22,_b23){return _b1d([_b22,_b23],{_metadataManager:null,contentViewModel:null,leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null,postscript:function(){this.inherited(arguments);this._metadataManager=this._metadataManager||_b1f.resolve("epi.shell.MetadataManager");this.initialize();},initialize:function(){var _b24=lang.hitch(this,function(name,_b25,_b26){var _b27=this.model.rightVersion;if(!_b27||(_b25===_b26)){return;}when(this._metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:_b27.contentLink}),lang.hitch(this,function(_b28){this.set("rightMetadata",_b28);}));});_b24("rightVersionContentLink",null,this.model.rightVersionContentLink);this.own(this.model.watch("rightVersionContentLink",_b24),this.model.watch("contentLink",lang.hitch(this,function(name,_b29,_b2a){if(!_b21.compareIgnoreVersion(_b29,_b2a)){this.set({leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null});}})));},generateComparison:function(){var _b2b={},_b2c=this.rightMetadata;if(!this.leftPropertyMap||!this.rightPropertyMap){this.set("comparison",null);return;}_b2c.groups.forEach(function(_b2d){_b2b[_b2d.name.toLowerCase()]=[];});_b2c.properties.forEach(lang.hitch(this,function(_b2e){this._addPropertyToComparison(_b2b,_b2e,_b2e.groupName);}));this.set("comparison",_b2b);},copy:function(_b2f){if(!_b2f){throw new Error("propertyName is required");}var _b30=this.contentViewModel,_b31=lang.getObject(_b2f,false,this.rightPropertyMap);if(_b30&&_b31!==undefined){_b30.setProperty(_b2f,lang.clone(_b31));_b30.save();}},_addPropertyToComparison:function(_b32,_b33,_b34,_b35){var _b36=_b20.pascalToCamel((_b35||"")+_b33.name),_b37=lang.getObject(_b36,false,this.leftPropertyMap),_b38=lang.getObject(_b36,false,this.rightPropertyMap);if(_b33.showForEdit&&!epi.areEqual(_b37,_b38,epi.compareOptions.treatFalsyAsEquals|epi.compareOptions.skipEmptyProperties)){if(_b33.properties.length){_b33.properties.forEach(lang.hitch(this,function(_b39){this._addPropertyToComparison(_b32,_b39,_b34,_b36+".");}));}else{_b32[_b34.toLowerCase()].push(_b36.toLowerCase());}}},_contentViewModelSetter:function(_b3a){this.contentViewModel=_b3a;this.set({leftMetadata:_b3a.metadata,leftPropertyMap:_b3a.contentData.properties});this.own(_b3a.watch("contentData",lang.hitch(this,function(name,_b3b,_b3c){this.set("leftPropertyMap",_b3c.properties);})),_b1e.after(_b3a,"onPropertySaved",lang.hitch(this,"_onPropertySaved"),true));},_leftPropertyMapSetter:function(_b3d){this.leftPropertyMap=lang.clone(_b3d);this.generateComparison();},_rightPropertyMapSetter:function(_b3e){this.rightPropertyMap=lang.clone(_b3e);this.generateComparison();},_rightMetadataSetter:function(_b3f){this.rightMetadata=_b3f;if(this.rightMetadata){when(this.model.contentDataStore.get(this.model.rightVersion.contentLink)).then(lang.hitch(this,function(_b40){this.set("rightPropertyMap",_b40.properties);}));}},_onPropertySaved:function(_b41,_b42){var _b43=this.comparison;if(this.leftPropertyMap){lang.setObject(_b41,_b42,this.leftPropertyMap);}if(!_b43){return;}var _b44=this.rightMetadata.getPropertyMetadata(_b41.split(".")[0]),_b45=this.rightMetadata.getPropertyMetadata(_b41),_b46=this.rightPropertyMap&&lang.getObject(_b41,false,this.rightPropertyMap);if(!_b45.showForEdit){return;}var _b47=_b43[_b44.groupName.toLowerCase()],name=_b41.toLowerCase(),_b48=_b47.indexOf(name),_b49=epi.areEqual(_b42,_b46,epi.compareOptions.treatFalsyAsEquals|epi.compareOptions.skipEmptyProperties);if(_b48>=0&&_b49){_b47.splice(_b48,1);}else{if(_b48<0&&!_b49){_b47.splice(0,0,name);}}this.set("comparison",_b43);}});});},"epi-cms/compare/AllPropertiesTransformer":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/MetadataTransformer","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_b4a,lang,_b4b,_b4c,res){return _b4a([_b4c],{model:null,_map:null,_getProperty:function(_b4d){function _b4e(map,_b4f,path){_b4f.forEach(function(_b50){var name=(!path?_b50.name:path+"."+_b50.name).toLowerCase();map[name]=_b50;_b50.properties.length&&_b4e(map,_b50.properties,name);});return map;};if(!this.model.rightMetadata){return null;}if(!this._map){this._map=_b4e({},this.model.rightMetadata.properties);}return this._map[_b4d.toLowerCase()];},_getComponentDefinitions:function(_b51,_b52,_b53,_b54,_b55){if(_b52 instanceof Array){var _b56=this.defaultSingleGroupType;_b52.forEach(function(_b57){if(_b57.name==="EPiServerCMS_SettingsPanel"){delete _b57.options.region;_b57.options.title=res.settingspaneltabname;_b57.uiType=_b56;}});}return this.inherited(arguments);},transformPropertySettings:function(_b58,_b59,_b5a,_b5b,_b5c){var _b5d=this.inherited(arguments),_b5e=this._getProperty(_b59+_b58.name),_b5f;_b5d.settings._hint="compare";_b5d.settings.groupName=_b58.groupName;if(_b5e){var _b60=_b4b.pascalToCamel(_b59+_b58.name),_b61=this.model&&lang.getObject(_b60,false,this.model.rightPropertyMap);_b5f=this.inherited(arguments,[_b5e,"compare."+_b59,false,true,_b5c]);_b5f.settings._type="compare";_b5f.settings.compareViewModel=this.model;_b5f.settings.value=_b61;return [_b5d,_b5f];}return _b5d;},_createGroupContainer:function(_b62,_b63){var _b64=this.inherited(arguments);_b64.settings._hint="compare";return _b64;},_createParentContainer:function(_b65){_b65.properties.forEach(function(_b66){_b66.groupName=_b65.groupName;});return this.inherited(arguments);}});});},"epi-cms/compare/FormField":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/form/Button","epi/shell/form/Field","epi/shell/form/formFieldRegistry","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_b67,lang,_b68,_b69,_b6a,_b6b,_b6c,_b6d,res){var _b6e=_b67([_b6c],{_copyButton:null,buildRendering:function(){this.inherited(arguments);this.own(this._copyButton=new _b6b({"class":"epi-form-container__section__row__copy-button epi-chromeless",iconClass:"epi-icon-compare--copy",label:res.copy.label,title:res.copy.tooltip}).placeAt(this.domNode,"last"));this._copyButton.on("click",lang.hitch(this,function(){this.model.copy(this.params.name);}));},addChild:function(_b6f,_b70){var _b71,_b72=_b69.create("div",{"class":"epi-form-container__section__row__editor--"+_b6f._type},this.domNode);if(_b6f.checkbox){_b71=(_b6f._type==="compare")?_b69.create("label",{innerHTML:_b6f.label},_b72):_b69.place(this.labelNode,_b72);this._addCheckboxChild(_b6f,_b71);}else{_b6f.placeAt(_b72);}},destroy:function(){this.inherited(arguments);if(this._comparisonWatch){this._comparisonWatch.remove();this._comparisonWatch=null;}},_setReadonlyIconDisplayAttr:function(_b73){this.inherited(arguments);if(this._copyButton){_b6a.set(this._copyButton.domNode,"display",_b73?"none":"");}},_setModelAttr:function(_b74){this._set("model",_b74);if(this._comparisonWatch){this._comparisonWatch.remove();}this._updateChangedState();this._comparisonWatch=_b74.watch("comparison",lang.hitch(this,"_updateChangedState"));},_updateChangedState:function(){var _b75=this.model.comparison,_b76=_b75&&_b75[this.groupName],_b77=_b76&&_b76.indexOf(this.name.toLowerCase())>=0;_b68.toggle(this.domNode,"epi-form-container__section__row--has-changes",_b77);}});function _b78(_b79,_b7a){var _b7b=new _b6e({labelTarget:_b79.checkbox?_b79.checkbox.id:_b79.id,label:_b79.label,tooltip:_b79.tooltip,name:_b79.name,groupName:_b79.groupName.toLowerCase(),readonlyIconDisplay:_b79.readOnly,hasFullWidthValue:_b79.useFullWidth});_b7b.own(_b79.watch("readOnly",function(name,_b7c,_b7d){_b7b.set("readonlyIconDisplay",_b7d);}));return _b7b;};function _b7e(_b7f,_b80){var _b81=_b80.getChildren().pop();_b81.set("model",_b7f.compareViewModel);return _b81;};_b7e.preventAdd=true;_b6d.add([{type:_b6d.type.field,hint:"compare",factory:_b78},{type:"compare",hint:"",factory:_b7e}]);return _b6e;});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_b82,_b83,_b84,_b85,_b86,_b87){return _b82([_b87,_b85,_b86],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.editLayoutContainer.addChild(form,0);},removeForm:function(form){this.editLayoutContainer.leftOver&&this._removeLeftOver();this.editLayoutContainer.leftOver=form;_b83.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;},_reloadPropertyPreview:function(){}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(_b88,_b89,lang,_b8a,when,_b8b,_b8c){return _b89(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._removeViewModelWatches){this._removeViewModelWatches();}if(this._form){if(this.removeForm(this._form)){this._form.destroyRecursive();this._form=null;}var _b8d;while((_b8d=this._formConnects.pop())){this.disconnect(_b8d);_b8d=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){var _b8e=new _b8a();this._formWidgets={};this._form=this._createForm();this._formConnects=[this.connect(this._form,"onFieldCreated",this.onFieldCreated),this.connect(this._form,"onGroupCreated",this.onGroupCreated),this.connect(this._form,"onFormCreated",function(){_b8e.resolve();})];this.placeForm(this._form);when(_b8e,lang.hitch(this,function(){this._finishFormCreation();}));},_createForm:function(){return new _b8c(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm",useDefaultValue:false},this.formSettings));},_createFormEditorWrappers:function(){for(var _b8f in this._formWidgets){var _b90={name:_b8f,metadata:this.viewModel.getPropertyMetaData(_b8f)};var _b91=lang.clone(this.viewModel.getProperty(_b90.name));var _b92=new _b8b({property:_b90,propertyName:_b8f,value:_b91,editorWidget:this._formWidgets[_b8f],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_b92.editorWidget.set("parent",_b92);_b92.editorWidget.set("editMode","formedit");this._formConnects.push(this.connect(_b92,"onValueChange","_onWrapperValueChange"),this.connect(_b92,"onCancel","_onWrapperCancel"),this.connect(_b92,"onStopEdit","_onWrapperStopEdit"));this._createMapping(_b8f,_b92);_b90=null;_b91=null;_b92=null;}},_createMapping:function(_b93,_b94){var _b95=_b93.split(".");var _b96=false;if(this.connectOverlayItemsToFormWidgets){while(_b95.length>0){var _b97=_b95.join(".");var _b98=this._mappingManager.find("propertyName",_b97);_b88.forEach(_b98,function(_b99){_b96=true;_b99.propertyName=_b93;_b99.wrapper=_b99.wrapper||_b94;});_b95.pop();}}if(!_b96){this._mappingManager.add({propertyName:_b93,wrapper:_b94});}},onSetActiveProperty:function(_b9a){var _b9b=this._mappingManager.find("propertyName",_b9a).filter(function(_b9c){return !!_b9c.wrapper;})[0];if(_b9b){_b9b.wrapper.startEdit();}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_b9d,_b9e){this._formWidgets[_b9d]=_b9e;if(this._addStateWatch){this._addStateWatch(_b9e);}},onGroupCreated:function(_b9f,_ba0,_ba1){if(_ba0.contentViewModel!==undefined){_ba0.set("contentViewModel",this.viewModel);}},_finishFormCreation:function(){when(this.selectFormOnCreation?this.editLayoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("viewselect","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();},_removeLeftOver:function(){var _ba2=this.editLayoutContainer,_ba3;if(_ba2.leftOver){_ba3=_ba2.selectedChildWidget===_ba2.leftOver;when(_ba3?_ba2.selectChild(this.iframeWithOverlay):null,function(){var _ba4=_ba2.leftOver;if(_ba4){_ba2.removeChild(_ba4);_ba4.destroyRecursive();_ba2=_ba2.leftOver=null;}});}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_ba5,lang,_ba6,_ba7){return _ba5([_ba7],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){this._tryToStartEditing(false);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_ba8,_ba9){this.set("value",_ba9);},_tryToStartEditing:function(_baa){if(this.editing){return;}this._grabFocusOnStartEdit=_baa;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _bab=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;this._lastSavedValue=this._resetValue=this.value;}this.inherited(arguments);this.editing=_bab;},_setValueAttr:function(_bac){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_ba6.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_bad){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/keys","dijit/_Widget","dijit/form/_TextBoxMixin","epi/epi"],function(_bae,lang,_baf,keys,_bb0,_bb1,epi){return _bae([_bb0],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,closeOnViewportClick:true,onStartEdit:function(_bb2,data){},onValueChange:function(_bb3,_bb4,_bb5){},onCancel:function(_bb6){},onStopEdit:function(_bb7,_bb8,_bb9){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.remove();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_bba,_bbb){if(!this.editing){this.set("value",_bbb);}},startEdit:function(_bbc){this._startEdit(_bbc);},_startEdit:function(_bbd){lang.mixin(this.editorParams,_bbd);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_bbe){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_bbe);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_bbf){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_bbf);}else{this.cancel(_bbf);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){this.set("editing",false);this._removeEditingFeatures();},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===keys.ESCAPE){_baf.stop(e);this.cancel();}else{if(e.keyCode===keys.ENTER&&e.target.tagName==="INPUT"){_baf.stop(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(!this.editing&&ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_bc0){this.setEditorValue(_bc0);this._set("value",this.getEditorValue()||_bc0);},_setBlockDisplayNodeAttr:function(node){this.blockDisplayNode=null;this._set("blockDisplayNode",node);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName==="INPUT"){_bb1.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(_bc1,_bc2,lang){return _bc2(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){this._removeViewModelWatches();this.inherited(arguments);},_removeViewModelWatches:function(){_bc1.forEach(this._watchHandles,function(_bc3){_bc3.remove();});this._watchHandles=[];},_addStateWatch:function(_bc4){var _bc5=_bc4.get("name"),_bc6=this.viewModel;var _bc7=function(){var _bc8=_bc4.get("state");if(_bc8!=="Error"){_bc6.validator.clearPropertyErrors(_bc5,_bc6.validator.validationSource.client);}else{if(_bc8==="Error"){var _bc9=_bc4.get("message")||_bc4.getErrorMessage()||"";_bc6.validator.setPropertyErrors(_bc5,[{severity:_bc6.validator.severity.error,errorMessage:_bc9}],_bc6.validator.validationSource.client);}}};this._watchHandles.push(_bc4.watch("state",_bc7));this._watchHandles.push(_bc4.watch("message",_bc7));}});});},"epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/query","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/DestroyableByKey","epi/shell/postMessage","epi-cms/ApplicationSettings","epi-cms/contentediting/MutationObserver","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_bca,_bcb,_bcc,_bcd,lang,_bce,_bcf,_bd0,when,_bd1,_bd2,_bd3,_bd4,_bd5,_bd6,_bd7,_bd8,_bd9,_bda,_bdb,_bdc,res){return _bcc([_bd7,_bd3],{toolbar:null,editorFactory:null,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_deferredReloadHandle:null,_eventHandlers:null,_isCreatingWrapper:null,_mutationObserver:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_bd1.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _bd9();this._mutationObserver=new _bd6();this.own(this._mutationObserver.on("dom-updated",function(){this.emit("dom-updated");}.bind(this)));this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}this.overlay.destroyDescendants();this._mutationObserver.teardown();this.inherited(arguments);},_setCommandEnabled:function(_bdd,_bde){if(this.toolbar){this.toolbar.setItemProperty(_bdd,"disabled",!_bde);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},onReloadRequired:function(){this.inherited(arguments);setTimeout(function(){this._renderManager.suspend();this._renderManager.clear();}.bind(this),0);},_setViewModelAttr:function(_bdf){if(_bdf===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_bcb.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_bcb.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",_bcb.connect(this.viewModel,"onPropertyReverted",this,this._onPropertyReverted));this.ownByKey("viewModel",_bd0.subscribe("/dnd/start",function(){setTimeout(this.beginOperation.bind(this),0);}.bind(this.viewModel)));this.ownByKey("viewModel",_bd0.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_be0){},onPreviewReady:function(_be1,doc,_be2){if(_be2||_be1!==this.viewModel){this.set("viewModel",_be1);this.setupEditMode(doc);}else{if(_be1){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._mappingManager.clear();if(this._renderManager){this._renderManager.destroy();}this._renderManager=new _bda();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _bd8({button:this.toolbar._getWidget("autosave")});this.own(_bce.after(this._autoSaveButton,"onLayoutChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();})));}this._autoSaveButton.set("model",this.viewModel);var _be3=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._destroyOverlay();this.ownByKey("viewModel",this.viewModel.watch("hasUndoSteps",_be3),this.viewModel.watch("hasRedoSteps",_be3));_be3();this.onReadySetupEditMode(doc);if(_bd5.hasExternalTemplates){this.ownByKey("overlay",_bd4.subscribe(this.iFrame.name+"/site/property-positions",this._createOverlaysForProperties.bind(this)));_bd4.publish("/site/check-property-positions");}this._mutationObserver.setup(doc);doc=null;this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);this._mutationObserver.setup(doc);}),1);}}));},_destroyOverlay:function(){this.destroyByKey("overlay");},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _be4=_bcf("[data-epi-edit], [data-epi-property-name]",doc);var _be5=_bcf("[data-epi-edit] [data-epi-edit], [data-epi-property-name] [data-epi-property-name], [data-epi-property-name] [data-epi-edit], [data-epi-edit] [data-epi-property-name]",doc);return _bca.filter(_be4,function(node){return _be5.indexOf(node)===-1;});},_getOverlayParameters:function(_be6,_be7){var _be8=[];_bca.forEach(_be6,function(node){var _be9=node.dataset;var _bea=_bd2.pascalToCamel(_be9.epiEdit||_be9.epiPropertyName);var _beb=this.viewModel.getPropertyMetaData(_bea);var _bec=_be7||!!_be9.epiEdit;if(!_beb){return;}if(_beb.settings&&_beb.settings.readOnly){return;}var _bed=_bd2.pascalToCamel(_beb.getName());var _bee=_be9.epiPropertyDisplayName;if(_bee){_beb=lang.delegate(_beb,{displayName:_bee});}if(_beb!=null&&_beb.showForEdit){var _bef={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_be9.epiPropertyRendersettings||undefined,useMvc:_be9.epiUseMvc?_be9.epiUseMvc.toLowerCase()==="true":false};_bef=lang.mixin(_bef,_beb.additionalValues.renderSettings);var _bf0=_bec?"none":_be9.epiPropertyRender||_beb.customEditorSettings.rendererClass;switch(_bf0){case "client":_bf0="epi-cms/contentediting/ClientRenderer";break;case "none":_bf0="epi-cms/contentediting/NullRenderer";break;}var _bf1=JSON.parse(_be9.epiPropertyEditorsettings||null);var _bf2=JSON.parse(_be9.epiPropertyOverlaysettings||null);_bf2=lang.mixin(_bf2,_beb.overlaySettings);if(_bec){_beb.customEditorSettings.uiType=null;_beb.customEditorSettings.uiWrapper=null;}_be8.push({node:node,disabled:_be9.epiDisabled==="true",useOverlay:_be9.epiUseoverlay==="true",overlayZIndex:parseInt(_be9.epiOverlayZIndex,10)||0,property:{name:_bed,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_be9.epiPropertyType,wrapperType:_bec?"floating":_be9.epiPropertyEdittype||null,editorParams:_bf1,overlayParams:_bf2,editorWidgetType:_be9.epiPropertyEditor,renderSettings:_bef,rendererClass:_bf0,metadata:_beb,propertyNodeName:_bea}});}},this);_be8.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _be8;},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var _bf3=this._getPropertyNodes(doc);return this._getOverlayParameters(_bf3,false);},_createOverlaysForProperties:function(_bf4){if(!this.overlay.enabled){return;}var _bf5=this._getOverlayParameters(_bf4,true);var _bf6=this._mappingManager.find(function(_bf7){return !!_bf7.overlayItem;});this._mappingManager.clearMappings(_bf6);_bf5.forEach(function(_bf8){_bdc.createByDimensions(_bf8).then(function(_bf9){this.overlay.addChild(_bf9);this._connectUpdateControllerAndOverlayEvents(null,_bf9);this._mappingManager.add({blockPropertyInfo:_bf8.property,overlayItem:_bf9});}.bind(this));},this);},_createUpdateControllers:function(doc){var _bfa=this._createFullPageUpdateController(doc);if(_bfa){this._connectFullPageUpdateControllerEvents(_bfa);this._mappingManager.add({updateController:_bfa});}var _bfb=this._getEditableNodes(doc);_bca.forEach(_bfb,function(_bfc){var _bfd=_bfc.property;var _bfe=_bfc.node.innerHTML;var _bff=this._createNodeUpdateController(_bfc);when(this._createNodeOverlay(_bfc),lang.hitch(this,function(_c00){this._connectUpdateControllerAndOverlayEvents(_bff,_c00);this._mappingManager.add({blockPropertyInfo:_bfd,node:_bfc.node,updateController:_bff,overlayItem:_c00});}));this._renderManager.cacheRender(_bfd.name,_bfd.renderSettings,this.viewModel.getProperty(_bfd.name),_bfe);},this);},_createNodeOverlay:function(_c01){var _c02=new _bcd();if(!this.createOverlays){_c02.resolve(null);return _c02;}when(_bdc.create(_c01),lang.hitch(this,function(_c03){this.overlay.addChild(_c03);_c02.resolve(_c03);}));return _c02;},_createNodeUpdateController:function(_c04){var _c05=_c04.property;var _c06=_c05.metadata;var _c07=new _bdb({displayName:_c06.displayName,renderManager:this._renderManager,contentModel:_c05.contentModel,contentLink:_c05.contentLink,modelPropertyName:_c05.name,nodePropertyName:_c05.propertyNodeName,renderSettings:_c05.renderSettings,rendererClass:_c05.rendererClass,displayNode:_c04.node});return _c07;},_createFullPageUpdateController:function(doc){var _c08=[];if(doc){var _c09=_bcf("input[data-epi-full-refresh-property-names][type='hidden']",doc);_bca.forEach(_c09,function(tag){_bca.forEach(tag.dataset.epiFullRefreshPropertyNames.split(","),function(_c0a){if(!_bca.some(_c08,function(p){return p===_c0a;})){_c08.push(_bd2.pascalToCamel(_c0a));}});});}_bca.forEach(this.viewModel.metadata.properties,function(_c0b){if(_c0b.additionalValues["reloadOnChange"]===true){_c08.push(_bd2.pascalToCamel(_c0b.name));}});if(!_c08.length){return null;}var _c0c=new _bdb({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_c08,renderSettings:{isFullReload:true}});return _c0c;},_remapUpdateControllers:function(doc){var _c0d=this._getEditableNodes(doc);var _c0e=this._mappingManager.remap(_c0d);_bca.forEach(_c0e,function(_c0f){var _c10=_c0f.property;var _c11=this._createNodeUpdateController(_c0f);when(this._createNodeOverlay(_c0f),lang.hitch(this,function(_c12){this._connectUpdateControllerAndOverlayEvents(_c11,_c12);this._mappingManager.add({blockPropertyInfo:_c10,node:_c0f.node,updateController:_c11,overlayItem:_c12});}));this._renderManager.cacheRender(_c10.name,_c10.renderSettings,this.viewModel.getProperty(_c10.name),_c0f.node.innerHTML);},this);var _c13=this._createFullPageUpdateController(doc);if(_c13){this._connectFullPageUpdateControllerEvents(_c13);this._mappingManager.add({updateController:_c13});}},_connectUpdateControllerAndOverlayEvents:function(_c14,_c15){if(_c14){this.ownByKey("overlay",_bce.after(_c14,"onReloadRequired",lang.hitch(this,this._onBlockReloadRequired),true),_bce.after(_c14,"onRender",lang.hitch(this,this._onBlockRender),true));}if(_c15){this.ownByKey("overlay",_bce.after(_c15,"onClick",lang.hitch(this,this._onOverlayItemClick),true),_bce.after(_c15,"onValueChange",lang.hitch(this,function(_c16){this._onOverlayValueChange(_c15,_c16);}),true));}},_connectFullPageUpdateControllerEvents:function(_c17){this.destroyByKey("fullpageoverlay");this.ownByKey("fullpageoverlay",_bce.after(_c17,"onReloadRequired",this._onBlockReloadRequired.bind(this),true),_bce.after(_c17,"onRender",this._onBlockRender.bind(this),true));},_getEditor:function(_c18){var _c19=this._mappingManager.findOne("overlayItem",_c18);return (_c19.wrapper&&_c19.wrapper.editorWidget)?_c19.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_c1a){},_onOverlayItemClick:function(_c1b){if(this._isCreatingWrapper){return;}this._isCreatingWrapper=true;var _c1c=this._mappingManager.findOne("overlayItem",_c1b);var _c1d=_c1c.blockPropertyInfo;var val=this.viewModel.getProperty(_c1c.propertyName);var _c1e=lang.clone(val,true);var _c1f;var _c20=lang.hitch(this,function(_c21){_c1c.wrapper=_c21;this._activeEditorWrapper=_c21;_bd0.publish("/epi/layout/pinnable/propertyEditor/show",null);_bca.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_c1c.overlayItem.set("active",true);var _c22={value:_c1e,parent:_c21};when(_c21.startEdit(_c22)).always(lang.hitch(this,function(){this._isCreatingWrapper=null;}));this.overlay.set("readOnly",_c21.isOverlayDisabled);this.viewModel.set("disableUndo",_c21.isUndoDisabled);});if(_c1c.wrapper){_c1f=_c1c.wrapper;if(_c1f&&_c1f.editorWidget&&!_c1f.editorWidget.overlayItem){_c1f.editorWidget.overlayItem=_c1b;}_c1f.set("blockDisplayNode",_c1c.node);_c20(_c1f);}else{when(this._createEditorWrapper(_c1d,_c1b,_c1c.node,_c1e),lang.hitch(this,function(_c23){_c20(_c23);this.onEditorWrapperCreated(_c23);}));}},_createEditorWrapper:function(_c24,_c25,node,_c26){var def=new _bcd(),_c27={overlayItem:_c25};when(this.editorFactory.createEditor(_c24,node,_c26,_c27),lang.hitch(this,function(_c28){this.ownByKey("overlay",_bce.after(_c28,"onValueChange",lang.hitch(this,this._onWrapperValueChange),true),_bce.after(_c28,"onCancel",lang.hitch(this,this._onWrapperCancel),true),_bce.after(_c28,"onStopEdit",lang.hitch(this,this._onWrapperStopEdit),true));def.resolve(_c28);}),def.reject);return def;},_onBlockReloadRequired:function(_c29){var _c2a=function(){if(this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor){return;}if(this._deferredReloadHandle){this._deferredReloadHandle.remove();this._deferredReloadHandle=null;}this._toggleUndoRedoActions(false,false);this.onReloadRequired();}.bind(this);if(this.viewModel.isSaved){_c2a();}else{if(!this._deferredReloadHandle){this.own(this._deferredReloadHandle=_bce.after(this.viewModel,"onPropertySaved",_c2a,true));}}},_onBlockRender:function(_c2b){var _c2c=this._mappingManager.findOne("updateController",_c2b);if(_c2c&&_c2c.overlayItem){_c2c.overlayItem.refresh();}},_saveEditorChanges:function(_c2d,data){var _c2e=this._getEditor(_c2d);if(_c2e&&!_c2e.overlayItem){_c2e.overlayItem=_c2d;}if(_c2e&&_c2e.saveChanges){_c2e.saveChanges(_c2e,data);}},_onOverlayValueChange:function(_c2f,data){this._saveEditorChanges(_c2f,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_c30,_c31,_c32){var _c33=this._mappingManager.findOne("wrapper",_c30),_c34=_c33.propertyName;if(_c33.overlayItem){_c33.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_c34,_c31,_c32);},_onWrapperStopEdit:function(_c35,_c36,_c37,_c38){var _c39=this._mappingManager.findOne("wrapper",_c35);this.viewModel.endOperation();if(_c39.overlayItem){_c39.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_c3a,_c3b){var _c3c=this._mappingManager.findOne("wrapper",_c3a),_c3d=_c3c.updateController;this.viewModel.abortOperation();if(_c3d&&_c3d.renderSettings&&_c3d.renderSettings.rerenderOnCancel){_c3d.render();}if(_c3c.overlayItem){_c3c.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onPropertyReverted:function(_c3e,_c3f){this._mappingManager.find("propertyName",_c3e).forEach(function(_c40){var _c41=_c40.wrapper,_c42;if(_c41){_c42=_c41.get("editing");_c41.set("editing",false);_c41.set("value",_c3f);_c41.set("editing",_c42);}});},_toggleUndoRedoActions:function(_c43,_c44){this._setCommandEnabled("undo",!!_c43);this._setCommandEnabled("redo",!!_c44);}});});},"epi-cms/contentediting/MutationObserver":function(){define(["dojo/_base/declare","dojo/Evented"],function(_c45,_c46){return _c45([_c46],{_mutationObserverHandle:null,setup:function(doc){this.teardown();if(!doc){return;}var _c47=new MutationObserver(function(_c48){_c48.forEach(function(_c49){if(_c49.type==="attributes"&&(_c49.attributeName==="data-epi-edit"||_c49.attributeName==="data-epi-property-name")){this._publishEvent();}else{if(_c49.type==="childList"){Array.prototype.slice.call(_c49.addedNodes).forEach(function(_c4a){var _c4b=this._getEpiPropertyNodes(_c4a);if(_c4b.length===0){return;}this._publishEvent();},this);}}}.bind(this));}.bind(this));_c47.observe(doc,{attributes:true,childList:true,subtree:true});this._mutationObserverHandle=_c47;},teardown:function(){if(this._mutationObserverHandle!==null){this._mutationObserverHandle.disconnect();}this._mutationObserverHandle=null;},_getEpiPropertyNodes:function(_c4c){if(_c4c.nodeType!==Node.ELEMENT_NODE&&_c4c.nodeType!==Node.DOCUMENT_NODE){return [];}if(_c4c.attributes&&(_c4c.attributes["data-epi-edit"]||_c4c.attributes["data-epi-property-name"])){return [_c4c];}else{var _c4d=_c4c.querySelectorAll("[data-epi-edit], [data-epi-property-name]");return Array.prototype.slice.call(_c4d);}},_publishEvent:function(){this.emit("dom-updated");}});});},"epi-cms/contentediting/_View":function(){define(["dojo/_base/declare","dijit/_Widget"],function(_c4e,_c4f){return _c4e([_c4f],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_c50){this._set("viewModel",_c50);},_setIframeWithOverlayAttr:function(_c51){this._set("iframeWithOverlay",_c51);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_c52,doc){this.set("viewModel",_c52);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(_c53,_c54){},onReloadRequired:function(){}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(_c55,_c56,_c57,lang,_c58,_c59,_c5a,_c5b,_c5c,res){var _c5d={Saving:0,Offline:1,Saved:2};return _c57([_c5b],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,_updateTimeHandle:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){_c55.forEach(this._modelHandles,function(_c5e){_c5e.unwatch();});this._updateTimeHandle&&clearTimeout(this._updateTimeHandle);this._updateTimeHandle=null;this.inherited(arguments);},_setModelAttr:function(_c5f){_c55.forEach(this._modelHandles,function(_c60){_c60.unwatch();});this._set("model",_c5f);if(_c5f){this._modelHandles=[_c5f.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),_c5f.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),_c5f.watch("isSaved",lang.hitch(this,"_isSavedChanged")),_c5f.watch("isSaving",lang.hitch(this,"_isSavingChanged")),_c5f.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),_c5f.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",_c5f.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_c61){this._set("lastSaved",_c61);this.updateLastSaveTime();},_disableUndo:function(_c62,_c63,_c64){this._isUndoDisabled=_c64;this.updateButton();},_isOnlineChanged:function(name,_c65,_c66){if(_c66===_c65){return;}if(_c66){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_c67,_c68){this.set("lastSaved",_c68);},_isSavedChanged:function(name,_c69,_c6a){if(_c6a){this.updateLastSaveTime();}},_isSavingChanged:function(name,_c6b,_c6c){if(_c6c){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_c6d,_c6e){if(_c6d===_c6e){return;}if(!_c6e){this.revertToLastAutoSaveTime();}else{_c56.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_c58.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_c58.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_c58.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state===_c5d.Saving||this._hasDropDownOpen()){return;}if(this._state===_c5d.Saved){_c58.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_c58.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!==_c5d.Saved);},_setVisibility:function(_c6f){if(_c6f!==this._visible){this._visible=_c6f;if(this.button){_c59.set(this.button.domNode,{display:_c6f?"":"none"});this.button.set("itemVisibility",_c6f&&!this.button.disabled);if(this.button.isInNarrowToolbar){this.onLayoutChanged();}}}},onLayoutChanged:function(){},_hasDropDownOpen:function(){return this.button._popupStateNode?_c58.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}this._updateTimeHandle&&clearTimeout(this._updateTimeHandle);this._updateTimeHandle=setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);this._setVisibility(true);},showSavingStatus:function(){this._setVisibility(true);this._state=_c5d.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_c5d.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||!this.model.canChangeContent()||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}if(this.model.isSaving){this._state=_c5d.Saving;return;}this._state=_c5d.Saved;var _c70="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _c71={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_c5c.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_c5a.substitute(_c70,_c71));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_c72,lang,_c73,json,_c74,_c75,SHA1){return _c72(null,{_mappings:null,domUtils:null,attrNames:["data-epi-edit","data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_c75;},clear:function(){var _c76;try{while((_c76=this._mappings.pop())){this._clearMapping(_c76);}}catch(ex){console.error(ex);}},clearMappings:function(_c77){_c77.forEach(function(_c78){try{this._clearMapping(_c78);this._mappings.splice(this._mappings.indexOf(_c78),1);}catch(ex){console.error(ex);}},this);},_calculateNodeHash:function(node){if(!node){return "";}var _c79=_c73.map(this.attrNames,lang.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(_c79));},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_c7a){if(this._calculateNodeHash(_c7a.node)===item.nodeHash){item.node=_c7a.node;item.updateController.displayNode=_c7a.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_c7a.node);item.overlayItem.refresh();}return {success:true,mappedNode:_c7a};}return {success:false};},remap:function(_c7b){var _c7c=[];var _c7d=(_c7b!=null?_c7b.slice(0):[]);_c73.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _c7e=null;var _c7f=_c73.some(_c7d,lang.hitch(this,function(_c80){var _c81=this._tryRemapNode(item,_c80);_c7e=_c7e||_c81.mappedNode;return _c81.success;}));if(_c7f){if(_c7e){_c7d.splice(_c73.indexOf(_c7d,_c7e),1);}}else{this._clearMapping(item);delete item.node;_c7c.push(item);}if(item.wrapper&&item.node){item.wrapper.set("blockDisplayNode",item.node);}}));var _c82;while((_c82=_c7c.pop())){this._mappings.splice(_c73.indexOf(this._mappings,_c82),1);}return _c7d;},findOne:function(_c83,_c84){var _c85;_c73.some(this._mappings,function(m){if(m[_c83]===_c84){_c85=m;return true;}});return _c85;},find:function(){var _c86;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_c86=arguments[0];}else{var _c87=arguments[0],_c88=arguments[1];_c86=function(m){return m[_c87]===_c88;};}}return _c73.filter(this._mappings,_c86);},_clearMapping:function(_c89){for(var prop in _c89){if(_c89[prop]){if(prop!=="node"){if(lang.isFunction(_c89[prop].destroyRecursive)){_c89[prop].destroyRecursive();}else{if(lang.isFunction(_c89[prop].destroy)){_c89[prop].destroy();}else{if(lang.isFunction(_c89[prop].remove)){_c89[prop].remove();}}}}_c89[prop]=null;}}}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var _c8a=8,mask=(1<<_c8a)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_c8b(key);if(wa.length>16){wa=core(wa,key.length*_c8a);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_c8b(data)),512+data.length*_c8a);return core(opad.concat(hash),512+160);};function _c8b(s){var wa=[];for(var i=0,l=s.length*_c8a;i<l;i+=_c8a){wa[i>>5]|=(s.charCodeAt(i/_c8a)&mask)<<(32-_c8a-i%32);}return wa;};function _c8c(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _c8d(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_c8a){s.push(String.fromCharCode((wa[i>>5]>>>(32-_c8a-i%32))&mask));}return s.join("");};function _c8e(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_c8f){var out=_c8f||dxd.outputTypes.Base64;var wa=core(_c8b(data),data.length*_c8a);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _c8c(wa);case dxd.outputTypes.String:return _c8d(wa);default:return _c8e(wa);}};dxd.SHA1._hmac=function(data,key,_c90){var out=_c90||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _c8c(wa);case dxd.outputTypes.String:return _c8d(wa);default:return _c8e(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var _c91=8;var mask=(1<<_c91)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*_c91;i<l;i+=_c91){wa[i>>5]|=(s.charCodeAt(i/_c91)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_c91){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_c92,lang,_c93,json,_c94,epi,_c95,_c96,SHA1,_c97,_c98){return _c92([_c97],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_c99){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_c99);this.defaultRenderer=this.defaultRenderer||new _c98();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_c95.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_c9a){var def=new _c93();if(_c9a){if(this._rendererPool[_c9a]){return this._rendererPool[_c9a];}else{require([_c9a],function(_c9b){def.resolve(new _c9b());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_c9c,_c9d,_c9e,_c9f,_ca0){var def;if(this._isSuspending){def=new _c93();def.cancel();return def;}_c9e=_c96.transformDate(_c9e);_c9f=this.cloneAndCompleteRenderSettings(_c9f||{});var _ca1=this._get(_c9d,_c9f,_c9e);if(_ca1){def=new _c93();def.resolve(_ca1);}else{if(_c9f&&_c9f.isFullReload){def=new _c93();def.resolve({doReload:true});}else{def=new _c93();_c93.when(this._getRenderer(_ca0),lang.hitch(this,function(_ca2){if(!_ca2){_ca2=this.defaultRenderer;}_c93.when(this._queueItem(_ca2,_c9c,_c9d,_c9f,_c9e),function(_ca3){def.resolve(_ca3);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_ca4){_ca4.propertyRenderSettings=_ca4.propertyRenderSettings||"";var _ca5=lang.clone(_ca4);if(this.viewSettingsManager.get("enabled")){_c94.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_ca6){if(_ca6.get("enabled")){var _ca7=this.viewSettingsManager.getSettingProperty(_ca6.key);if(_ca7){this.updateRenderSettings(_ca5,_ca7,_ca6.key,_ca6.isTagItem);}}}));}return _ca5;},updateRenderSettings:function(_ca8,_ca9,key,_caa){var _cab=[],_cac=[],_cad="",_cae=(_caa?"tag":key),_caf=!_caa,data=null;if(_caa){_ca8.propertyRenderSettings=_ca8.propertyRenderSettings||"";data=(_ca8.propertyRenderSettings?dojo.fromJson(_ca8.propertyRenderSettings):{});}else{data=(_ca8?_ca8:{});}if(!data[_cae]||_caf){_cad=_ca9;}else{_cab=data[_cae].split(",");_c94.forEach(_cab,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!==_ca9.toLowerCase()){_cac.push(item);}});_cac.push(_ca9);_cad=_cac.join(", ");}data[_cae]=_cad;if(_caa){_ca8.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _cb0=this._nextItemToProcessIndex();while(_cb0>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_cb0);_cb0=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var _cb1=-1;var i=0;while(i<this._queue.length&&_cb1===-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){_cb1=i;}i++;}return _cb1;},_processItemInQueue:function(_cb2){var item=this._queue.splice(_cb2,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _cb3=lang.hitch(this,function(_cb4){if(this._isDestroyed){item.deferred.cancel();return;}if(_cb4&&_cb4.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:_cb4.doReload,innerHtml:_cb4.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_cb4);});var _cb5=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_c93.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_cb3,_cb5);},cacheRender:function(_cb6,_cb7,_cb8,_cb9){var data={innerHtml:_cb9,doReload:false};this._put(_cb6,_cb7,_cb8,data);},_queueItem:function(_cba,_cbb,_cbc,_cbd,_cbe){var key=this._getRenderHash(_cbc,_cbd);var _cbf;var _cc0=this._itemsBeingRendered[key];if(_cc0&&!_cc0.deferred.fired&&_cc0.value===_cbe){_cbf=_cc0.deferred;}else{var _cc1=this._queueIndex(_cba,_cbb,_cbc,_cbd,_cbe);if(_cc1<0){_cbf=new _c93();this._queue.push({contentLink:_cbb,renderer:_cba,propertyName:_cbc,renderSettings:_cbd,renderSettingsString:json.toJson(_cbd),value:_cbe,deferred:_cbf});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[_cc1];item.contentLink=_cbb;item.renderer=_cba;item.value=_cbe;_cbf=item.deferred;}}return _cbf;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_cc2,_cc3){return SHA1(json.toJson({p:_cc2,r:_cc3}));},_queueIndex:function(_cc4,_cc5,_cc6,_cc7,_cc8){var _cc9=-1;var _cca=json.toJson(_cc7);_c94.some(this._queue,function(item,i){if((item.propertyName===_cc6)&&(item.renderSettingsString===_cca)){_cc9=i;return true;}});return _cc9;},_put:function(_ccb,_ccc,_ccd,data){if(!_ccc.cacheResults){return;}var _cce=this._getCacheHash(_ccb,_ccc,_ccd);if(!this._cache){this._cache={};}this._cache[_cce]={data:data};},_get:function(_ccf,_cd0,_cd1){var _cd2=this._getCacheHash(_ccf,_cd0,_cd1);var _cd3=this._cache[_cd2];return (_cd3?_cd3.data:undefined);},_getCacheHash:function(_cd4,_cd5,_cd6){return SHA1(json.toJson({p:_cd4,r:_cd5,v:_cd6}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_cd7,epi,_cd8,_cd9,_cda,_cdb,_cdc,_cdd){return _cd7([_cda],{_routes:_cdc,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _cd9();}this._profile=this._profile||_cd8.resolve("epi.shell.Profile");},render:function(_cde,_cdf,_ce0,_ce1){var _ce2=_cdb.toContentReference(_cde);var url=null;if(_ce1.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_ce1.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_ce2.toString(),epieditmode:true,visitorgroupsByID:_ce1.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _ce3={propertyName:_cdf,propertyValue:json.toJson(_ce0),id:_ce2.toString(),renderSettings:""};if(_ce1&&_ce1.propertyRenderSettings){_ce3.renderSettings=_ce1.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_ce3});}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_ce4){dojo.mixin(this,_ce4);},render:function(_ce5,_ce6,_ce7,_ce8){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,_ce9,_cea,lang,_ceb,_cec,_ced,_cee,_cef){return _cea(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_cf0){dojo.mixin(this,_cf0);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_cf1){this._modelWatchHandle.push(this.contentModel.watch(_cf1,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){_ce9.forEach(this._modelWatchHandle,function(_cf2){_cf2.remove();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_cf3){},onRender:function(_cf4){},_renderNode:function(_cf5,_cf6,_cf7){var _cf8=this.contentLink;var _cf9=this.renderSettings;var _cfa=this.rendererClass;var _cfb=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_cf8,_cfb,_cf7,_cf9,_cfa);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_cfc){if(this._lastRenderDeferred){if(_cfc.doReload!==undefined&&_cfc.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_cfc)){this._updateRendering(_cfc);}else{if(_cfc.innerHtml!==undefined){this._updateRendering(_cfc.innerHtml,_cfc.attributes);}else{if(_cfc.error!==undefined){this._handleValidationError(_cfc.error);}}}}if(def===this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_cfd){var html="";if(!_cfd){return false;}if(_cfd.tagName==="IMG"){html=dojo.attr(_cfd,"src")||"";}else{html=_cfd.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _cfe;if(!this._showEmptyNode){return;}_cfe=this._isEmptyHtml(this.displayNode);if(_cfe&&this._canModifyDisplayNode()){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_canModifyDisplayNode:function(){return this.rendererClass!=="epi-cms/contentediting/NullRenderer";},_ensureSize:function(){if(!this._canModifyDisplayNode()){return;}try{this._clearComputedStyle();this._computeStyle();}catch(e){console.warn("Could not get or set domStyle for displayNode",e);}},_clearComputedStyle:function(){var _cff=this._originalStyle;if(_cff){for(var prop in _cff){if(_cff.hasOwnProperty(prop)){_cec.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){var node=this.displayNode,_d00=node&&_cec.get(node);if(!_d00){return;}var _d01={minWidth:_cec.toPixelValue(node,_d00.minWidth),minHeight:_cec.toPixelValue(node,_d00.minHeight),display:_d00.display},_d02={},_d03=_d01.minHeight===0,_d04=_d01.minWidth===0,_d05=_d01.display==="inline",_d06=_ced.getMarginBox(node,_d00);if(_d06.h<(_d03?this.minHeight:_d01.minHeight)||_d06.w<(_d04?this.minWidth:_d01.minWidth)){if(_d03){_d02.minHeight=this.minHeight+"px";}if(_d04){_d02.minWidth=this.minWidth+"px";}if(_d05){_d02.display="inline-block";}if(_d05||_d03||_d04){this._originalStyle=_d01;_cec.set(node,_d02);}}},_updateRendering:function(_d07,_d08){this.displayNode.innerHTML=_d07;if(_d08){_ce9.forEach(_d08,lang.hitch(this,function(_d09){this._updateAttribute(_d09);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_cec.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_d0a){if(_d0a.name.toLowerCase()==="class"){_ceb.add(this.displayNode,_d0a.value);}else{_cee.set(this.displayNode,_d0a.name,_d0a.value);}},_handleValidationError:function(_d0b){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){_cef.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi-cms/widget/overlay/Property"],function(lang,_d0c){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_d0d){var _d0e=new _d0c();var _d0f=_d0d.property.metadata.overlaySettings&&_d0d.property.metadata.overlaySettings.customType;var _d10=_d0d.property,_d11=_d0f||this.defaultType,_d12={},_d13=_d10.metadata&&_d10.metadata.settings||{};_d12.allowedTypes=_d13.allowedTypes||[];_d12.restrictedTypes=_d13.restrictedTypes||[];require([_d11],lang.hitch(this,function(_d14){var _d15=lang.mixin({name:_d10.name,description:lang.getObject("settings.tooltip",false,_d10.metadata),contentModel:_d10.contentModel,displayName:_d10.metadata.displayName,disabled:_d0d.disabled,sourceItemNode:_d0d.node},_d10.overlayParams,_d12);var _d16=new _d14(_d15);_d0e.resolve(_d16);}));return _d0e;},createByDimensions:function(_d17){_d17.property.metadata.overlaySettings.customType=this.defaultType;return this.create(_d17).then(function(_d18){_d18.updatePosition(_d17.node);return _d18;});}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_d19,lang,_d1a,Item){return _d19([Item],{onValueChange:function(_d1b){},_getRightProperty:function(){var _d1c=this.name;if(this.dndTargetPropertyName){_d1c+=("."+_d1a.pascalToCamel(this.dndTargetPropertyName));}return _d1c;},onDrop:function(_d1d,_d1e){var _d1f=this._getRightProperty();function _d20(_d21){if(!_d21){return [];}if(!(_d21 instanceof Array)){return [_d21];}return _d21;};if(this.dndTargetPropertyAllowMultiple===true){var _d22=_d20(lang.clone(this.contentModel.get(_d1f)));_d20(_d1e).forEach(function(item){_d22.push(item);});_d1e=_d22;}this.onValueChange({propertyName:_d1f,value:_d1e});}});});},"epi-cms/compare/views/CompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi-cms/contentediting/PageDataController","epi-cms/compare/CompareToolbar","epi-cms/compare/viewmodels/CompareViewModel"],function(_d23,lang,_d24,_d25,_d26,_d27){return _d23([_d25],{iframeName:"compareView",buildRendering:function(){this.inherited(arguments);var _d28=new _d27(),_d29=this.mainLayoutContainer,_d2a=new _d26({region:"top",splitter:false,model:_d28.compareToolbarViewModel});_d29.addChild(_d2a);this.set("compareModel",_d28);this.own(_d28,_d28.watch("leftVersionUri",lang.hitch(this,function(name,_d2b,uri){this._changeContext(uri);})),_d2a,_d2a.on("versionInformationUpdated",function(){_d29.layout();}),_d24.subscribe("/epi/shell/action/changeview",this._onChangeView.bind(this)));},setView:function(_d2c,_d2d){_d2d=lang.mixin({model:this.compareModel},_d2d);return this.inherited(arguments,[_d2c,_d2d]);},_changeContext:function(uri){if(uri&&this._currentViewModel&&uri!==this._currentViewModel.contentData.uri){_d24.publish("/epi/shell/context/request",{uri:uri},{sender:this});}},_refreshModel:function(_d2e,_d2f){this.inherited(arguments);this.compareModel.set({contentLink:_d2e.contentLink,typeIdentifier:_d2e.typeIdentifier,languages:_d2e.existingLanguageBranches});},_switchEditMode:function(){if(this.isActive){_d24.publish("/epi/shell/action/changeview","formedit",null,null,true);}},_onChangeView:function(type){if(type==="sidebysidecompare"||type==="allpropertiescompare"){this.compareModel.set("rightVersion",null);}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/debounce","epi/dependency","epi/Url","epi/shell/StickyViewSelector","epi/shell/TypeDescriptorManager","epi/shell/postMessage","epi-cms/_ContentContextMixin","epi-cms/contentediting/EditNotifications","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/viewmodel/ContentActivityFeedViewModel","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html","dijit/layout/BorderContainer","epi/shell/layout/CardContainer","epi/shell/layout/PreserveRatioBorderContainer","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/NotificationBar","epi-cms/activity/ActivityFeed"],function(_d30,_d31,lang,_d32,_d33,_d34,_d35,_d36,when,_d37,_d38,_d39,_d3a,_d3b,Url,_d3c,_d3d,_d3e,_d3f,_d40,_d41,_d42,_d43,res,_d44){return _d31([_d38,_d37,_d39,_d3f],{templateString:_d44,contextTypeName:"epi.cms.contentdata",iframeName:"sitePreview",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #1456F1 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_postMessage:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_ensurePreviewReadyPromise:null,_stickyViewSelector:null,componentTypeName:null,postMixInProperties:function(){this.inherited(arguments);var _d45=_d3b.resolve("epi.storeregistry");this._pageDataStore=this._pageDataStore||_d45.get("epi.cms.contentdata");this._stickyViewSelector=new _d3c();this._viewSettingsManager=_d3b.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_d3b.resolve("epi.shell.MessageService");this._profile=this._profile||_d3b.resolve("epi.shell.Profile");this._postMessage=this._postMessage||_d3e;this._editingCommands=_d43;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_d3b.resolve("epi.cms.contentediting.inUseNotificationManager");this._editNotifications=this._editNotifications||new _d40();this.own(this._editNotifications,this._editNotifications.on("changed",function(e){this._defaultNotificationWatchHandler("",e.oldValue,e.newValue,e.notification);}.bind(this)));this.activityModel=this.activityModel||new _d42({componentTypeName:this.componentTypeName});this.own(this.activityModel.watch("isActivitiesVisible",this._toggleActivities.bind(this)));},postCreate:function(){var cs;this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",this._switchEditMode.bind(this));cs=_d3b.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(this._interceptRequestContext.bind(this));this.own(this.notificationBar.on("notificationsChanged",function(){this.mainLayoutContainer.layout();}.bind(this)),_d36.subscribe("/epi/cms/action/undo",this._undoAction.bind(this)),_d36.subscribe("/epi/cms/action/redo",this._redoAction.bind(this)),_d36.subscribe("/epi/cms/action/save",this._saveAction.bind(this)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_d32.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),function(_d46){this.contextChanged(_d46);}.bind(this));this._toggleActivities();var _d47=this.mainLayoutContainer.getSplitter("right");_d34.after(_d47,"_stopDrag",function(){var _d48={size:_d33.get(this.activityFeed.domNode,"width")};this.activityModel._persistActivityFeedSettings(_d48);}.bind(this));},buildRendering:function(){this.inherited(arguments);this._loadSettings();},destroy:function(){this._interceptorHandle&&this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels.forEach(function(vm){vm.destroy();});this._viewModels=null;this.inherited(arguments);},_defaultNotificationWatchHandler:function(name,_d49,_d4a,_d4b){if(_d49){this.notificationBar.remove(_d49);}if(_d4a&&_d4a.content){var _d4c=_d4b?this._editNotifications.getAvailableNotificationIndex(_d4b):0;this.notificationBar.add(_d4a,_d4c);}},_switchEditMode:function(_d4d,_d4e,_d4f){var _d50,_d51=this._currentViewModel.viewName,_d52=false,_d53="view",_d54="onpageedit",_d55="formedit";if(!this.isActive){return;}if(_d51===_d53){_d36.publish("/epi/cms/action/disablepreview");}if(_d51===_d55){_d50=_d54;_d52=true;}else{_d50=_d55;}if(_d4f){this._stickyViewSelector.save(this._currentViewModel.contentData.hasTemplate,this._currentViewModel.contentData.typeIdentifier,_d50);}return this._ensurePreviewReady(this.setView(_d50,_d4e),_d52,true,_d50);},_iFrameLoaded:function(url,_d56){if(!!url&&!_d56){this._requestContextChangeByUrl(url,true,true);}var _d57=this._getInitialData(url);var _d58=this.iFrame.getWindow();this._postMessage.publish("beta/epiReady",_d57,_d58);this._postMessage.publish("epiReady",_d57,_d58);},_getInitialData:function(url){url=new Url(url);if(!url.query||url.query.epieditmode!=="True"){return {isEditable:false};}return {isEditable:!!this._currentViewModel&&this._currentViewModel.canChangeContent()};},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var _d59=-1;_d30.some(this._viewModels,function(item,idx){if(item.contentLink===id){_d59=idx;return true;}});return _d59;},_getViewModel:function(id){var _d5a=this._getViewModelIndex(id);if(_d5a>=0){return this._viewModels[_d5a];}else{return null;}},_removeViewModel:function(id){var _d5b=this._getViewModelIndex(id);if(_d5b>=0){var _d5c=this._viewModels.splice(_d5b,1)[0];_d5c.clear();}},_createViewModel:function(_d5d,ctx){var _d5e=new _d41({contentLink:_d5d.contentLink,contextTypeName:this.contextTypeName});_d5e.set("contentData",_d5d);_d5e.set("languageContext",ctx.languageContext);this._viewModels.push(_d5e);return _d5e;},contentContextUpdated:function(ctx,_d5f){var _d60=ctx.id;this._pageDataStore.refresh(_d60).then(function(_d61){if(this._currentViewModel){this._updateContentViewModel(_d61,ctx.languageContext);this._refreshModel(_d61,ctx);this._onViewRequireReload();}}.bind(this));},updateView:function(_d62,ctx,_d63){this._setActivityCommandModel();when(this._ensurePreviewReadyPromise,function(){if(_d62&&_d62.skipUpdateView&&_d62.viewName===this._currentViewModel.viewName){return;}if(_d63&&_d63.widgetResumed){_d33.set(this.domNode,"visibility","hidden");}if(_d62&&_d62.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(function(_d64){var _d65=this._currentViewModel.contentData.contentLink;this._updateContentViewModel(_d64,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange(_d65,_d64.contentLink);this._refreshModel(_d64,ctx);}.bind(this));}else{if(this._currentViewModel){this._currentViewModel.suspend();}var _d66;if(_d62&&_d62.viewName){if(_d62.availableViews){this._availableViewsLookup={};_d30.forEach(_d62.availableViews,function(_d67){this._availableViewsLookup[_d67.key]=_d67;},this);}_d66=_d62.viewName;}var _d68=_d62.forceReload;if((_d66==="view"||_d66==="onpageedit")&&this._currentViewModel&&this._currentViewModel.viewName==="formedit"){_d68=true;}return this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_d66,ctx,_d62.availableViews),true,_d68,_d66);}}.bind(this));},_getPreviewUrl:function(_d69){return when(this.getCurrentContext(),function(_d6a){return (_d69==="view"&&_d6a.previewUrl)?_d6a.previewUrl:_d6a.editablePreviewUrl;});},_ensurePreviewReady:function(_d6b,_d6c,_d6d,_d6e){var def=new _d35();if(_d6b){def=_d6b;}else{def.resolve();}if(_d6c&&_d6e!=="formedit"){def=def.then(function(_d6f){return when(this._getPreviewUrl(_d6e),function(url){return when(this._changeUrl(url,_d6d),function(){return _d6f;});}.bind(this));}.bind(this));}this._ensurePreviewReadyPromise=when(def,function(_d70){var doc=this.iframeWithOverlay.iframe.getDocument();var _d71=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_d71);_d71=null;this.iframeWithOverlay.overlay.set("enabled",this._currentViewModel.get("showOverlay"));if(this._viewSettingsManager.get("enabled")&&this._viewSettingsManager.getSettingProperty("project")){this.iframeWithOverlay.overlay.set("enabled",false);}this.iframeWithOverlay.layout(true);});_d33.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,!!_d70);this._editNotifications.updateSettings({viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}.bind(this));return this._ensurePreviewReadyPromise;},_loadContentDataAndSetView:function(_d72,_d73,ctx,_d74){var def=new _d35();when(this._pageDataStore.refresh(_d72)).then(function(_d75){this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_d74,viewName:_d73},contentData:_d75});if(!_d75){return;}if(this._currentViewModel&&this._currentViewModel.contentLink!==_d72){this.notificationBar.clear();}this._currentViewModel=this._getViewModel(_d75.contentLink);if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_d75,ctx);this._setActivityModel(_d75);}else{this._updateContentViewModel(_d75,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_d75,ctx);when(this.setView(_d73)).then(function(){def.resolve(true);}).otherwise(function(){def.cancel();});}.bind(this)).otherwise(function(){def.reject();});return def.promise;},_updateContentViewModel:function(_d76,_d77){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_d76);this._currentViewModel.set("languageContext",_d77);this._setActivityModel(_d76);},_refreshModel:function(_d78,_d79){var _d7a=this._currentViewModel;if(_d7a){this.toolbar.set("contentViewModel",_d7a);this._inUseNotificationManager.updateCommandModel(_d7a);this._editingCommands.set("model",_d7a);this._editNotifications.update(_d78,_d79,_d7a);}},itemChanged:function(id,item){},setView:function(_d7b,_d7c){var def=new _d35();if(_d7b==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_d7b in this._availableViewsLookup))){_d7b="formedit";}if(_d7b&&!(_d7b in this._availableViewsLookup)){return;}var _d7d=function(){when(this._setView(_d7b,_d7c),function(){def.resolve();},function(){def.cancel();});}.bind(this);var _d7e=function(){_d36.publish("/epi/cms/action/showerror");def.cancel();};when(this._savePendingChanges(),_d7d,_d7e);return def;},_setView:function(_d7f,_d80){var def=new _d35(),_d81=this._currentViewComponent,_d82=_d81&&_d81.viewModel&&_d81.viewModel.viewName===_d7f;var _d83=function(def){if(this.editLayoutContainer.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}.bind(this));}def.resolve();}.bind(this);_d36.publish("/epi/shell/action/changeview/updatestate",{viewName:_d7f});if(_d82){this._currentViewModel.viewName=_d7f;this.toolbar.set("contentViewModel",this._currentViewModel);_d83(def);}else{this._destroyCurrentViewComponent();var _d84=this._availableViewsLookup[_d7f].viewType;require([_d84],function(_d85){this._currentViewComponent=new _d85(lang.mixin({mainLayoutContainer:this.mainLayoutContainer,editLayoutContainer:this.editLayoutContainer,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_d80));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);this._currentViewComponent.on("dom-updated",_d3a(this._onDomUpdated,this,100));this._currentViewComponent.startup();this._currentViewModel.viewName=_d7f;this.toolbar.set("contentViewModel",this._currentViewModel);_d83(def);}.bind(this));}return def;},_onViewRequireReload:function(){return this._ensurePreviewReady(null,true,true,this._currentViewModel.viewName);},resize:function(size){this.inherited(arguments);if(this._started){this.mainLayoutContainer.resize(size);}},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",true);this.iframeWithOverlay.overlay.set("readOnly",false);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);if(this._currentViewModel){this._currentViewModel.resetNotifications();}},_requestContextChangeByUrl:function(url,_d86,_d87,_d88,_d89){var _d8a=new Url(url,_d88,_d89),_d8b={url:_d8a.toString()},_d8c={sender:this,forceContextChange:_d86,suppressFailure:_d87,viewName:this._currentViewModel&&this._currentViewModel.viewName};_d36.publish("/epi/shell/context/request",_d8b,_d8c);},_changeUrl:function(url,_d8d){var _d8e=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_d8e},true,_d8d);},_interceptRequestContext:function(_d8f,_d90){if(!(_d90&&_d90.sender&&_d90.sender===this)){return this._savePendingChanges();}else{var def=new _d35();def.resolve();return def;}},_savePendingChanges:function(){if(this._saveDeferred&&!this._saveDeferred.isFulfilled()){return this._saveDeferred.promise;}else{this._saveDeferred=new _d35();}if(this._currentViewModel&&this._currentViewModel.get("hasPendingChanges")&&!this._currentViewModel.get("hasErrors")){var _d91=this._currentViewModel.watch("hasPendingChanges",function(name,_d92,_d93){if(!_d93){_d91.remove();_d91=null;this._saveDeferred.resolve();}}.bind(this));this._currentViewModel.save();}else{this._saveDeferred.resolve();}return this._saveDeferred.promise;},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);},_undoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.undo();}},_redoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.redo();}},_saveAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.save();}},_onDomUpdated:function(){if(!this._currentViewComponent){return;}var doc=this.iframeWithOverlay.iframe.getDocument();this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,false);},_setIsActiveAttr:function(_d94){this._set("isActive",_d94);if(_d94){this._currentViewModel&&this._currentViewModel.wakeUp();this._editNotifications.wakeUp();}else{this._viewModels.forEach(function(_d95){_d95.suspend();});this._editNotifications.suspend();}},_toggleActivities:function(){_d32.toggle(this.activityFeed.domNode,"dijitHidden",!this.activityModel.isActivitiesVisible);_d32.toggle(this.activityFeed._splitterWidget.domNode,"dijitHidden",!this.activityModel.isActivitiesVisible);this._loadSettings();this.mainLayoutContainer.layout();},_setActivityCommandModel:function(){var _d96=_d3b.resolve("contentActivityCommandProvider");_d96.updateCommandModel(this.activityModel);},_setActivityModel:function(_d97){this.activityModel.set({contentLink:_d97.contentLink,name:_d97.name});},_loadSettings:function(){var _d98=this.activityModel.getActivityFeedSettings();if(!_d98||!_d98.size||_d33.get(this.mainLayoutContainer.domNode,"width")<_d98.size){return;}_d33.set(this.activityFeed.domNode,"width",_d98.size+"px");}});});},"epi-cms/contentediting/EditNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/plugin-area/edit-notifications"],function(_d99,lang,_d9a,_d9b,_d9c){return _d99([_d9b,_d9a],{_notificationChangedKey:"_EditingNotificationHandles",_notificationsKey:"_notifications",_notifications:null,postscript:function(){this.inherited(arguments);this.own(_d9c.on("added, removed",this._watchNotifications.bind(this)));this._watchNotifications();},update:function(_d9d,_d9e,_d9f){this._notifications.forEach(function(_da0){_da0.set("value",{contentData:_d9d,context:_d9e,contentViewModel:_d9f});});},updateSettings:function(_da1){this._notifications.forEach(function(_da2){_da2.set("settings",_da1);});},suspend:function(){this._notifications.forEach(function(_da3){_da3.set("isSuspended",true);});},wakeUp:function(){this._notifications.forEach(function(_da4){_da4.set("isSuspended",false);});},_watchNotifications:function(){this.destroyByKey(this._notificationsKey);this._notifications=_d9c.get().sort(function(a,b){return a.order-b.order;}).map(function(_da5){this.ownByKey(this._notificationsKey,_da5);return _da5;},this);this.destroyByKey(this._notificationChangedKey);this._notifications.forEach(function(_da6){this.ownByKey(this._notificationChangedKey,_da6.watch("notification",function(name,_da7,_da8){this.emit("changed",{notification:_da6,oldValue:_da7,newValue:_da8});}.bind(this)));},this);},getAvailableNotificationIndex:function(_da9){if(typeof _da9.order==="undefined"){return undefined;}var _daa=this._notifications.filter(function(n){return n!==_da9&&n.notification&&n.notification.content;});var _dab=0;_daa.forEach(function(n,_dac){if(_da9.order>=n.order){_dab=_dac+1;}},this);return _dab;}});});},"epi-cms/plugin-area/edit-notifications":function(){define(["epi/PluginArea","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/FuturePublishingDateNotification","epi-cms/project/ProjectNotification","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification"],function(_dad,_dae,_daf,_db0,_db1,_db2,_db3,_db4){var _db5=new _dad("epi-cms/edit/notifications[]");_db5.add(_db2);_db5.add(_db3);_db5.add(_db4);_db5.add(_dae);_db5.add(_daf);_db5.add(_db0);_db5.add(_db1);return _db5;});},"epi/PluginArea":function(){define("epi/PluginArea",["dojo/_base/declare","dojo/Evented","epi/locator"],function(_db6,_db7,_db8){return _db6([_db7],{constructor:function(_db9){if(typeof _db9!=="string"||_db9===""){throw new Error("The argument 'identifier' must be a non-empty string.");}this._identifier=_db9;_db8.add(_db9,[]);_db8.on(_db9,this.emit.bind(this));},add:function(_dba){return _db8.add(this._identifier,_dba);},get:function(){return _db8.get(this._identifier);}});});},"epi/locator":function(){define("epi/locator",["dojo/Evented","dojo/has","dojo/string"],function(_dbb,has,_dbc){var _dbd=/.+\[\]$/,_dbe={},_dbf=new _dbb();return {add:function(_dc0,_dc1){if(typeof _dc0!=="string"||_dc0===""){throw new Error("The argument 'identifier' must be a non-empty string.");}var _dc2=_dbd.test(_dc0);if(!_dc2&&_dbe[_dc0]){throw new Error(_dbc.substitute("A service with the identifier '${0}' has already been registered.",[_dc0]));}_dbe[_dc0]=_dc2?(_dbe[_dc0]||[]).concat(_dc1):_dc1;_dbf.emit(_dc0,"added");return {remove:this.remove.bind(this,_dc0,_dc1)};},get:function(_dc3){var _dc4=_dbe[_dc3];if(_dc4===undefined){if(has("epi-ignore-undefined-dependencies")){return;}throw new Error(_dbc.substitute("No service has been registered for the identifier '${0}'.",[_dc3]));}var _dc5=function(_dc6){return (typeof _dc6==="function")?new _dc6():_dc6;};if(_dbd.test(_dc3)){return _dc4.map(_dc5);}return _dc5(_dc4);},on:_dbf.on.bind(_dbf),remove:function(_dc7,_dc8){var _dc9=_dbe[_dc7];if(_dc9===undefined){return;}if(_dbd.test(_dc7)){var _dca=_dc9.indexOf(_dc8);if(_dca>-1){_dc9.splice(_dca,1);}}else{delete _dbe[_dc7];}_dbf.emit(_dc7,"removed");}};});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/Stateful","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/DestroyableByKey","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(_dcb,_dcc,_dcd,_dce,_dcf,on,when,epi,_dd0,_dd1,_dd2,_dd3,_dd4,_dd5){return _dcc([_dcf,_dd2],{order:40,_backCommand:null,_clickHandleKey:"clickHandle",constructor:function(){this._backCommand=new _dd3();},postscript:function(){this.inherited(arguments);this._store=this._store||_dd0.resolve("epi.storeregistry").get("epi.cms.referenced-content");},_valueSetter:function(_dd6){this.value=_dd6;var _dd7=_dd1.getValue(_dd6.contentData.typeIdentifier,"actAsAnAsset");if(!_dd7){this.set("notification",null);return;}when(this._store.query({ids:[_dd6.contentData.contentLink]})).then(this._updateNotification.bind(this));},_updateNotification:function(_dd8){if(!_dd8){this.set("notification",null);return;}var _dd9=_dd8[0].references;var _dda=_dce.create("div");if(_dd9.length>0){_dda.innerHTML+=_dd5.affect;var _ddb=_dd9.length+" "+(_dd9.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_ddc=_dce.create("a",{href:"#",innerHTML:_ddb,title:_dd5.referencestooltip},_dda);this.destroyByKey(this._clickHandleKey);this.ownByKey(this._clickHandleKey,on(_ddc,"click",function(evt){_dcd.stop(evt);self._showReferenceDialog();}));}else{_dda.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this.set("notification",{content:_dda,commands:[this._backCommand]});},_showReferenceDialog:function(){_dd4({contentItems:[this.get("value").contentData],showToolbar:true,mode:_dd4.mode.show});}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_ddd,_dde,_ddf,_de0,_de1){return _ddd([_de0],{label:_de1.backtoprevious,tooltip:_de1.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_ddf.resolve("epi.cms.BackContextHistory");},_execute:function(){_dde.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/Stateful","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_de2,lang,_de3,Url,_de4,_de5,_de6,_de7,_de8,_de9){return _de2([_de4],{order:50,_valueSetter:function(data){var _dea=data.context;if(!_dea.languageContext){this.set("notification",null);return;}var _deb=_de6.resolve("epi.storeregistry").get("epi.cms.language");_deb.query().then(lang.hitch(this,function(_dec){var _ded={};_de3.forEach(_dec,function(_dee){_ded[_dee.languageId]=_dee.name;},this);var _def=_dea.languageContext.warning;var _df0=_de7.currentContentLanguage;var _df1=_dea.languageContext;var _df2;if(_df0!==_df1.preferredLanguage&&_df1.isTranslationNeeded){_def=lang.replace(_de9.nottranslatedswitchto,[_ded[_df1.language],_ded[_df1.preferredLanguage]]);_df2=_df1.preferredLanguage;}else{if(_df0!==_df1.language&&!_df1.isTranslationNeeded){var _df3=_ded[_df0];var _df4=_ded[_df1.language];if(_df3&&_df4){_def=lang.replace(_de9.workinginwrongsite,[_df3,_df4]);}else{_def=_de9.languagenotenabled;}_df2=_df1.language;}}if(!_def){this.set("notification",null);return;}var html=_de5.create("div",{innerHTML:_def});var _df5=_ded[_df2];if(_df5){var url=new Url(window.top.location.href);var text=lang.replace(_de9.switchto,[_df5]);_de5.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_df2,"#context=",_dea.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this.set("notification",{content:html,commands:_df1.isTranslationNeeded&&_df0===_df1.preferredLanguage?[_de8.translate]:[]});}));}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_df6,_df7,_df8,_df9,_dfa,_dfb,_dfc,_dfd){return _df6([_df7],{order:60,postscript:function(){this.inherited(arguments);this._notificationPeriod=_dfb.expirationNotificationPeriod;this._setupCommands();},_valueSetter:function(_dfe){var _dff=_dfe.contentData.properties.iversionable_expire;this._updateNotification(_dff);},_updateNotification:function(_e00){var _e01=_df9.serverTime();var _e02=_e00?_e00.stopPublish:null,_e03=new Date(_e02);var text=null;if(_e02&&_df9.isDateValid(_e03)){if(new Date(_e01.getTime()+this._notificationPeriod*1000)>_e03){text=_e03<_e01?_dfd.expired:_df8.substitute(_dfc.expiretimetext,[_df9.timeToGo(_e03)]);}}if(!text){this.set("notification",null);}else{this.set("notification",{content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_dfa.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_e04,_e05){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_e05.watch("value",function(name,_e06,_e07){self._updateNotification(_e07);});});}});});},"epi-cms/contentediting/FuturePublishingDateNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.futurepublishingdate"],function(_e08,_e09,_e0a,_e0b,_e0c,_e0d){return _e08([_e09],{order:70,notification:null,_valueSetter:function(_e0e){var _e0f=_e0e&&_e0e.contentData;if(_e0f.status===_e0c.versionStatus.Published){var _e10=new Date(_e0f.properties.iversionable_startpublish);_e10.setSeconds(0,0);if(_e10.getTime()>_e0b.serverTime()){var _e11=_e0a.substitute(_e0d.message,[_e0b.toUserFriendlyHtml(_e10)]);this.set("notification",{content:_e11});return;}}this.set("notification",null);}});});},"epi-cms/project/ProjectNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/Stateful","dojox/html/entities","epi/dependency","epi/shell/DestroyableByKey","epi-cms/ApplicationSettings","epi-cms/contentediting/command/CreateDraft","epi-cms/core/ContentReference","dojo/text!./templates/ProjectNotification.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.notifications"],function(_e12,lang,all,_e13,_e14,_e15,_e16,_e17,_e18,_e19,_e1a,_e1b){return _e12([_e13,_e16],{order:10,_projectService:null,_createDraftCommand:null,constructor:function(_e1c,_e1d){this._projectService=_e1d||_e15.resolve("epi.cms.ProjectService");this._createDraftCommand=new _e18({ignoreContentStatus:true});this.own(this._projectService.on("project-item-updated",lang.hitch(this,this._onItemUpdated)),this._projectService.on("project-item-removed",lang.hitch(this,this._onItemRemoved)),this._projectService.on("project-updated",function(){this._onModelChanged(this.value);}.bind(this)));},_valueSetter:function(_e1e){var _e1f=_e1e.contentViewModel;this.value=_e1f;if(!_e1f||!_e1f.contentLink){this.set("model",null);this._currentProjectItemId=0;return;}this._createDraftCommand.set("model",_e1f);var _e20="contentLinkWatch";this.destroyByKey(_e20);this.ownByKey(_e20,_e1f.watch("contentLink",lang.hitch(this,"_onModelChanged",_e1f)));this._onModelChanged(_e1f);},_onItemUpdated:function(item){this._onItemsAddedOrRemoved(item.id);},_onItemRemoved:function(id){this._onItemsAddedOrRemoved(id);},_onItemsAddedOrRemoved:function(_e21){if(!this.model){return;}if(this._currentProjectItemId===_e21){this._updateNotification(this.model.contentLink);}},_onModelChanged:function(_e22){if(_e22.get("isSuspended")){return;}this._projectService.getProjectItemForContent(_e22.contentLink).then(function(_e23){var _e24=_e22.languageContext,_e25=_e24&&_e24.isTranslationNeeded&&_e17.currentContentLanguage===_e24.preferredLanguage;this.set("model",_e22);this._currentProjectItemId=_e23&&_e23.id||0;this._updateNotification(_e22.contentLink,_e22.contentData.isPartOfAnotherProject,_e25);}.bind(this)).otherwise(function(){this._currentProjectItemId=0;}.bind(this));},_updateNotification:function(_e26,_e27,_e28){var self=this;all([this._projectService.getProjectsForContent(_e26),this._projectService.getCurrentProject()]).then(function(_e29){var _e2a=_e29[0],_e2b=_e29[1];if(_e2a.length===0){self.set("notification",null);return;}var _e2c=_e2a.map(function(_e2d){return _e14.encode(_e2d.name);}).join(", ");var _e2e="";if(_e27){_e2e=_e1b.partofanotherproject+": "+_e2c;}else{if(_e2b){_e2e=_e1b.partofcurrentproject;}else{_e2e=_e1b.partofproject+": "+_e2c;}}var _e2f=lang.replace(_e1a,{partOfProject:_e2e});var _e30=_e27&&self._projectService.isProjectModeEnabled&&!_e28?[self._createDraftCommand]:[];self.set("notification",{content:_e2f,commands:_e30});});}});});},"url:epi-cms/project/templates/ProjectNotification.html":"<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon epi-iconProject\"></span>\r\n<span class=\"dijitReset dijitInline epi-project-notification__content\">{partOfProject}</span>","epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_e31,lang,_e32,_e33,_e34){var _e35=["normal","shortcut","external","inactive","fetchdata"];return _e31([_e32],{order:20,_valueSetter:function(_e36){var _e37=_e36.contentViewModel.contentModel.get("iversionable_shortcut");if(_e37){this._updateNotification(_e37.pageShortcutType);}if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_e36.contentViewModel.contentModel.watch("iversionable_shortcut",lang.hitch(this,function(name,_e38,_e39){this._updateNotification(_e39&&_e39.pageShortcutType);}));},_updateNotification:function(_e3a){var _e3b,_e3c=null;if(_e3a>0){_e3b=_e35[_e3a];_e3c=_e33.toHTML(_e34[_e3b]);}this.set("notification",{content:_e3c});}});});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","dojo/Stateful","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_e3d,_e3e,_e3f,_e40){return _e3d([_e3e],{order:30,_settingsSetter:function(_e41){var _e42=_e41.viewModel.contentData&&_e41.viewModel.contentData.accessMask<=_e3f.accessLevel.Read,_e43=_e42&&_e41.viewSetting.get("enabled")&&_e41.viewSetting.hasVisitorGroup();this.set("notification",_e43?{content:_e40.visitorgroups.noaccessright}:null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/json","dojo/Deferred","dojo/_base/lang","dojo/topic","dojo/on","dojo/when","dojo/promise/all","dojo/Stateful","dijit/Destroyable","dgrid/List","dgrid/extensions/DijitRegistry","epi","epi/dependency","epi/shell/UndoManager","epi/shell/DialogService","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","epi/shell/xhr/errorHandler","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_e44,_e45,_e46,json,_e47,lang,_e48,on,when,all,_e49,_e4a,List,_e4b,epi,_e4c,_e4d,_e4e,_e4f,_e50,_e51,_e52,_e53,_e54,_e55,_e56,_e57,res,_e58){return _e46([_e49,_e4a],{contentModel:null,metadata:null,syncService:null,editorFactory:null,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,enableAutoSave:true,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,validationErrors:null,isChangingContentStatus:false,isSuspended:false,constructor:function(){this.contentModel=new _e51();},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_e4c.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_e4c.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_e4c.resolve("epi.cms.ProjectService");this.currentContentLanguage=this.currentContentLanguage||_e53.currentContentLanguage;this.contentDataStore=this.contentDataStore||_e4c.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_e4c.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _e4d();this.validator=this.validator||new _e55({contextId:this.get("contentLink"),contextTypeName:this.contextTypeName});this._dialogService=this._dialogService||_e4e;if(!this.syncService){this._createSyncService();}var _e59=lang.hitch(this,function(name,_e5a,_e5b){this.set(name,_e5b);});this._operation=new _e57();this.own(this.syncService.watch("hasPendingChanges",_e59),this.validator.watch("isValid",_e59),this.validator.watch("hasErrors",_e59),this.undoManager.watch("hasUndoSteps",_e59),this.undoManager.watch("hasRedoSteps",_e59),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this.set("isSuspended",true);this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this.set("isSuspended",false);},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _e5c=new _e56({contentLink:this.get("contentLink"),contentDataStore:this.contentDataStore});this.syncService=_e5c;},connectLocal:function(_e5d,obj,evt,_e5e){if(!lang.isArray(_e5d)){throw Error("First argument to connectLocal must be an Array");}return _e5d.push(_e45.connect(obj,evt,this,_e5e));},disconnectLocal:function(_e5f){if(lang.isArray(_e5f)){var _e60;while((_e60=_e5f.pop())){_e45.disconnect(_e60);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_e61){return this.contentModel.get(_e61);},setProperty:function(_e62,_e63,_e64){this._setModelProperty(_e62,_e63,_e64);},scheduleForPublish:function(date){return this.saveProperty("iversionable_startpublish",date,_e54.saveAction.ForceCurrentVersion|_e54.saveAction.Schedule);},saveProperty:function(_e65,_e66,_e67){return this.syncService.saveProperty(_e65,_e66,_e67).then(function(_e68){this.set("validationErrors",_e68.validationErrors);this.contentModel.set(_e65,_e66);return this.changeContentStatus(_e67,true);}.bind(this));},saveAndPublishProperty:function(_e69,_e6a,_e6b){return when(this.syncService.saveProperty(_e69,_e6a,_e54.saveAction.Publish|_e6b),lang.hitch(this,function(_e6c){this.validator.setGlobalErrors(_e6c.validationErrors,this.validator.validationSource.server);this.contentModel.set(_e69,_e6a);return when(all([this.contentDataStore.refresh(_e6c.contentLink),_e6c.publishedContentLink?this.contentDataStore.refresh(_e6c.publishedContentLink):null]),lang.hitch(this,function(_e6d){var _e6e=_e6d[0];this.set("contentData",_e6e);return _e6c;}));}));},_commitChanges:function(_e6f){var _e70=[];_e6f.forEach(function(_e71){_e70.push({propertyName:_e71.propertyName,value:_e71.oldValue,oldValue:_e71.value});},this);this.undoManager.createStep(this,this._saveProperties,[_e70],"Edit properties");},_saveProperties:function(_e72){this.beginOperation();_e44.forEach(_e72,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_e73,_e74,_e75){_e75=_e75===undefined?this.contentModel.get(_e73):_e75;this.set("isSaved",false);this.contentModel.set(_e73,_e74);this._operation.save({propertyName:_e73,value:_e74,oldValue:_e75});this.syncService.scheduleForSync(_e73,_e74);this.enableAutoSave&&this.save();this.onPropertyEdited(_e73,_e74);},onPropertyEdited:function(_e76,_e77){},onPropertySaved:function(_e78,_e79){},onPropertyReverted:function(_e7a,_e7b){this.contentModel.set(_e7a,_e7b);},_onSynchronizeSuccess:function(_e7c,_e7d,_e7e){_e44.forEach(_e7d,lang.hitch(this,function(_e7f){this.validator.clearPropertyErrors(_e7f.name,this.validator.validationSource.server);this._patchContentDataStore(_e7c,_e7f.name,null,_e7f.value);this.onPropertySaved(_e7f.name,_e7f.value);}));this.validator.setGlobalErrors(_e7e.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_e80,_e81,_e82,_e83){var _e84=[];_e44.forEach(_e81,function(_e85){if("successful" in _e85){if(_e85.successful){this.validator.clearPropertyErrors(_e85.name,this.validator.validationSource.server);}else{_e84.push(_e85);}}},this);if(_e84.length){var _e86=_e44.map(_e84,function(_e87){return _e87.validationErrors;});this._showErrorsDialog(res.autosave.error,_e86,lang.hitch(this,function(){_e44.forEach(_e84,function(_e88){this.onPropertyReverted(_e88.name,_e88.value);},this);}));}if(_e83){if(_e83.validationErrors){this.validator.setGlobalErrors(_e83.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_showErrorsDialog:function(_e89,_e8a,_e8b){var list=new (_e46([List,_e4b]))({className:"epi-grid-max-height--300"});list.renderArray(_e8a);list.startup();function _e8c(){if(typeof _e8b==="function"){_e8b();}this._currentErrorDialog=null;};if(this._currentErrorDialog){this._currentErrorDialog.set("content",list);}else{this._currentErrorDialog=new _e50({description:_e89,content:list,onAction:_e8c.bind(this)});this._currentErrorDialog.show();}},_contentLinkChanged:function(_e8d){this.set("contentLink",_e8d);this.syncService.set("contentLink",_e8d);this.validator.setContextId(_e8d);this.onContentLinkChange();},ensureWritableVersion:function(){var _e8e=this.get("contentLink");if(!this.contentData.isNewVersionRequired){return _e8e;}if(this._isCreatingNewVersionDeferred&&!this._isCreatingNewVersionDeferred.isFulfilled()){return this._isCreatingNewVersionDeferred.promise;}else{this._isCreatingNewVersionDeferred=new _e47();}this.isCreatingNewVersion=true;when(this._contentVersionStore.put({originalContentLink:_e8e}),lang.hitch(this,function(_e8f){this.contentDataStore.refresh(_e8f.contentLink).then(lang.hitch(this,function(_e90){this.set("contentData",_e90);})).always(lang.hitch(this,function(){this.isCreatingNewVersion=false;this._contentLinkChanged(_e8f.contentLink);this._isCreatingNewVersionDeferred.resolve(_e8f);}));}),lang.hitch(this,function(_e91){this.isCreatingNewVersion=false;this._isCreatingNewVersionDeferred.reject(_e91);var _e92=_e91.responseText?json.fromJson(_e91.responseText):_e91.message;this.validator.setGlobalErrors(_e92,this.validator.validationSource.server);}));return this._isCreatingNewVersionDeferred.promise;},validate:function(){var def;if(!this.validator){def=new _e47();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _e93=this.get("contentLink");return when(this._contentVersionStore.remove(_e93),function(){this._loadPublishedVersion(_e93);}.bind(this),function(_e94){var _e95;if(_e94.status===403){_e95=_e58.deleteversion.cannotdeletepublished;}else{if(_e94.status===404){_e95=res.versionstatus.versionnotfound;}}if(_e95){return this._dialogService.alert(_e95).then(function(){this._loadPublishedVersion(_e93);}.bind(this));}}.bind(this));},_loadPublishedVersion:function(_e96){when(this._contentVersionStore.query({contentLink:_e96,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_e97){if(_e97!==null){var _e98={uri:"epi.cms.contentdata:///"+_e97.contentLink,context:this};_e48.publish("/epi/shell/context/request",_e98,{sender:this,forceReload:true});}}));},createDraft:function(){var _e99=this.get("contentLink"),_e9a=this.contentData.isCommonDraft&&this.contentData.status===_e54.versionStatus.DelayedPublish&&!this.projectService.isProjectModeEnabled;return when(this._contentVersionStore.put({originalContentLink:_e99,isCommonDraft:_e9a}),lang.hitch(this,function(_e9b){var _e9c={uri:"epi.cms.contentdata:///"+_e9b.contentLink,context:this};_e48.publish("/epi/shell/context/request",_e9c,{sender:this});_e48.publish("/epi/cms/content/statuschange/","common-draft",{id:_e9b.contentLink});}));},editCommonDraft:function(){var _e9d=this.get("contentLink");return when(this._contentVersionStore.query({contentLink:_e9d,query:"getcommondraftversion"}),lang.hitch(this,function(_e9e){var _e9f={uri:"epi.cms.contentdata:///"+_e9e.contentLink,context:this};_e48.publish("/epi/shell/context/request",_e9f,{sender:this});}));},_populateContentModel:function(data,_ea0){var _ea1={},_ea2,_ea3;for(var _ea4 in data){var _ea5=_ea0.getPropertyMetadata(_ea4);var _ea6=data[_ea4];if(_ea5.hasSubProperties()){_ea1[_ea4]=this._populateContentModel(_ea6,_ea5);}else{_ea1[_ea4]=_ea6;_ea2=_ea5.customEditorSettings.converter;if(_ea2){_ea3=_e4f.getConverter(_ea2,"runtimeType");if(_ea3){_ea1[_ea4]=_ea3.convert(_ea2,"runtimeType",_ea6);}}}}return _ea1;},getPropertyMetaData:function(_ea7){return when(this._getMetadata(),function(_ea8){return _ea8.getPropertyMetadata(_ea7);});},reload:function(){return when(all([this.contentDataStore.get(this.get("contentLink")),this._getMetadata(true)]),lang.hitch(this,function(data){var _ea9=data[0],_eaa=data[1];this.set("contentData",_ea9);var _eab=this.get("contentModel");var _eac=this._populateContentModel(_ea9.properties,_eaa);for(var name in _eac){if(_eac.hasOwnProperty(name)&&!epi.areEqual(_eab.get(name),_eac[name])){_eab.set(name,_eac[name]);}}}));},_getMetadata:function(_ead){var _eae=this.get("metadata");if(!_ead&&_eae){return _eae;}var self=this;return when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.get("contentLink")}),function(_eaf){self.set("metadata",_eaf);return _eaf;});},save:function(){if(!this.isOnline){var def=new _e47();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _e47(),_eb0=lang.hitch(this,function(_eb1){if(_eb1){if(_eb1.successful){this._onSynchronizeSuccess(_eb1.contentLink,_eb1.properties,_eb1);}else{this._rescheduleProperties(_eb1.properties);this._onSynchronizeFailure(_eb1.contentLink,_eb1.properties,_eb1.validationErrors,_eb1);}if(_eb1&&_eb1.hasContentLinkChanged&&this.contentLink!==_eb1.contentLink){this._contentLinkChanged(_eb1.contentLink);}this.set("validationErrors",_eb1.validationErrors);}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_eb2=lang.hitch(this,function(_eb3){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);if(_eb3&&_eb3.error&&(_eb3.error.status===409||_eb3.error.status===404)){var _eb4=_eb3.error.status===409?res.autosave.conflict:res.autosave.reloadmessage;this._showErrorsDialog(_eb4,[]);}else{this.set("isOnline",false);if(_eb3){this.set("validationErrors",_eb3.validationErrors);this._rescheduleProperties(_eb3.properties);}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);}def.reject(_eb3);});if(!this.hasPendingChanges){_eb0();}else{when(this.ensureWritableVersion()).then(lang.hitch(this,function(){this.set("isSaving",true);return this.syncService.save();})).then(_eb0).otherwise(_eb2);}return def;},_rescheduleProperties:function(_eb5){_e44.forEach(_eb5,lang.hitch(this,function(_eb6){if(!this.syncService.pendingSync(_eb6.name)){this.syncService.scheduleForSync(_eb6.name,_eb6.value);}}));},undo:function(){!this.get("isSuspended")&&this.undoManager.undo();},redo:function(){!this.get("isSuspended")&&this.undoManager.redo();},_patchContentDataStore:function(_eb7,_eb8,_eb9,_eba){var _ebb={};lang.setObject(_eb8,_eba,_ebb);return this.contentDataStore.patchCache({contentLink:_eb7,changedBy:this.profileHandler.userName,saved:(new Date()).toISOString(),properties:_ebb});},changeContentStatus:function(_ebc,_ebd){var _ebe=this.get("contentLink");var def=new _e47();this.set("isChangingContentStatus",true);var _ebf=lang.hitch(this,function(_ec0){var _ec1=_ec0&&_ec0.success;var _ec2=this.validator;if(_ec1){if(_ebc===_e54.saveAction.Publish||_ebc===_e54.saveAction.CheckIn||_ebc===(_e54.saveAction.CheckIn|_e54.saveAction.DelayedPublish|_e54.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_ec2){_ec2.clearGlobalErrors(_ec2.validationSource.server);}var _ec3={id:_ec0.id,oldId:_ebe};_e48.publish("/epi/cms/content/statuschange/",_ebc,_ec3);def.resolve(_ec3);}else{if(_ec0&&_ec0.validationErrors){if(_ec2){_ec2.setGlobalErrors(_ec0.validationErrors,_ec2.validationSource.server);_ec2.validate();}def.reject(null);}else{def.reject((_ec0&&_ec0.errorMessage)?_ec0.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _ec4=lang.hitch(this,function(_ec5){_e48.publish("/epi/cms/action/showerror");def.reject((_ec5&&_ec5.errorMessage)?_ec5.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();if(_ebd){var _ec6;if(this.validationErrors&&this.validationErrors.length>0){_ec6=!this.validationErrors.some(function(_ec7){return _ec7.severity===3;});}else{_ec6=true;}_ebf({id:this.contentLink,success:_ec6,validationErrors:this.validationErrors});}else{when(this.validate()).then(this.save.bind(this)).then(function(){return _e52.wrapXhr(this.contentDataStore.executeMethod("ChangeStatus",this.get("contentLink"),{action:_ebc}));}.bind(this)).then(_ebf).otherwise(_ec4);}return def;},_lastSavedGetter:function(){if(this.lastSaved){return this.lastSaved;}if(this.contentData){return this.contentData.saved;}return null;},onContentChange:function(){},onContentLinkChange:function(){if(this.get("isSuspended")){return;}var _ec8={uri:"epi.cms.contentdata:///"+this.get("contentLink")};_e48.publish("/epi/shell/context/request",_ec8,{sender:this,contextIdSyncChange:true,trigger:"internal"});},hasEditAccess:function(){return _e54.hasAccess(this.contentData.accessMask,_e54.accessLevel.Edit);},hasAccess:function(_ec9){var _eca=!this.languageContext||!this.languageContext.isTranslationNeeded;return _eca&&_e54.isActionAvailable(this.contentData,_ec9||_e54.action.Edit,_e54.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!==this.currentContentLanguage){return false;}return true;},canChangeContent:function(_ecb){var _ecc=this.projectService.isProjectModeEnabled&&this.contentData.isPartOfAnotherProject;return !_ecc&&this.canEditCurrentLanguage()&&this.hasAccess(_ecb);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language===this.currentContentLanguage;},_contentDataSetter:function(_ecd){this.contentData=_ecd;if(_ecd.contentLink!==undefined){this.set("contentLink",_ecd.contentLink);}},_showOverlayGetter:function(){var _ece=this.getProperty("iversionable_shortcut");if(_ece&&_ece.pageShortcutType){return _ece.pageShortcutType!==4;}return true;}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_ecf,_ed0,_ed1,lang,_ed2,_ed3,_ed4,_ed5){return _ed0([_ed4],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{none:0,info:1,warn:2,error:3},validationSource:{server:1,client:2},_errorLevels:{},constructor:function(_ed6){_ed0.safeMixin(this,_ed6);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _ed7=this.severity[p];this._errorLevels[_ed7]=p;}this.messageService=this.messageService||_ed5.resolve("epi.shell.MessageService");this._store=new _ed3({idAttribute:"id",data:[]});},setContextId:function(_ed8){var _ed9=this.contextId;this.contextId=_ed8;var _eda=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_ed9});_eda.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_edb,_edc){if(!_edb){return;}this._clearErrors(_edb,_edc);},setPropertyErrors:function(_edd,_ede,_edf){if(!_edd){return;}this._setErrors(_ede,_edd,_edf);},clearGlobalErrors:function(_ee0){this._clearErrors(null,_ee0);},clearErrorsBySource:function(_ee1){this._clearErrors(undefined,_ee1);},setGlobalErrors:function(_ee2,_ee3){this._setErrors(_ee2,null,_ee3);},_clearErrors:function(_ee4,_ee5){var _ee6;if(_ee4){_ee6={propertyName:_ee4};}else{if(_ee4===null){_ee6={global:true};}else{_ee6={};}}if(_ee5){_ee6.source=_ee5;}var _ee7=this._store.query(_ee6);_ee7.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_ee8,_ee9,_eea){this._clearErrors(_ee9,_eea);_ecf.forEach(_ee8,function(item){this._putStoreItem(item,_ee9,_eea);},this);this._updateFlags();},_putStoreItem:function(item,_eeb,_eec){var _eed="";if(this._errorLevels[item.severity]){_eed=this._errorLevels[item.severity];}var _eee=this.messageService.put(_eed,item.errorMessage,this.contextTypeName,this.contextId);var _eef={id:this._storeId++,item:item,severity:item.severity,messageId:_eee};if(_eeb){_eef.propertyName=_eeb;}else{_eef.global=true;}if(_eec!==undefined){_eef.source=_eec;}return this._store.put(_eef);},_updateFlags:function(){var _ef0=this._store.query({severity:this.severity.error});var _ef1=this._store.query({severity:this.severity.warn});var _ef2=_ef0.length===0&&_ef1.length===0;var _ef3=_ef0.length>0;this.set("isValid",_ef2);this.set("hasErrors",_ef3);},validate:function(){var _ef4=this.severity.error,_ef5=new _ed1();_ed1.when(this._validate(_ef4),function(_ef6){if(_ef6){_ed2.publish("/epi/cms/action/showerror");}_ef5.resolve(_ef6);},function(){_ed2.publish("/epi/cms/action/showerror");_ef5.reject();});return _ef5;},_validate:function(_ef7){var _ef8=new _ed1();if(!this._isBlocking){_ed1.when(this._store.query({severity:_ef7}),lang.hitch(this,function(_ef9){var _efa=_ecf.filter(_ef9,function(item){return item.source===this.validationSource.client;},this);var _efb=_efa.length>0;var _efc=_ef9.length>_efa.length;if(_efb){_ef8.reject();}else{_ef8.resolve(_efc);}}));}return _ef8;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/json","dojo/Stateful","epi/assign","epi/datetime","epi/string","epi/shell/postMessage","./ContentActionSupport"],function(_efd,_efe,_eff,when,json,_f00,_f01,_f02,_f03,_f04,_f05){return _efe([_f00],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,_oldContentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,_postMessage:null,constructor:function(_f06){_efe.safeMixin(this,_f06);this._queue=[];this._postMessage=this._postMessage||_f04;},_contentLinkSetter:function(_f07){this._oldContentLink=this.contentLink;this.contentLink=_f07;},scheduleForSync:function(_f08,_f09){if(_f09===undefined){return;}this.set("hasPendingChanges",true);_f09=_f02.transformDate(_f09);var _f0a=this._propertyIndexInQueue(_f08);if(_f0a<0){this._queue.push({name:_f08,value:_f09});}else{this._queue[_f0a].value=_f09;}},saveProperty:function(_f0b,_f0c,_f0d){this.scheduleForSync(_f0b,_f0c);return this._startSynchronizeInterval({delay:0,action:_f0d});},_propertyIndexInQueue:function(_f0e){var _f0f=-1;_efd.some(this._queue,function(item,i){if(item.name===_f0e){_f0f=i;return true;}});return _f0f;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(_f10){var _f11;if(!this._saveDeferred){this._saveDeferred=new _eff();_f11=_f10&&_f10.delay||this.processInterval;setTimeout(this._synchronizeItem.bind(this,_f10),_f11);}return this._saveDeferred.promise;},_synchronizeItem:function(_f12){var _f13=this._queue,_f14=this.contentLink,_f15=this._saveDeferred;this._queue=[];this._saveDeferred=null;this.set("hasPendingChanges",false);var _f16=function(_f17){var _f18={},_f19;if(_f17){_efd.forEach(_f17.properties,function(_f1a){_f1a.name=_f03.pascalToCamel(_f1a.name);},this);_f19=_f17.savedContentLink;_f18=_f01({successful:false,contentLink:_f17.savedContentLink,hasContentLinkChanged:this._hasContentLinkChanged(_f17)},_f17);if(_f19&&_f19!==this.contentLink){this.set("contentLink",_f19);}_f18.oldContentLink=this._oldContentLink;this._oldContentLink=null;this._publishContentSavedMessage(_f18);_f15.resolve(_f18);}else{_f15.reject({contentLink:_f14,properties:_f13,error:"Unexpected result returned from the server."});}}.bind(this);var _f1b=function(_f1c){var _f1d={contentLink:_f14,properties:_f13,error:_f1c};_f15.reject(_f1d);}.bind(this);if(_f13.length===0){_f15.resolve();return;}when(this._saveProperties(_f13,_f12)).then(_f16).otherwise(_f1b);},_hasContentLinkChanged:function(_f1e){var _f1f=this._oldContentLink&&this._oldContentLink!==this.contentLink;return _f1e.savedContentLink&&_f1e.savedContentLink!==this.contentLink||_f1f;},_publishContentSavedMessage:function(_f20){this._postMessage.publish("contentSaved",{contentLink:_f20.contentLink});this._postMessage.publish("beta/contentSaved",_f20);},pendingSync:function(_f21){return this._propertyIndexInQueue(_f21)!==-1;},_saveProperties:function(_f22,_f23){var _f24=this.contentLink,_f25={};_efd.forEach(_f22,function(item){_f25[item.name]=json.toJson(item.value);});var _f26={id:_f24,properties:_f25,action:_f23?_f23.action:_f05.saveAction.Save|_f05.saveAction.SkipValidation};return this.contentDataStore.patch(_f26,{id:_f26.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(_f27,_f28,lang,_f29,_f2a){return _f28([_f2a,_f29],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=_f27.filter(this.changes,function(_f2b){if(_f2b.propertyName===data.propertyName){data.oldValue=_f2b.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/viewmodel/ContentActivityFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/project/viewmodels/_ProjectFeedViewModel"],function(_f2c,lang,when,_f2d,_f2e){return _f2c([_f2e],{isSingleItemSelected:true,_contentLink:null,isActivitiesVisible:false,_activityFeedSettings:null,postscript:function(){this.inherited(arguments);this.store=this.store||_f2d.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_f2d.resolve("epi.shell.profile");this._activityFeedSettings={};when(this.profile.get(this._getActivityFeedProfileKey())).then(function(_f2f){this._activityFeedSettings=_f2f;this.set("isActivitiesVisible",!!(_f2f&&_f2f.isActivitiesVisible));}.bind(this));},_contentLinkSetter:function(_f30){this._contentLink=_f30;this._updateQuery();},_isActivitiesVisibleSetter:function(_f31){this.isActivitiesVisible=_f31;this._updateQuery();this._persistActivityFeedSettings({isActivitiesVisible:_f31});},_updateQuery:function(){if(this.isActivitiesVisible&&this._contentLink){this.set("query",{contentReferences:[this._contentLink]});}else{this.set("query",null);}},_nameSetter:function(name){this.set("placeholderName",name);},_persistActivityFeedSettings:function(_f32){this._activityFeedSettings=lang.mixin(this._activityFeedSettings,_f32);this.profile.set(this._getActivityFeedProfileKey(),this._activityFeedSettings);},getActivityFeedSettings:function(){return this._activityFeedSettings;},_getActivityFeedProfileKey:function(){return this.componentTypeName+"activity-feed";}});});},"epi-cms/project/viewmodels/_ProjectFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/activity/viewmodels/_ActivityViewModel","dojo/Evented"],function(_f33,lang,_f34,_f35,_f36){return _f33([_f35,_f36],{hideOnPost:false,isEditEnabled:false,isSingleItemSelected:false,readOnly:false,selectedProjectId:null,noDataMessage:"",_save:function(_f37){var _f38=this.activityService.addMessage(this.selectedProjectId,this._contentLink,_f37);_f38.then(this.emit.bind(this,"save"));return _f38;},_placeholderNameSetter:function(_f39){this.placeholderName=_f39;var _f3a=_f39?lang.replace(_f34.textareaplaceholder,{name:_f39}):"";this.set("placeholderText",_f3a);}});});},"epi-cms/activity/viewmodels/_ActivityViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_f3b,_f3c,all,_f3d,when,_f3e,_f3f,_f40,_f41,_f42,_f43,_f44){return _f3b([_f41],{activityService:null,editLabel:_f43.edit,comment:null,sendLabel:_f43.post,resetLabel:_f43.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_f44.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_f3f.resolve("epi.cms.ActivityService");this.profile=this.profile||_f3f.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_f3f.resolve("epi.storeregistry").get("epi.cms.notification.users");},getComment:function(){var _f45=this.comment;if(!_f45){return "";}return this._formatText(_f45);},save:function(_f46){var _f47=this._save(_f46);_f47.otherwise(this._handleError.bind(this));return _f47;},_save:function(_f48){},_formatText:function(text){if(!text){return "";}var map=_f3e.html;text=_f3e.encode(text,map);text=text.replace(/\r\n|\n|\r/ig,"<br/>");return text;},_handleError:function(){this.set("errorMessage",_f42.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_f49){this.message=_f49;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _f4a=this._formatText(this.message);if(!_f4a||!this.notificationUserStore){return new _f3c().resolve(_f4a);}var _f4b=/\B@([^\s":;|=,+*?<>[\]]+)/g,_f4c=_f4a.match(_f4b)||[],_f4d={},_f4e=_f4c.map(function(_f4f){var _f50=_f4f.replace(/^@/,"");return when(this.notificationUserStore.query({name:_f50,exactMatch:true})).then(function(user){_f4d[_f50]=user.displayName;}).otherwise(function(){});}.bind(this));return all(_f4e).then(function(){_f4a=_f4a.replace(_f4b,function(_f51,key){return _f4d[key]?"<strong>"+_f40.encodeForWebString(_f4d[key])+"</strong>":_f51;});return _f4a;});}});});},"url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\r\n    <div data-dojo-attach-point=\"mainLayoutContainer\" data-dojo-type=\"epi/shell/layout/PreserveRatioBorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\r\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top', layoutPriority: 90\"></div>\r\n        <div data-dojo-attach-point=\"activityFeed\" data-dojo-type=\"epi-cms/activity/ActivityFeed\" data-dojo-props=\"region: 'right', model: this.activityModel, layoutPriority: 95, splitter: true, minSize: 200\" style=\"width: 25%; min-width: 200px\" class=\"dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"editLayoutContainer\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center', layoutPriority: 100\">\r\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true, iframeName:'${iframeName}'\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_f52,lang,fx,_f53,has,on,_f54,_f55,_f56,_f57,when,_f58,_f59,_f5a){return _f52([_f59,_f58],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var _f5b=this.selectedChildWidget;var _f5c=this.getChildren(),_f5d=_f5c[_f5c.length-1];if(_f5b&&_f5b.resize){if(_f5b.fitContainer){_f5b.resize(this._containerContentBox||this._contentBox);}else{_f5b.resize();}}if(_f5b!==_f5d&&!_f5b.fitContainer){_f54.replace(_f5d.domNode,"dijitVisible","dijitHidden");if(_f5d&&_f5d!==_f5b&&_f5d.resize){if(_f5d.fitContainer){_f5d.resize(this._containerContentBox||this._contentBox);}else{_f5d.resize();}}}},addChild:function(_f5e,_f5f){if(this._started){var _f60=this.getChildren(),_f61=_f60[_f60.length-1];if(_f5f>=_f60.length){_f54.replace(_f61.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_f62,_f63){var _f64=this.getChildren(),_f65=_f64[_f64.length-1];if(!_f63||_f63._destroyed){return;}if(_f63.fitContainer&&_f63!==_f65){_f54.replace(_f65.domNode,"dijitVisible","dijitHidden");}return when(_f62===_f65?this._hideTransition(_f63,_f65):null,lang.hitch(this,function(n){var _f66=0;if(_f63&&!_f63._destroyed&&_f63!==_f65){_f66=_f56.getMarginBox(_f63.domNode).h;this._hideChild(_f63);}if(!_f62||_f62._destroyed){return;}this._showChild(_f62);if(_f62.resize){if(_f62.fitContainer){_f62.resize(this._containerContentBox||this._contentBox);}else{_f62.resize(null);}return when(this._showTransition(_f62,_f65,_f66),function(){if(_f62.fitContainer&&_f62!==_f65){_f54.replace(_f65.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_f67,_f68){return this._doTransition(_f67,_f68,false);},_showTransition:function(_f69,_f6a,_f6b){return this._doTransition(_f69,_f6a,true,_f6b);},_doTransition:function(page,_f6c,_f6d,_f6e){if(page!==_f6c){var _f6f=_f56.getMarginBox(page.domNode),_f70=this._getAnimationNode(page,_f6c);var _f71=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_f6f.h:_f6f.w,from=_f6d?-(size-_f6e)+"px":"0px",to=_f6d?"0px":-size+"px",_f72=!_f6d;return this._animate(_f70,_f71,from,to,_f72);}},_getAnimationNode:function(page,_f73){return page.transitionMode==="slideIn"?this.containerNode:((page.transitionMode==="reveal")?_f73.domNode:null);},_animate:function(node,_f74,from,to,_f75){var dfd=new _f57();if(node&&has("css-transitions")&&from!==to){_f55.set(node,_f74,from);setTimeout(lang.hitch(this,function(){_f54.add(node,this.transitionClass);var _f76=on(node,has("transitionend"),lang.hitch(this,function(){_f76.remove();_f54.remove(node,this.transitionClass);if(_f75){_f55.set(node,_f74,from);}dfd.resolve();}));setTimeout(function(){_f55.set(node,_f74,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi/shell/layout/PreserveRatioBorderContainer":function(){define("epi/shell/layout/PreserveRatioBorderContainer",["dojo/_base/declare","dijit/layout/BorderContainer","epi/shell/layout/_PreserveRatioMixin"],function(_f77,_f78,_f79){return _f77([_f78,_f79],{});});},"epi/shell/layout/_PreserveRatioMixin":function(){define("epi/shell/layout/_PreserveRatioMixin",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/Destroyable"],function(_f7a,lang,_f7b,_f7c){return _f7a([_f7c],{postCreate:function(){this.inherited(arguments);this.own(_f7b.before(this,"resize",lang.hitch(this,this._adjustSplitter)));},_adjustSplitter:function(){if(typeof this.getChildren==="function"){var _f7d=this.getChildren();if(_f7d.length===0){return;}var _f7e=_f7d.filter(function(obj){return (obj.splitter===true);});var _f7f=_f7d.filter(function(obj){return (obj.splitter!==true);});var _f80=_f7e.length;var max=0;for(var _f81 in _f7e){max=this._calcTrueMax(_f7f,_f7e,_f7e[_f81],_f80);_f7e[_f81].set("style",this._getStyle(_f7e[_f81],max));}}},_getStyle:function(_f82,max){var _f83=null;switch(_f82.region){case "top":case "bottom":_f83="height: "+this._calcRatio(_f82.get("h"),max)+"%;";break;case "left":case "right":_f83="width: "+this._calcRatio(_f82.get("w"),max)+"%;";break;}return _f83;},_calcRatio:function(_f84,max){return (_f84/max)*100;},_calcTrueMax:function(_f85,_f86,_f87,_f88){var _f89="w";if(_f87.region==="bottom"||_f87.region==="top"){_f89="h";}var max=_f87.get(_f89);var _f8a=_f85.filter(function(_f8b){return _f8b.region==="center";})[0].get(_f89);var _f8c=_f87._splitterWidget.get(_f89);var _f8d=function(_f8e){if(_f89==="w"&&(_f8e.region==="right"||_f8e.region==="left")){max+=_f8e.get("w");}else{if(_f89==="h"&&(_f8e.region==="bottom"||_f8e.region==="top")){max+=_f8e.get("h");}}};_f85.forEach(_f8d);_f86.forEach(function(_f8f){if(_f8f===_f87){return;}_f8d(_f8f);});return max+_f8a+(_f8c*_f88);}});});},"epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/topic","dojo/when","epi","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_f90,lang,_f91,_f92,_f93,when,epi,_f94,_f95,_f96,res,_f97){return _f90([_f96],{res:res,_isSavingHandle:null,_editActionViewModel:null,_commands:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_f94;this.own(this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);})));this._editActionViewModel=new _f95();this.own(this._editActionViewModel);},resize:function(_f98){this.inherited(arguments);if(_f98){_f92.toggle(this.domNode,"epi-editToolbarNarrow",_f98.w<620);_f92.toggle(this.domNode,"epi-editToolbarMedium",_f98.w>=620&&_f98.w<1000);_f92.toggle(this.domNode,"epi-editToolbarLarge",_f98.w>=1300);this._editActionViewModel.set("expanded",_f98.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_f98.w<1000);}},setupChildren:function(_f99,_f9a){var _f9b=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_f93.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_f93.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._commands.revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}}];var _f9c=_f99?_f99:[];_f9b=_f9a?_f9a.concat(_f9b):_f9b;return this.inherited(arguments,[_f9c,_f9b]);},_setContentViewModelAttr:function(_f9d){this._set("contentViewModel",_f9d);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(_f9d);}));},_updateToolbarItemsModel:function(_f9e){if(!_f9e.isSaving){this.setItemProperty("autosave","label","");}this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _f9f=_f9e.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_f9f.contentLink});this._editActionViewModel.set("dataModel",_f9e);if(this._isSavingHandle){this._isSavingHandle.unwatch();}this._isSavingHandle=_f9e.watch("isSaving",function(name,_fa0,_fa1){this._widgetMap["editactionpanel"].toggleDropDownMenu(!_fa1);}.bind(this));this.setItemProperty("viewselect","viewName",_f9e.viewName);}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(_fa2,_fa3,lang,_fa4,_fa5,_fa6,_fa7,_fa8,_fa9,_faa,_fab,res){return _fa3([_fa8],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10,AwaitingApproval:11,Rejected:12},_isSavingHandle:null,_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_fab.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _fac in this._virtualStatusEnum){this._virtualStatusCssState.push(_fac);this._virtualStatusLocalization.push(this.res["status"][_fac.toLowerCase()]);}this._statusMap[_fa7.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_fa7.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_fa7.versionStatus.Rejected]=this._virtualStatusEnum.Rejected;this._statusMap[_fa7.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_fa7.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_fa7.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_fa7.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusMap[_fa7.versionStatus.AwaitingApproval]=this._virtualStatusEnum.AwaitingApproval;this._statusIcon[_fa7.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_fa7.versionStatus.Rejected]="epi-icon--inverted epi-iconStop";this._statusIcon[_fa7.versionStatus.AwaitingApproval]="epi-icon--inverted epi-iconGlasses";}if(!this.skipChildModels){this.publishMenuViewModel=new _fa9({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}if(this._isSavingHandle){this._isSavingHandle.unwatch();}this.inherited(arguments);},_dataModelSetter:function(_fad){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",_fad);}},onDataModelChange:function(){var _fae=this.dataModel.contentData;if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this._isChangingContentStatusHandle=this.dataModel.watch("isSaving",function(name,_faf,_fb0){if(_fb0){this.set("statusText","");}else{this._refresh(_fb0);}}.bind(this));this._refresh((!this.dataModel.hasErrors&&this.dataModel.hasPendingChanges)||this.dataModel.isSaving);if(_fae.isDeleted){this.set("statusIcon","");this.set("nonEditableIndicator",true);}else{this.set("statusIcon",this._getStatusIcon(_fae));var _fb1=this.dataModel.canChangeContent(_fa7.action.Edit);var _fb2=_fae.status===_fa7.versionStatus.AwaitingApproval;this.set("nonEditableIndicator",!_fb1&&!_fb2);}this.set("visible",!_fae.isWastebasket);},_refresh:function(_fb3){if(_fb3){return;}var _fb4=this.dataModel.contentData;var _fb5=this._getVirtualStatus(_fb4);this.set("additionalClass",this._getVirtualStatus(_fb4)===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this.set("state",this._virtualStatusCssState[_fb5]);this.set("statusText",this._getStatusText(_fb5,_fb4));this.set("buttonText",this._getButtonText(_fb5,_fb4));},_getStatusText:function(_fb6,_fb7){if(_fb6===this._virtualStatusEnum.Deleted){return this._virtualStatusLocalization[_fb6];}if(_fb7.status===_fa7.versionStatus.DelayedPublish){return _fa5.substitute(this._virtualStatusLocalization[_fb6],[_faa.toUserFriendlyHtml(_fb7.properties.iversionable_startpublish)]);}if(_fb6===this._virtualStatusEnum.InUse){var _fb8=this.inUseNotificationManager.getOtherUsersInUseNotifications(_fb7.inUseNotifications);_fb8=_fb8.map(function(item){return _fa6.encode(item);}).join(",");return _fa5.substitute(this._virtualStatusLocalization[_fb6],[_fb8]);}if(_fb7.status===_fa7.versionStatus.AwaitingApproval){if(this._canApproveCurrentStep()){return this.res.awaitingyourapproval.label;}return this.res.currentlyinreview.label;}return this._virtualStatusLocalization[_fb6];},_getStatusIcon:function(_fb9){if(this._isRejected()){return "";}return this._statusIcon[_fb9.status]||"";},_getButtonText:function(_fba,_fbb){if((_fba===this._virtualStatusEnum.NotPublishedYet||_fba===this._virtualStatusEnum.ChangesToPublish||_fba===this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_fa7.action.Publish)){return this.res.buttonlabel.publish;}else{if(this._shouldShowApprovalButton(_fba)){return this.res.awaitingyourapproval.button;}else{return this.res.buttonlabel.option;}}},_shouldShowApprovalButton:function(_fbc){return _fbc===this._virtualStatusEnum.AwaitingApproval&&this._isContentInCurrentLanguage()&&this._canApproveCurrentStep();},_isContentInCurrentLanguage:function(){var _fbd=this.dataModel.contentData;if(_fbd&&_fbd.capabilities&&!_fbd.capabilities.language){return true;}if(!this.dataModel.languageContext){return false;}var _fbe=this.dataModel.currentContentLanguage;var _fbf=this.dataModel.languageContext.language;return _fbe===_fbf;},_getVirtualStatus:function(_fc0){if(_fc0.isDeleted){return this._virtualStatusEnum.Deleted;}var _fc1,_fc2,_fc3;_fc1=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_fc2=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_fc1;_fc3=this.inUseNotificationManager.hasInUseNotificationWarning(_fc0.inUseNotifications);if(_fc3&&_fc2){return this._virtualStatusEnum.InUse;}if(_fc0.isCommonDraft){if(_fc0.status===_fa7.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_fc0.status===_fa7.versionStatus.CheckedOut){return _fc0.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}if(this._isRejected()){return this._virtualStatusEnum.NotPublishedYet;}return this._statusMap[_fc0.status];},_isRejected:function(){return !this._canTransitionTo("readyforreview")&&this._canTransitionTo("readytopublish");},_canApproveCurrentStep:function(){return this._canTransitionTo("approvechanges");},_canTransitionTo:function(_fc4){return this.dataModel.contentData.transitions.some(function(item){return item.name===_fc4;});}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/Stateful","epi/shell/DestroyableByKey"],function(_fc5,_fc6,_fc7){return _fc5([_fc6,_fc7],{dataModel:null,_dataModelHandlesKey:"dataModelHandles",_dataModelSetter:function(_fc8){this.destroyByKey(this._dataModelHandlesKey);this.dataModel=_fc8;this.onDataModelChange();this.ownByKey(this._dataModelHandlesKey,this.dataModel.watch("status",this.onDataModelChange.bind(this)),this.dataModel.watch("contentData",this.onDataModelChange.bind(this)));},onDataModelChange:function(name,_fc9,_fca){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dijit/Destroyable","dojox/html/entities","epi","epi/datetime","epi/dependency","epi/Url","epi/string","epi/username","epi-cms/content-approval/ApprovalEnums","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_fcb,lang,when,_fcc,_fcd,_fce,epi,_fcf,_fd0,Url,_fd1,_fd2,_fd3,_fd4,_fd5,_fd6,_fd7,_fd8,res){return _fcb([_fd6,_fd7,_fd8,_fcd],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,bottomInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.projectService=this.projectService||_fd0.resolve("epi.cms.ProjectService");this.approvalService=this.approvalService||_fd0.resolve("epi.cms.ApprovalService");this.contentActionSupport=this.contentActionSupport||_fd4;this.initializeCommandProviders();},onDataModelChange:function(name,_fd9,_fda){var _fdb=this.dataModel.contentData,_fdc=this._contentHasPublishedVersion(_fdb);this._updateCommands();this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_fdb));this.set("bottomInfoSectionVisible",this._getBottomInfoSectionVisible());this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_fdb));this.set("lastPublishedTitle",this._getLastPublishedTitle(_fdb));this.set("lastPublishedTitleVisible",_fdc);this.set("lastPublishedText",this._getLastPublishedText(_fdb));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_fdb,_fdc));this.set("lastPublishedViewLinkHref",this._getLastPublishedHref(_fdb));this.set("typeIdentifier",_fdb.typeIdentifier);this._setAdditionalInfo(_fdb);if(this._shouldShowApprovalInfo()){this._setApprovalInfo(_fdb);}else{this._setLastChangeStatus(_fdb);}},onCommandsChanged:function(name,_fdd,_fde){if(_fdd){_fdd.forEach(function(_fdf){this.destroyByKey(_fdf);},this);}_fde.forEach(function(_fe0){if(_fe0.options&&_fe0.options.isMain){this.ownByKey(_fe0,_fe0.watch("canExecute",function(){this._calculateMainButtonCommand();}.bind(this)));}},this);},_dataModelSetter:function(_fe1){this.updateCommandModel(_fe1);this.inherited(arguments);},_shouldShowApprovalInfo:function(){var _fe2=this.dataModel.contentData.status===_fd4.versionStatus.AwaitingApproval;var _fe3=this.dataModel.languageContext&&this.dataModel.languageContext.isTranslationNeeded;return _fe2&&!_fe3;},_isOpenSetter:function(_fe4){this.isOpen=_fe4;if(_fe4){var _fe5=this.dataModel.contentData;if(this._shouldShowApprovalInfo()){this._setApprovalInfo(_fe5);}else{this._setLastChangeStatus(_fe5);}}},_setApprovalInfo:function(_fe6){return this.approvalService.getApproval(_fe6.contentLink).then(lang.hitch(this,function(_fe7){if(!_fe7||_fe7.status!==_fd3.status.inReview){if(this.dataModel.contentData.status===_fd4.versionStatus.AwaitingApproval){this._setAbortInfo(_fe6);}return null;}var _fe8=lang.replace(this.res.approvalinfo.timepassed,{timepassed:_fcf.timePassed(new Date(_fe7.startDate))});var _fe9=" <br /> "+lang.replace(this.res.approvalinfo.stepinfo,{activeStepIndex:_fe7.activeStepIndex+1,totalsteps:_fe7.totalSteps});var _fea=_fe8+(_fe7.status===_fd3.status.inReview?_fe9:"");this.set("topInfoSectionVisible",true);this.set("lastChangeStatus",_fea);var _feb=lang.replace(this.res.approvalinfo.requestedby,{username:this._getFriendlyUsername(_fe7.startedBy,true),time:_fcf.toUserFriendlyHtml(_fe7.startDate)});this.set("publishInfoSectionVisible",true);this.set("lastPublishedText",_feb);this.set("lastPublishedTitleVisible",false);this.set("lastPublishedViewLinkVisible",false);return _fe7;})).otherwise(function(){return null;});},_setAbortInfo:function(_fec){this.set("topInfoSectionVisible",true);this._setLastChangeStatus(_fec);this.set("publishInfoSectionVisible",true);this.set("lastPublishedText",this.res.approvalinfo.approvalmissing);this.set("lastPublishedTitleVisible",false);this.set("lastPublishedViewLinkVisible",false);},_updateCommands:function(){this._calculateMainButtonCommand();this.set("commands",this.getCommands());},_calculateMainButtonCommand:function(){var _fed=this.getCommands(),_fee=null;_fed.forEach(function(_fef){if(_fef.canExecute&&_fef.options&&_fef.options.isMain&&_fef.options.priority&&(!_fee||_fee.options.priority<_fef.options.priority)){_fee=_fef;}});this.set("mainButtonCommand",_fee);this.set("mainButtonSectionVisible",_fee!==null);},_getBottomInfoSectionVisible:function(){return this.getCommands().some(function(_ff0){return _ff0.isAvailable&&_ff0!==this.mainButtonCommand;}.bind(this));},_getTopInfoSectionVisible:function(_ff1){return this.mainButtonCommand||!((_ff1.status===_fd4.versionStatus.Published||_ff1.status===_fd4.versionStatus.Expired)&&!_ff1.isCommonDraft);},_getPublishInfoSectionVisible:function(_ff2){var _ff3=this.inUseNotificationManager.hasInUseNotificationWarning(_ff2.inUseNotifications),_ff4=this._isOriginallyEditable();return !(_ff3&&_ff4);},_getLastPublishedViewLinkVisible:function(_ff5,_ff6){return _ff6&&!!_ff5.publicUrl;},_setLastChangeStatus:function(_ff7){var _ff8,_ff9,self=this;var _ffa=this.dataModel.get("lastSaved");_ff9=_ff8=this._getTemplatedText(this.res.lastchangestatus,_ff7.changedBy,_ffa);if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _ffb=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;_ff9=_ffb;}if(_ff7.missingLanguageBranch&&_ff7.missingLanguageBranch.isTranslationNeeded){_ff9=lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_ff7.missingLanguageBranch.languageId],languageId:_ff7.missingLanguageBranch.languageId});}if(_ff7.status===_fd4.versionStatus.Published||_ff7.status===_fd4.versionStatus.Expired){_ff9=this.res.notmodifiedsincelastpublish;}if(_ff7.status===_fd4.versionStatus.PreviouslyPublished){_ff9=this._getTemplatedText(this.res.previouslypublished,_ff7.versionCreatedBy,_ff7.versionCreatedTime);}if(_ff7.status===_fd4.versionStatus.Rejected){_ff9=this._getTemplatedText(this.res.rejectedapproval,_ff7.versionCreatedBy,_ff7.versionCreatedTime);}if(_ff7.status===_fd4.versionStatus.DelayedPublish){_ff9=this.projectService.getProjectsForContent(_ff7.contentLink).then(function(_ffc){_ffc=_ffc.filter(function(_ffd){return _ffd.status==="delayedpublished";});if(_ffc.length){return lang.replace(self.res.projectdelayedpublish,{date:_fcf.toUserFriendlyHtml(_ff7.properties.iversionable_startpublish),project:_fce.encode(_ffc[0].name)});}return _ff8;});}when(_ff9,lang.hitch(this,"set","lastChangeStatus"));},_getLastPublishedTitle:function(_ffe){return _ffe.status===_fd4.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_fff){return (this._contentHasPublishedVersion(_fff))?this._getTemplatedText(this.res.publishedtime,_fff.publishedBy,_fff.lastPublished,true):this.res.notpublishedbefore;},_getLastPublishedHref:function(_1000){if(!_1000.publicUrl){return null;}var url=new Url(_1000.publicUrl);if(_1000.properties.pageShortcutType===_fd5.pageShortcutTypes.Shortcut){url.query.id=new Date().valueOf();}return url.toString();},_setAdditionalInfo:function(_1001){var _1002=this.inUseNotificationManager.hasInUseNotificationWarning(_1001.inUseNotifications),_1003=this._isOriginallyEditable(),_1004=_1002&&_1003;this.set("additionalInfoSectionVisible",_1004);if(_1004){var _1005=this.inUseNotificationManager.getOtherUsersInUseNotifications(_1001.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_1005.join(",")));}},_isOriginallyEditable:function(){var _1006=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _1007=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_1006;return _1007;},_getFriendlyUsername:function(name,_1008){return _fd2.toUserFriendlyHtml(name,null,_1008);},_getTemplatedText:function(_1009,_100a,_100b,_100c){var date=new Date(_100b);return lang.replace(_1009,{username:this._getFriendlyUsername(_100a,_100c),time:_fcf.toUserFriendlyHtml(date),timepassed:_fcf.timePassed(date)});},_canTransitionTo:function(_100d,_100e){return _100d.transitions.some(function(item){return item.name===_100e;});},_contentHasPublishedVersion:function(_100f){if(!_100f){return false;}var _1010=_100f.lastPublished&&_100f.lastPublished!=="0001-01-01T00:00:00Z";if(_1010){return true;}return _100f.status===_fd4.versionStatus.Published||_100f.status===_fd4.versionStatus.PreviouslyPublished;}});});},"epi-cms/content-approval/ApprovalEnums":function(){define({definitionStatus:{enabled:0,disabled:1,inherited:2},reviewerType:{user:0,role:1},status:{inReview:0,approved:1,rejected:2}});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){return {pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(array,_1011,lang,_1012,_1013){return _1011([_1012],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_1013.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);array.forEach(this.commandProviders.providers,function(_1014){this._consumer.addProvider(_1014);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(model){this._currentCommandModel=model;array.forEach(this.commandProviders.providers,function(_1015){if(_1015.updateCommandModel){_1015.updateCommandModel(model);}},this);},onProvidersChanged:function(name,_1016,added){if(_1016){array.forEach(_1016,this._consumer.removeProvider,this._consumer);}if(added){array.forEach(added,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){array.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/plugin-area/edit-view-filters","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ChangeView"],function(_1017,lang,all,when,_1018,_1019,_101a,_101b,_101c,_101d,_101e){return _1017([_101b],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,constructor:function(){this.viewConfigurations={};},buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(_101f,_1020){var _1021=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1022=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ChangeView"},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];_1021=_101f?_101f.concat(_1021):_1021;_1022=_1020?_1020.concat(_1022):_1022;return this.add(_1021).then(lang.hitch(this,function(){return this.add(_1022);}));},updateChildren:function(){var _1023=this.currentContext,_1024=_1023&&_1023.id;this.setItemProperty("breadcrumbs","contentLink",_1024);this.setItemProperty("viewselect","currentContext",this.currentContext);this.setItemProperty("viewselect","viewName",this.viewConfigurations.viewName);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_1023){this.setItemProperty("currentcontent","currentItemInfo",{name:_1023.name,dataType:_1023.dataType});}},update:function(data){if(!data){return;}var _1025=data.viewConfigurations;_101c.get().forEach(function(_1026){_1025=_1026(_1025,data.contentData,data.currentContext);},this);this.currentContext=data.currentContext;this.viewConfigurations=_1025;when(this.isSetup(),lang.hitch(this,this.updateChildren));}});});},"epi-cms/plugin-area/edit-view-filters":function(){define(["epi/PluginArea"],function(_1027){var _1028=new _1027("epi-cms/edit-view/filters[]");return _1028;});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_1029,_102a,_102b,topic,_102c,_102d,_102e,_102f,_1030,_1031){return _1029([_102e,_102d],{templateString:_1031,_currentIconClass:null,_setCurrentItemInfoAttr:function(value){if(!value){return;}this.heading.innerHTML=_102f.encodeForWebString(value.name);if(value.dataType){var _1032=_1030.getValue(value.dataType,"iconClass");if(_1032&&_1032!==this._currentIconClass){_102a.remove(this.iconNode,this._currentIconClass);_102a.add(this.iconNode,_1032);this._currentIconClass=_1032;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\r\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\r\n</div>","epi-cms/widget/ChangeView":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/ViewSwitchButton","epi-cms/widget/ViewSelectorDropDownButton","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_1033,array,_1034,_1035,_1036,_1037,_1038,_1039,_103a,res){return _1033([_1036,_1037,_1038],{templateString:"<div class=\"dijitInline epi-trailingContainer\"></div>",buildRendering:function(){this.inherited(arguments);this._createViewSelector();this._createSwitchButton();},_createViewSelector:function(){this._viewSelectorDropDownButton=new _103a({showLabel:false,"class":"epi-mediumButton"});this._viewSelectorDropDownButton.placeAt(this.domNode);},_createSwitchButton:function(){this._viewSwitchButton=new _1039({firstButtonSettings:{title:res.onpageedit.title,label:res.onpageedit.label,iconClass:"epi-iconLayout",showLabel:false},secondButtonSettings:{title:res.formedit.title,label:res.formedit.label,iconClass:"epi-iconForms",showLabel:false}});this._viewSwitchButton.placeAt(this.domNode);},_setStateAttr:function(value){this.inherited(arguments);this._viewSwitchButton.set("state",value);},_setViewNameAttr:function(_103b){var _103c=_103b==="onpageedit"||_103b==="sidebysidecompare"||_103b==="view"||_103b==="allpropertiescompare";this._viewSwitchButton.set("isFirstButtonActive",_103c);},_setCurrentContextAttr:function(_103d){this._currentContext=_103d;},_setViewConfigurationsAttr:function(_103e){this._viewSelectorDropDownButton.set("viewConfigurations",_103e);var _103f=this._hasCustomViews(_103e.availableViews);var _1040=this._hasBuiltInViews(_103e.availableViews);this._setVisibility(this._viewSwitchButton,!_103f&&_1040&&this._currentContext.hasTemplate);this._setVisibility(this._viewSelectorDropDownButton,_103f);},_hasCustomViews:function(_1041){return array.filter(_1041,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_1042){return array.filter(_1042,function(view){return view.key==="onpageedit"||view.key==="formedit";}).length===2;},_setVisibility:function(_1043,_1044){_1035.set(_1043.domNode,{display:(_1044?"":"none")});_1043.set("itemVisibility",_1044);}});});},"epi-cms/widget/ViewSwitchButton":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/topic","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_CssStateMixin","dijit/form/Button"],function(_1045,_1046,topic,_1047,_1048,_1049,_104a,_104b){return _1045([_1047,_1048,_1049,_104a],{baseClass:"epi-viewSwitchButton",templateString:"<span data-dojo-attach-point=\"stateNode\" class=\"epi-groupedButtonContainer\"></span>",_state:"",buildRendering:function(){this.inherited(arguments);this._firstButton=this._createButton();this._secondButton=this._createButton();this.set("isFirstButtonActive",true);},_createButton:function(value){var _104c=new _104b({showLabel:false,onClick:function(){if(_1046.contains(this.domNode,"loading")){return;}_1046.toggle(this.domNode,"loading",true);setTimeout(function(){topic.publish("/epi/cms/action/switcheditmode",null,null,true);},0);}});_104c.placeAt(this.domNode);return _104c;},_setFirstButtonSettingsAttr:function(value){this._firstButton.set(value);},_setSecondButtonSettingsAttr:function(value){this._secondButton.set(value);},_setIsFirstButtonActiveAttr:function(value){this._firstButton.set("disabled",value);this._secondButton.set("disabled",!value);_1046.toggle(this._firstButton.domNode,"epi-button--pressed",value);_1046.toggle(this._secondButton.domNode,"epi-button--pressed",!value);_1046.toggle(this._firstButton.iconNode,"epi-icon--active",value);_1046.toggle(this._secondButton.iconNode,"epi-icon--active",!value);},_setStateAttr:function(value){this.inherited(arguments);if(value===""){_1046.toggle(this._firstButton.domNode,"loading",false);_1046.toggle(this._secondButton.domNode,"loading",false);}},_getStateAttr:function(){return this._state;}});});},"epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(array,_104d,lang,_104e,_104f,_1050){return _104d([_104e],{buildRendering:function(){this.inherited(arguments);this.set("title",_1050.title);this.own(this.dropDown=new _104f());},_setViewConfigurationsAttr:function(value){if(!value){return;}array.some(value.availableViews,lang.hitch(this,function(view){if(view.key===value.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",value);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(array,_1051,lang,topic,when,_1052,_1053,_1054,_1055){return _1051([_1054],{viewConfigurations:null,headingText:_1053.title,_setViewConfigurationsAttr:function(value){this._set("viewConfigurations",value);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}this.getChildren().forEach(function(item){this.removeChild(item);item.destroyRecursive();},this);var _1056=this.viewConfigurations.viewName,_1057=this.viewConfigurations.availableViews;var _1058="";array.forEach(_1057,function(view){if(view.hideFromViewMenu){return;}var _1059=view.category||"";if(_1059!==_1058){this.addChild(new _1052({baseClass:"epi-menuSeparator"}));}_1058=_1059;var item=new _1055({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_1056});item.own(item.on("click",function(){this.onExecute();item.set("checked",!item.checked);if(_1056==="view"){topic.publish("/epi/cms/action/disablepreview");}topic.publish("/epi/shell/action/changeview",view.key,null,null,true);}.bind(this)));this.addChild(item);},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_105a,keys,_105b,_105c){return _105a([_105b],{templateString:_105c,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-menu--inverted\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span>${headingText}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\r\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_105d,_105e,_105f){return _105d(_105e,{templateString:_105f});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(array,_1060,event,lang,_1061,keys,_1062,_1063,_1064,_1065,_1066,_1067,_1068,_1069,_106a,_106b){return _1060([_1062,_1063,_1064],{res:_106b,templateString:_106a,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_1067.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _1069({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this.own(this._tooltipDialog);this._buildIconBlock();_1061.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));},update:function(_106c){this._hideTooltip();this.messageContext=_106c;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_106d){var query=(_106d)?lang.mixin({typeName:_106d},this.messageContext):this.messageContext;return this.messageService.query(query);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_106e,items){if(items&&items.length>0){array.forEach(items,function(item){zone.addRow(lang.replace(_106e,{message:_1066.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _106f=this.getMessages("error");var _1070=this.getMessages("warn");var _1071=this.getMessages("info");this._totalNotifications=_106f.length+_1070.length+_1071.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_106f);this._updateNotificationZone(this.warningZone,this._itemTemplate,_1070);this._updateNotificationZone(this.infoZone,this._itemTemplate,_1071);this._updateIconStatus(_106f.length,_1070.length,_1071.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_1061.add(this.domNode,this._dimmedOutCssClass);_1061.remove(this.domNode,this._notificationNoteClass);_1061.remove(this.domNode,this._notificationWarningClass);_1061.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_1061.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_1072,_1073,_1074){if(_1072){_1061.add(this.domNode,this._notificationErrorClass);_1061.remove(this.domNode,this._notificationNoteClass);_1061.remove(this.domNode,this._notificationWarningClass);}else{if(_1073){_1061.add(this.domNode,this._notificationWarningClass);_1061.remove(this.domNode,this._notificationNoteClass);}else{if(_1074){_1061.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(value){this._set("notificationContext",value);this.update(value);},_show:function(e){if(e){event.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_1075,_1076,_1077){return _1075([_1076,_1077],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_1078,_1079){dojo.place(_1078,this.contentContainer,_1079);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_107a,dijit,_107b,_107c,_107d,_107e){return dojo.declare([_107b],{templateString:_107e,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_107a.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_107f,_1080){dijit.popup.open({popup:this,around:_107f,orient:_1080});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){dijit.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_107a.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner==="MR"||this._pos.aroundCorner==="ML"){var _1081=_107a.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_1081));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_1082){if(!_1082){return 0;}if(_1082==="right"||_1082==="left"){var _1083=dojo.style(this.connectorNode,_1082);if(!_1083){return 0;}var _1084=/(px|em|%)/ig;return _107a.parse(_1083)||_107a.parse(_1083.replace(_1084,""));}return 0;},_getNumberInPx:function(_1085){return _1085+"px";},_getCenterHorizontalAroundNode:function(){return _107a.round((_107a.parse(this.connectorNode.clientWidth)-_107a.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\r\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\r\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\r\n    </div>\r\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\r\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\r\n    <div class=\"epi-dijitTooltipTitleBar\">\r\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\r\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\r\n    </div>\r\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\r\n        <div data-dojo-attach-point=\"zoneContainer\">\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_1086,lang,_1087,_1088,_1089,_108a,_108b,_108c,_108d,_108e,epi,_108f,_1090,_1091,_1092,res,_1093){return _1086([_108c,_108b,_108d,_108a,_1091],{templateString:_1093,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{state:["state"],statusText:["statusText"],visible:["visible"],buttonText:["buttonText"],nonEditableIndicator:["nonEditableIndicator"],statusIcon:["statusIcon"],publishMenuViewModel:["publishMenuViewModel"],additionalClass:["additionalClass"],expanded:["expanded"]},_setStatusTextAttr:function(_1094){this._set("statusText",_1094);this._setStatusNodeText(_1094);},_setStatusNodeText:function(_1095){this.statusTextNode.innerHTML=_1095;_1087.set(this.stateNode,"visibility",_1095?"visible":"hidden");_1089.set(this.stateNode,"title",_1092.stripHtmlTags(_1095));},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_1087.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_1096){this._set("expanded",_1096);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_1088.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_1088.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){if(this.get("statusIcon")){_1088.remove(this.statusTextIcon,this.get("statusIcon"));}this._set("statusIcon",val);_1088.add(this.statusTextIcon,val);},_setAdditionalClassAttr:function(val){var _1097=this.get("additionalClass");if(_1097){_1088.remove(this.stateNode,_1097);}this._set("additionalClass",val);_1088.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},toggleDropDownMenu:function(val){_1087.set(this.dropDownMenu.domNode,"display",val?"":"none");this.dropDownButton.set("disabled",!val);},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(array,_1098,event,lang,_1099,_109a,_109b,_109c,html,on,sniff,_109d,when,_109e,_109f,_10a0,epi,_10a1,_10a2,_10a3,_10a4,_10a5,_10a6,res){return _1098([_109e,_10a0,_10a2],{templateString:_10a6,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _10a3();},modelBindingMap:{commands:["commands"],mainButtonCommand:["mainButtonCommand"],mainButtonSectionVisible:["mainButtonSectionVisible"],lastChangeStatus:["lastChangeStatus"],topInfoSectionVisible:["topInfoSectionVisible"],publishInfoSectionVisible:["publishInfoSectionVisible"],lastPublishedTitle:["lastPublishedTitle"],lastPublishedTitleVisible:["lastPublishedTitleVisible"],lastPublishedText:["lastPublishedText"],lastPublishedViewLinkVisible:["lastPublishedViewLinkVisible"],lastPublishedViewLinkHref:["lastPublishedViewLinkHref"],additionalInfoSectionVisible:["additionalInfoSectionVisible"],additionalInfoText:["additionalInfoText"],typeIdentifier:["typeIdentifier"],bottomInfoSectionVisible:["bottomInfoSectionVisible"]},_setCommandsAttr:function(_10a7){this.focusedChild=null;this.destroyDescendants();this._addCommandsToMenu(_10a7);this.focusFirstChild();},_setMainButtonCommandAttr:function(_10a8){this._set("mainButtonCommand",_10a8);if(_10a8){this.mainButton.set("label",_10a8.label);this.mainButton.set("disabled",!_10a8.get("canExecute"));_109b.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_109b.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_10a8.options&&_10a8.options.mainButtonClass){this._addedMainButtonClass=_10a8.options.mainButtonClass;_109b.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_10a9){_1099.set(this.mainButtonSection,"display",_10a9?"":"none");_1099.set(this.mainButton.domNode,"display",_10a9?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_10aa){_1099.set(this.topInfoSection,"display",_10aa?"":"none");},_setBottomInfoSectionVisibleAttr:function(_10ab){_1099.set(this.bottomInfoSection,"display",_10ab?"":"none");},_setPublishInfoSectionVisibleAttr:function(_10ac){_1099.set(this.publishInfoSection,"display",_10ac?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_10ad){_1099.set(this.lastPublishedTitleNode,"display",_10ad?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_10ae){_1099.set(this.lastPublishedViewLinkNode,"display",_10ae?"":"none");},_setLastPublishedViewLinkHrefAttr:function(value){_109a.set(this.lastPublishedViewLinkNode,"href",value);},_setAdditionalInfoSectionVisibleAttr:function(_10af){_1099.set(this.additionalInfoSection,"display",_10af?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_10b0){var _10b1=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_10b2=_10b1&&_10b1.downloadUrl,_10b3=_10b0&&_10a1.getValue(_10b0,"actAsAnAsset");if(!_10b3||!_10b2){_109a.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_109a.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){event.stop(e);var _10b4=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_10b4&&_10b4.downloadUrl,name=_10b4.name;_10a4.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_10b5,added){if(_10b5){this._removeCommandsFromMenu(lang.isArray(_10b5)?_10b5:[_10b5]);}if(added){this._addCommandsToMenu(lang.isArray(added)?added:[added]);}},_addCommandsToMenu:function(_10b6){array.forEach(_10b6,function(_10b7){if(_10b7!==this.model.mainButtonCommand){this._menuBuilder.create(_10b7,this);}},this);},_removeCommandsFromMenu:function(_10b8){var _10b9=this.getChildren();array.forEach(_10b8,function(_10ba){for(var i=_10b9.length-1;i>=0;i--){var item=_10b9[i];if(item._command===_10ba){this.removeChild(item);item.destroyRecursive();break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_109b.add(this.mainButton.domNode,"epi-loading");var _10bb=this.mainButtonCommand,_10bc=lang.hitch(this,function(){if(_10bb.options&&_10bb.options.resetLabelAfterExecution){this.mainButton.set("label",_10bb.label);}_109b.remove(this.mainButton.domNode,"epi-loading");if(_10bb.options&&!_10bb.options.keepMenuOpen){this.onExecute();}}),_10bd=lang.hitch(this,function(){this.model.set("lastExecutedCommand",_10bb);});when(this.mainButtonCommand.execute(),function(){return when(_10bc(),_10bd);},function(){return _10bc();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _10be=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_10be){this.focusedChild._setSelected(false);return _1099.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _10bf=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _1099.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_10bf){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_10c0){var _10c1=_109c.getMarginBox(this.domNode),_10c2=_109c.getPadExtents(this.topInfoSection),_10c3=_109c.getMarginBox(this.mainButton.containerNode),_10c4=_109c.getMarginBox(this.containerNode);var _10c5=Math.max(_10c3.w+_10c2.l+_10c2.r,_10c1.w);_10c5=Math.max(_10c4.w,_10c5);_10c0.w=_10c5;_109c.setMarginBox(this.domNode,_10c0);}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_10c6){return {_classicalDownload:function(url,name){var _10c7=document.getElementsByTagName("body")[0],_10c8={href:url,download:name,target:"_blank",style:{display:"none;"}},_10c9=_10c6.create("a",_10c8,_10c7,"last");_10c9.click();_10c6.destroy(_10c9);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\"\r\n                        data-dojo-attach-point=\"mainButton\"\r\n                        data-dojo-attach-event=\"onClick: _onMainButtonClick\"\r\n                        class=\"epi-button--full-width\"></button>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" data-dojo-attach-point=\"bottomInfoSection\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\r\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\r\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\r\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\r\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\r\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\r\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line. -->\r\n    </div>\r\n\r\n\r\n\r\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\r\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-button--bold'\">\r\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_10ca,lang,_10cb,_10cc,_10cd,array,on,_10ce,_10cf,_10d0,_10d1,_10d2,_10d3,_10d4,_10d5,_10d6){var _10d7=_10ca([_10cf,_10ce,_10d1,_10d2],{templateString:_10d6,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_10cd.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){array.forEach(this.item.commands,lang.hitch(this,function(_10d8){this._addButtonForCommand(_10d8);}));}},_addButtonForCommand:function(_10d9){var _10da=new _10d3({label:_10d9.label,title:_10d9.tooltip,iconClass:_10d9.iconClass});if(_10d9.cssClass){_10cb.add(_10da.domNode,_10d9.cssClass);}_10da.set("disabled",!_10d9.canExecute);_10da.on("click",function(){_10d9.execute();});this.own(_10d9.watch("canExecute",lang.hitch(this,function(){_10da.set("disabled",!_10d9.canExecute);})));if(_10d9.category==="leftAligned"){_10da.placeAt(this.contentContainer,"first");}else{_10da.placeAt(this.buttonContainer,"first");}this.own(_10da);}});var _10db=_10ca([_10cf,_10d0,_10ce,_10d1,_10d2],{templateString:_10d5,noBorderClass:"epi-notificationBarWithoutBorder",buildRendering:function(){this.inherited(arguments);this._hideIfEmpty();},clear:function(){this._hideIfEmpty();array.forEach(this.getChildren(),function(_10dc){this.removeChild(_10dc);_10dc.destroy();_10dc=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_10dd,_10de){var _10df=new _10d7({item:_10dd});this.own(on(_10df,"close",lang.hitch(this,"_onCloseNotification")));this.addChild(_10df,_10de);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_10e0){array.forEach(this.getChildren(),lang.hitch(this,function(_10e1){if(_10e1.item&&_10e1.item===_10e0){this._onCloseNotification(_10e1);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_10cb.toggle(this.domNode,this.noBorderClass,!show);_10cc.set(this.domNode,"display",show?"":"none");}});return _10db;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\r\n    <div data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\r\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\r\n        <p data-dojo-attach-point=\"textContainer\"></p>\r\n    </div>\r\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\r\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\r\n    </div>\r\n</div>","epi-cms/activity/ActivityFeed":function(){define(["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","epi/debounce","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","epi-cms/activity/Activity","epi-cms/activity/ActivityCommentForm"],function(_10e2,_10e3,_10e4,_10e5,_10e6,_10e7,_10e8,_10e9,_10ea,_10eb,_10ec,_10ed,_10ee,_10ef,_10f0,_10f1,_10f2,_10f3){var _10f4=_10e2([_10ef,_10f0,_10f1]);return _10e2([_10eb,_10ec,_10ed,_10ee],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _10f3({model:this.model});_10e4.add(this.commentForm.domNode,"epi-card");this.list=new _10f4({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_10e3.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_10e7.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_renderRow:function(value){var _10f5=new _10f2({activity:value});_10e4.add(_10f5.domNode,"epi-card");return _10f5.domNode;},_resizeList:function(_10f6){return function(){_10f6.apply(this.list,arguments);var _10f7=this.model.isSingleItemSelected?_10e5.getMarginBox(this.commentForm.domNode).h:0;_10e6.set(this.list.contentNode,"height","calc(100% - "+_10f7+"px)");}.bind(this);},_setNoDataMessageAttr:function(_10f8){this.noDataMessage=_10f8;this.list.set("noDataMessage",_10f8);},_setQueryAttr:function(query){this._set("query",query);if(!this._queryFunction){this._queryFunction=_10e9(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,query);},_setQueryCallback:function(store,query){if(this._destroyed){return;}var _10f9=this.model.isSingleItemSelected;_10e4.toggle(this.domNode,"epi-activity-feed--single-item",_10f9);_10e4.toggle(this.commentForm.domNode,"dijitHidden",!_10f9);if(query){this.list.set("store",store,query,this.queryOptions);}else{this.list.set("store",null);}this.list.resize();}});});},"epi/shell/dgrid/WidgetRow":function(){define("epi/shell/dgrid/WidgetRow",["dojo/_base/declare","dijit/registry"],function(_10fa,_10fb){return _10fa(null,{insertRow:function(){var row=this.inherited(arguments),_10fc=_10fb.byNode(row);_10fc.startup();return row;},removeRow:function(_10fd,_10fe){this.inherited(arguments);var _10ff=_10fd.element||_10fd,_1100=_10fb.byNode(_10ff);if(_1100){_1100.destroyRecursive(_10fe);}}});});},"epi-cms/activity/Activity":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","./ActivityComment","./viewmodels/ActivityViewModel","./viewmodels/ActivityCommentViewModel","./viewmodels/MessageActivityViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/Activity.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/activity/ActivityCommentForm"],function(_1101,lang,_1102,_1103,_1104,_1105,_1106,_1107,_1108,_1109,_110a,_110b,_110c){return _1101([_1107,_1108,_1109,_110a],{templateString:_110b,model:null,modelBindingMap:{upsertActivityComment:["upsertActivityComment"]},buildRendering:function(){this.inherited(arguments);var _110d=this.activity;var model=new _1104({activity:_110d});this.set("model",model);this.own(this.model);this.commentForm.set("model",model);this.titleNode.textContent=model.get("title");_1102.add(this.iconNode,model.get("iconClass"));_1102.add(this.actionIconNode,model.get("actionIconClass"));_1102.add(this.actionNode,model.get("actionClass"));this.actionTextNode.textContent=model.get("content");if(_110d.message){_1102.add(this.domNode,"epi-activity__message");this.own(this._messageForm=new _1103({model:new _1106(_110d)},this.messageNode));}var _110e=model.getComment();if(_110e){this.activityCommentNode.innerHTML=_110e;}else{_1102.add(this.activityCommentNode,"dijitHidden");}if(_110d.comments){_110d.comments.forEach(function(_110f){this.set("upsertActivityComment",_110f);},this);}},startup:function(){this.inherited(arguments);this._messageForm&&this._messageForm.startup();},_getActivityCommentComponent:function(_1110){var index=-1;var _1111=null;var _1112=this.getChildren()||[];for(var i=0;i<_1112.length;i++){index=i;var _1113=_1112[i];if(_1113.get("model").id===_1110){_1111=_1113;break;}}return {position:(_1111!==null?index:-1),activityComment:_1111};},_setUpsertActivityCommentAttr:function(_1114){if(!_1114){return;}var _1115=this._getActivityCommentComponent(_1114.id);var _1116=_1115.activityComment;var _1117=(_1115.position===-1?this.getChildren().length:_1115.position);if(_1116){var _1118=new Date(_1116.get("model").lastUpdated).getTime();var _1119=new Date(_1114.lastUpdated).getTime();if(_1118===_1119){return;}this.removeChild(_1116);_1116.destroyRecursive();}var _111a=new _1103({model:new _1105(_1114)});this.addChild(_111a,_1117);}});});},"epi-cms/activity/ActivityComment":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityComment.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message","./ActivityCommentForm","dijit/form/Button"],function(_111b,lang,_111c,_111d,_111e,_111f,_1120,_1121,_1122,_1123,_1124){return _111b([_111f,_1120,_1121,_1122],{templateString:_1123,modelBindingMap:{hasChanged:["hasChanged"]},_setHasChangedAttr:function(_1125){this._set("hasChanged",_1125);var _1126=lang.replace(_1124.editedformat,{updated:_111d.toUserFriendlyString(this.model.lastUpdated)});this.editedIconNode.title=_1126;_111c.toggle(this.editedIconNode,"dijitHidden",!_1125);},buildRendering:function(){this.inherited(arguments);var user=this.model.changedBy||this.model.author;this.usernameNode.textContent=_111e.toUserFriendlyString(user,null,false,false,true);this.timestampNode.textContent=_111d.toUserFriendlyString(this.model.created);}});});},"url:epi-cms/activity/templates/ActivityComment.html":"<div class=\"epi-activity-comment\">\r\n    <header>\r\n        <span class=\"dijitReset dijitInline epi-username\" data-dojo-attach-point=\"usernameNode\"></span>\r\n        <span class=\"dijitReset dijitInline epi-event__timestamp\" data-dojo-attach-point=\"timestampNode\"></span>\r\n        <span class=\"dijitReset dijitInline epi-iconEdited\" data-dojo-attach-point=\"editedIconNode\"></span>\r\n    </header>\r\n    <div data-dojo-type=\"epi-cms/activity/ActivityCommentForm\"\r\n         data-dojo-props=\"model: this.model\"\r\n         data-dojo-attach-point=\"commentForm\"></div>\r\n</div>\r\n","epi-cms/activity/ActivityCommentForm":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_FocusMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityCommentForm.html","epi/shell/widget/AutoCompleteTextarea","dijit/form/Button"],function(_1127,_1128,_1129,_112a,_112b,_112c,_112d,_112e){return _1127([_1129,_112a,_112b,_112c,_112d],{templateString:_112e,readOnly:null,hideOnPost:null,isEditEnabled:true,errorMessage:"",modelBindingMap:{readOnly:["readOnly"],editLabel:["editLabel"],isEditEnabled:["isEditEnabled"],hideOnPost:["hideOnPost"],errorMessage:["errorMessage"],placeholderText:["placeholder"],sendLabel:["sendLabel"],resetLabel:["resetLabel"],message:["value"],formattedMessage:["displayValue"],noNotificationUserMessage:["noNotificationUserMessage"],notificationUserStore:["notificationUserStore"]},postCreate:function(){this.inherited(arguments);this._commentChanged(this.get("value"));this._commentTextarea.on("save",this._postComment.bind(this));},_setModelAttr:function(model){this.inherited(arguments);this._toggleFormsButtonVisibility(!model.readOnly&&this.get("value")!=="");},_setErrorMessageAttr:function(_112f){this._set("errorMessage",_112f);this._errorMessage.textContent=_112f;},_setSendLabelAttr:function(_1130){this._set("sendLabel",_1130);if(_1130){this._postButton.set("label",_1130);}},_setResetLabelAttr:function(_1131){this._set("resetLabel",_1131);if(_1131){this._resetButton.set("label",_1131);}},_setEditLabelAttr:function(_1132){this._set("editLabel",_1132);if(_1132){this._editButton.set("label",_1132);}},_setIsEditEnabledAttr:function(_1133){this._set("isEditEnabled",_1133);if(this._editButton){_1128.toggle(this._editButton.domNode,"dijitHidden",!this.isEditEnabled);}},_setNoNotificationUserMessageAttr:function(_1134){this._commentTextarea.set("noDataMessage",_1134);},_setNotificationUserStoreAttr:function(store){this._set("notificationUserStore",store);this._commentTextarea.set("store",store);},_setPlaceholderAttr:function(_1135){this._commentTextarea.set("placeholder",_1135);},_setReadOnlyAttr:function(_1136){this._set("readOnly",_1136);_1128.toggle(this._commentTextarea.domNode,"dijitHidden",this.readOnly);if(this.readOnly){this._toggleFormsButtonVisibility(false);}},_setValueAttr:function(value){this._set("value",value);this._commentTextarea.set("value",value);},_setDisplayValueAttr:function(_1137){_1137.then(function(value){this.commentNode.innerHTML=value;}.bind(this));},_getValueAttr:function(){return this._commentTextarea.get("value");},_commentChanged:function(_1138){this._started&&this._postButton.set("disabled",!_1138||_1138===this.model.message);},_commentFocused:function(){this._toggleFormsButtonVisibility(true);},_reset:function(){if(this._destroyed){return;}this.hideOnPost&&this._toggleWriteComment();this.model.set("errorMessage","");this._commentTextarea.reset();this._toggleFormsButtonVisibility(false);},_postComment:function(){var value=this._commentTextarea.get("value");if(value.trim().length===0){return;}if(value===this.model.message||this._postButton.get("disabled")){this._reset();return;}this._postButton.set("disabled",true);var delay=10;this.defer(function(){_1128.add(this._postButton.domNode,"epi-button--loading");}.bind(this),delay);this.model.save(value).then(this._reset.bind(this)).always(function(){if(!this._destroyed){this._postButton.set("disabled",false);_1128.remove(this._postButton.domNode,"epi-button--loading");}}.bind(this));},_toggleWriteComment:function(){_1128.toggle(this._commentTextarea.domNode,"dijitHidden");_1128.toggle(this._editButton.domNode,"dijitHidden");_1128.toggle(this.commentNode,"dijitHidden");if(this._commentTextarea.isFocusable()){this._commentTextarea.focus();this._commentTextarea.setCaretLast();}if(this._editButton.isFocusable()){this._editButton.focus();}},_toggleFormsButtonVisibility:function(_1139){_1128.toggle(this._commentFormButtons,"dijitHidden",!_1139);}});});},"url:epi-cms/activity/templates/ActivityCommentForm.html":"<div class=\"epi-activity-comment-form\">\r\n    <div class=\"epi-activity-comment__message\"\r\n         data-dojo-attach-point=\"commentNode\"></div>\r\n    <div data-dojo-attach-point=\"_commentTextarea, focusNode\"\r\n         data-dojo-attach-event=\"onChange:_commentChanged, onFocus: _commentFocused\"\r\n         data-dojo-props=\"intermediateChanges: true, searchProperty: 'name', tagProperty: 'name', displayProperty: 'displayName'\"\r\n         data-dojo-type=\"epi/shell/widget/AutoCompleteTextarea\" class=\"epi-autocomplete-textarea--chat-icon\"></div>\r\n    <div class=\"epi-activity-comment-form__buttons dijitHidden\"\r\n         data-dojo-attach-point=\"_commentFormButtons\">\r\n        <span class=\"epi-activity-feed__error-message\"\r\n              data-dojo-attach-point=\"_errorMessage\"></span>\r\n        <button data-dojo-type=\"dijit/form/Button\"\r\n                class=\"epi-primary\"\r\n                data-dojo-attach-event=\"onClick:_postComment\"\r\n                data-dojo-props=\"disabled: true\"\r\n                data-dojo-attach-point=\"_postButton\"></button>\r\n        <button data-dojo-type=\"dijit/form/Button\"\r\n                class=\"epi-chromeless epi-chromeless--text-only\"\r\n                data-dojo-attach-point=\"_resetButton\"\r\n                data-dojo-attach-event=\"onClick: _reset\"></button>\r\n    </div>\r\n    <button data-dojo-type=\"dijit/form/Button\"\r\n            class=\"epi-chromeless epi-chromeless--text-only epi-text--small\"\r\n            data-dojo-attach-point=\"_editButton\"\r\n            data-dojo-attach-event=\"onClick: _toggleWriteComment\"></button>\r\n</div>\r\n","epi/shell/widget/AutoCompleteTextarea":function(){define("epi/shell/widget/AutoCompleteTextarea",["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-style","dojo/dom-geometry","dijit/form/_FormValueWidget","dijit/_WidgetsInTemplateMixin","dijit/form/_TextBoxMixin","dgrid/OnDemandList","dgrid/Selection","epi/debounce","put-selector/put","dijit/popup","epi/shell/dgrid/selection/Extensions","dijit/form/Textarea"],function(_113a,lang,keys,_113b,_113c,_113d,_113e,_113f,_1140,_1141,_1142,put,popup,_1143){var _1144=_113a([_1140,_1141,_1143]);return _113a([_113d,_113e],{templateString:"<div><div data-dojo-type='dijit/form/Textarea' data-dojo-attach-point='_textArea, focusNode'></div><div data-dojo-attach-point='_listNode'></div></div>",baseClass:"epi-autocomplete-textarea",value:null,store:null,placeholder:"",searchProperty:"query",tagProperty:"",displayProperty:"",noDataMessage:"",_setIdAttr:"domNode",buildRendering:function(){this.inherited(arguments);var _1145=this._textArea;this.own(_1145.on("keyup",lang.hitch(this,"_onKeyUp")),_1145.on("keydown",lang.hitch(this,"_onKeyDown")),_1145.on("change",lang.hitch(this,"_handleOnChange")),this.on("blur",this._closePopup.bind(this)),this._selectList=new _1144({className:"epi-autocomplete-list",selectionMode:"single",renderRow:this._renderRow.bind(this)},this._listNode),this._selectList.on(".dgrid-row:click",this._insertSelection.bind(this)),this._selectList.on("dgrid-refresh-complete",lang.hitch(this._selectList,"moveSelectionDown")));popup.moveOffScreen(this._selectList);},startup:function(){this.inherited(arguments);this._selectList.startup();},focus:function(){if(this.isFocusable()){this.inherited(arguments);}},setCaretLast:function(){if(this._textArea.value){_113f.selectInputText(this._textArea.domNode,this._textArea.value.length);}},reset:function(){this._textArea.reset();},_setIntermediateChangesAttr:function(_1146){this._set("intermediateChanges",_1146);this._textArea.set("intermediateChanges",_1146);},_setNoDataMessageAttr:function(_1147){this._selectList.set("noDataMessage",_1147);},_setPlaceholderAttr:function(_1148){this._set("placeholder",_1148);this._textArea.set("placeholder",_1148);},_setValueAttr:function(value){this._set("value",value);this._textArea.set({value:value,_resetValue:value});},_getValueAttr:function(){return this._textArea.get("value");},_onKeyUp:function(e){if(!this.store){return;}var key=e.keyCode;switch(key){case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.HOME:case keys.END:case keys.UP_ARROW:case keys.DOWN_ARROW:case keys.CTRL:case keys.ALT:case keys.SHIFT:return;}var _1149=this._textArea.textbox,_114a=_1149.selectionStart,value=_1149.value;if(value[_114a-1]==="@"&&(_114a===1||/\s/.test(value[_114a-2]))){this._tagStart=_114a-1;this._openPopup();}if(this._isPopupOpen){var _114b=key===keys.ESCAPE,_114c=typeof this._tagStart=="number"&&value[this._tagStart]!=="@";if(_114b||_114c){this._closePopup();return;}if(key===keys.ENTER||key===keys.TAB){this._insertSelection();return;}this._tagEnd=_114a;var query=value.substring(this._tagStart+1,_114a);this._setQuery(query);}},_setQuery:function(query){query=(query||"").trim();if(!query){this._selectList.set("store",null);return;}if(!this._queryFunction){var _114d=function(query){this._selectList.set("store",this.store,query);};this._queryFunction=_1142(_114d.bind(this),null,200);}var _114e={};_114e[this.searchProperty]=query;this._queryFunction(_114e);},_onKeyDown:function(e){var _114f=this._selectList,key=e.keyCode;if(this._isPopupOpen){switch(key){case keys.UP_ARROW:e.preventDefault();_114f.moveSelectionUp();break;case keys.DOWN_ARROW:e.preventDefault();_114f.moveSelectionDown();break;case keys.ESCAPE:case keys.ENTER:case keys.TAB:e.preventDefault();break;}return;}if(key===keys.ENTER&&!e.shiftKey){this.emit("save");e.preventDefault();}},_insertSelection:function(){var _1150=this._textArea.textbox,_1151=this._selectList,_1152=this._tagEnd,value=_1150.value;var _1153=null;for(var id in _1151.selection){if(_1151.selection[id]){_1153=_1151.row(id).data;break;}}if(!_1153){this._closePopup();return;}var _1154=_1153[this.tagProperty];var _1155="";var _1156=0;(value.charAt(_1152)!==" "?_1155=" ":_1156=1);var _1157=value.slice(0,this._tagStart+1)+_1154+_1155;var _1158=_1157.length+_1156;_1157+=value.slice(_1152);_1150.value=_1157;_1150.setSelectionRange(_1158,_1158);this._closePopup();},_renderRow:function(item){return put("div",""+item[this.displayProperty]);},_openPopup:function(){var _1159=this._selectList,_115a=_113c.getContentBox(this.domNode),_115b=this._closePopup.bind(this);_113b.set(_1159.domNode,"width",_115a.w+"px");popup.open({parent:this,popup:_1159,around:this.domNode,onExecute:_115b,onCancel:_115b});this._isPopupOpen=true;},_closePopup:function(){this._isPopupOpen=false;this._tagStart=null;this._tagEnd=null;this._selectList.set("store",null);popup.close(this._selectList);}});});},"epi/shell/dgrid/selection/Extensions":function(){define("epi/shell/dgrid/selection/Extensions",["dojo/_base/declare","dojo/query","dojo/window"],function(_115c,query,win){return _115c([],{moveSelectionUp:function(){return this.moveSelection(true);},moveSelectionDown:function(){return this.moveSelection(false);},moveSelection:function(up){var _115d=this.getFirstSelectedRow();if(!_115d){return this._selectFirstRow();}this.clearSelection();_115d=up?this.up(_115d,1,true):this.down(_115d,1,true);this.select(_115d,1,true);win.scrollIntoView(_115d.element);return _115d;},hasSelection:function(){return Object.keys(this.selection).length>0;},getFirstSelectedRow:function(){if(!this.hasSelection()){return null;}var row=this.row(Object.keys(this.selection)[0]);if(row&&!row.data){return null;}return row;},_selectFirstRow:function(){var rows=query(".dgrid-row",this.domNode);if(rows.length===0){return null;}var _115e=this.row(rows[0]);if(!_115e){return null;}this.select(_115e,1,true);return _115e;}});});},"epi-cms/activity/viewmodels/ActivityViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/Destroyable","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.cms.activities.activity"],function(_115f,lang,_1160,_1161,_1162,_1163,_1164,_1165,_1166){return _115f([_1165,_1160],{id:null,hasMessage:false,title:null,content:null,comment:null,actionIconClass:null,actionClass:null,iconClass:null,_resources:_1166,postscript:function(){this.inherited(arguments);this.set({id:this.activity.id,hasMessage:!!this.activity.message,upsertActivityComment:null,comment:this.activity.comment,title:this.activity.name});this.own(this.activityService.on("activity-comment-updated",lang.hitch(this,this._activityCommentUpdated)));this.set("actionIconClass",lang.replace("epi-icon{actionIcon} epi-icon--{actionColor}",this.activity));this.set("actionClass",lang.replace("epi-event--{actionColor} epi-event--{actionColor}-{activityType}",this.activity));this.set("iconClass",_1163.getValue(this.activity.typeIdentifier,"iconClass")||"epi-iconProject");var _1167=this.activity;var _1168=_1167.delayPublishUntil?this._resources.delaypublishmessagetemplate:this._resources.messagetemplate;var _1169=lang.replace(_1168,{event:_1167.actionText,delaypublish:_1161.toUserFriendlyString(_1167.delayPublishUntil),user:_1162.toUserFriendlyString(_1167.changedBy),date:_1161.toUserFriendlyString(_1167.created)});this.set("content",_1169);},_editLabelGetter:function(){return this.hasMessage?this._resources.message.reply.label:this._resources.message.comment.label;},_save:function(_116a){return this.activityService.addComment(this.id,_116a);},_activityCommentUpdated:function(_116b){if(_116b&&_116b.activityId===this.id){this.set("upsertActivityComment",_116b);}},_titleSetter:function(title){var _116c=this.activity.language;if(_116c&&_116c!==_1164.currentContentLanguage){title=lang.replace("{0} ({1})",[title,_116c]);}this.title=title;}});});},"epi-cms/activity/viewmodels/ActivityCommentViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_116d,_116e,_116f){return _116d([_116e],{sendLabel:_116f.save,_save:function(_1170){var _1171=this.activityService.saveComment(this.id,_1170);_1171.then(this.set.bind(this));return _1171;}});});},"epi-cms/activity/viewmodels/MessageActivityViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1172,_1173,_1174){return _1172([_1173],{sendLabel:_1174.save,_save:function(_1175){return this.activityService.saveMessage(this.id,_1175);}});});},"url:epi-cms/activity/templates/Activity.html":"<div class=\"epi-event epi-activity\">\r\n    <div class=\"epi-event__title-wrapper\">\r\n        <span class=\"dijitInline\" data-dojo-attach-point=\"iconNode\"></span>\r\n        <span class=\"epi-event__title\" data-dojo-attach-point=\"titleNode\"></span>\r\n    </div>\r\n    <div class=\"epi-event__status\" data-dojo-attach-point=\"actionNode\">\r\n        <span class=\"dijitInline epi-event__status__icon\">\r\n            <span data-dojo-attach-point=\"actionIconNode\"></span>\r\n        </span><span class=\"epi-event__status__message\" data-dojo-attach-point=\"actionTextNode\"></span>\r\n    </div><div data-dojo-attach-point=\"messageNode\"></div\r\n    ><div class=\"epi-activity__comment\" data-dojo-attach-point=\"activityCommentNode\"></div\r\n    ><div class=\"epi-activity__comments\" data-dojo-attach-point=\"containerNode\"></div>\r\n    <div data-dojo-type=\"epi-cms/activity/ActivityCommentForm\" data-dojo-attach-point=\"commentForm\"></div>\r\n</div>\r\n","epi-cms/compare/CompareToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Evented","dojo/topic","dijit/Toolbar","epi/shell/widget/DeferredDropDownButton","epi","epi/username","epi-cms/version/VersionSelector","epi/shell/widget/_ModelBindingMixin","dojo/text!./template/CompareToolbar.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_1176,lang,_1177,_1178,topic,_1179,_117a,epi,_117b,_117c,_117d,_117e,_117f,_1180){return _1176([_1179,_1178,_117d],{region:"top",baseClass:"epi-compare-toolbar epi-localToolbar epi-flatToolbar",templateString:_117e,_leftVersionSelector:null,_rightVersionSelector:null,_resources:lang.mixin(_117f,_1180),modelBindingMap:{currentLanguage:["currentLanguage"],leftVersion:["leftVersion"],rightVersion:["rightVersion"],leftButtonLabel:["leftButtonLabel"],rightButtonLabel:["rightButtonLabel"],leftByText:["leftByText"],rightByText:["rightByText"],leftDateText:["leftDateText"],rightDateText:["rightDateText"],messageText:["messageText"],showsVersionSelectors:["showsVersionSelectors"]},buildRendering:function(){this.inherited(arguments);this._leftVersionSelector=this._createVersionSelector("leftVersion","left");this._rightVersionSelector=this._createVersionSelector("rightVersion","right");this._leftButton=new _117a({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._leftVersionSelector,iconClass:"epi-iconVersions"},this.leftVersionSelector);this._rightButton=new _117a({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._rightVersionSelector,iconClass:"epi-iconVersions"},this.rightVersionSelector);this.own(this._leftVersionSelector,this._rightVersionSelector,this._leftButton,this._rightButton);},_refreshSelectors:function(){this._leftVersionSelector.refresh();this._rightVersionSelector.refresh();},_setLeftVersionAttr:function(_1181){if(epi.areEqual(this.leftVersion,_1181)){return;}this._set("leftVersion",_1181);if(_1181){this._leftVersionSelector.set("contentLink",_1181.contentLink);this._rightVersionSelector.set("markedContentLink",_1181.contentLink);this._refreshSelectors();}},_setRightVersionAttr:function(_1182){this._set("rightVersion",_1182);if(_1182){this._rightVersionSelector.set("contentLink",_1182.contentLink);this._leftVersionSelector.set("markedContentLink",_1182.contentLink);}},_setLeftButtonLabelAttr:function(label){this._set("leftButtonLabel",label);this._leftButton.set("label",label);},_setRightButtonLabelAttr:function(label){this._set("rightButtonLabel",label);this._rightButton.set("label",label);},_setLeftByTextAttr:{node:"leftBy",type:"innerHTML"},_setRightByTextAttr:{node:"rightBy",type:"innerHTML"},_setLeftDateTextAttr:{node:"leftDate",type:"innerHTML"},_setRightDateTextAttr:{node:"rightDate",type:"innerHTML"},_setMessageTextAttr:{node:"messageSection",type:"innerHTML"},_setShowsVersionSelectorsAttr:function(_1183){_1177.toggle(this.leftVersionSection,"dijitHidden",!_1183);_1177.toggle(this.rightVersionSection,"dijitHidden",!_1183);_1177.toggle(this.messageSection,"dijitHidden",_1183);this.emit("versionInformationUpdated");},_createVersionSelector:function(_1184,_1185){var model=this.model,_1186=new _117c({store:model.contentVersionStore,region:_1185,languages:model.languages,currentLanguage:model.currentLanguage,name:_1184}),_1187=function(name,_1188,value){_1186.set(name,value);};this.own(_1186.on("change",function(e){model.set(_1184,e.version);}),model.watch("languages",_1187),model.watch("currentLanguage",_1187));return _1186;}});});},"epi-cms/version/VersionSelector":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi-cms/core/ContentReference","dojo/text!./template/VersionSelector.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/extensions/ColumnHider","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","epi-cms/dgrid/formatters","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","epi/shell/widget/_FocusableMixin","epi-cms/version/LanguageSelector"],function(_1189,event,lang,_118a,_118b,keys,_118c,_118d,_118e,_118f,_1190,_1191,_1192,_1193,_1194,_1195,misc,_1196,_1197,_1198,_1199,_119a,_119b){return _1189([_1197,_1198,_1199,_119a,_119b],{baseClass:"epi-version-selector",templateString:_118d,contentLink:null,markedContentLink:null,languages:null,store:null,region:null,buildRendering:function(){this.inherited(arguments);this.grid=new (_1189([_118f,_1190,_1191,_1192,_1195,_1194,_1193]))({columns:{selector:{label:"",formatter:function(){return misc.icon("epi-iconCheckmark");},sortable:false},icon:{label:"",formatter:function(){return misc.icon("");},sortable:false},language:{label:_118e.language,sortable:false},status:{label:_118e.status,renderCell:_1196.commonDraft},savedDate:{label:_118e.saved,formatter:_1196.localizedDate,className:"epi-grid--30"},savedBy:{label:_118e.by,formatter:_1196.userName,sortable:false}},cellNavigation:false,selectionEvents:"click",selectionMode:"exclusive",sort:[{attribute:"savedDate",descending:true}]},this.gridNode);this.own(this.grid,this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.grid.on("dgrid-select",lang.hitch(this,"_versionSelected")),_118a.around(this.grid,"renderRow",lang.hitch(this,"_renderRow")),this.languageSelector.watch("value",lang.hitch(this,"_updateFilter")),this.on("keydown",lang.hitch(this,"_onKeydown")));},startup:function(){if(this._started){return;}this.inherited(arguments);this.grid.startup();this.grid.set("store",this.store,{contentLink:this.contentLink});},resize:function(){this.inherited(arguments);this.grid.resize();},refresh:function(){if(this._started){this.grid.refresh();}},_setContentLinkAttr:function(_119c){if(this.contentLink===_119c){return;}if(this._started&&!_118c.compareIgnoreVersion(this.contentLink,_119c)){this.languageSelector.set("value",this.languageSelector.defaultOption.value);this.grid.set("query",{contentLink:_119c});}this.contentLink=_119c;this.grid.clearSelection();this.grid.select(_119c);},_setCurrentLanguageAttr:function(_119d){this._set("currentLanguage",_119d);this.languageSelector.set("currentLanguage",_119d);},_setLanguagesAttr:function(_119e){this._set("languages",_119e);this.languageSelector.set("languages",_119e);var _119f=_119e&&_119e.length;this.languageSelector.set("disabled",!_119f);_118b.toggle(this.languageSelectorContainer,"dijitHidden",!_119f);this.grid.toggleColumnHiddenState("language",!_119f);},_setMarkedContentLinkAttr:function(_11a0){var row=this._getRowElement(this.markedContentLink);if(row){_118b.remove(row,"dgrid-row--marked");}row=this._getRowElement(_11a0);if(row){_118b.add(row,"dgrid-row--marked");}this.markedContentLink=_11a0;},_setRegionAttr:function(_11a1){var _11a2=this.baseClass+"--"+_11a1,_11a3=this.baseClass+"--"+this.region;this.region=_11a1;_118b.replace(this.domNode,_11a2,_11a3);},_refreshComplete:function(){this.grid.select(this.contentLink);this.emit("loaded");},_versionSelected:function(e){if(e.parentType){var _11a4=e.rows&&e.rows[0].data;this.contentLink=_11a4.contentLink;this.emit("change",{version:_11a4});}},_renderRow:function(_11a5){var self=this;return function(item){var row=_11a5.apply(this,arguments);if(item.contentLink===self.markedContentLink){_118b.add(row,"dgrid-row--marked");}return row;};},_getRowElement:function(_11a6){if(_11a6){return this.grid.row(_11a6).element;}},_updateFilter:function(name,_11a7,value){if(this._started){if(value!==this.languageSelector.defaultOption.value){this.grid.set("query",{contentLink:this.contentLink,language:value});}else{this.grid.set("query",{contentLink:this.contentLink});}}this.refresh();},_onKeydown:function(evt){if(evt.ctrlKey||evt.altKey||evt.keyCode!==keys.TAB){return;}if(evt.shiftKey){this.focusPrev();}else{this.focusNext();}event.stop(evt);}});});},"url:epi-cms/version/template/VersionSelector.html":"<div>\r\n    <div data-dojo-attach-point=\"languageSelectorContainer\" class=\"epi-flatToolbar\">\r\n        <select data-dojo-attach-point=\"languageSelector\" data-dojo-type=\"epi-cms/version/LanguageSelector\" class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\"></select>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\" class=\"epi-plain-grid epi-grid-max-height--300\"></div>\r\n</div>\r\n","dgrid/extensions/ColumnHider":function(){define(["dojo/_base/declare","dojo/has","dojo/on","../util/misc","put-selector/put","dojo/i18n!./nls/columnHider","xstyle/css!../css/extensions/ColumnHider.css"],function(_11a8,has,_11a9,_11aa,put,i18n){var _11ab,_11ac,hasIE=has("ie"),_11ad=hasIE&&has("quirks"),_11ae=hasIE<8||_11ad?"htmlFor":"for";function _11af(cb,grid){return cb.id.substr(grid.id.length+18);};return _11a8(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:i18n,_hiderMenuOpened:false,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var _11b0=this.subRows,first=true,_11b1,_11b2,sr,c;delete this._columnHiderFirstCheckbox;for(sr=0,_11b1=_11b0.length;sr<_11b1;sr++){for(c=0,_11b2=_11b0[sr].length;c<_11b2;c++){this._renderHiderMenuEntry(_11b0[sr][c]);if(first){first=false;this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[_11b0[sr][c].id];}}}},_renderHiderMenuEntry:function(col){var id=col.id,_11b3=_11aa.escapeCssIdentifier(id,"-"),div,_11b4,_11b5,label;if(col.hidden){col.hidden=false;this._hideColumn(id);col.hidden=true;}if(col.unhidable){return;}div=put("div.dgrid-hider-menu-row");_11b4=this.domNode.id+"-hider-menu-check-"+_11b3;_11b5=this._columnHiderCheckboxes[id]=put(div,"input.dgrid-hider-menu-check.hider-menu-check-"+_11b3+"[type=checkbox]");_11b5.id=_11b4;label=put(div,"label.dgrid-hider-menu-label.hider-menu-label-"+_11b3+"["+_11ae+"="+_11b4+"]",col.label||col.field||"");put(this.hiderMenuNode,div);if(!col.hidden){_11b5.checked=true;}},renderHeader:function(){var grid=this,_11b6=this.hiderMenuNode,_11b7=this.hiderToggleNode,id;function _11b8(event){event.stopPropagation();};this.inherited(arguments);if(!_11b6){_11b7=this.hiderToggleNode=put(this.domNode,"button.ui-icon.dgrid-hider-toggle[type=button][aria-label="+this.i18nColumnHider.popupTriggerLabel+"]");this._listeners.push(_11a9(_11b7,"click",function(e){grid._toggleColumnHiderMenu(e);}));_11b6=this.hiderMenuNode=put("div.dgrid-hider-menu[role=dialog][aria-label="+this.i18nColumnHider.popupLabel+"]");_11b6.id=this.id+"-hider-menu";this._listeners.push(_11a9(_11b6,"keyup",function(e){var _11b9=e.charCode||e.keyCode;if(_11b9===27){grid._toggleColumnHiderMenu(e);_11b7.focus();}}));_11b6.style.display="none";put(this.domNode,_11b6);this._listeners.push(_11a9(_11b6,".dgrid-hider-menu-check:"+(hasIE<9||_11ad?"click":"change"),function(e){grid._updateColumnHiddenState(_11af(e.target,grid),!e.target.checked);}));this._listeners.push(_11a9(_11b6,"mousedown",_11b8),_11a9(_11b7,"mousedown",_11b8));if(!_11ac){_11ac=_11a9.pausable(document,"mousedown",function(e){_11ab&&_11ab._toggleColumnHiderMenu(e);});_11ac.pause();}}else{for(id in this._columnHiderRules){this._columnHiderRules[id].remove();}_11b6.innerHTML="";}this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries();},destroy:function(){this.inherited(arguments);for(var id in this._columnHiderRules){this._columnHiderRules[id].remove();}},left:function(cell,steps){return this.right(cell,-steps);},right:function(cell,steps){if(!cell.element){cell=this.cell(cell);}var _11ba=this.inherited(arguments),_11bb=cell;while(_11ba.column.hidden){_11ba=this.inherited(arguments,[_11ba,steps>0?1:-1]);if(_11bb.element===_11ba.element){return cell;}_11bb=_11ba;}return _11ba;},isColumnHidden:function(id){return !!this._columnHiderRules[id];},_toggleColumnHiderMenu:function(){var _11bc=this._hiderMenuOpened,_11bd=this.hiderMenuNode,_11be=this.domNode,_11bf;_11bd.style.display=(_11bc?"none":"");if(_11bc){_11bd.style.height="";}else{if(_11bd.offsetHeight>_11be.offsetHeight-12){_11bd.style.height=(_11be.offsetHeight-12)+"px";}(_11bf=this._columnHiderFirstCheckbox)&&_11bf.focus();}_11ac[_11bc?"pause":"resume"]();_11ab=_11bc?null:this;this._hiderMenuOpened=!_11bc;},_hideColumn:function(id){var grid=this,_11c0="#"+_11aa.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",_11c1;if(this._columnHiderRules[id]){return;}this._columnHiderRules[id]=_11aa.addCssRule(_11c0+_11aa.escapeCssIdentifier(id,"-"),"display: none;");if((has("ie")===8||has("ie")===10)&&!has("quirks")){_11c1=_11aa.addCssRule(".dgrid-row-table","display: inline-table;");window.setTimeout(function(){_11c1.remove();grid.resize();},0);}},_showColumn:function(id){if(this._columnHiderRules[id]){this._columnHiderRules[id].remove();delete this._columnHiderRules[id];}},_updateColumnHiddenState:function(id,_11c2){this[_11c2?"_hideColumn":"_showColumn"](id);this.columns[id].hidden=_11c2;_11a9.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[id],hidden:_11c2,bubbles:true});this.resize();},toggleColumnHiddenState:function(id,_11c3){if(typeof _11c3==="undefined"){_11c3=!this._columnHiderRules[id];}this._updateColumnHiddenState(id,_11c3);this._columnHiderCheckboxes[id].checked=!_11c3;}});});},"dgrid/extensions/nls/columnHider":function(){define({root:{popupTriggerLabel:"Show or hide columns",popupLabel:"Show or hide columns"},es:true,ro:true});},"epi-cms/version/LanguageSelector":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.languageselector","dijit/form/Select"],function(_11c4,_11c5,_11c6){return _11c4([_11c6],{defaultOption:null,languages:null,currentLanguage:null,constructor:function(){this.defaultOption={label:_11c5.alllanguages,value:"all"};},_setLanguagesAttr:function(_11c7){this._set("languages",_11c7);if(!_11c7||!_11c7.length){this.set("options",[]);return;}this.set("options",this._convertLanguagesToOptions(_11c7));},_setCurrentLanguageAttr:function(_11c8){this._set("currentLanguage",_11c8);var _11c9=this.languages;if(_11c9&&_11c9.length){this.set("options",this._convertLanguagesToOptions(_11c9));}},_convertLanguagesToOptions:function(_11ca){var value=this.value,_11cb=this.currentLanguage;var _11cc=_11ca.map(function(item){var _11cd=item.languageId===_11cb;return {label:item.name+(_11cd?" ("+_11c5.currentlanguage+")":""),value:item.languageId};});_11cc=[this.defaultOption,{}].concat(_11cc);_11cc.forEach(function(item){item.selected=item.value===value;});return _11cc;}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(array,_11ce,_11cf,_11d0,_11d1,event,i18n,lang,has,_11d2,_11d3,Menu,_11d4,_11d5,_11d6,_11d7){var _11d8=_11ce("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_11d0.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";n.setAttribute("role","listbox");o.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",event.stop);},focus:function(){var found=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){array.forEach(this.parentWidget._getChildren(),function(child){if(child.option&&(val===child.option.value)){found=true;this.focusChild(child,false);}},this);}if(!found){this.inherited(arguments);}},resize:function(mb){if(mb){_11d1.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _11d9=_11ce("dijit.form.Select",[_11d2,_11d3],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_11d7,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _11d8({id:this.id+"_menu",parentWidget:this});_11d0.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_11da){if(!_11da.value&&!_11da.label){return new _11d5({ownerDocument:this.ownerDocument});}else{var click=lang.hitch(this,"_setValueAttr",_11da);var item=new _11d4({option:_11da,label:_11da.label||this.emptyLabel,onClick:click,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_11da.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_11db){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_11db));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_11dc){if(_11dc===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{array.forEach(this._getChildren(),function(child){child.destroyRecursive();});var item=new _11d4({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(value){this.inherited(arguments);_11cf.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(value){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(value){this._set("required",value);this.focusNode.setAttribute("aria-required",value);this._refreshState();},_setOptionsAttr:function(_11dd){this._isLoaded=false;this._set("options",_11dd);},_setDisplay:function(_11de){var lbl=_11de||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_11df){var _11e0=this.disabled||this.isValid(_11df);this._set("state",_11e0?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_11e0?"false":"true");var _11e1=_11e0?"":this._missingMsg;if(_11e1&&this.focused&&this._hasBeenBlurred){_11d6.show(_11e1,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_11d6.hide(this.domNode);}this._set("message",_11e1);return _11e0;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_11d6.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",event.stop);this.domNode.setAttribute("aria-expanded","false");},_setStyleAttr:function(value){this.inherited(arguments);_11d0.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_11e2){this._loadChildren(true);this._isLoaded=true;_11e2();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_11e3){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_11e3);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_11d6.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_11d9._Menu=_11d8;return _11d9;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(array,_11e4,_11e5,_11e6,_11e7,dom,_11e8,_11e9,lang,query,when,_11ea,_11eb){var _11ec=_11e7("dijit.form._FormSelectWidget",_11eb,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_11ed){var opts=this.options||[];if(_11ed==null){return opts;}if(lang.isArray(_11ed)){return array.map(_11ed,"return this.getOptions(item);",this);}if(lang.isString(_11ed)){_11ed={value:_11ed};}if(lang.isObject(_11ed)){if(!array.some(opts,function(_11ee,idx){for(var a in _11ed){if(!(a in _11ee)||_11ee[a]!=_11ed[a]){return false;}}_11ed=idx;return true;})){_11ed=-1;}}if(_11ed>=0&&_11ed<opts.length){return opts[_11ed];}return null;},addOption:function(_11ef){array.forEach(lang.isArray(_11ef)?_11ef:[_11ef],function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_11f0){var _11f1=this.getOptions(lang.isArray(_11f0)?_11f0:[_11f0]);array.forEach(_11f1,function(_11f2){if(_11f2){this.options=array.filter(this.options,function(node){return (node.value!==_11f2.value||node.label!==_11f2.label);});this._removeOptionItem(_11f2);}},this);this._loadChildren();},updateOption:function(_11f3){array.forEach(lang.isArray(_11f3)?_11f3:[_11f3],function(i){var _11f4=this.getOptions({value:i.value}),k;if(_11f4){for(k in i){_11f4[k]=i[k];}}},this);this._loadChildren();},setStore:function(store,_11f5,_11f6){var _11f7=this.store;_11f6=_11f6||{};if(_11f7!==store){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!store.get){lang.mixin(store,{_oldAPI:true,get:function(id){var _11f8=new _11e4();this.fetchItemByIdentity({identity:id,onItem:function(_11f9){_11f8.resolve(_11f9);},onError:function(error){_11f8.reject(error);}});return _11f8.promise;},query:function(query,_11fa){var _11fb=new _11e4(function(){if(_11fc.abort){_11fc.abort();}});_11fb.total=new _11e4();var _11fc=this.fetch(lang.mixin({query:query,onBegin:function(count){_11fb.total.resolve(count);},onComplete:function(_11fd){_11fb.resolve(_11fd);},onError:function(error){_11fb.reject(error);}},_11fa));return new _11ea(_11fb);}});if(store.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_11e5.after(store,"onNew",lang.hitch(this,"_onNewItem"),true),_11e5.after(store,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_11e5.after(store,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",store);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}if(_11f6.query){this._set("query",_11f6.query);this._set("queryOptions",_11f6.queryOptions);}if(store){this._loadingStore=true;this.onLoadDeferred=new _11e4();this._queryRes=store.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(items){if(this.sortByLabel&&!_11f6.sort&&items.length){if(store.getValue){items.sort(_11e6.createSortFunction([{attribute:store.getLabelAttributes(items[0])[0]}],store));}else{var _11fe=this.labelAttr;items.sort(function(a,b){return a[_11fe]>b[_11fe]?1:b[_11fe]>a[_11fe]?-1:0;});}}if(_11f6.onFetch){items=_11f6.onFetch.call(this,items,_11f6);}array.forEach(items,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._observeHandle=this._queryRes.observe(lang.hitch(this,function(_11ff,_1200,_1201){if(_1200==_1201){this._onSetItem(_11ff);}else{if(_1200!=-1){this._onDeleteItem(_11ff);}if(_1201!=-1){this._onNewItem(_11ff);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_11f5);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(items);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _11f7;},_setValueAttr:function(_1202,_1203){if(!this._onChangeActive){_1203=null;}if(this._loadingStore){this._pendingValue=_1202;return;}if(_1202==null){return;}if(lang.isArray(_1202)){_1202=array.map(_1202,function(value){return lang.isObject(value)?value:{value:value};});}else{if(lang.isObject(_1202)){_1202=[_1202];}else{_1202=[{value:_1202}];}}_1202=array.filter(this.getOptions(_1202),function(i){return i&&i.value;});var opts=this.getOptions()||[];if(!this.multiple&&(!_1202[0]||!_1202[0].value)&&!!opts.length){_1202[0]=opts[0];}array.forEach(opts,function(opt){opt.selected=array.some(_1202,function(v){return v.value===opt.value;});});var val=array.map(_1202,function(opt){return opt.value;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}var disp=array.map(_1202,function(opt){return opt.label;});this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_1203]);this._updateSelection();},_getDisplayedValueAttr:function(){var ret=array.map([].concat(this.get("selectedOptions")),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_setDisplayedValueAttr:function(label){this.set("value",this.getOptions(typeof label=="string"?{label:label}:label));},_loadChildren:function(){if(this._loadingStore){return;}array.forEach(this._getChildren(),function(child){child.destroyRecursive();});array.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=[].concat(this.value);if(val&&val[0]){array.forEach(this._getChildren(),function(child){var _1204=array.some(val,function(v){return child.option&&(v===child.option.value);});_11e8.toggle(child.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_1204);child.domNode.setAttribute("aria-selected",_1204?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=array.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return array.map(array.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_1205){if(!_1205||!_1205.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var store=this.store;this.removeOption({value:store.getIdentity(item)});},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var store=this.store,label=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:store.getLabel(item),value=(label?store.getIdentity(item):null);return {value:value,label:label,item:item};},_addOptionForItem:function(item){var store=this.store;if(store.isItemLoaded&&!store.isItemLoaded(item)){store.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _1206=this._getOptionObjForItem(item);this.addOption(_1206);},constructor:function(_1207){this._oValue=(_1207||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?query("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_11e9._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);_11e5.after(this,"onChange",lang.hitch(this,"_updateSelection"));var store=this.store;if(store&&(store.getIdentity||store.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(store,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions({selected:true});},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _11ec;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _1208={};lang.setObject("dojo.data.util.sorter",_1208);_1208.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_1208.createSortFunction=function(_1209,store){var _120a=[];function _120b(attr,dir,comp,s){return function(itemA,itemB){var a=s.getValue(itemA,attr);var b=s.getValue(itemB,attr);return dir*comp(a,b);};};var _120c;var map=store.comparatorMap;var bc=_1208.basicComparator;for(var i=0;i<_1209.length;i++){_120c=_1209[i];var attr=_120c.attribute;if(attr){var dir=(_120c.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_120a.push(_120b(attr,dir,comp,store));}}return function(rowA,rowB){var i=0;while(i<_120a.length){var ret=_120a[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _1208;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","url:epi-cms/compare/template/CompareToolbar.html":"<div class=\"dijit\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <span data-dojo-attach-point=\"leftVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\r\n        <span>${_resources.comparing}</span>\r\n        <span data-dojo-attach-point=\"leftVersionSelector\"></span>\r\n\r\n        <span data-dojo-attach-point=\"leftDate\"></span>\r\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\r\n        <span data-dojo-attach-point=\"leftBy\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"rightVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\r\n        <span>${_resources.with}</span>\r\n        <span data-dojo-attach-point=\"rightVersionSelector\"></span>\r\n        <span data-dojo-attach-point=\"rightDate\"></span>\r\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\r\n        <span data-dojo-attach-point=\"rightBy\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"messageSection\" class=\"epi-compare-toolbar__text-wrapper epi-compare-toolbar__text-wrapper--text-only\"></span>\r\n</div>\r\n","epi-cms/compare/viewmodels/CompareViewModel":function(){define(["dojo/_base/declare","dojo/aspect","dojo/topic","dojo/_base/lang","dojo/Stateful","dojo/when","epi/shell/DestroyableByKey","epi/dependency","epi-cms/core/ContentReference","epi-cms/compare/viewmodels/CompareToolbarViewModel"],function(_120d,_120e,topic,lang,_120f,when,_1210,_1211,_1212,_1213){return _120d([_120f,_1210],{contentLink:null,languages:null,typeIdentifier:null,leftVersion:null,rightVersion:null,leftVersionUri:null,rightVersionUrl:null,hasAccess:true,contentDataStore:null,contentVersionStore:null,orientation:"vertical",compareToolbarViewModel:null,_rightVersionDeferred:null,postscript:function(){this.inherited(arguments);this.contentDataStore=this.contentDataStore||_1211.resolve("epi.storeregistry").get("epi.cms.contentdata");this.contentVersionStore=this.contentVersionStore||_1211.resolve("epi.storeregistry").get("epi.cms.contentversion");this._setupCompareToolbarViewModel();this.own(topic.subscribe("/epi/cms/content/statuschange/",lang.hitch(this,"_refresh")));},_refresh:function(){var store=this.contentVersionStore;when(store.refresh(this.leftVersion.contentLink),lang.hitch(this,function(_1214){this.set("leftVersion",_1214);}));if(this.rightVersion){when(store.refresh(this.rightVersion.contentLink),lang.hitch(this,function(_1215){this.set("rightVersion",_1215);}));}},_contentLinkSetter:function(_1216){this.contentLink=_1216;var store=this.contentVersionStore;if(this._rightVersionDeferred&&!this._rightVersionDeferred.isFulfilled()){this._rightVersionDeferred.cancel();}when(store.get(_1216),lang.hitch(this,function(_1217){this.set("leftVersion",_1217);if(!this.rightVersion||!_1212.compareIgnoreVersion(this.leftVersion.contentLink,this.rightVersion.contentLink)){var _1218={contentLink:_1216,language:this.leftVersion.language,query:"getcompareversion"};this._rightVersionDeferred=store.query(_1218);when(this._rightVersionDeferred,lang.hitch(this,function(_1219){this.set("hasAccess",true);this.set("rightVersion",_1219&&_1219.length?_1219[0]:null);}),lang.hitch(this,function(error){this.set("hasAccess",error.status!==403);this.set("rightVersion",null);}));}}));},_leftVersionSetter:function(_121a){this.leftVersion=_121a;if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.leftVersion!==_121a){this.compareToolbarViewModel.set("leftVersion",_121a);}}this.set("leftVersionUri",_121a.uri);},_rightVersionSetter:function(_121b){var _121c="removeAfter";this.rightVersion=_121b;this.destroyByKey(_121c);if(_121b){this.ownByKey(_121c,_120e.after(this.contentVersionStore,"remove",lang.hitch(this,function(_121d){if(_121b.contentLink===_121d){this.set("rightVersion",null);}}),true));}if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.rightVersion!==_121b){this.compareToolbarViewModel.set("rightVersion",_121b);}}if(_121b===null){this.set("rightVersionUrl","about:blank");this.set("rightVersionContentLink",null);return;}when(this.contentDataStore.get(_121b.contentLink),lang.hitch(this,function(_121e){if(this.leftVersion===this.rightVersion){this.set("rightVersionUrl","about:blank");}this.set("rightVersionUrl",_121e.editablePreviewUrl);this.set("rightVersionContentLink",_121e.contentLink);}));},_typeIdentifierSetter:function(_121f){this.typeIdentifier=_121f;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("typeIdentifier",_121f);}},_languagesSetter:function(_1220){this.languages=_1220;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("languages",_1220);}},_hasAccessSetter:function(_1221){this.hasAccess=_1221;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("hasAccess",_1221);}},_setupCompareToolbarViewModel:function(){this.compareToolbarViewModel=this.compareToolbarViewModel||new _1213({contentVersionStore:this.contentVersionStore,leftVersion:this.leftVersion,rightVersion:this.rightVersion,typeIdentifier:this.typeIdentifier,hasAccess:this.hasAccess,languages:this.languages});this.own(this.compareToolbarViewModel.watch("leftVersion",lang.hitch(this,function(_1222,_1223,_1224){if(this.leftVersion!==_1224){this.set("leftVersion",_1224);}})));this.own(this.compareToolbarViewModel.watch("rightVersion",lang.hitch(this,function(_1225,_1226,_1227){if(this.rightVersion!==_1227){this.set("rightVersion",_1227);}})));}});});},"epi-cms/compare/viewmodels/CompareToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_1228,lang,_1229,when,_122a,_122b,_122c,_122d,_122e,_122f){return _1228([_1229],{contentVersionStore:null,leftVersion:null,rightVersion:null,leftButtonLabel:null,rightButtonLabel:null,leftByText:null,rightByText:null,leftDateText:null,rightDateText:null,messageText:null,showsVersionSelectors:null,hasAccess:true,typeIdentifier:null,languages:null,currentLanguage:null,postscript:function(){this.inherited(arguments);var _1230=this._profile||_122a.resolve("epi.shell.Profile");when(_1230.getContentLanguage(),lang.hitch(this,function(_1231){this.set("currentLanguage",_1231);}));},_leftVersionSetter:function(_1232){this.leftVersion=_1232;if(_1232){this.set("leftButtonLabel",this._createButtonLabel(_1232));this.set("leftByText",_122c.toUserFriendlyString(_1232.savedBy,null,false));this.set("leftDateText",_122b.toUserFriendlyString(_1232.savedDate));}},_rightVersionSetter:function(_1233){this.rightVersion=_1233;if(_1233){this.set("rightButtonLabel",this._createButtonLabel(_1233));this.set("rightByText",_122c.toUserFriendlyString(_1233.savedBy,null,false));this.set("rightDateText",_122b.toUserFriendlyString(_1233.savedDate));}this.set("showsVersionSelectors",_1233!==null);},_typeIdentifierSetter:function(_1234){this.typeIdentifier=_1234;this._updateMessageText();},_hasAccessSetter:function(_1235){this.hasAccess=_1235;this._updateMessageText();},_updateMessageText:function(){this.set("messageText",this.hasAccess?_122d.getResourceValue(this.typeIdentifier,"compare.onlyoneversion"):_122f.insufficientpermission);},_createButtonLabel:function(_1236){var _1237=_1236.language?" ("+_1236.language+")":"";var _1238=_122e.getVersionStatus(_1236.status);return _1238+_1237;}});});},"epi-cms/compare/views/SideBySideCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/shell/widget/Iframe","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/OnPageEditing"],function(_1239,lang,topic,_123a,_123b,_123c){return _1239([_123c,_123b],{createOverlays:true,modelBindingMap:{rightVersionUrl:["rightVersionUrl"]},_rightIframe:null,buildRendering:function(){this.inherited(arguments);this._setupComparePanes();},destroy:function(){this._removeAndDestroyComparePanes();this.inherited(arguments);},_setRightVersionUrlAttr:function(url){if(url){this._rightIframe.load(url);}},_setupComparePanes:function(){var _123d=this.model.orientation;var width=this.editLayoutContainer.w/2;this._rightIframe=new _123a({region:_123d==="vertical"?"right":"bottom",layoutPriority:100,style:_123d==="vertical"?"width: "+width+"px":"height: 50%",splitter:true,"class":"epi-iframe--overflow epi-editorViewport"});this.own(this._rightIframe.on("load",lang.hitch(this,this._onRightIframeLoad)));this.mainLayoutContainer.addChild(this._rightIframe);},_onRightIframeLoad:function(url,_123e){if(!!url&&!_123e&&url!==this.model.rightVersionUrl){topic.publish("/epi/shell/context/request",{url:url},{sender:this,forceContextChange:true,suppressFailure:true});}},_removeAndDestroyComparePanes:function(){if(this._rightIframe){this.mainLayoutContainer.removeChild(this._rightIframe);this._rightIframe.destroyRecursive();this._rightIframe=null;}}});});},"epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/when","dojo/topic","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_123f,lang,_1240,on,when,topic,_1241,_1242,_1243,_1244){return _123f([_1244,_1242,_1243],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_1245,_1246){return _1246.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_1247){if(_1247&&_1247.editorWidget){var _1248=_1247.editorWidget;if(_1248.onFieldCreated){var _1249=_1240.after(_1248,"onFieldCreated",lang.hitch(this,function(_124a,_124b){_1249.remove();_1249=null;this._addStateWatch(_124b);}),true);}else{_1248.set("name",_1247.get("propertyName"));this._addStateWatch(_1248);}_1248.validate&&_1248.validate();}},onSetActiveProperty:function(_124c){var _124d=this._mappingManager.findOne("propertyName",_124c);if(!_124d){topic.publish("/epi/cms/action/switcheditmode",null,{activePropertyOnStartup:_124c});}else{if(_124d.wrapper){_124d.wrapper.startEdit();}else{if(_124d.overlayItem){this._onOverlayItemClick(_124d.overlayItem);}}}},_onOverlayItemClick:function(_124e,e){var _124f=this._activeEditorWrapper;var _1250=this._mappingManager.find().filter(function(item){return (item.overlayItem&&item.wrapper);}).map(function(item){return item.wrapper;});if(_1250.length>0){_1250.forEach(function(item){item.tryToStopEditing();});var _1251=_1250.some(function(item){return (item.editing);});if(_1251||(_124f&&_124e.name===_124f.overlayItem.name)){return;}}this.inherited(arguments);},onReadySetupEditMode:function(){this.inherited(arguments);var self=this,_1252=function(){var _1253=self._activeEditorWrapper;if(_1253&&_1253.closeOnViewportClick){_1253.tryToStopEditing(false);}};this._formConnects.push(on(this._form,"mouseup",_1252));this.own(on(this.iframeWithOverlay.iframe,"mouseup",_1252));},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.editLayoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _1254=this;this._pullDownGesture=_1241(_1254.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_1254.editLayoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_1254.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_1254.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_1254.editLayoutContainer.selectChild(_1254.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_1254.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_1254.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_1254.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _1255=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_1255=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_1255&&_1255.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while((c=this._iframeConnects.pop())){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},_destroyOverlay:function(){this.inherited(arguments);this._removeViewModelWatches();},removeForm:function(form){this._removePullDownGesture();this.editLayoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_1256,event,lang,mouse,on,_1257){return _1256([_1257],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_1258,_1259){this._delegate=_1259;this._scrollTarget=_1258;this.addMouseWheelListener(_1258);},addMouseWheelListener:function(_125a){if(_125a){return this.own(on(_125a,mouse.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){event.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){event.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){event.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(array,_125b,lang,topic,_125c,_125d,_125e,_125f,_1260){return _125b([_1260],{ignoreVersionWhenComparingLinks:false,_sort:"dateAdded",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_125c.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _1261=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single",dndFormatSuffix:this.dndFormatSuffix,sort:this._sort},this.defaultGridMixin);this.grid=new this._gridClass(_1261,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);this.own(topic.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_1262){if(_1262){_1262.forEach(function(_1263){this.store.remove("epi.cms.contentdata:///"+_1263);},this);}})));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _1264=this.inherited(arguments);_1264.data.contentLink=new _125d(_1264.data.uri).getId();return _1264;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort",this._sort,true);},fetchData:function(){var _1265=_125e.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_1265+"]|\\d{2,})")});this.grid.set("sort",this._sort,true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/ExpandoMenuBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_1266,lang,_1267,_1268,_1269,_126a,_126b,_126c,_126d,_126e,_126f,_1270,_1271,_1272){var _1273=_1266([_126d],{_create:function(_1274){var _1275=_1266([_1274.settings.widget,_126b]);return new _1275(_1274.settings);}});var _1276=_1266([_126e],{_getBuildInfo:function(_1277){if(_1277.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category===_1277.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _1266([_126a,_126c],{templateString:_1271,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _1278=new _1273();var _1279=new _126f({settings:{title:_1272.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false},hideEmptyButton:true});var _127a=[{category:"leading",builder:_1278,target:this.leadingContainerNode},{category:"view",builder:new _1270({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.viewNode},{category:"center",builder:_1278,target:this.centerContainerNode},{category:"trailing",builder:_1278,target:this.trailingContainerNode},{category:"create",builder:_1279,target:this.leadingContainerNode},{category:"compare",builder:new _1270({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.compareNode}];var _127b=new _1276({configuration:_127a,commandSource:this});_127b.build();},_getNextFocusableChild:function(child,dir){var _127c=this.getChildren();var index=_127c.indexOf(child);index=(dir>0)?index+1:index-1;if(index<0){index=_127c.length-1;}else{if(index>=_127c.length){index=0;}}return _127c[index];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_127d,_127e,_127f){return _127d([_127e,_127f],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_1280,_1281,_1282){return _1280([_1282,_1281],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <div class=\"epi-toolbarGroupContainer\">\r\n        <div class=\"epi-toolbarLeading epi-toolbarGroup\">\r\n            <span data-dojo-attach-point=\"leadingContainerNode\"></span\r\n            ><span data-dojo-attach-point=\"viewNode\"></span\r\n            ><span data-dojo-attach-point=\"compareNode\"></span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\r\n    </div>\r\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-class","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/component/_ShowAllLanguagesMixin","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree","dojo/text!./templates/MainNavigation.html","epi-cms/widget/SearchBox"],function(array,_1283,lang,_1284,_1285,when,_1286,_1287,_1288,_1289,_128a,res,_128b){return _1283([_1286,_1287,_1288,_1289],{templateString:_128b,res:res,contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_128a.resolve("epi.cms.contentRepositoryDescriptors");var _128c=this.contentRepositoryDescriptors.get(this.repositoryKey);var roots=this.roots?this.roots:_128c.roots;this.search.set("area",_128c.searchArea);this.search.set("searchRoots",roots);var _128d=_128c.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_128d],lang.hitch(this,function(_128e){var _128f=new _128e({typeIdentifiers:_128c.mainNavigationTypes?_128c.mainNavigationTypes:_128c.containedTypes,containedTypes:_128c.containedTypes,settings:_128c,roots:roots,repositoryKey:this.repositoryKey});_128f.placeAt(this.navigation);this.tree=_128f;when(this.tree._isSiteMultilingual()).then(function(_1290){if(!_1290){return;}this.loadShowAllLanguages().then(function(_1291){_128f.set("showAllLanguages",_1291);this._setShowAllLanguagesLinkVisibility(_1291);}.bind(this));}.bind(this));this.tree.resize();this.own(this.tree.watch("showAllLanguages",function(value){var _1292=this.tree.get("showAllLanguages");this.search.set("filterOnCulture",!_1292);if(this.showAllLanguages!==_1292){this.saveShowAllLanguages(_1292);}this.set("showAllLanguages",_1292);this._setShowAllLanguagesLinkVisibility(_1292);}.bind(this)));}));this.own(this.on(".epi-main-navigation-language-link:click",function(){this.tree.set("showAllLanguages",true);}.bind(this)));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;this._relayout();}},_relayout:function(){var sb=_1284.getMarginBox(this.search.domNode);var _1293=_1285.contains(this.bottomLinkContainer,"dijitHidden")?0:_1284.getMarginBox(this.bottomLinkContainer).h;_1284.setMarginBox(this.navigation,{w:this._contentBox.w,h:this._contentBox.h-sb.h-_1293});},_setShowAllLanguagesLinkVisibility:function(_1294){_1285.toggle(this.bottomLinkContainer,"dijitHidden",_1294);if(!this._contentBox){return;}this._relayout();}});});},"epi-cms/component/_ShowAllLanguagesMixin":function(){define(["dojo/_base/declare","dojo/when","epi/dependency"],function(_1295,when,_1296){return _1295([],{showAllLanguages:true,_showAllLanguagesKey:"_showAllLanguages",_profile:null,constructor:function(_1297){this._profile=_1297._profile||_1296.resolve("epi.shell.Profile");},loadShowAllLanguages:function(){return when(this._profile.get(this.componentId+this._showAllLanguagesKey)).then(function(_1298){if(_1298!==null){this.showAllLanguages=_1298;return _1298;}return this.showAllLanguages;}.bind(this));},saveShowAllLanguages:function(value){this._profile.set(this.componentId+this._showAllLanguagesKey,value);}});});},"url:epi-cms/component/templates/MainNavigation.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>\r\n    <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">\r\n    </div>\r\n    <div class=\"epi-gadget-bottom-container dijitHidden\" data-dojo-attach-point=\"bottomLinkContainer\">\r\n        <a class=\"epi-visibleLink epi-main-navigation-language-link\">${res.showalllanguages}</a>\r\n    </div>\r\n</div>\r\n","epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/asset/HierarchicalList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_1299,_129a,_129b,_129c,on,topic,_129d,_129e,_129f,_12a0,_12a1,_12a2){return _1299([_129e],{res:_12a2,showCreateContentArea:true,showThumbnail:true,modelClassName:_129d,noDataMessages:_12a2.nodatamessages,hierarchicalListClass:"epi-mediaList",createContentText:_12a2.dropareatitle,postMixInProperties:function(){this.inherited(arguments);this.modelBindingMap.dropZoneSettings=["dropZoneSettings"];},buildRendering:function(){this.inherited(arguments);this._setupDropZone();},postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);var _12a3=this.model.getCommand("uploadDefault");this.own(_12a3.watch("canExecute",function(name,_12a4,_12a5){this._toggleCreateContentArea(_12a5);}.bind(this)),_12a3.watch("isAvailable",function(name,_12a6,_12a7){this._toggleCreateContentArea(_12a7);}.bind(this)));},_setupDropZone:function(){var _12a8=this.model.getCommand("uploadDefault");if(!_12a8){return;}this.own(this._dropZone=new _129f({outsideDomNode:this.container.domNode}));_129b.place(this._dropZone.domNode,this.domNode,"first");this.connect(this._dropZone,"onDrop",this._onDrop);},_onDrop:function(evt,_12a9){_12a9=_12a0.filterFileOnly(_12a9);if(!_12a9||_12a9.length<=0){return;}var _12aa=this.model.getCommand("uploadDefault");if(!_12aa){return;}_12aa.set("fileList",_12a9);_12aa.execute();this.searchBox.clearValue();},_setDropZoneSettingsAttr:function(_12ab){if(this._dropZone){this._dropZone.set("settings",_12ab);}},_onCreateAreaClick:function(){this.inherited(arguments);this.model.getCommand("uploadDefault").execute();},_setupCreateContentArea:function(){this.inherited(arguments);var _12ac=this.createContentAreaButton.domNode;_129a.remove(_12ac,"epi-flat");_129a.add(_12ac,"epi-button--full-width");}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","dojo/topic","epi","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/asset/view-model/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/command/UploadContent","epi-cms/command/DownloadMedia","epi-cms/asset/command/UploadContentToSelection","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(array,_12ad,lang,_12ae,when,topic,epi,_12af,_12b0,_12b1,_12b2,_12b3,_12b4,_12b5,_12b6,_12b7){return _12ad([_12b1],{dropZoneSettings:null,_dialog:null,postscript:function(){this.inherited(arguments);this.own(topic.subscribe("/epi/cms/upload",function(_12b8){this.set("selectedTreeItems",this.get("selectedTreeItems"));if(this.isPseudoContextualRoot({contentLink:_12b8})&&this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"){this.treeStoreModel.refreshRoots(this);}}.bind(this)));},_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _12b9={selection:this.selection};var _12ba=new _12b4(lang.mixin({iconClass:"epi-iconPlus",label:_12b7.command.label,resources:_12b7,viewModel:this},_12b9));var _12bb={uploadDefault:{command:_12ba},upload:{command:new _12b6(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_12b7.linktocreateitem,viewModel:this},_12b9)),order:2},download:{command:new _12b5(lang.mixin({category:"context",label:_12b7.command.download},_12b9)),order:4}};this.own(_12ba.watch("canExecute",this._onUploadCommandUpdated.bind(this)));this._commandRegistry=lang.mixin(this._commandRegistry,_12bb);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_onUploadCommandUpdated:function(name,_12bc,_12bd){var _12be=this._commandRegistry.uploadDefault.command;var _12bf=_12be.get("model");var _12c0=_12bf?_12bf.length===1:false;var _12c1=_12c0?_12bf[0].name:null;var _12c2=this.get("isSearching");var _12c3={dropFolderName:_12c1,validSelection:_12c0,enabled:!_12c2&&(_12bd||!_12c0)};this.set("dropZoneSettings",_12c3);},_selectedTreeItemsSetter:function(items){this._commandRegistry.uploadDefault.command.set("model",items);this.inherited(arguments);},upload:function(_12c4,_12c5,_12c6){var _12c7=new _12b3({model:new _12b2({store:this.get("store"),query:this.get("listQuery")})});_12c7.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_12c7.on("close",lang.hitch(this,function(_12c8){this._dialog&&(_12c8?this._dialog.hide():this._dialog.destroy());}));_12c7.on("uploadComplete",lang.hitch(this,function(_12c9){if(_12c7.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_12c7.set("createAsLocalAsset",false);_12c7.set("uploadDirectory",this.get("selectedTreeItems")[0].id);_12c7.model.set("query",this.get("listQuery"));topic.publish("/epi/cms/action/createlocalasset",this.treeStoreModel);}));}else{this.onListItemUpdated(_12c9);topic.publish("/epi/cms/upload",_12c5);this.selectListItemsByContentReferences(_12c9.map(function(_12ca){var _12cb=_12b0.toContentReference(_12ca.contentLink);return _12cb.createVersionUnspecificReference().toString();}));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _12af({title:_12b7.linktocreateitem,dialogClass:"epi-dialog-upload",content:_12c7,autofocus:true,defaultActionsVisible:false,closeIconVisible:false,destroyOnHide:false});this._dialog.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:function(){_12c7.close();}});this._dialog.resize({w:700});this._dialog.show();var _12cc=this.get("selectedTreeItems")[0];this._buildBreadcrumb(_12cc,_12c7);_12c7.set("uploadDirectory",_12c5||_12cc.id);_12c7.set("createAsLocalAsset",_12c6);_12c7.upload(_12c4);},onListItemUpdated:function(_12cd){var store=this.store;return when(this.getCurrentContext(),function(_12ce){var _12cf=(new _12b0(_12ce.id)).createVersionUnspecificReference().toString();return when(store.get(_12cf),function(_12d0){var _12d1=array.filter(_12cd,function(_12d2){return _12d0.name.toLowerCase()===_12d2.fileName.toLowerCase();})[0];return _12d1?_12d0:null;});});},_buildBreadcrumb:function(_12d3,_12d4){if(!_12d4){return;}if(this.treeStoreModel.isTypeOfRoot(_12d3)){_12d4.set("breadcrumb",[_12d3]);return;}this.treeStoreModel.getAncestors(_12d3.contentLink,lang.hitch(this,function(_12d5){var _12d6,paths=[_12d3];for(var i=_12d5.length-1;i>=0;i--){_12d6=_12d5[i];paths.unshift(_12d6);if(this.treeStoreModel.isTypeOfRoot(_12d6)){break;}}_12d4.set("breadcrumb",paths);}));}});});},"epi-cms/asset/view-model/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/aspect","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/registry","dijit/Destroyable","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/CreateCommandsMixin","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/component/command/ViewTrash","epi-cms/asset/command/ChangeContextToSelection","epi-cms/asset/command/NewFolder","epi-cms/asset/command/RenameSelectedFolder","epi-cms/asset/command/TranslateSelectedContent","epi-cms/plugin-area/assets-pane"],function(array,_12d7,lang,topic,_12d8,_12d9,_12da,when,all,_12db,_12dc,epi,_12dd,_12de,_12df,_12e0,_12e1,_12e2,_12e3,_12e4,_12e5,_12e6,_12e7,_12e8,_12e9,_12ea,_12eb,_12ec,_12ed,_12ee,_12ef,_12f0,_12f1,_12f2){return _12d7([_12da,_12d9,_12e4,_12e2,_12e8,_12dc],{searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,treePaths:null,selectedTreeItems:null,selectedListItems:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:null,treeStoreModel:null,store:null,searchStore:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,noDataMessages:null,noDataMessage:"",_profile:null,_commandItems:null,_pluginCommands:null,constructor:function(){this._commandRegistry={sort:function(){var _12f3=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var index=this[key].order;if(!index){index=100;}_12f3.push([index,this[key].command]);}}_12f3.sort(function(a,b){return a[0]-b[0];});return _12f3;},toArray:function(){var _12f4=this.sort();var _12f5=[];array.forEach(_12f4,function(key){_12f5.push(key[1]);});return _12f5;}};this.own(_12f2.on("added, removed",this._setCommands.bind(this)));},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_12dd.resolve("epi.cms.contentRepositoryDescriptors");_12d7.safeMixin(this,this.contentRepositoryDescriptors.get(args.repositoryKey));this._profile=this._profile||_12dd.resolve("epi.shell.Profile");this.clipboardManager=this.clipboardManager||new _12de();this.selection=this.selection||new _12e0();this.store=this.store||_12dd.resolve("epi.storeregistry").get(this.storeKey);this.searchStore=this.searchStore||_12dd.resolve("epi.storeregistry").get("epi.cms.content.search");this._setupTreeStoreModel();this._setupCommands();this._setCommands();this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_12f6){return this._commandRegistry[_12f6]?this._commandRegistry[_12f6].command:null;},contentContextChanged:function(_12f7,_12f8){this._setupSearchRoots();if(!this._isSupportedContent(_12f7)){return;}this.selectItemsByContentReference(_12f7.id,false);},selectItemsByContentReference:function(_12f9,_12fa){if(!_12f9){return;}var _12fb=_12e5.toContentReference(_12f9);when(this.store.get(_12fb.createVersionUnspecificReference().toString()),function(_12fc){this.treeStoreModel.getAncestors(_12fc,function(_12fd){if(!_12fa&&this._isAncestorAssetFolder(_12fd)){return;}var _12fe=[];if(_12fc.capabilities.isContentFolder){_12fd.push(_12fc);}else{_12fe.push(_12fc);}var _12ff=[_12fd];if(epi.areEqual(this.get("treePaths"),_12ff)&&epi.areEqual(this.get("selectedListItems"),_12fe)){return;}this.emit("setPathsAndItems",_12ff,_12fe);}.bind(this));}.bind(this));},selectListItemsByContentReferences:function(_1300){all(_1300.map(function(_1301){return when(this.store.get(_1301));}.bind(this))).then(function(_1302){this.set("selectedListItems",_1302);}.bind(this));},_isAncestorAssetFolder:function(_1303){if(_1303.length===1){return true;}return _1303.some(function(_1304){return this._isAssetsFolder(_1304);}.bind(this));},_isAssetsFolder:function(_1305){return _1305.typeIdentifier==="episerver.core.contentassetfolder"||_12e5.compareIgnoreVersion(_1305.contentLink,_12e3.contentAssetsFolder);},updateTreePaths:function(_1306){var _1307=this.get("treePaths");if(!_1307||!_1307.length){return;}var _1308=this._getAssetFolderIndex(_1307);if(this._selectionContainsAssetFolder(_1308)){var _1309=lang.clone(_1307);this._removeOldAssetFolder(_1309,_1308);this._addNewAssetFolder(_1306,_1309);if(!_1309.length){_1309=this._getDefaultTreePaths();}when(_1309).then(function(_130a){this.set("treePaths",_130a);}.bind(this));}},_getAssetFolderIndex:function(_130b){var _130c=-1;_130b.some(function(_130d,index){return _130d.some(function(_130e){var _130f=this._isAssetsFolder(_130e);if(_130f){_130c=index;}return _130f;}.bind(this));}.bind(this));return _130c;},_selectionContainsAssetFolder:function(_1310){return _1310>-1;},_removeOldAssetFolder:function(_1311,_1312){_1311.splice(_1312,1);},_addNewAssetFolder:function(_1313,_1314){_1313.some(function(_1315){var _1316=this._isAssetsFolder(_1315);if(_1316){_1314.push([this.treeStoreModel.root,_1315]);}return _1316;}.bind(this));},setSearchText:function(_1317){var _1318=!!_1317;this.set("isSearching",_1318);this._updateSearchListQuery(_1317);var _1319=_1318?null:this.get("selectedListItems")||this.get("selectedTreeItems");this._updateCommands(_1319);},onListItemUpdated:function(_131a){},_isSupportedContent:function(_131b){return !!(_131b&&_131b.id)&&this.containedTypes.some(function(type){return _12e1.isBaseTypeIdentifier(_131b.dataType,type);});},_showAllLanguagesSetter:function(value){this.showAllLanguages=value;this._updateListQuery(this.selectedTreeItems);if(this.get("isSearching")){var _131c=this.get("searchListQuery");this._updateSearchListQuery(_131c.queryText);}this.treeStoreModel.set("showAllLanguages",value);},setTreePaths:function(_131d){if(!epi.areEqual(_131d,this.get("treePaths"))){this._treePathsSetter(_131d);}},_treePathsSetter:function(value){this.treePaths=value;this._saveTreePaths(value);this._changeAttrValue("selectedListItems",null);var _131e=lang.clone(value);var _131f=_131e?_131e.map(function(path){return path.pop();}):null;this.set("selectedTreeItems",_131f);},_selectedTreeItemsSetter:function(value){this.selectedTreeItems=value;this._updateListQuery(value);if(!this.get("isSearching")){this._updateCommands(value);}},setSelectedListItems:function(_1320){this._selectedListItemsSetter(_1320);},_selectedListItemsSetter:function(value){this.selectedListItems=value;if(!this.get("isSearching")){this._updateCommands(value);}},setSelectedSearchResults:function(_1321){this._selectedSearchResultsSetter(_1321);},_selectedSearchResultsSetter:function(value){this.selectedSearchResults=value;this._updateCommands(value);},updateTreeCommands:function(){this._updateCommands(this.get("selectedTreeItems"));},updateListCommands:function(){this._updateCommands(this.get("selectedListItems"));},_setupSelection:function(){if(!this.roots||!this.roots.length){return null;}when(this.getCurrentContext(),function(ctx){if(this._isSupportedContent(ctx)){this.contentContextChanged(ctx,null);return;}when(this._loadTreePaths()).then(function(paths){if(!paths){paths=this._getDefaultTreePaths();}when(paths).then(function(paths){this.set("treePaths",paths);}.bind(this));}.bind(this));}.bind(this));},_getDefaultTreePaths:function(){if(!this.roots||!this.roots.length){return [];}var _1322=_12e5.toContentReference(this.roots[0]).toString();return this.store.get(_1322).then(function(model){return [[this.treeStoreModel.root,model]];}.bind(this));},_setupTreeStoreModel:function(){if(!this.treeStoreModelClass){this.treeStoreModelClass=this.enableContextualContent?_12e7:_12e6;}var _1323=this.treeStoreModel||new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,autoSelectPastedItem:false,onAddDelegate:lang.hitch(this,function(node){var _1324=_12db.getEnclosingWidget(node.domNode),_1325=_1324&&_1324.item,_1326=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_1325);if(_1326){node.edit();var _1327=function(){topic.publish("/epi/cms/contentdata/childrenchanged",_1325.parentLink);};var _1328=node.on("rename",function(){_1328.remove();_1327();});var _1329=node.on("cancelEdit",function(){_1329.remove();_1327();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),onPasteItemsFailed:lang.hitch(this,this._pasteItemsFailed),additionalQueryOptions:{sort:this._getSortSettings()}});this.own(_1323,_12d8.after(_1323,"rename",this._afterRename.bind(this)));this.set("treeStoreModel",_1323);},_afterRename:function(_132a){return _132a.then(function(_132b){return this.store.refresh(_132b.contentLink).then(function(item){var _132c=this.selectedTreeItems;if(_132c&&_132c.length===1){if(_132c[0].contentLink===item.contentLink){this.set("selectedTreeItems",[item]);}}}.bind(this));}.bind(this));},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){var roots=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[];when(this.getCurrentContent()).then(lang.hitch(this,function(_132d){var _132e=_132d&&_132d.assetsFolderLink;if(_132e&&typeof this._getPseudoContextualContent==="function"&&_132e!==this._getPseudoContextualContent()){roots.push(_132e);}})).always(lang.hitch(this,function(){this.set("searchRoots",roots.join(","));}));},_setupCommands:function(){var _132f={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var index=1;array.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _12ef(lang.mixin({typeIdentifier:type},_132f)),order:index};index=index+1;},this);this.createCommands=this.getCreateCommands(index);var _1330=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);var _1331={rename:{command:new _12f0(_132f),order:10},cut:{command:new _12ea(_132f),order:20},copy:{command:new _12e9(_132f),order:30},paste:{command:new _12ec(lang.mixin({typeIdentifiers:this.mainNavigationTypes},_132f)),order:40},edit:{command:new _12ee(lang.mixin({forceReload:true,forceContextChange:true,typeIdentifiers:_1330},_132f)),order:3},translate:{command:new _12f1(_132f)},"delete":{command:new _12eb(_132f),order:50},trash:{command:new _12ed({typeIdentifiers:this.mainNavigationTypes,order:60}),order:60}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_1331);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_setCommands:function(){var _1332=[];_12f2.get().forEach(function(_1333){_1333.category="context";_1332.push(_1333);});this._pluginCommands=_1332;var _1334=this._commandRegistry.toArray().concat(_1332);this.set("commands",_1334);},_pasteItemsFailed:function(_1335){this.set("selectedListItems",_1335);},_updateListQuery:function(items){var query=null;if(items&&items.length>0){query=this._createListChildrenQuery(items);this.set("noDataMessage",items.length>1?this.noDataMessages.multiple:this.noDataMessages.single);}this.set("listQuery",query);},_createListChildrenQuery:function(items){var _1336=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);var ids=items.map(function(item){return item.contentLink.toString();});return {references:ids,query:"getpagedchildren",allLanguages:this.showAllLanguages,typeIdentifiers:_1336};},_updateSearchListQuery:function(_1337){var query=null;if(_1337){query=this._createListSearchQuery(_1337);}this.set("searchListQuery",query);},_createListSearchQuery:function(_1338){return {queryText:_1338,query:"searchcontent",allLanguages:this.showAllLanguages,contentSearchAreas:this.get("searchArea"),searchRoots:this.get("searchRoots"),maxResults:1000,filterDeleted:true};},_updateCommands:function(_1339){if(epi.areEqual(this._commandItems,_1339)){return;}this._commandItems=_1339;this._updateSelection(_1339);this._updateCommandModels(_1339);if(_1339&&_1339.length===1){this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}},_updateSelection:function(_133a){var _133b=_133a?_133a.map(function(_133c){return {type:"epi.cms.contentdata",data:_133c};}):[];this.selection.set("data",_133b);},_updateCommandModels:function(_133d){var _133e=this.createCommands;for(var key in _133e){_133e[key].command.set("model",_133d);}this._pluginCommands.forEach(function(_133f){_133f.set("model",_133d);});},_saveTreePaths:function(_1340){this._profile.set(this.componentId+"_treePaths",_1340);},_loadTreePaths:function(){return this._profile.get(this.componentId+"_treePaths");},_getPseudoContextualCommands:function(){var key,_1341=[];for(key in this.createCommands){_1341.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_1341.push(this.createHierarchyCommands[key].command);}_1341.push(this._commandRegistry.paste.command);return _1341;},upload:function(_1342){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_1343,_1344){return _1343(_1344,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_1345,copy){this.set("copy",copy);this.set("data",_1345);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_1346,_1347){return _1346(_1347,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_1348,_1349,when,lang,_134a,_134b,_134c){return _1348([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_134d){lang.mixin(this,_134d);},_isSiteMultilingual:function(){var _134e=new _1349();if(this._cachedValue!==undefined){_134e.resolve(this._cachedValue);return _134e;}if(!this._siteTreeModel){var _134f=_134a.resolve("epi.storeregistry"),_1350=_134f.get("epi.cms.sitestructure");this._siteTreeModel=new _134c({store:_1350});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(items){this._cachedValue=items.length>=2;_134e.resolve(this._cachedValue);}));return _134e;},_contentExistsInCurrentLanguage:function(_1351){if(!_1351){return false;}if(_1351.capabilities&&!_1351.capabilities.language){return true;}if(!_1351.currentLanguageBranch){return false;}return _134b.currentContentLanguage===_1351.currentLanguageBranch.languageId;}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(array,_1352,lang,_1353,_1354,_1355,_1356){return _1352([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_1355,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1353.resolve("epi.cms.contentRepositoryDescriptors");_1352.safeMixin(this,this.contentRepositoryDescriptors.get(this.repositoryKey));this.commandCategory=this.commandCategory||"context";var _1357={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_1357.ROOT|_1357.TREE;},getCreateCommands:function(index){var _1358={};var _1359=index||1;if(!this.creatableTypes){return _1358;}array.forEach(this.creatableTypes,function(type){_1358[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_1359};_1359=_1359+1;},this);if(this.creatableTypes.length<2){return _1358;}var _135a=new _1354({label:_1356.action["new"],commands:_1358});return {popupCommand:{command:_135a,order:index}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(array,_135b,_135c,_135d,_135e,_135f){return _135b([_135d,_135e],{category:"popup",canExecute:true,popup:null,popupClass:_135f,popupCategory:"context",_commandsSetter:function(value){if(!value){return;}var _1360=[];if(value instanceof Array){_1360=value;}else{for(var index in value){_1360.push(value[index].command);}}this.commands=_1360;this._updateIsAvailable();},_popupSetter:function(popup){this.popup=popup;popup.addProvider(this);},_updateIsAvailable:function(){var _1361=array.some(this.get("commands"),function(_1362){return _1362.get("isAvailable");});this.set("isAvailable",_1361);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(array,_1363,lang,_1364,topic,when,all,_1365,_1366,_1367,_1368){return _1363([_1366],{contentType:null,createAsLocalAsset:false,postscript:function(){this.inherited(arguments);var _1369=this.contentType;this.label=this.label||_1367.getResourceValue(_1369,"create");this.tooltip=this.tooltip||_1367.getResourceValue(_1369,"createdescription");this.iconClass=this.iconClass||_1367.getValue(_1369,"commandIconClass");if(!this.store){var _136a=_1365.resolve("epi.storeregistry");this.store=_136a.get("epi.cms.contenttype");}},_execute:function(){topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,view:_1367.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}this.set("canExecute",this._canExecute());var model=this.model;if(!model){this.set("isAvailable",false);return;}when(this._getContentType(model),lang.hitch(this,function(_136b){if(!_136b){this.set("isAvailable",false);return;}when(this._checkAvailability(_136b.availableContentTypes),lang.hitch(this,function(_136c){this.set("isAvailable",_136c);}));}));},_canExecute:function(){var model=this.model,_136d=_1368.action.Create,_136e=_1368.providerCapabilities.Create,_136f=model&&!(model.isWastebasket||model.isDeleted)&&_1368.hasLanguageAccess(model)&&_1368.isActionAvailable(model,_136d,_136e,true);return !!_136f;},_getContentType:function(model){if(!model){return null;}return this.store.get(model.contentTypeID);},_checkAvailability:function(_1370){if(_1370.length===0){return false;}var _1371=new _1364();var _1372=array.map(_1370,lang.hitch(this,function(_1373){return this.store.get(_1373);}));when(all(_1372),lang.hitch(this,function(_1374){var _1375=array.some(_1374,lang.hitch(this,function(_1376){return _1367.isBaseTypeIdentifier(_1376.typeIdentifier,this.contentType);}));_1371.resolve(_1375);}));return _1371;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_1377,array,epi,_1378,_1379,_137a){return _1377([_1378,_1379,_137a],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_137b=this.selection.data,_137c=false;if(model&&_137b.length){_137c=array.every(_137b,function(item){return model.canCopy(item.data);});}this.set("canExecute",_137c);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_137d,epi,_137e,_137f,_1380){return _137d([_137e,_137f,_1380],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_1381=this.selection.data,_1382=false;if(model&&_1381.length){_1382=array.every(_1381,function(item){return model.canCut(item.data);});}this.set("canExecute",_1382);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_1383,lang,_1384,topic,when,_1385,_1386,_1387,_1388,_1389,_138a,_138b){return _1383([_1387,_1388,_1389],{label:_138a.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var model=this.model,_138c=this.clipboard,_138d=this.selection.data,_138e=this.hasWastebasket?model.move(_138d,{contentLink:_1385.wastebasketPage,isWastebasket:true}):model.remove(_138d);return when(_138e,lang.hitch(this,function(){var _138f=[];if(_138c&&_138c.data){_138d.forEach(function(_1390){var map=_138c.data.map(function(_1391){return model.isAncestor(_1390.data,_1391.data);});_138f=_138f.concat(map);});}when(_1384(_138f),function(_1392){var _1393=_1392.every(function(_1394){return _1394;});if(_1393){_138c.clear();}});}),lang.hitch(this,function(){topic.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_1395){this.hasWastebasket=_1395;this.set("iconClass",_1395?"epi-iconTrash":"epi-iconClose");this.set("label",_1395?_138a.movetotrash:_138b.action.deletelabel);},_onModelChange:function(){var model=this.model,_1396=this.selection.data,_1397=function(item){var _1398=item.data;return _1398&&!_1398.isDeleted&&model.canDelete(_1398);},_1399=function(item){var _139a=item.data;return _139a&&_1386.hasProviderCapability(_139a.providerCapabilityMask,_1386.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_1396.length&&_1396.every(_1399));this.set("canExecute",!!(model&&_1396.length)&&_1396.every(_1397)&&(this.hasWastebasket||!_1396.some(_1399)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager"],function(array,_139b,lang,_139c,when,epi,_139d,_139e,_139f,_13a0){return _139b([_139d,_139e,_139f],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",typeIdentifiers:null,createAsLocalAsset:false,_execute:function(){var _13a1=this.get("clipboardData"),_13a2=this._getSingleSelectionData();this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_13a1,_13a2);}else{return when(this.model.move(_13a1,_13a2),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,model=self.model,_13a3=self.get("clipboardData"),_13a4=self._getSingleSelectionData();self.set("canExecute",false);var _13a5=!!_13a4&&this._isTargetOfCorrectType(_13a4);this.set("isAvailable",_13a5);if(model&&_13a3&&_13a3.length&&_13a4){var _13a6=array.map(_13a3,function(item){return model.canPaste(item.data,_13a4,self.clipboard.copy);});when(_139c(_13a6),function(_13a7){var _13a8=array.every(_13a7,function(_13a9){return _13a9;});if(self.clipboard.copy){self.set("canExecute",_13a8);return;}model.getAncestors(_13a4,function(_13aa){var _13ab=array.some(_13a3,function(item){return array.indexOf(_13aa,item.data)>=0;});self.set("canExecute",_13a8&&!_13ab);});});}},_isTargetOfCorrectType:function(_13ac){if(!this.typeIdentifiers){return true;}return this.typeIdentifiers.some(function(type){return _13a0.isBaseTypeIdentifier(_13ac?_13ac.typeIdentifier:"",type);},this);}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_13ad,lang,topic,when,_13ae,_13af,_13b0,_13b1){return _13ad([_13b0],{label:_13b1.viewtrash,category:"setting",typeIdentifiers:null,postscript:function(){this.inherited(arguments);var store=this.store||_13ae.resolve("epi.storeregistry").get("epi.cms.content.light"),_13b2=store.get(_13af.wastebasketPage.toString());when(_13b2,lang.hitch(this,function(_13b3){this.set("canExecute",_13b3.statusCode!==403);}));},_execute:function(){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_13af.wastebasketPage},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/asset/command/ChangeContextToSelection":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_13b4,topic,_13b5,_13b6,_13b7,_13b8,_13b9){return _13b4([_13b6,_13b7],{contentActionSupport:null,forceContextChange:false,forceReload:false,viewType:null,viewName:null,typeIdentifiers:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13b5;},_execute:function(){var _13ba=this._getSingleSelectionData();topic.publish("/epi/shell/context/request",{uri:_13ba.uri},{sender:null,forceReload:this.forceReload,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){var _13bb=this._getSingleSelectionData();if(!_13bb){this.set("canExecute",false);this.set("isAvailable",false);return;}var _13bc=this.contentActionSupport.hasAccess(_13bb.accessMask,this.contentActionSupport.accessLevel.Read);var _13bd=this._isTargetOfCorrectType(_13bb);this.set("isAvailable",_13bd);this.set("canExecute",_13bd&&_13bc);if(this.contentActionSupport.hasAccess(_13bb.accessMask,this.contentActionSupport.accessLevel.Edit)){this.set("label",_13b9.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_13b9.view);this.set("iconClass","epi-iconSearch");}},_isTargetOfCorrectType:function(_13be){if(!this.typeIdentifiers){return true;}return this.typeIdentifiers.some(function(type){return _13b8.isBaseTypeIdentifier(_13be.typeIdentifier,type);},this);}});});},"epi-cms/asset/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(array,_13bf,lang,topic,when,_13c0,_13c1,_13c2,_13c3,_13c4){return _13bf([_13c0,_13c1],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _13c5=this.typeIdentifier;this._defaultName=_13c2.getResourceValue(_13c5,"newitemdefaultname");var _13c6=_13c2.getResourceValue(_13c5,"create");this.set("label",_13c6);this.set("tooltip",_13c6);},_execute:function(){var self=this,_13c7=self._getSingleSelectionData(),_13c8=(new _13c3(_13c7.contentLink)).createVersionUnspecificReference().toString(),_13c9=self.createAsLocalAsset;var _13ca=function(_13cb){self.model.getChildren(_13cb,function(_13cc){when(self.model.add({parentLink:_13c8,name:self._getUniqueFolderName(_13cc,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_13c9},self.onRefreshSelection),function(_13cd){if(_13cd.parentLink!==_13c8){topic.publish("/epi/cms/action/createlocalasset");}});});};if(_13c9){when(self.model.store.refresh(_13c8),function(_13ce){when(self.model.store.get(_13ce.assetsFolderLink),_13ca);});}else{_13ca(_13c7);}},_onModelChange:function(){var _13cf=this._getSingleSelectionData(),_13d0=_13c4.action.Create,_13d1=_13c4.providerCapabilities.Create,_13d2=!!this.model&&!!_13cf&&_13c4.isActionAvailable(_13cf,_13d0,_13d1,true),_13d3=_13d2&&_13c2.isBaseTypeIdentifier(_13cf.typeIdentifier,this.typeIdentifier);this.set("isAvailable",_13d3);this.set("canExecute",_13d2);},_getUniqueFolderName:function(arr,_13d4){var _13d5=function(times){var name=times>0?lang.replace(_13d4+" {0}",[times]):_13d4;if(times>1000){return name;}var _13d6=array.some(arr,function(child){return lang.trim(child.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_13d6){times=times+1;return _13d5(times);}return name;};return _13d5(0);}});});},"epi-cms/asset/command/RenameSelectedFolder":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager"],function(_13d7,epi,_13d8,_13d9,_13da,_13db){return _13d7([_13d9,_13da],{label:epi.resources.action.rename,contentActionSupport:null,iconClass:"epi-iconRename",renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13d8;},_execute:function(){this.renameDelegate(this._getSingleSelectionData());},_onModelChange:function(){var _13dc=this._getSingleSelectionData();var _13dd=!!_13dc&&_13db.isBaseTypeIdentifier(_13dc.typeIdentifier,this.typeIdentifier)&&!((this.model.isContextualContent&&this.model.isContextualContent(_13dc))||this.model.isRoot(_13dc.contentLink));var _13de=_13dd&&this.renameDelegate&&this.contentActionSupport.hasAccess(_13dc.accessMask,_13d8.accessLevel[_13d8.action.Edit]);this.set("isAvailable",_13dd);this.set("canExecute",_13de);}});});},"epi-cms/asset/command/TranslateSelectedContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin"],function(_13df,topic,_13e0,_13e1,_13e2){return _13df([_13e1,_13e2],{label:_13e0.label,executingLabel:_13e0.executinglabel,tooltip:_13e0.title,category:"context",_execute:function(){var model=this._getNormalizedModel();var data={contentData:model.content,languageBranch:model.language.preferredLanguage};topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);},_onModelChange:function(){var model=this._getNormalizedModel(),_13e3=model&&model.language,_13e4=model&&model.content.isDeleted,_13e5=_13e3&&_13e3.isTranslationNeeded&&!_13e4,_13e6=_13e5&&_13e3.hasTranslationAccess&&_13e3.isPreferredLanguageAvailable;if(model&&typeof model.content.canTranslateContent==="function"){var _13e7=model.content.canTranslateContent();_13e5=_13e5&&_13e7;_13e6=_13e6&&_13e7;}this.set("isAvailable",!!_13e5);this.set("canExecute",!!_13e6);},_getNormalizedModel:function(){var model=this._getSingleSelectionData();if(model){return {content:model.contentData||model,language:model.languageContext||model.missingLanguageBranch};}}});});},"epi-cms/plugin-area/assets-pane":function(){define(["epi/PluginArea","epi-cms/content-approval/command/EditApprovalDefinition"],function(_13e8,_13e9){var _13ea=new _13e8("epi-cms/assets-pane/commands[]");_13ea.add(_13e9);return _13ea;});},"epi-cms/content-approval/command/EditApprovalDefinition":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.contentapproval.command.edit","epi/shell/command/_Command"],function(_13eb,_13ec,_13ed,_13ee,_13ef){return _13eb([_13ef],{canExecute:false,contentActionSupport:null,iconClass:"epi-iconApproval",isAvailable:false,label:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13ed;this.approvalService=this.approvalService||_13ec.resolve("epi.cms.ApprovalService");},_onModelChange:function(){if(this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}if(!this.model){this._setEnabledState(false);return;}this._setEnabledState(true);var _13f0=this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Administer);this.set("label",_13f0?_13ee.editlabel:_13ee.viewlabel);},_setEnabledState:function(_13f1){this.set("canExecute",!!_13f1);var _13f2=this.canExecute&&!this.model.ownerContentLink&&this.model.capabilities.canconfigureapproval;this.set("isAvailable",!!_13f2);},_execute:function(){this.approvalService.navigateToDefinition(this.model.contentLink);}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Stateful"],function(array,_13f3,lang,when,_13f4){return _13f3([_13f4],{upload:function(_13f5){return when(this._filterUploadingFiles(_13f5),function(_13f6){if(!_13f6||!(_13f6.existingContents instanceof Array)||_13f6.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_13f5};}return {showConfirmation:true,uploadingFiles:_13f5,newFiles:_13f6.newFiles,existingContents:_13f6.existingContents};});},_filterUploadingFiles:function(_13f7){var self=this;if(!self.store){return null;}var query=lang.clone(self.get("query"));query.typeIdentifiers=query.typeIdentifiers||[];var _13f8="episerver.core.icontentmedia";if(query.typeIdentifiers.indexOf(_13f8)<0){query.typeIdentifiers.push(_13f8);}return when(self.store.query(query),function(_13f9){var _13fa=array.filter(_13f9,function(_13fb){return _13fb.typeIdentifier!=="episerver.core.icontentfolder"&&array.some(_13f7,function(file){return file.name.toLowerCase()===_13fb.name.toLowerCase();});});var _13fc=array.filter(_13f7,function(file){return array.every(_13f9,function(_13fd){return file.name.toLowerCase()!==_13fd.name.toLowerCase();});});return {existingContents:_13fa,newFiles:_13fc};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/form/Uploader","epi/routes","epi/shell/DialogService","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi/shell/form/uploader/HTML5"],function(array,_13fe,lang,_13ff,_1400,when,_1401,_1402,_1403,_1404,_1405,_1406,_1407,_1408,_1409,_140a,_140b,_140c){return _13fe([_1402,_1403,_1404,_1401],{res:_140c,_isCompleted:true,templateString:_140b,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _1408();},upload:function(_140d){var self=this,_140e=self.uploaderInput,_140f=self._getUploadSettings();if(!_140d||_140d.length===0){return;}when(self.model.upload(_140d),function(_1410){when(self._confirm(_1410),function(_1411){self._resetUploader();if(!(_1411 instanceof Array)||_1411.length===0){self._onUploadComplete(_1411);return;}self._fileListModel.set("uploadFiles",_1411);_140e._files=_1411;_140e.upload(_140f);});});},close:function(){var self=this,files=self.uploaderInput._files,_1412=function(_1413){self.emit("close",_1413);self.set("disableToolbar",false);};if(self._isCompleted||!files||files.length<=0){_1412(false);}else{_1407.alert(_140c.confirmdialog.description).then(function(){_1412(true);});}},_setBreadcrumbAttr:function(parts){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_13ff.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_1414=parts?parts.length:0;if(_1414>0){for(i;i<_1414-1;i++){this.breadcrumbBar._createItem(parts[i],true);}this.breadcrumbBar._createItem(parts[_1414-1],false);}},_setDisableToolbarAttr:function(_1415){this.uploaderInput.set("disabled",_1415);!_1415&&this.uploaderInput.set("tabindex",0);},_setupUploader:function(){var self=this;this.uploaderInput.uploadUrl=_1406.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});this.own(_1400.before(this.uploaderInput,"onChange",function(_1416){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}),this.uploaderInput.on("error",function(){self._fileListModel.error();self._onUploadComplete();}));},_getUploadSettings:function(){return {uploadDirectory:this.get("uploadDirectory"),createAsLocalAsset:this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_1417=this.uploaderInput;self._fileListModel=new _140a();self.fileList.set("model",self._fileListModel);this.own(_1417.on("begin",function(files){if(files&&files.length>0){self._fileListModel.set("showProgressBar",true);}}),_1417.on("progress",function(_1418){self._fileListModel.set("progress",_1418);}),_1417.on("complete",lang.hitch(self,self._onUploadComplete)),_1400.after(_1417,"reset",lang.hitch(self,self._fileListModel.clear)),_1400.around(_1417,"onChange",function(_1419){return function(_141a){var _141b=_1417._files;return when(self.model.upload(_141b),function(_141c){return when(self._confirm(_141c),function(_141d){_141d=_1409.getFileArray(_141d);if(!(_141d instanceof Array)||_141d.length===0){self._resetUploader();return _1419.apply(_1417,[_141a]);}self._fileListModel.set("uploadFiles",_141d);_1417._files=_141d;_1417.upload(self._getUploadSettings());return _1419.apply(_1417,[_141a]);});});};}));},_confirm:function(_141e){return _141e.showConfirmation===true?this._confirmationDialog.showConfirmation(_141e.existingContents,_141e.uploadingFiles,_141e.newFiles):_141e.uploadingFiles;},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){this._fileListModel.set("showProgressBar",false);this.uploaderInput.reset();this.set("disableToolbar",false);},_onUploadComplete:function(evt){this._isCompleted=true;var _141f=_1409.getFileArray(evt);this._fileListModel.update(_141f);this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",this._fileListModel.uploadFiles||_141f);}});});},"epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(array,_1420,lang,_1421,_1422,_1423,when,_1424,_1425,_1426,_1427){return _1420(null,{showConfirmation:function(_1428,_1429,_142a){var _142b=new _1423(),_142c=this._getDialog(_1428.length),_142d=this._getContentList();_142c.set("content",_142d);_142c.set("onAction",function(_142e){_142b.resolve(_142e?_1429:_142a);});when(_142c.show(),function(){_142d.grid.renderArray(_1428);});return _142b;},_getDialog:function(_142f){var self=this,_1430=_1424.toHTML(_142f>1?lang.replace(_1427.multiple.heading,[_142f]):_1427.single.heading),_1431=_1424.toHTML(_142f>1?_1427.multiple.description:_1427.single.description);var _1432=new _1425({closeIconVisible:false,title:_1427.title,heading:_1430,description:_1431,dialogClass:"epi-dialog--auto-height",getActions:function(){return self._getActions(this,_142f===1);}});return _1432;},_getActions:function(_1433,_1434){return [{name:"replaceFiles",label:_1434?_1427.single.buttons.replace:_1427.multiple.buttons.replace,title:null,action:function(){when(_1433.hide(),function(){return _1433.onAction(true);});}},{name:"skipFiles",label:_1434?_1427.single.buttons.skip:_1427.multiple.buttons.skip,title:null,action:function(){when(_1433.hide(),function(){return _1433.onAction(false);});}}];},_getContentList:function(){var _1435=new _1426();_1421.add(_1435.grid.domNode,"epi-thumbnailContentList");return _1435;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase"],function(_1436,_1437,_1438,_1439,_143a,_143b){return _1436([_143b],{_gridClass:_1436([_1437,_1438]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(value){this._set("query",value);this._updateQuery(value);},_getBaseSettings:function(_143c){var _143d=function(item){var _143e=new _1439(item.contentLink);return _143a.title(item.name,_143e.id,item.contentTypeName);};var _143f=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_143a.contentItemFactory("name",_143d,null,_143c,_143f,undefined,undefined,true)],deselectOnRefresh:true,sort:this.queryOptions&&this.queryOptions.sort};},_updateQuery:function(query){if(query){this.grid.set("query",query);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/when","./_GridWidgetBase"],function(_1440,lang,_1441,_1442,when,_1443){return _1440([_1443],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,_defaultGridNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _1444=this.getListSettings();_1444=lang.mixin(_1444,this.defaultGridMixin);if(!this.gridAttachNode){this._defaultGridNode=_1441.create("div",null,this.domNode);}this.grid=new this._gridClass(_1444,this.gridAttachNode||this._defaultGridNode);var _1445=this.model&&this.model.commands&&this.model.commands.length>0;if(_1445){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},layout:function(){this.inherited(arguments);if(this._defaultGridNode){_1442.setMarginBox(this._defaultGridNode,this._contentBox);}},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_1446){var grid=this.grid;var model={contextId:_1446.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);model.data.push(row.data);}}this.model.set("model",model);}}));}});});},"epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(array,lang,_1447){return {StatusScope:{Single:0,All:1},validUploadFiles:function(files){if(!files||!(files instanceof Array)||files.length===0){return false;}return !array.some(files,function(item){return (item.name==null||item.size==null);});},addStatus:function(store,scope,_1448,_1449){var _144a=[];if(store instanceof Array){_144a=lang.clone(store);}var _144b=array.some(_144a,function(item){return (item.scope===scope&&item.itemName===_1448&&item.message===_1449);});if(!_144b){_144a.push({scope:scope,itemName:_1448,message:_1449});}return _144a;},filterFileOnly:function(files){return array.filter(files,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},toggleVisibility:function(_144c,_144d){_1447.set(_144c,"display",(_144d?"block":"none"));},getFileArray:function(_144e){if(!_144e){return null;}if(_144e instanceof Array){return _144e;}if(typeof _144e.item!=="function"){return null;}var i=0,total=_144e.length,_144f=[];for(i;i<total;i++){_144f.push(_144e.item(i));}return _144f;}};});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_1450,array,lang,_1451,_1452,_1453){return _1450([_1451],{progress:null,uploadFiles:null,showProgressBar:false,_progressSetter:function(value){this.progress=value;var files=this.get("uploadFiles");var _1454=0;files.forEach(function(_1455){_1454+=_1455.size;if(_1455.status===_1453.uploadform.uploading&&value.bytesLoaded>=_1454){_1455.status=_1453.uploadform.uploaded;}},this);this.set("uploadFiles",files);},_uploadFilesSetter:function(files){if(!_1452.validUploadFiles(files)){return;}var _1456=[];array.forEach(files,function(file){_1456.push({fileName:file.name,size:file.size,status:_1453.uploadform.uploading});},this);this.uploadFiles=_1456;},update:function(_1457){if(!_1457||_1457.length===0){return;}var files=this.get("uploadFiles");_1457.forEach(function(_1458){var _1459=array.filter(files,function(file){return _1458.fileName===file.fileName;})[0];_1459.contentLink=_1458.contentLink;if(_1458.errorMessage){_1459.status=_1453.uploadform.failed;_1459.statusMessage=_1458.errorMessage;}else{_1459.status=_1453.uploadform.uploaded;}},this);this.set("uploadFiles",files);},error:function(){var files=this.get("uploadFiles");array.forEach(files,function(_145a){_145a.status=_1453.uploadform.failed;_145a.statusMessage=_1453.uploadform.errormessage;});this.set("uploadFiles",files);},clear:function(){this.set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>","epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_145b,lang,_145c,_145d,_145e,_145f,_1460,_1461,_1462,_1463,_1464,_1465,_1466,_1467,_1468,_1469){return _145b([_1460,_1465],{templateString:_1469,modelBindingMap:{showProgressBar:["showProgressBar"],progress:["progress"],uploadFiles:["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(files){this._bindData(files);},_setShowProgressBarAttr:function(show){_1467.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_146a){if(!_146a){return;}this.progressBar.update({progress:_146a.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _146b=_145b([_1461,_1463,_1466]);this._grid=new _146b({columns:{fileName:{label:_1468.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_1468.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _146c=this.convertBytes(file.size).value;if(isNaN(_146c)){return _146c;}var _146d=_146c===0?_1468.bytetext:_1468.bytestext;return lang.replace("{0} {1}",[_146c,_146d]);})},status:{label:_1468.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,value,node,_146e){_145c.set(node,"title",item.statusMessage?item.statusMessage:"");_145e.toggle(node,"epi-failedStatus",item.status===_1468.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_145d.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_146f,_1470,_1471,lang,_1472,_1473,_1474,_1475){return _1470("dijit.ProgressBar",[_1473,_1474],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_1475,_indeterminateHighContrastImagePath:_146f.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_1476){lang.mixin(this,_1476||{});var tip=this.internalProgress,ap=this.domNode;var _1477=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_1477=Math.min(parseFloat(this.progress)/100,1);this.progress=_1477*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_1477=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-labelledby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_1477);_1471.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_1477*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(label){this._set("label",label);this.update();},_setIndeterminateAttr:function(_1478){this.indeterminate=_1478;this.update();},report:function(_1479){return this.label?this.label:(this.indeterminate?"&#160;":_1472.format(_1479,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\r\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\r\n</div>","epi/shell/form/uploader/HTML5":function(){define("epi/shell/form/uploader/HTML5",["dojo/_base/declare","dojo/_base/lang","dojox/form/uploader/plugins/HTML5","epi/shell/request/mutators","epi/shell/applicationSettings","epi/shell/XhrWrapper"],function(_147a,lang,HTML5,_147b,_147c,_147d){var _147e=_147a([HTML5],{_headers:null,uploadWithFormData:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},sendAsBinary:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},createXhr:function(){var xhr=this.inherited(arguments),_147f=this._headers;if(_147f){for(var key in _147f){if(_147f.hasOwnProperty(key)){xhr.setRequestHeader(key,_147f[key]);}}}xhr.setRequestHeader(_147c.antiforgeryTokenHeaderName,_147d.sharedXsrfHeader);return xhr;},_getHeadersThenExecute:function(_1480,args){var _1481={options:{headers:{}}};return _147b.execute("beforeSend",_1481).then(lang.hitch(this,function(_1482){this._headers=_1482.options.headers;var _1483=_1480.apply(this,args);this._headers=null;return _1483;}));}});dojox.form.addUploaderPlugin(_147e);return _147e;});},"epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi/shell/TypeDescriptorManager"],function(_1484,_1485,_1486,_1487,_1488,_1489){return _1484([_1485,_1486],{fileList:null,typeIdentifier:"episerver.core.contentfolder",createAsLocalAsset:false,_execute:function(){var _148a=_1488.toContentReference(this._getParentLink()).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_148a.toString(),this.createAsLocalAsset);this.fileList=null;},_getParentLink:function(){var model=this._getModel();if(this.createAsLocalAsset){return model.ownerContentLink?model.ownerContentLink:model.contentLink;}return model.contentLink;},_onModelChange:function(){var model=this._getModel(),_148b=!!model&&_1487.hasProviderCapability(model.providerCapabilityMask,_1487.providerCapabilities.Create)&&_1487.hasAccess(model.accessMask,_1487.accessLevel.Create),_148c=_148b&&_1489.isBaseTypeIdentifier(model?model.typeIdentifier:"",this.typeIdentifier);this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.set("isAvailable",_148c);this.set("canExecute",!!(_148b&&this.viewModel&&!this.viewModel.get("isSearching")));},_getModel:function(){return this.model instanceof Array?this.model.length===1?this.model[0]:null:this.model;}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_148d,_148e,_148f,has,sniff,when,_1490,_1491,_1492,_1493,_1494){return _148d([_1492,_1493],{label:_1494.download,tooltip:_1494.download,iconClass:"epi-iconDownload",_execute:function(){var _1495=this._getContentData();if(!_1495){return;}_1490.download(_1495.downloadUrl,_1495.name);},_onModelChange:function(){var _1496=this._getContentData(),_1497=_1496&&_1496.downloadUrl,_1498=_1496&&_1496.typeIdentifier,_1499=_1498&&_1491.getValue(_1498,"actAsAnAsset"),_149a=!!(_1499&&_1497);this.set("isAvailable",_149a);this.set("canExecute",_149a);},_getContentData:function(){var _149b=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_149b=this.selection.data[0].data;}return _149b;}});});},"epi-cms/asset/command/UploadContentToSelection":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi/shell/TypeDescriptorManager"],function(_149c,_149d,_149e,_149f,_14a0,_14a1,_14a2){return _149c([_149d,_149f,_149e],{fileList:null,typeIdentifier:"episerver.core.contentfolder",createAsLocalAsset:false,_execute:function(){var _14a3=_14a1.toContentReference(this._getParentLink()).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_14a3.toString(),this.createAsLocalAsset);this.fileList=null;},_getParentLink:function(){var model=this._getSingleSelectionData();if(this.createAsLocalAsset){return model.ownerContentLink?model.ownerContentLink:model.contentLink;}return model.contentLink;},_onModelChange:function(){var model=this._getSingleSelectionData(),_14a4=!!model&&_14a0.hasProviderCapability(model.providerCapabilityMask,_14a0.providerCapabilities.Create)&&_14a0.hasAccess(model.accessMask,_14a0.accessLevel.Create),_14a5=_14a4&&_14a2.isBaseTypeIdentifier(model?model.typeIdentifier:"",this.typeIdentifier);this.set("isAvailable",_14a5);this.set("canExecute",!!(_14a4&&this.viewModel&&!this.viewModel.get("isSearching")));},_viewModelSetter:function(value){this.viewModel=value;this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));}});});},"epi-cms/asset/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/DestroyableByKey","epi/shell/DialogService","epi/shell/widget/ContextMenu","epi/shell/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","./view-model/HierarchicalListViewModel","epi/shell/dnd/tree/multiDndSource","dojo/text!./templates/HierarchicalList.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(array,_14a6,lang,_14a7,_14a8,_14a9,_14aa,keys,on,when,_14ab,_14ac,_14ad,_14ae,_14af,_14b0,_14b1,_14b2,_14b3,_14b4,_14b5,_14b6,_14b7,_14b8,_14b9,_14ba,_14bb,res){return _14a6([_14ad,_14ab,_14ac,_14b2,_14b1,_14b3],{contextMenu:null,templateString:_14bb,showRoot:false,showThumbnail:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_14b9,hierarchicalListClass:"",noDataMessages:null,noSearchResultMessage:res.nosearchresults,createContentIcon:"",createContentText:"",dndSource:_14ba,additionalTreeClass:"epi-secondaryGadgetContainer",modelBindingMap:{searchRoots:["searchRoots"],searchArea:["searchArea"],listQuery:["listQuery"],treePaths:["treePaths"],selectedListItems:["selectedListItems"],searchListQuery:["searchListQuery"],noDataMessage:["noDataMessage"]},_setSearchAreaAttr:function(value){this.searchBox.set("area",value);},_setSelectedListItemsAttr:function(value){this.list.grid.clearSelection();(value||[]).forEach(function(_14bc){this.list.grid.select(_14bc.contentLink);},this);this._set("selectedListItems",value);},_setSearchRootsAttr:function(value){this.searchBox.set("searchRoots",value);},_setListQueryAttr:function(value){this.list.set("query",value);},_setNoDataMessageAttr:function(value){this.list.set("noDataMessage",value);},_setSearchListQueryAttr:function(value){this.searchResultList.set("query",value);this._showSearchResults(value);},_setTreePathsAttr:function(value){return this.tree.set("paths",value);},_setShowRootAttr:function(value){this.tree.set("showRoot",value);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _14bd=_14a6(this.modelClassName);this.model=this.commandProvider=new _14bd({componentId:this.componentId,repositoryKey:this.repositoryKey,noDataMessages:this.noDataMessages});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _14b5({category:"context",popupParent:this}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_14a8.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();this._toggleCreateContentArea(this.showCreateContentArea);this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)),this.searchBox.on("searchBoxChange",lang.hitch(this,this._onSearchTextChanged)));},startup:function(){this.inherited(arguments);this.model.startup();if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){var _14be=_14a9.getMarginBox(this.searchBoxNode),_14bf={h:this._contentBox.h-_14be.h,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_14bf);},_toggleCreateContentArea:function(_14c0){_14aa.set(this.createContentArea.domNode,"display",_14c0?"":"none");this.listContainer.layout();},_toggleActive:function(_14c1){var _14c2="epi-list--is-active";var _14c3="epi-tree--is-active";if(_14c1===this.tree){_14a8.replace(this.domNode,_14c3,_14c2);}else{_14a8.replace(this.domNode,_14c2,_14c3);}},_showNotification:function(_14c4){_14b4.alert(_14b0.toHTML(_14c4));},_onSearchTextChanged:function(_14c5){this.model.setSearchText(_14c5);},_showSearchResults:function(_14c6){_14aa.set(this.contentNode,"display",_14c6?"none":"");_14aa.set(this.resultNode,"display",!_14c6?"none":"");this.container.layout();},_setupTree:function(){var _14c7=this.model._commandRegistry;function _14c8(copy){copy?_14c7.copy.command.execute():_14c7.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_14c8),on(this.tree,"paste",function(){_14c7.paste.command.execute();}),on(this.tree,"delete",function(){_14c7["delete"].command.execute();}),_14a7.after(this.tree,"onFocus",function(){this.model.updateTreeCommands();this._toggleActive(this.tree);}.bind(this)),_14a7.after(this.tree.rootNode,"setChildItems",function(_14c9){this.model.updateTreePaths(_14c9);}.bind(this),true));if(this.contextMenu){this.own(on(this.tree,"showContextMenu",this.contextMenu.forceOpen.bind(this.contextMenu)));}this.tree.onLoadDeferred.then(function(){this.own(this.tree.watch("paths",function(_14ca,old,_14cb){this.model.setTreePaths(_14cb);}.bind(this)));}.bind(this));_14c7.rename.command.set("renameDelegate",lang.hitch(this,function(model){this.tree.getNodesByItem(model)[0].edit();}));this.tree.supportedDndSources=[this.tree.dndController,this.list.grid.dndSource];},_setupCreateContentArea:function(){this.createContentAreaButton.set("iconClass",this.createContentIcon);this.createContentAreaButton.set("label",this.createContentText);this.own(this.createContentAreaButton.on("click",lang.hitch(this,"_onCreateAreaClick")));},_setupList:function(){var _14cc=this.model._commandRegistry;this.own(on(this.model,"setPathsAndItems",function(_14cd,_14ce){this.model.set("treePaths",_14cd);this.set("treePaths",_14cd).then(function(){this.model.set("selectedListItems",_14ce);}.bind(this));}.bind(this)),_14a7.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_14cf){when(_14cf,lang.hitch(this,this.editContent));})),this.searchResultList.grid.addKeyHandler(keys.ESCAPE,lang.hitch(this.searchBox,this.searchBox.clearValue)),_14a7.after(this.model.treeStoreModel,"onDeleted",lang.hitch(this,function(items){array.forEach(items,function(item){var _14d0=this.searchResultList.grid.row(item.contentLink);if(_14d0&&_14d0.data){this.searchResultList.grid.removeRow(_14d0);}},this);}),true),_14a7.after(this.list,"onFocus",function(){this.model.updateListCommands();this._toggleActive(this.list);}.bind(this)),on(this.searchResultList,"selectionChanged",function(e){this.model.setSelectedSearchResults(e.selection);}.bind(this)),on(this.list,"selectionChanged",function(e){this.model.setSelectedListItems(e.selection);}.bind(this)),on(this.list.grid.domNode,"dgrid-refresh-complete",function(){var _14d1=this.get("selectedListItems");this.list.grid.clearSelection();if(_14d1){_14d1.forEach(function(item){this.list.grid.select(item.contentLink);},this);}}.bind(this)));this.searchBox.on("keyup",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER){e.preventDefault();this.searchResultList.editSelectedContent();}}));this.searchBox.on("keydown",lang.hitch(this,function(e){if(e.keyCode===keys.DOWN_ARROW||e.keyCode===keys.UP_ARROW){e.preventDefault();this.searchResultList.grid.moveSelection(e.keyCode===keys.UP_ARROW);}}));if(this.model.changeContextOnItemSelection){var _14d2=function(){_14cc.edit.command.execute();};this.own(on(this.list,"itemAction",_14d2),on(this.searchResultList,"itemAction",_14d2));}if(this.showThumbnail){_14a8.add(this.list.grid.domNode,"epi-thumbnailContentList");_14a8.add(this.searchResultList.grid.domNode,"epi-thumbnailContentList");}this.list.set("selectionMode","extended");this.searchResultList.set("selectionMode","extended");this.searchResultList.set("noDataMessage",this.noSearchResultMessage);this._handleListKeyEvents();},_handleListKeyEvents:function(){var _14d3=this.model._commandRegistry,_14d4=this.list;this.own(on(_14d4,"copyOrCut",function copyOrCuthandler(copy){copy?_14d3.copy.command.execute():_14d3.cut.command.execute();}),on(_14d4,"paste",function(){this.tree.focus();_14d3.paste.command.execute();}.bind(this)),on(_14d4,"delete",function(){_14d3["delete"].command.execute();}));},_onCreateAreaClick:function(){},_updateClipboardIndicators:function(name,_14d5,_14d6){var _14d7=this.model.clipboardManager.isCopy();if(_14d5 instanceof Array){array.forEach(_14d5,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);this.searchResultList.toggleCut(clip.data,false);},this);}if(!_14d7&&_14d6 instanceof Array){array.forEach(_14d6,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);this.searchResultList.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi/shell/widget/_FocusableMixin","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(array,_14d8,lang,_14d9,_14da,_14db,json,when,_14dc,_14dd,_14de,_14df,_14e0,_14e1,_14e2,_14e3){return _14d8([_14e2,_14e0],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_14db.around(self.model,"onRefreshRoots",function(_14e4){return function(_14e5){if(_14e5&&typeof self._onItemDelete==="function"){self._onItemDelete(_14e5);}return _14e4.apply(self.model,[_14e5]);};}));},toggleCut:function(item,isCut){var node=this.tree.getNodesByItem(item)[0];if(node){_14da.toggle(node.rowNode,"epi-opacity50",isCut);}},_createTreeModel:function(){return new _14e3({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}array.forEach(node.getChildren(),function(_14e6){_14e6.set({item:lang.mixin(_14e6.item,{isDeleted:true})});this._updateItemDeletedHierachy(_14e6);},this);},_onDeleted:function(item){var nodes=this.getNodesByItem(item);array.forEach(nodes,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _14e7=lang.trim(name),_14e8=this.getNodesByItem(item)[0];if(_14e7){when(this.model.rename(item.contentLink,_14e7)).otherwise(function(ex){_14e8.rollbackLabel(item.name,ex);_14e8.edit();});}else{_14e8.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _14e9=new _14e1(args);_14e9.bindContextMenu(this.contextMenu);this.own(_14e9.on("rename",lang.hitch(this,function(val){this._renameFolder(_14e9.item,val);})));return _14e9;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();},checkAcceptance:function(_14ea,nodes){if(this.tree.supportedDndSources){return this.tree.supportedDndSources.indexOf(_14ea)>=0;}else{return this.inherited(arguments);}}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_14eb,lang,_14ec,_14ed,_14ee,_14ef,_14f0,_14f1,keys,on,when,_14f2,_14f3,_14f4,_14f5,_14f6,epi,_14f7){_14eb("_TreeInlineEditor",[_14f6._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});return _14eb([_14f7,_14f0],{templateString:_14f3,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_14ef.set(this.iconNodeMenu,"zIndex",_14ee.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _14f6({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!==keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_14ed.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,error){if(!this.labelWidget.value){this._resetValue(val);}if(error&&error.length>0){this._setEditorState(error[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _14f1();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _14f1();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_14f8){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _14f9=this._currentRowState;this._currentRowState=_14f8?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_14f9;this._updateStyle();if(_14f8){this.emit("nodeSelected",this);}},setFocusable:function(_14fa){this.inherited(arguments);_14ed.toggle(this.domNode,"epi-folderTreeNode--focused",_14fa);},_updateIndividualLayout:function(){this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_14ed.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_14ed.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");_14ed.add(this.domNode,"epi-folderTreeNode--hovered");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();_14ed.remove(this.domNode,"epi-folderTreeNode--hovered");},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_14fb){var _14fc=this._rowStates;switch(_14fb){case _14fc.SELECTED:case _14fc.ENTERED:if(this.contextMenu){_14ed.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_14ed.remove(this.iconNodeMenu,this._blockFolderMenu);}_14ed.remove(this.iconNode,this._blockFolderExpand);_14ed.remove(this.iconNode,this._blockFolderCollapse);var _14fd=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_14ed.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_14fd);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_14ed.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){if(this._destroyed){return;}for(var _14fe in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_14fe],10)>0){this._updateStyleBySingleState(this._rowStates[_14fe]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_14ec.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_14ff){if(this._editWidget){_14ff=_14f2.encode(_14ff);this._editWidget.invalidMessage=_14ff||"";this._editWidget.set("state",_14ff?"Error":"");this._editWidget.isValid=function(){return !_14ff;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dojo/keys","dojo/on","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi/epi","epi/shell/dgrid/Formatter","epi/shell/dgrid/selection/Extensions","epi/shell/TypeDescriptorManager","epi/shell/widget/_FocusableMixin","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_1500,_1501,lang,_1502,_1503,_1504,_1505,keys,on,_1506,_1507,_1508,_1509,epi,_150a,_150b,_150c,_150d,_150e,_150f,DnD,_1510,_1511){return _1500([_1511,_150d,_1505],{_gridClass:_1500([_1507,_150a,_1508,_150b,DnD,_1506,_1510]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_1502.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(value){if(!this.get("editingItem")){this.set("editingItem",value);}this._set("currentItem",value);this.select(value);},_setNoDataMessageAttr:function(value){this.noDataMessage=value;this.grid.set("noDataMessage",value);},_dndNodeCreator:function(item,hint){var _1512=_150c.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_1512&&this.dndTypes){_1512=this.dndTypes;}return {node:_1503.create("div").appendChild(document.createTextNode(item.name)),type:_1512,data:item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(_1504.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)),this.grid.on("dgrid-contextmenu",lang.hitch(this,"_itemSelected")));this._bindKeys();},_bindKeys:function(){var self=this;function _1513(key,_1514,_1515,_1516){return self.grid.addKeyHandler(key,function(e){if(_1516||_1501.isCopyKey(e)){e.preventDefault();_1515?self.emit(_1514,_1515):self.emit(_1514);}});};this.own(_1513("C".charCodeAt(0),"copyOrCut",true),_1513("X".charCodeAt(0),"copyOrCut",false),_1513("V".charCodeAt(0),"paste"),_1513(keys.DELETE,"delete",undefined,true));},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"&&evt.rows[0].data){this._itemSelected(evt.rows[0].element);}},_itemSelected:function(_1517){var row=this.grid.row(_1517);this.emit("itemSelected",row.data);},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},editSelectedContent:function(){var _1518=this.grid.getFirstSelectedRow();if(!_1518){return;}this.editContent(_1518.data);},_onChangeContext:function(evt){var grid=this.grid;on.once(grid.domNode,"dgrid-refresh-complete",function(evt){grid.focus(grid.getFirstSelectedRow());});this.editContent(grid.row(evt).data);},toggleCut:function(item,isCut){var row;if(item){row=this.grid.row(_150e.toContentReference(item.contentLink).id);if(row&&row.element){_1502.toggle(row.element,"epi-opacity50",isCut);}}}});});},"url:epi-cms/asset/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxNode\">\r\n        <div data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi/shell/widget/SearchBox\"\r\n             data-dojo-props=\"triggerContextChange: this.triggerContextChange, triggerChangeOnEnter: true, encodeSearchText: true\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n\r\n        <div data-dojo-attach-point=\"contentNode\">\r\n            <div class=\"epi-gadgetTopContainer ${additionalTreeClass}\"\r\n                 data-dojo-attach-point=\"tree\"\r\n                 data-dojo-type=\"epi-cms/widget/FolderTree\"\r\n                 data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu, dndSource: this.dndSource\"></div>\r\n            <div class=\"epi-gadgetBottomContainer\"\r\n                 data-dojo-attach-point=\"listContainer\"\r\n                 data-dojo-type=\"dijit/layout/BorderContainer\"\r\n                 data-dojo-props=\"region:'bottom', splitter:true, gutters: false\">\r\n                <div class=\"epi-createContentContainer\"\r\n                     data-dojo-attach-point=\"createContentArea\"\r\n                     data-dojo-type=\"dijit/layout/_LayoutWidget\"\r\n                     data-dojo-props=\"region:'top', splitter:false\">\r\n                    <button type=\"button\" class=\"epi-flat epi-chromeless\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-attach-point=\"createContentAreaButton\"></button>\r\n                </div>\r\n                <div data-dojo-attach-point=\"list\"\r\n                     data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                     data-dojo-props=\"region:'center', splitter:false, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"resultNode\" style=\"display:none\">\r\n            <div data-dojo-attach-point=\"searchResultList\"\r\n                 data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                 data-dojo-props=\"region:'center', splitter:false, store: this.model.searchStore, queryOptions: this.model.searchResultQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/on","dijit/_Widget","dijit/_TemplatedMixin","epi/shell/widget/_ModelBindingMixin","./viewmodel/FilesUploadDropZoneViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_1519,_151a,_151b,on,_151c,_151d,_151e,_151f,_1520,_1521){return _1519([_151c,_151d,_151e],{res:_1520,templateString:_1521,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,validSelection:true,descriptionText:null,settings:null,model:null,modelBindingMap:{descriptionText:["descriptionText"],enabled:["enabled"],validSelection:["validSelection"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _151f();},postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.own(on(this.outsideDomNode,"dragenter",this._onDragEnter.bind(this)),on(this.outsideDomNode,"dragend",this._onDragLeave.bind(this)),on(this.outsideDomNode,"drop",this._onDragLeave.bind(this)));}this.own(on(this.dropArea,"dragover",this._onDragOver.bind(this)),on(this.dropArea,"dragleave",this._onDragLeave.bind(this)),on(this.dropArea,"dragend",this._onDragLeave.bind(this)),on(this.dropArea,"drop",this._onDrop.bind(this)));},_onDragEnter:function(evt){if(!this.enabled){return;}evt.preventDefault();_151a.add(this.domNode,this.dragStartCssClass);},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_151a.remove(this.domNode,this.dragStartCssClass);_151a.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();},onDrop:function(evt,files){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_151a.remove(this.domNode,this.dragStartCssClass);_151a.remove(this.domNode,this.dragOverCssClass);},_setSettingsAttr:function(value){this._set("settings",value);this.model.set("settings",value);},_setValidSelectionAttr:function(value){this._set("validSelection",value);_151a.toggle(this.iconNode,"epi-no-drop",!value);},_setDescriptionTextAttr:{node:"descriptionNode",type:"innerText"}});});},"epi-cms/widget/viewmodel/FilesUploadDropZoneViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone"],function(_1522,lang,_1523,_1524){return _1522([_1523],{settings:null,descriptionText:null,dropFolderName:null,validSelection:null,enabled:null,_descriptionTemplate:null,_settingsSetter:function(value){this.settings=value;if(!value){value=this._getDefaultValue();}this.set("enabled",value.enabled);this.set("validSelection",value.validSelection);this.set("dropFolderName",value.dropFolderName);this.set("_descriptionTemplate",value.descriptionTemplate);this.set("descriptionText",this._getDescription(value));},_getDefaultValue:function(){return {enabled:false,validSelection:false,dropFolderName:null};},_getDescription:function(_1525){if(!_1525.validSelection){return _1524.toomanyfolders;}var _1526=this._descriptionTemplate||_1524.description;return lang.replace(_1526,[_1525.dropFolderName||_1524.defaultfoldername]);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <div class=\"dijitReset dijitInline epi-dropZone\">\r\n        <div data-dojo-attach-point=\"iconNode\" class=\"epi-dropZone-icon\"></div>\r\n        <span data-dojo-attach-point=\"descriptionNode\" class=\"epi-dropZone-text\"></span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dropArea\" class=\"epi-dropZone-overlay\"></div>\r\n</div>\r\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi-cms/ApplicationSettings","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(array,_1527,lang,topic,when,_1528,_1529,_152a,_152b,_152c){return _1527([_152b],{betweenThreshold:5,expandExtraNodeItems:_1528.startPage,allowSorting:true,postMixInProperties:function(){this.inherited(arguments);this.checkAcceptance=lang.hitch(this,this.checkAcceptance);this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);},checkAcceptance:function(_152d,nodes){return _152d===this.tree.dndController;},checkItemAcceptance:function(_152e,_152f,_1530){return this.allowSorting||_1530==="over";},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _1529({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_152c.command.label,resources:_152c});this.commands=array.filter(this.commands,lang.hitch(this,function(_1531){return !(_1531 instanceof _1529);}));this._viewTrashCommand=new _152a({typeIdentifiers:this.typeIdentifiers,order:100});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},_setShowAllLanguagesAttr:function(value){this.inherited(arguments);this.allowSorting=!!value;},getIconClass:function(item,_1532){var _1533=array.some(this.model.roots,function(root){return root===this.model.getIdentity(item);},this);if(_1533){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/DialogService","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(array,_1534,_1535,lang,_1536,topic,when,_1537,_1538,_1539,_153a,_153b,_153c,_153d,_153e,_153f,_1540,_1541,_1542,_1543,_1544,_1545,_1546,_1547,_1548,_1549,_154a,_154b,_154c,_154d,_154e,res){return _1535([_1547,_153e,_153a,_153f],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_1544,nodeConstructor:_1543,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _1539();this.selection=new _153b();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("showContextMenu",this._showContextMenuFromKeyboard.bind(this)),this.on("select",lang.hitch(this,this._onTreeNodeClicked)),this.on("paste",function(){if(this._pasteCommand.get("canExecute")){this._pasteCommand.execute();}}.bind(this)));this.contextRequests=[];this.connect(this,"onClick","_onTreeNodeClicked");var _154f=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_154f);this.subscribe("/dnd/cancel",_154f);},_showContextMenuFromKeyboard:function(e){this._ensureContextMenu();this._contextMenu.forceOpen(e);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_1550){this.contextChanged(_1550);}));},_preparePathNodes:function(paths){var self=this,_1551;array.some(paths,function(_1552,index){var nodes=self.getNodesByItem(_1552),_1553=nodes.length===1&&!nodes[0];if(index>0&&_1553){array.forEach(_1551,function(_1554){if(_1554.state==="LOADED"){_1554._loadDeferred=null;}});return true;}_1551=nodes;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showAllLanguagesCommand=new _1542({model:this});var _1555=this._contextMenuCommandProvider.get("commands");array.some(_1555,lang.hitch(this,function(_1556){if(_1556 instanceof _154a){this._copyCommand=_1556;}else{if(_1556 instanceof _154b){this._cutCommand=_1556;}else{if(_1556 instanceof _154d){this._pasteCommand=_1556;}else{if(_1556 instanceof _154c){this._deleteCommand=_1556;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showAllLanguagesCommand].concat(_1555);},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this.model.set("showAllLanguages",value);this._showAllLanguagesCommand.set("active",!value);},_onTreeNodeClicked:function(page,node,event){var _1557=function(){if(this.contextRequests.length>0){this.contextRequests.push(page);return;}this._requestContextChange(page);this.contextRequests.push(page);}.bind(this);if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_1557,200);},_requestContextChange:function(page){var _1558={typeName:_153c.getResourceValue(page.typeIdentifier,"name"),name:page.name};topic.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(this,{requestedContent:_1558}),forceContextChange:true});},contentContextChanged:function(_1559,_155a){this._dequeueContextRequest(_1559.versionAgnosticUri);var _155b=new _1546(_1559.id),_155c=_155b.createVersionUnspecificReference().toString(),_155d=_1540.wastebasketPage.toString();this.inherited(arguments);if(_155c===_155d){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_155c;if(_155a&&_155a.sender===this&&this.selectedItem&&_155c===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_1559.dataType)){this.selectContent(_155c,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_155e){return this.tree.model.isSupportedType(_155e);},_getSelectionData:function(_155f){return _155f?[{type:"epi.cms.contentdata",data:_155f}]:[];},_updateGlobalToolbarButtons:function(_1560){var node=_1560||this.get("selectedNode"),_1561=node?this._getSelectionData(node.item):[],_1562=this.getCommandModel(node);if(this._createCommand){this._createCommand.set("model",_1562);}this._contextMenuCommandProvider.updateCommandModel(_1562);this.selection.set("data",_1561);},getCommandModel:function(_1563){return _1563&&_1563.item;},contextChangeFailed:function(_1564,_1565,_1566){this.inherited(arguments);if(_1564){this._dequeueContextRequest(_1565.uri);if(_1566&&_1566.sender===this){this.selectContent(_1564.contentLink);}}},_dequeueContextRequest:function(uri){var _1567=-1;this.contextRequests.some(function(_1568,i){if(_1568.uri===uri){_1567=i;return true;}});if(_1567!==-1){this.contextRequests.splice(_1567,1);}if(this.contextRequests.length>0){this._requestContextChange(this.contextRequests[0],this);}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_1536.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_1536.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(value){this._removeHighlightClass();this._focusNode=value;},_ensureContextMenu:function(){if(!this._contextMenu){this.own(this._contextMenu=new _1548({leftClickToOpen:true,category:"context",popupParent:this}),_1534.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_1534.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}},_showContextMenu:function(evt){this._ensureContextMenu();this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _1569=this.inherited(arguments);_1569.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _1569;},getIconClass:function(item,_156a){var _156b=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _156b;}var _156c="";switch(item.properties.pageShortcutType){case _1541.pageShortcutTypes.Shortcut:_156c="epi-iconObjectInternalLink";break;case _1541.pageShortcutTypes.External:_156c="epi-iconObjectExternalLink";break;case _1541.pageShortcutTypes.Inactive:_156c="epi-iconObjectNoLink";break;case _1541.pageShortcutTypes.FetchData:_156c=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _156c?_156b+" "+_156c:_156b;},enableDrop:function(node,_156d){node._droppable=_156d;},_showNotificationMessage:function(_156e){_153d.alert(_1538.toHTML(_156e));},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_156f,lang,when,_1570,_1571,_1572,_1573,_1574){return _156f([_1573],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_1572.currentContentLanguage;this.store=this.store||_1571.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(){this.set("label",_1574.showonlycontentin);}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(value){this.set("canExecute",value);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/Evented","dojo/mouse","dojo/on","dojo/text!./templates/_ContentNavigationTreeNode.html","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(array,_1575,event,lang,_1576,_1577,_1578,mouse,on,_1579,_157a,_157b,_157c,_157d,_157e,_157f,_1580,_1581,res){return _1575([_1580,_157d,_1578],{templateString:_1579,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _1582=_157b.resolve("epi.storeregistry");this._contentTypeStore=_1582.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _1581({contentStatus:this.item.status}));},modelBindingMap:{statusIcon:["statusIcon"],statusMessage:["statusMessage"]},_setStatusMessageAttr:function(_1583){_1576.set(this.iconNodeStatus,"title",_157c.toTooltipText(_1583));},_setStatusIconAttr:function(_1584){if(!(_1584 instanceof Array)){return;}_1577.remove(this.iconNodeStatus);_1577.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");array.forEach(_1584,function(_1585){_1577.add(this.iconNodeStatus,_1585);},this);},setSelected:function(_1586){this.inherited(arguments);if(this.hasContextMenu){_1577.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_1586);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_1577.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){event.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){event.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask===1){_1577.add(this.iconNodeAccess,this._pageLocked);_1576.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_1577.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_1577.add(this.iconNodeAccess,this._pageBeingEdited);var _1587=[this.res.tooltip.beingedited];array.forEach(this.item.inUseNotifications,function(_1588){var date=_157a.toUserFriendlyString(new Date(_1588.created));_1587.push(_1588.userName+", "+date);},this);_1576.set(this.iconNodeAccess,"title",_1587.join("\n"));}else{_1577.remove(this.iconNodeAccess,this._pageBeingEdited);_1577.remove(this.iconNodeAccess,this._pageLocked);_1576.set(this.iconNodeAccess,"title","");_1577.remove(this.contentNode,"epi-treeReadOnly");}}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_1589,_158a,_158b,_158c,_158d){return _1589(_158d,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _158e="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_158b.encode(row.label);row.text=_158b.encode(row.text);}if(!row.text){_158e+="<li class='dojoxEllipsis'>"+_158a.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_158e+="<li class='dojoxEllipsis'>"+_158a.substitute(this.tooltipRowTemplate,row)+"</li>";}}_158e+="</ul>";return _158e;}return this.inherited(arguments);}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../plugin-area/navigation-tree","../widget/CreateCommandsMixin","epi/shell/command/_SelectionCommandMixin","epi/shell/selection"],function(_158f,_1590,_1591,_1592,_1593,_1594,_1595,_1596,_1597,_1598,_1599,_159a){return _158f([_1591,_1598,_1590],{treeModel:null,clipboardManager:null,_settings:null,constructor:function(_159b){_158f.safeMixin(this,_159b);this.own(_1597.on("added, removed",this._updateCommands.bind(this)));},postscript:function(){this.inherited(arguments);this._updateCommands();},updateCommandModel:function(_159c){this.get("commands").forEach(function(_159d){if(!_159d.isInstanceOf(_1599)){_159d.set("model",_159c);}});this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:_159c}]);},_updateCommands:function(){this.get("commands").forEach(function(_159e){if(typeof _159e.destroy==="function"){_159e.destroy();}});this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _159a()};var _159f=this.getCreateCommands(),_15a0=[];for(var key in _159f){_15a0.push(_159f[key].command);}_15a0.push(new _1595({category:"context"}),new _1593(this._settings),new _1592(this._settings),new _1594(this._settings),new _1596(this._settings));_1597.get().forEach(function(_15a1){_15a1.category="context";_15a0.push(_15a1);});this.set("commands",_15a0);}});});},"epi-cms/plugin-area/navigation-tree":function(){define(["epi/PluginArea","epi-cms/content-approval/command/EditApprovalDefinition"],function(_15a2,_15a3){var _15a4=new _15a2("epi-cms/navigation-tree/commands[]");_15a4.add(_15a3);return _15a4;});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/DialogService","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_15a5,lang,epi,_15a6,_15a7,_15a8,_15a9,_15aa,_15ab,_15ac,_15ad,_15ae,_15af,_15b0){return _15a5([_15af,_15a7,_15ac],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_15a6.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _15b1=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_15b1,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _15b2=[new _15a9({label:_15b0.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _15a8({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_15b2);this.fetchData();},_setOnlyShowMyChangesAttr:function(value){this._set("onlyShowMyChanges",value);if(this._started){this._saveSettingComponent("onlyShowMyChanges",value);}},fetchData:function(){var query=this._getQuery();this.grid.set("query",query.query,query.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _15b3={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,value,node,_15b4){node.innerHTML=_15ad.getVersionStatus(value);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_15b3.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _15b3;},_saveSettingComponent:function(type,value){var item=this._componentsController.getComponentDefinition(this.id),query;if(item){item.settings.onlyShowMyChanges=value;var saved=this._componentsController.saveComponents([item]);saved.then(function(done){},function(){_15ab.alert(_15b0.errormessage);});query=this._getQuery();this.grid.query=query.query;this.grid.queryOptions=query.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_15b5){this.grid.clearSelection();var _15b6=new _15ae(_15b5.id).createVersionUnspecificReference().toString();var row=this.grid.row(_15b6);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-geometry","dojo/dom-class","dojo/on","epi-cms/asset/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(array,_15b7,lang,_15b8,_15b9,_15ba,_15bb,on,_15bc,_15bd,_15be,res,_15bf){return _15b7([_15bc],{showCreateContentArea:false,modelClassName:_15bd,noDataMessages:_15be.nodatamessages,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,postMixInProperties:function(){this.inherited(arguments);this.modelBindingMap.showAllLanguages=["showAllLanguages"];},buildRendering:function(){this.inherited(arguments);var self=this;this.own(_15b8.after(this.list.grid,"renderQuery",function(_15c0){return _15c0.then(function(_15c1){var _15c2=_15c1.length>0?false:self.model.getCommand("newBlockDefault").get("canExecute");self._toggleCreateContentArea(_15c2);});}));var link=_15b9.create("a",{"class":"epi-visibleLink",innerHTML:_15bf.showalllanguages});this.own(on(link,"click",function(){this.model.set("showAllLanguages",true);}.bind(this)));this.bottomLinkContainer=_15b9.toDom("<div class=\"epi-gadget-bottom-container dijitHidden\"></div>");_15b9.place(link,this.bottomLinkContainer);_15b9.place(this.bottomLinkContainer,this.domNode);},layout:function(){var _15c3=_15bb.contains(this.bottomLinkContainer,"dijitHidden")?0:_15ba.getMarginBox(this.bottomLinkContainer).h;var _15c4=_15ba.getMarginBox(this.searchBoxNode),_15c5={h:this._contentBox.h-_15c4.h-_15c3,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_15c5);},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.newBlockDefault.command.execute();},_setShowAllLanguagesAttr:function(_15c6){this._set("showAllLanguages",_15c6);_15bb.toggle(this.bottomLinkContainer,"dijitHidden",_15c6);if(this._contentBox){this.layout();}}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","../asset/view-model/HierarchicalListViewModel","epi-cms/component/_ShowAllLanguagesMixin","./command/NewBlock","epi-cms/command/ShowAllLanguages"],function(_15c7,lang,when,_15c8,_15c9,_15ca,_15cb){return _15c7([_15c8,_15c9],{_selectedTreeItemsSetter:function(_15cc){this._commandRegistry.newBlockDefault.command.set("model",_15cc);this.inherited(arguments);},_setupCommands:function(){this.inherited(arguments);this.showAllLanguagesCommand=new _15cb({model:this});this._setupShowAllLanguages();var _15cd={newBlockDefault:{command:new _15ca({viewModel:this})},allLanguages:{command:this.showAllLanguagesCommand,order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_15cd);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);},_setupShowAllLanguages:function(){when(this._isSiteMultilingual()).then(function(_15ce){if(!_15ce){return;}this.loadShowAllLanguages().then(function(value){this.set("showAllLanguages",value);this.showAllLanguagesCommand.set("active",!value);}.bind(this));}.bind(this));},_showAllLanguagesSetter:function(value){var _15cf=this.showAllLanguages;this.inherited(arguments);if(_15cf!==value){this.saveShowAllLanguages(value);this.showAllLanguagesCommand.set("active",!value);}}});});},"epi-cms/component/command/NewBlock":function(){define(["dojo/_base/declare","epi/shell/DestroyableByKey","epi-cms/command/NewContent","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_15d0,_15d1,_15d2,_15d3){return _15d0([_15d2,_15d1],{contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_15d3.command.label,resources:_15d3,viewModel:null,_onModelChange:function(){this.destroyByKey("isSearchingWatch");this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.inherited(arguments);},_canExecute:function(){var _15d4=this.inherited(arguments);return _15d4&&!this.viewModel.get("isSearching");}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi/Url","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_15d5,_15d6,lang,array,when,_15d7,_15d8,_15d9,Url,_15da,_15db,_15dc,_15dd,_15de,Tree,_15df){return _15d5([_15d8,_15dd],{profile:null,buildRendering:function(){this.inherited(arguments);_15d7.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _15e0=_15dc.resolve("epi.storeregistry");var store=_15e0.get("epi.cms.sitestructure");this.profile=this.profile||_15dc.resolve("epi.shell.Profile");var model=this._treeModel=new _15da({store:store});var _15e1=new _15de({category:"setting",label:_15df.showalllanguages,model:model,property:"showAllLanguages"});this.commands.push(_15e1);this._tree=new Tree({model:model,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _15e2=item.editUrl;if(array.some(item.hosts,function(host){return host===window.location.host;})){var _15e3=new Url(_15e2);_15e3.scheme=window.location.protocol.replace(":","");_15e3.authority=window.location.host;_15e2=_15e3.toString();}window.location.replace(_15e2);});}}),_createTreeNode:function(args){return new _15db(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_15d9.show(_15df.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_15d9.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_15d6.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_15e4){this._tree.set("path",["root",_15e4.currentSite,_15e4.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_15e5,_15e6,_15e7){return _15e5([_15e7],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_15e6.add(this.domNode,"epi-st-disabledRow");}else{_15e6.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_15e6.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","./viewmodels/TasksViewModel","epi-cms/component/ContentQueryGrid","epi/shell/form/CategorizedSelect","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_15e8,lang,_15e9,_15ea,topic,_15eb,_15ec,_15ed,_15ee,epi,_15ef,_15f0,_15f1,_15f2,_15f3){return _15e8([_15ec,_15ed,_15eb,_15ee],{templateString:_15f2,resources:_15f3,querySelection:null,model:null,_selectionChangedEventHandler:null,buildRendering:function(){this.inherited(arguments);this.model=new _15ef({categories:this.categories});this.querySelection=new _15f1({name:"QuerySelection",options:this.model.getOptions()});_15e9.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),topic.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},startup:function(){this.inherited(arguments);this._reloadQuery();},resize:function(_15f4){this.inherited(arguments);this.contentQuery.resize(this._calculateContentQuerySize(_15f4));},_calculateContentQuerySize:function(_15f5){var _15f6=_15ea.getMarginBox(this.toolbar);return {w:_15f5.w,h:_15f5.h-_15f6.h};},_reloadQuery:function(){var _15f7=this.querySelection.get("value");var query=this.model.getQuery(_15f7);if(query){this.contentQuery.set("ignoreVersionWhenComparingLinks",!query.versionSpecific);}this.contentQuery.set("queryName",_15f7);}});});},"epi-cms/component/viewmodels/TasksViewModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_15f8,_15f9){return _15f8([_15f9],{categories:null,getOptions:function(){var _15fa=this._convert(this.categories);this._selectFirstItem(_15fa);return _15fa;},getQuery:function(_15fb){var _15fc=null;this.categories.some(function(_15fd){return _15fd.queries.some(function(query){if(query.name===_15fb){_15fc=query;return true;}});});return _15fc;},_selectFirstItem:function(_15fe){var _15ff=_15fe.length>0&&_15fe[0].category;if(_15ff){var item=_15fe[1];if(item){item.selected=true;}}},_convert:function(_1600){var _1601=[];_1600.forEach(function(_1602){if(_1602.displayName){_1601.push({category:true,label:_1602.displayName});}_1602.queries.forEach(function(query){_1601.push({label:query.displayName,value:query.name});});});return _1601;}});});},"epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_1603,lang,when,_1604,_1605,_1606){return _1603([_1606],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _1607=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,value,node,_1608){node.innerHTML=_1605.getVersionStatus(value);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_1607,this.domNode);this.grid.set("showHeader",false);this.own(_1604.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_1609){this.set("currentItem",_1609);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:false}]});var _160a=this.queryParameters||{};_160a.query=this.queryName;this.grid.set("query",_160a);},_setQueryNameAttr:function(value){this.queryName=value;this.fetchData();}});});},"epi/shell/form/CategorizedSelect":function(){define("epi/shell/form/CategorizedSelect",["dojo/_base/declare","./CategoryMenuItem","dijit/form/Select"],function(_160b,_160c,_160d){return _160b([_160d],{baseClass:"epi-categorized-select- dijitSelect dijitValidationTextBox",_getMenuItemForOption:function(_160e){if(_160e.category){return new _160c({ownerDocument:this.ownerDocument,label:_160e.label});}return this.inherited(arguments);}});});},"epi/shell/form/CategoryMenuItem":function(){define("epi/shell/form/CategoryMenuItem",["dojo/_base/declare","dojo/dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_Contained"],function(_160f,dom,_1610,_1611,_1612){return _160f([_1610,_1611,_1612],{baseClass:"dijitMenuItemGroup",templateString:"<tr class=\"dijitMenuItemGroup\"><td colspan=\"4\" data-dojo-attach-point=\"containerNode\"></td></tr>",_setLabelAttr:{node:"containerNode",type:"innerHTML"},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.domNode,false);},isFocusable:function(){return false;}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\r\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\r\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\r\n    </div>\r\n</div>\r\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_1613,_1614,_1615,_1616,_1617,_1618,Trash,_1619){return _1613([_1615,_1616,_1617,_1618],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _1619());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dojox/html/entities","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/DialogService","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi-cms/widget/command/DeleteContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(array,_161a,lang,_161b,_161c,_161d,_161e,_161f,_1620,_1621,_1622,_1623,_1624,_1625,_1626,_1627,_1628,_1629,_162a,_162b,_162c,_162d,_162e,_162f,_1630){return _161a([_1620,_1621,_1622,_1626,_161d],{resources:_162f,templateString:_1630,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{contentStore:["store"],queryOptions:["queryOptions"],actionResponse:["actionResponse"],trashes:["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_1631,_1632){this.model.set("currentTrash",_1632.trash);}));this._restoreContentCommand=new _162d({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_162b(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("restoreItem",this._onRestoreItemClick);this.on("deleteItem",this._onDeleteItemClick);},_setTrashesAttr:function(_1633){this.tabContainer.destroyDescendants();var _1634=[];array.forEach(_1633,function(trash){if(trash&&trash.active){this._addTrash(trash);var _1635=new _162c({hasDeleteAccess:trash.hasDeleteAccess,label:trash.name,tooltip:trash.name,trashId:trash.wasteBasketLink,model:this.model});_1634.push(_1628(_1635,null,{title:_162f.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(trash.name),onShow:lang.hitch(this,function(){var _1636=this.tabContainer.selectedChildWidget.getChildren()[0];_1636.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_1634);if(_1633&&_1633.length===1){_161b.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(trash){var _1637=null;if(trash.active){trash.isRequireLoad=true;var item=new _1624({title:trash.name,trash:trash});this.tabContainer.addChild(item);if(this._isSelected(trash)){_1637=item;}}if(_1637){this.tabContainer.selectChild(_1637);}},_isSelected:function(trash){var _1638=false;array.some(trash.typeIdentifiers,lang.hitch(this,function(_1639){return array.some(this.typeIdentifiers,function(type){if(_1639===type){_1638=true;return false;}});}));return _1638;},_setQueryOptionsAttr:function(_163a){if(_163a){var _163b=this.tabContainer.selectedChildWidget;if(_163b){var _163c=this.get("store"),_163d=null;if(_163b.itemListId){_163d=_1625.byId(_163b.itemListId);_163d.set("queryOptions",_163a);}else{_163d=new _1629({queryOptions:_163a,store:_163c,model:this.model});_163d.on("restoreItem",lang.hitch(this,function(row){this.emit("restoreItem",row);}));_163d.on("deleteItem",lang.hitch(this,function(row){this.emit("deleteItem",row);}));_163d.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_163b.set("content",_163d);_163b.itemListId=_163d.id;}}}},_setActionResponseAttr:function(_163e){if(!_163e){return;}this._showNotificationMessage(_163e);},_showNotificationMessage:function(_163f){if(_163f instanceof Array){_1627.alertWithErrors({},_163f);}else{_1627.alert(_163f?_163f:"");}},_onRestoreItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeleteItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){var _1640=_1628(new _162e({model:this.model,contentId:row.data.contentLink}),null,{title:_162f.singledelete.dialog.title,description:lang.replace(_162f.singledelete.dialog.description,[_161f.encode(row.data.name)])});_1640._execute();}},_onSearchBoxChange:function(_1641){var _1642=this.model.get("currentTrash");_1642.queryText=_1641;_1642.isRequireLoad=true;this.model.set("currentTrash",_1642);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(array,_1643,lang,_1644,_1645,_1646,_1647,_1648,_1649,keys,_164a,query,html,_164b,_164c,when,_164d,_164e,_164f,_1650,_1651,_1652,_1653,_1654,Tree,_1655,_1656,put,epi,_1657,_1658,_1659,_165a,_165b,_165c,_165d,_165e,_165f,_1660,_1661){return _1643([_164d,_164e,_164f,_164a,_164b,_165c],{resources:_1660,epi:epi,templateString:_1661,_grid:null,_observers:{},_setQueryOptionsAttr:function(_1662){this._set("queryOptions",_1662);this._initialize();},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_1663){this.emit("searchBoxChange",_1663);}));},resize:function(){if(this._grid){var top=_1647.position(this._grid.domNode).y;var _1664=_1647.position(_1644.body()).h;_1648.set(this._grid.domNode,"height",(_1664-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_1646.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},_createGrid:function(store,_1665){var _1666=_1643([_1652,_1653,_1654,_1658,_1655]);var grid=new _1666({store:store,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_1659.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_1659.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _1651({target:grid.domNode,color:"#fff",zIndex:500}).placeAt(document.body);this._standby.startup();this.own(_1649.after(grid,"expand",function(_1667){var row=_1667.element?_1667:grid.row(_1667),_1668=query(row.element).parent()[0];if(_1668){_1648.set(_1668,"height","");}},true));_1649.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_1649.before(grid,"adjustRowIndices",function(_1669){if(_1669){array.forEach(query("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_1649.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_1649.before(grid,"renderArray",lang.hitch(this,function(_166a,_166b,_166c){var _166d=this.queryOptions.query;if(_166d&&_166d.query==="searchdeletedcontent"){_166a.map(function(_166e){if(_166e){_166e.hasChildren=false;}});}}));if(_1665){grid.set("queryOptions",_1665.options);grid.set("query",_1665.query);}var _166f="epi-dgrid-mouseover";grid.on(_1656.enterRow,function(evt){_1645.add(this,_166f);});grid.on(_1656.leaveRow,function(evt){_1645.remove(this,_166f);});grid.on(".epi-gridRestoreAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("restoreItem",row);}));grid.on(".epi-gridDeleteAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("deleteItem",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("restoreItem",row);}}));return grid;},_renderTreeNode:function(_1670,data,td,_1671){var title=_1659.htmlEncode(_165f.title(data,_1670.contentLink,_1670.contentTypeName));if(_1670.thumbnailUrl){_1646.create("img",{src:_1670.thumbnailUrl+_164c.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_1646.place(_1659.ellipsis(_1659.htmlEncode(data),title),td);}else{var _1672=_165a.getValue(_1670.typeIdentifier,"iconClass")||"epi-iconObjectPage";_1646.place(_1659.icon(_1672+" epi-objectIcon",_1659.ellipsis(_1659.htmlEncode(data),title)),td);}},_renderActionMenu:function(value){var _1673=lang.replace("<a class=\"epi-gridAction epi-gridRestoreAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_1660.restore.tooltip,label:_1660.restore.label});var _1674=lang.replace("<a class=\"epi-gridAction epi-gridDeleteAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_1660.singledelete.tooltip,label:_1660.singledelete.label});return _1673+_1674;},_localizeDate:function(value){return _165d.toUserFriendlyString(value);},_createUserFriendlyUsername:function(name){return _165e.toUserFriendlyString(_1659.htmlEncode(name));},_showStandby:function(_1675){if(!this._standby){return;}if(_1675){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_1660.trashitemempty+"</span></span>";},_aroundInsertRow:function(_1676){return lang.hitch(this,function(_1677,_1678,_1679,i,_167a){var row=_1676.apply(this._grid,arguments);if(_1677&&_1677.thumbnailUrl){_1645.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/extensions/ColumnResizer":function(){define(["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_167b,_167c,query,lang,dom,geom,has,_167d,put){function _167e(table,span,_167f,_1680,id){for(var i=1;i<span;i++){table[_167f+i][_1680]=id;}};function _1681(_1682){var i=_1682.length,l=i,_1683=_1682[0].length,table=new Array(i);while(i--){table[i]=new Array(_1683);}var _1684={};for(i=0;i<l;i++){var row=table[i],_1685=_1682[i];for(var j=0,js=0;j<_1683;j++){var cell=_1685[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_167e(table,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_167e(table,cell.rowSpan,i,j,cell.id);}}}_1684[cell.id]=_1682[0][j].id;js++;}}return _1684;};function _1686(grid,colId,width,_1687,_1688){if(width<=0){return;}var _1689=grid.columns[colId],event,rule;if(!_1689){return;}event={grid:grid,columnId:colId,width:width,bubbles:true,cancelable:true};if(_1687){event.parentType=_1687;}if(!grid._resizedColumns||_167c.emit(grid.headerNode,"dgrid-columnresize",event)){if(width==="auto"){delete _1689.width;}else{_1689.width=width;width+="px";}rule=grid._columnSizes[colId];if(rule){rule.set("width",width);}else{rule=_167d.addCssRule("#"+_167d.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_167d.escapeCssIdentifier(colId,"-"),"width: "+width+";");}grid._columnSizes[colId]=rule;if(_1688!==false){grid.resize();}return true;}};var _168a,_168b=0;var _168c={create:function(){_168a=put("div.dgrid-column-resizer");},destroy:function(){put(_168a,"!");_168a=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_168a.style.top=pos.y+"px";_168a.style.height=pos.h+"px";put(document.body,_168a);},move:function(x){_168a.style.left=x+"px";},hide:function(){_168a.parentNode.removeChild(_168a);}};return _167b(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_168b++){_168c.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_168b){_168c.destroy();}},resizeColumnWidth:function(colId,width){return _1686(this,colId,width);},configStructure:function(){var _168d=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _168d){if(!(k in this._columnSizes)){_168d[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_168e){this.inherited(arguments);var colId=_168e.id,rule;if("width" in _168e){if((rule=this._oldColumnSizes[colId])){rule.set("width",_168e.width+"px");}else{rule=_167d.addCssRule("#"+_167d.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_167d.escapeCssIdentifier(colId,"-"),"width: "+_168e.width+"px;");}this._columnSizes[colId]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var assoc;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){assoc=lang.mixin(assoc||{},_1681(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){assoc=_1681(this.subRows);}}var _168f=query(".dgrid-cell",grid.headerNode),i=_168f.length;while(i--){var _1690=_168f[i],id=_1690.columnId,col=grid.columns[id],_1691=_1690.childNodes,_1692;if(!col||col.resizable===false){continue;}var _1693=put("div.dgrid-resize-header-container");_1690.contents=_1693;while(_1691.length>0){put(_1693,_1691[0]);}_1692=put(_1690,_1693,"div.dgrid-resize-handle.resizeNode-"+_167d.escapeCssIdentifier(id,"-"));_1692.columnId=assoc&&assoc[id]||id;}if(!grid.mouseMoveListen){_167c(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_167c.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_167d.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_167c.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_1694){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=query(".dgrid-column-"+_167d.escapeCssIdentifier(_1694.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(e);_168c.show(this);},_resizeMouseUp:function(e){var _1695=this._columnSizes,_1696,_1697,_1698;if(this.adjustLastColumn){_1698=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_1696=query(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_1696=_1696.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _1695);});}else{if(this.subRows&&this.subRows.length>1){_1696=_1696.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _1695);});}}_1697=_1696.map(function(_1699){return _1699.offsetWidth;});_1696.forEach(function(_169a,i){_1686(this,_169a.columnId,_1697[i],null,false);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,delta=this._getResizeMouseLocation(e)-this._startX,_169b=cell.offsetWidth+delta,obj=this._getResizedColumnWidths(),_169c=obj.totalWidth,_169d=obj.lastColId,_169e=query(".dgrid-column-"+_167d.escapeCssIdentifier(_169d,"-"),this.headerNode)[0].offsetWidth;if(_169b<this.minWidth){_169b=this.minWidth;}if(_1686(this,cell.columnId,_169b,e.type)){if(cell.columnId!=_169d&&this.adjustLastColumn){if(_169c+delta<_1698){_1686(this,_169d,"auto",e.type);}else{if(_169e-delta<=this.minWidth){_1686(this,_169d,this.minWidth,e.type);}}}}_168c.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _169f=this._getResizeMouseLocation(e),delta=_169f-this._startX,width=this._targetCell.offsetWidth,left=_169f;if(width+delta<this.minWidth){left=this._startX-(width-this.minWidth);}_168c.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _16a0=0,_16a1=query((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode);var i=_16a1.length;if(!i){return {};}var _16a2=_16a1[i-1].columnId;while(i--){_16a0+=_16a1[i].offsetWidth;}return {totalWidth:_16a0,lastColId:_16a2};}});});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>\r\n","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_16a3,_16a4,_16a5,_16a6,_16a7,_16a8){return _16a3([_16a4],{resources:_16a8,_setCommandsAttr:function(_16a9){this._set("commands",_16a9);this._bindEmptyTrashMenu(_16a9);},_bindEmptyTrashMenu:function(_16aa){this.destroyDescendants();if(!_16aa||_16aa.length<1){return;}var _16ab=_16aa.length>1;var _16ac=null;if(_16ab){_16ac=new _16a6({settings:{label:_16a8.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_16ac=new _16a5({settings:{label:_16a8.emptytrash.title}});this.commands[0].label=_16a8.emptytrash.title;}new _16a7({configuration:[{builder:_16ac,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/DialogService","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_16ad,_16ae,lang,_16af,when,_16b0,_16b1,_16b2,_16b3,_16b4,_16b5,_16b6,_16b7){return function(model){var _16b8=function(title,_16b9,_16ba){return _16b4.confirmation({description:_16b1.toHTML(_16b9),title:_16b1.toHTML(title)}).then(function(){return _16ba;});};var _16bb=function(_16bc){var _16bd=_16b0.resolve("epi.cms.contentRepositoryDescriptors");var _16be=[];_16bd.list().forEach(function(key){_16bd.get(key).containedTypes.forEach(function(type){if(_16b2.isBaseTypeIdentifier(_16bc,type)){_16be=_16be.concat(_16bd.get(key).containedTypes);}});});return _16be;};var _16bf=function(_16c0,roots,_16c1){var df=new _16ae(),_16c2=_16b7.restore.dialog,_16c3=_16b2.getValue(_16c0.typeIdentifier,"containerTypes"),_16c4={showButtons:false,roots:roots,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_16c3||_16bb(_16c0.typeIdentifier),selectedContentType:_16c0.typeIdentifier,showAllLanguages:true};var _16c5=new _16b5(_16c4);var _16c6=new _16b3({title:_16b1.toHTML(_16c2.title),description:_16c1||_16b1.toHTML(_16c2.description),confirmActionText:_16b1.toHTML(_16b7.restore.label),content:_16c5});var _16c7=function(value){when(model.contentStore.query({id:value}),function(_16c8){_16c6.onActionPropertyChanged({name:"ok"},"disabled",!_16c8);});};_16c5.on("change",function(value){if(value){_16c7(value);}else{_16c6.onActionPropertyChanged({name:"ok"},"disabled",true);}});_16c6.on("execute",function(){df.resolve(_16c5.get("value"));});_16c6.on("onHide",function(){df.cancel();});_16c6.show();_16c5.onChange(null);return df;};var _16c9=function(_16ca,_16cb){var _16cc=_16b6.action.Create,_16cd=_16b6.providerCapabilities.Create,_16ce=_16cb&&!(_16cb.isWastebasket||_16cb.isDeleted)&&_16b6.isActionAvailable(_16cb,_16cc,_16cd,true,true);if(!_16ce){_16b4.alert(_16b1.toHTML(_16b7.restore.userdonothavepermission));return false;}return true;};var _16cf=function(_16d0){var _16d1=_16b0.resolve("epi.cms.contentRepositoryDescriptors");var roots=[];_16d1.list().forEach(function(key){var _16d2=_16d1.get(key);_16d2.containedTypes.forEach(function(type){if(_16b2.isBaseTypeIdentifier(_16d0.typeIdentifier,type)){_16d2.roots.forEach(function(root){if(roots.indexOf(root)===-1){roots.push(root);}});}});});return roots;};var _16d3=function(model,_16d4,_16d5,_16d6,_16d7,_16d8){var _16d9;if(!_16d7||!model||!_16d4){return false;}if(_16d6&&_16d5){_16d9=_16b8(_16b7.restore.label,_16b7.restore.confirmquestion,_16d5);}else{_16d9=_16bf(_16d4,_16cf(_16d4),_16d8);}when(_16d9,function(_16da){when(model.contentStore.get(_16da),function(_16db){if(!_16c9(_16d4,_16db)){return false;}return _16d7.apply(model,[_16d4,_16da]);});},function(){return false;});};_16af.around(model,"restore",function(_16dc){return function(_16dd,_16de){return when(model.contentStore.query({id:_16dd.contentLink}),lang.hitch(this,function(_16df){var _16e0=null;var _16e1=null;if(_16df.hasOwnProperty("statusCode")&&(_16df.statusCode===401||_16df.statusCode===403)){_16e0=_16b1.toHTML(_16b7.restore.userdonothavepermission);}if(_16df.hasOwnProperty("isDeleted")&&!_16df.isDeleted){_16e0=_16b1.toHTML(_16b7.restore.contentalreadyrestored);_16e1=function(){model.updateTrash(model.get("currentTrash"));};}if(_16e0){_16b4.alert(_16e0).then(_16e1);return false;}var _16e2=model.get("currentTrash");if(_16df.parentLink!==_16e2.wasteBasketLink){return when(_16bf(_16df,_16cf(_16df)),function(_16e3){when(model.contentStore.get(_16e3),function(_16e4){if(!_16c9(_16df,_16e4)){return false;}return _16dc.apply(model,[_16df,_16e3]);});},function(){return false;});}else{return when(model.getOldParent(_16df.contentLink),function(_16e5){var _16e6=_16e5?_16e5.contentLink:null;_16d3(model,_16df,_16e6,_16e6!=null,_16dc);});}}),lang.hitch(this,function(error){_16b4.alert(_16b1.toHTML(_16b7.restore.contentdeletedpermanently)).then(function(){model.updateTrash(model.get("currentTrash"));});return false;}));};});return model;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_16e7,_16e8){return _16e7([_16e8],{label:null,tooltip:null,hasDeleteAccess:false,trashId:null,_execute:function(){this.model.emptyTrash(this.trashId);},_onModelChange:function(){var _16e9=this.model&&this.hasDeleteAccess&&!!this.trashId;this.set("canExecute",_16e9);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_16ea,_16eb){return _16ea([_16eb],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _16ec=!!this.model;this.set("canExecute",_16ec);}});});},"epi-cms/widget/command/DeleteContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_16ed,_16ee){return _16ed([_16ee],{contentId:null,_execute:function(){this.model.deleteContent(this.contentId);},_onModelChange:function(){var _16ef=this.model&&!!this.contentId;this.set("canExecute",_16ef);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\r\n    <div class=\"epi-listingTopContainer\">\r\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n        <div class=\"epi-mediumButton epi-button--bold epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\r\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"stackContainer\">\r\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_16f0,lang,topic,when,_16f1,json,epi,_16f2,_16f3,_16f4){return _16f0([_16f1],{resources:_16f4,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,contentService:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_16f3.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.contentService=this.contentService||_16f3.resolve("epi.cms.ContentHierarchyService");this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=this._contentRepositoryDescriptors||_16f3.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var store=this.storeRegistry.get("epi.cms.content.light"),model=this;var _16f5=epi.delegate(store,{getChildren:function(_16f6,_16f7){var _16f8=model.get("currentTrash"),_16f9=model._createQueryOptions(_16f8);lang.mixin(_16f9.query,{referenceId:_16f6.contentLink});return this.query(_16f9.query,_16f9.options);},mayHaveChildren:function(_16fa){return _16fa.hasChildren;}},["notify"]);return _16f5;},_createTrashes:function(){when(this.trashStore.query(),function(_16fb){this.set("trashes",lang.clone(_16fb));}.bind(this));},_currentTrashSetter:function(trash){this.currentTrash=trash;if(trash.isRequireLoad){this.updateTrash(trash);trash.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_16fc){var _16fd=_16f4.emptytrash.singleproviderdescription;if(this.trashes.length>1){_16fd=_16f4.emptytrash.description.replace("{0}",_16fc);}return _16fd;},updateTrash:function(trash){if(trash&&trash.active){this.set("queryOptions",this._createQueryOptions(trash));}else{this.set("queryOptions",null);}},_createQueryOptions:function(trash){var query={referenceId:trash.wasteBasketLink,query:"getchildren"};var _16fe={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(query,{allLanguages:this.showAllLanguages});_16fe.ignore.push("allLanguages");}if(trash.isSearchable){lang.mixin(query,{isSearchable:trash.isSearchable});_16fe.ignore.push("isSearchable");}if(trash.queryText){lang.mixin(query,{query:"searchdeletedcontent",matchProvider:true,queryText:trash.queryText});}return {query:query,options:_16fe};},_createComparers:function(){return {referenceId:function(_16ff,_1700){return _16ff===_1700.parentLink;}};},emptyTrash:function(_1701){if(!_1701){return;}when(this.trashStore.executeMethod("Empty",_1701),function(_1702){var _1703=array.filter(this.get("trashes"),function(trash){return trash&&trash.wasteBasketLink===_1701;});array.forEach(_1703,function(trash){trash.isRequireLoad=true;});this.isEmptyTrash=true;topic.publish("/epi/cms/trash/empty",_1702.extraInformation);if(this.currentTrash.wasteBasketLink===_1701){this.set("currentTrash",this.currentTrash);}}.bind(this),function(_1704){if(_1704.status===403){this.set("actionResponse",_16f4.emptytrash.accessdenied);}}.bind(this));},deleteContent:function(_1705){if(!_1705){return;}when(this.trashStore.executeMethod("PermanentDelete",_1705).then(function(_1706){var self=this;var _1707=this.get("trashes");var _1708;_1707.some(function(trash,index){if(_1706.extraInformation===trash.wasteBasketLink){_1708=index;trash.isRequireLoad=true;self.set("currentTrash",trash);return true;}return false;});if(_1708){_1707[_1708].isRequireLoad=true;}}.bind(this)).otherwise(function(_1709){if(_1709.status===403){this.set("actionResponse",_16f4.singledelete.accessdenied);}else{if(_1709.status===400){this.set("actionResponse",_16f4.singledelete.notfromwastebasket);}}}.bind(this)));},restore:function(_170a,_170b){if(!(_170a&&_170a.contentLink&&_170a.isDeleted&&_170b)){return;}return this.contentService.move(_170a.contentLink,_170b);},getOldParent:function(_170c){var query={referenceId:_170c,query:"getrestorepoint",allLanguages:true};return when(this.contentStore.query(query)).then(function(_170d){var _170e=_170d&&lang.isArray(_170d)&&_170d.length>0?_170d[0]:null;return _170e;});}});});},"epi-cms/component/VersionsComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-class","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/component/_ShowAllLanguagesMixin","epi-cms/component/Versions","dojo/text!./templates/Versions.html","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(array,_170f,lang,_1710,_1711,when,_1712,_1713,_1714,_1715,_1716,_1717,_1718,res){return _170f([_1712,_1713,_1714,_1716],{templateString:_1718,res:res,postCreate:function(){this.inherited(arguments);when(this.versions._isSiteMultilingual()).then(function(_1719){if(!_1719){return;}this.loadShowAllLanguages().then(function(_171a){this.versions.set("showAllLanguages",_171a);this._setShowAllLanguagesLinkVisibility(_171a);}.bind(this));}.bind(this));this.own(this.versions.watch("showAllLanguages",function(){var _171b=this.versions.get("showAllLanguages");if(this.showAllLanguages!==_171b){this.saveShowAllLanguages(_171b);}this.set("showAllLanguages",_171b);this._setShowAllLanguagesLinkVisibility(_171b);}.bind(this)));this.own(this.on(".epi-versions-language-link:click",function(){this.versions.set("showAllLanguages",true);}.bind(this)));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;this._relayout();}},_relayout:function(){var _171c=_1711.contains(this.bottomLinkContainer,"dijitHidden")?0:_1710.getMarginBox(this.bottomLinkContainer).h;_1710.setMarginBox(this.versions.domNode,{w:this._contentBox.w,h:this._contentBox.h-_171c});},_setShowAllLanguagesLinkVisibility:function(_171d){_1711.toggle(this.bottomLinkContainer,"dijitHidden",_171d);if(!this._contentBox){return;}this._relayout();}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/string","dojo/topic","dojo/when","dojo/_base/json","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi-cms/dgrid/formatters","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/DialogService","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_171e,lang,_171f,_1720,_1721,topic,when,json,_1722,_1723,_1724,_1725,epi,_1726,_1727,_1728,_1729,_172a,_172b,_172c,_172d,_172e,_172f,_1730,_1731,_1732,_1733,_1734,_1735){return _171e([_1734,_1728,_172a,_172c],{showAllLanguages:true,isMultilingual:false,postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.forceContextReload=true;this.inherited(arguments);this._currentContentLanguage=_172d.currentContentLanguage;this._showAllLanguagesCommand=new _1732({model:this});var _1736=_1726.resolve("epi.storeregistry");this._contentStore=_1736.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _1737=_171e([_1723,_1724]);this.grid=new _1737({columns:{language:{label:epi.resources.header.language},status:{label:epi.resources.header.status,renderCell:_1725.commonDraft},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.inherited(arguments);this.add("commands",this._showAllLanguagesCommand);this._commonDraftCommand=new _1731();this._deleteVersionCommand=new _172f();this._deleteLanguageBranchCommand=new _1730();this.own(_171f.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_1738){_1738.then(lang.hitch(this,this.fetchData),lang.hitch(this,this._onSetCommonDraftFailure));})),_171f.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_1739){_1739.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_171f.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_173a){_173a.then(lang.hitch(this,this._onDeleteLanguageBranchSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_1729(this._deleteVersionCommand,null,{title:_1735.deletemenuitemtitle,heading:_1735.deleteversion.note,description:_1735.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_1729(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_171f.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage();this.fetchData();},_setShowAllLanguagesAttr:function(_173b){this._set("showAllLanguages",_173b);this._showAllLanguagesCommand.set("active",!_173b);this._toggleFilterByLanguage(_173b);},contextChanged:function(_173c,_173d){this.inherited(arguments);!this._isContentContext(_173c)&&this.grid.set("store",null);},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._setQuery(item.contentLink,this.showAllLanguages);this.set("isMultilingual",true);}));},_aroundRenderRow:function(_173e){return lang.hitch(this,function(item){if(item.isCommonDraft){var _173f=this._commonDrafts[item.language];if(_173f&&_173f!==item.contentLink){this._removeCommonDraft(_173f);}this._commonDrafts[item.language]=item.contentLink;}this._versionsByLanguage[item.language]=this._versionsByLanguage[item.language]||[];if(array.every(this._versionsByLanguage[item.language],function(ver){return ver!==item.contentLink;})){this._versionsByLanguage[item.language].push(item.contentLink);}var row=_173e.apply(this.grid,arguments);_1720.toggle(row,"dgrid-row-published",item.status===_1733.versionStatus.Published);return row;});},_onError:function(e){if(e.error&&e.error.status===403){when(this.getCurrentContent(),lang.hitch(this,function(item){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);}));}else{this.inherited(arguments);}},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_1740){if(_1740&&_1740.currentLanguageBranch){var _1741=lang.replace(_1735.deletelanguagebranch.label,[_1740.currentLanguageBranch.name]),_1742=_1727.getResourceValue(_1740.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_1741,description:lang.replace(_1742,[_1722.encode(_1740.name),_1740.currentLanguageBranch.name]),title:_1741});this._deleteLanguageBranchCommand.set("label",_1741);}this._deleteLanguageBranchCommand.set("model",_1740);}));},_showNotificationMessage:function(_1743){_172b.alert({title:_1735.notificationtitle,description:_1743});},_selectCommonDraftVersion:function(uri,_1744){var _1745={sender:this};if(_1744){_1745.forceReload=_1744;}topic.publish("/epi/shell/context/request",{uri:uri},_1745);},_onDeleteLanguageBranchSuccess:function(){return when(this._onDeleteVersionSuccess(arguments),lang.hitch(this,function(){var _1746=this._deleteLanguageBranchCommand.model.currentLanguageBranch.languageId;array.forEach(this._versionsByLanguage[_1746],lang.hitch(this,function(ver){this.store.notify(undefined,new _172e(ver));}));}));},_onDeleteVersionSuccess:function(){var self=this;return when(this.getCurrentContent(),function(_1747){var _1748=new _172e(_1747.contentLink);var _1749=_1748.createVersionUnspecificReference().toString();self._selectCommonDraftVersion("epi.cms.contentdata:///"+_1749,true);});},_onDeleteVersionFailure:function(_174a){if(!_174a||!_174a.status){return;}else{if(_174a.status===403){this._showNotificationMessage(_1735.deleteversion.cannotdeletepublished);}else{if(_174a.status===409){var _174b=_174a.responseText?json.fromJson(_174a.responseText).message:_1735.deleteversion.cannotdelete;this._showNotificationMessage(_174b);}else{this._showNotificationMessage(_1735.deleteversion.cannotdelete);}}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_1735.setcommondraft.failuremessage);},_removeCommonDraft:function(_174c){if(_174c){var item=this.grid.row(_174c).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_174d){return when(this.getCurrentContext()).then(function(_174e){if(!this._isContentContext(_174e)){this.grid.set("store",null);}else{this._setQuery(_174e.id,_174d);this._toggleLanguage();}}.bind(this));},_setQuery:function(_174f,_1750){var query={contentLink:new _172e(_174f).createVersionUnspecificReference().toString()};if(!_1750){query.language=this._currentContentLanguage;}this.grid.set("query",query);if(!this.grid.store){this.grid.set("store",this.store);}this._versionsByLanguage={};},_toggleLanguage:function(){var value=this.showAllLanguages?"table-cell":"none";this.grid.styleColumn("language",_1721.substitute("display:${0};",[value]));}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1751,lang,when,_1752,_1753,_1754,_1755,_1756){return _1751([_1756],{label:_1755.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_1754.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_1752.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_1757){var _1758=_1753.action,_1759=_1757&&_1753.isActionAvailable(_1757,_1758.Delete);this.set("canExecute",_1759);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_175a,lang,when,_175b,_175c,_175d,_175e,_175f,_1760){return _175a([_175c,_175d],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_175b.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _1761=_175f.toContentReference(this.model.contentLink);return when(this._versions.remove(_1761,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_1761.createVersionUnspecificReference().toString());}));},_onModelChange:function(){var model=this.model,_1762=!!(model&&model.currentLanguageBranch&&model.capabilities.deleteLanguageBranch&&!_175e.disableVersionDeletion),_1763=_1762&&!model.currentLanguageBranch.isMasterLanguage&&_1760.isActionAvailable(model,_1760.action.Delete);this.set("canExecute",_1763);this.set("isAvailable",_1762);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1764,topic,_1765,_1766,_1767,_1768){return _1764([_1768],{label:_1767.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _1769=_1766.resolve("epi.storeregistry");this.store=_1769.get("epi.cms.contentversion");},_execute:function(){var store=this.store;return store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){topic.publish("/epi/cms/content/statuschange/","common-draft",{id:item.contentLink});return store.patchCache(item);});},_onModelChange:function(){var model=this.model,_176a=_1765.versionStatus,_176b=model&&!model.isCommonDraft&&(model.status===_176a.CheckedOut||model.status===_176a.Rejected);this.set("canExecute",!!_176b);}});});},"url:epi-cms/component/templates/Versions.html":"<div>\r\n    <div class=\"epi-versions\" data-dojo-type=\"epi-cms/component/Versions\" data-dojo-attach-point=\"versions\"></div>\r\n    <div class=\"epi-gadget-bottom-container dijitHidden\" data-dojo-attach-point=\"bottomLinkContainer\">\r\n        <a class=\"epi-visibleLink epi-versions-language-link\">${res.showalllanguages}</a>\r\n    </div>\r\n</div>\r\n","epi-cms/content-approval/ApprovalComponent":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Deferred","dojo/dom-class","epi/shell/DialogService","epi/shell/command/builder/ButtonBuilder","epi-cms/content-approval/ApprovalEnums","epi-cms/content-approval/viewmodels/ContentApprovalViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ApprovalComponent.html","epi/i18n!epi/nls/episerver.cms.contentapproval.component","epi/i18n!epi/nls/episerver.shared.action","dijit/Toolbar","dijit/form/CheckBox","dijit/form/RadioButton","dijit/form/Select","dijit/form/Form","./Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/NotificationStatusBar","epi-cms/content-approval/ApprovalStepList"],function(lang,_176c,_176d,_176e,_176f,_1770,_1771,_1772,_1773,_1774,_1775,_1776,_1777,_1778,_1779){function _177a(_177b,_177c){_176e.toggle(_177b,"dijitHidden",!_177c);};return _176c([_1773,_1774,_1775,_1776],{templateString:_1777,languageWarningTemplate:" <span class='dijitInline dijitReset dijitIcon epi-iconWarning' title='"+_1778.languagefilter.warningmessage+"'></span>",resources:_1778,ApprovalDefinitionStatus:_1771.definitionStatus,_iconThumbnailTemplate:"<img class=\"epi-heading-icon-thumbnail\" src=\"{url}\" />",_iconContentTemplate:"<span class=\"dijitInline dijitReset dijitIcon epi-icon--large {iconClass} \"></span>",modelBindingMap:{approvalLink:["approvalLink"],content:["content"],isOptionsEnabled:["isOptionsEnabled"],isDeclineCommentRequired:["isDeclineCommentRequired"],isApproveCommentRequired:["isApproveCommentRequired"],isStartCommentRequired:["isStartCommentRequired"],selfApprove:["selfApprove"],isReadOnly:["isReadOnly"],filterOptions:["filterOptions"],status:["status"],approvalInheritedFrom:["approvalInheritedFrom"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1772();this.own(this.model);},buildRendering:function(){this.inherited(arguments);var _177d=new _1770(),_177e=this.model.get("commands");_177e.forEach(function(_177f){_177d.create(_177f,this.commandNode);},this);},postCreate:function(){this.inherited(arguments);this.stepList.set("model",this.model);this.own(this.enableButton.on("click",this._updateStatus.bind(this,_1771.definitionStatus.enabled)),this.disableButton.on("click",this._updateStatus.bind(this,_1771.definitionStatus.disabled)),this.inheritButton.on("click",this._updateStatus.bind(this,_1771.definitionStatus.inherited)),this.demandDeclineCommentButton.on("click",this._updateDemandDeclineComment.bind(this)),this.demandApproveCommentButton.on("click",this._updateDemandApproveComment.bind(this)),this.demandStartCommentButton.on("click",this._updateDemandStartComment.bind(this)),this.preventSelfApproveButton.on("click",this._updateSelfApprove.bind(this)),this.languageFilter.on("change",this._updateSelectedLanguage.bind(this)));},updateView:function(){this._focus();},_updateSelectedLanguage:function(_1780){this.model.set("selectedLanguage",_1780);},_setNotificationContext:function(_1781){this.validation.set("notificationContext",{contextTypeName:"epi.cms.approval",contextId:_1781});},_setBreadcrumb:function(_1782){this.breadcrumb.set("contentLink",_1782.contentLink);this.breadcrumbCurrentItem.set("currentItemInfo",{name:_1782.name,dataType:_1782.typeIdentifier});},_setContentIcon:function(_1783){_177a(this.contentIcon,true);if(_1783){this.contentIcon.innerHTML=lang.replace(this._iconThumbnailTemplate,{url:_1783});return;}var _1784=this.model.iconClass();if(_1784){this.contentIcon.innerHTML=lang.replace(this._iconContentTemplate,{iconClass:_1784});return;}_177a(this.contentIcon,false);},_setContentName:function(_1785){this.contentName.textContent=_1785;},_setApprovalLinkAttr:function(_1786){this._set("approvalLink",_1786);this._setNotificationContext(_1786);},_setContentAttr:function(_1787){this._set("content",_1787);if(!_1787){return;}this._setBreadcrumb(_1787);this._setContentName(_1787.name);this._setContentIcon(_1787.thumbnailUrl);},_setStatusAttr:function(_1788){this._set("status",_1788);this.form.set("value",{status:_1788});this._focus();_177a(this.demandCommentFieldsetNode,(this.model.get("isEnabled")));_177a(this.stepList.domNode,this.model.get("isEnabled"));_177a(this.filterNode,this.model.get("isEnabled")&&!!this.model.get("filterOptions"));this._updateWarningMessage();},_focus:function(){this.enableButton.get("checked")&&this.enableButton.focus();this.disableButton.get("checked")&&this.disableButton.focus();this.inheritButton.get("checked")&&this.inheritButton.focus();},_setApprovalInheritedFromAttr:function(_1789){this._set("approvalInheritedFrom",_1789);this._updateWarningMessage();},_updateWarningMessage:function(){_177a(this.warningNode,(!this.model.get("isEnabled")||this.model.get("isInherited")));_177a(this.goToInheritedSequence,this.model.get("isInherited"));this.warningMessage.textContent=this.model.getWarningMessage();},_setIsDeclineCommentRequiredAttr:function(_178a){this._set("isDeclineCommentRequired",_178a);this.demandDeclineCommentButton.set("checked",_178a);},_setIsApproveCommentRequiredAttr:function(_178b){this._set("isApproveCommentRequired",_178b);this.demandApproveCommentButton.set("checked",_178b);},_setIsStartCommentRequiredAttr:function(_178c){this._set("isStartCommentRequired",_178c);this.demandStartCommentButton.set("checked",_178c);},_setSelfApproveAttr:function(_178d){this._set("selfApprove",_178d);this.preventSelfApproveButton.set("checked",!_178d);},_setIsOptionsEnabledAttr:function(_178e){this._set("isOptionsEnabled",_178e);this.demandDeclineCommentButton.set("disabled",!_178e);this.demandApproveCommentButton.set("disabled",!_178e);this.demandStartCommentButton.set("disabled",!_178e);this.preventSelfApproveButton.set("disabled",!_178e);},_setIsReadOnlyAttr:function(_178f){this._set("isReadOnly",_178f);this.enableButton.set("disabled",_178f);this.disableButton.set("disabled",_178f);this.inheritButton.set("disabled",_178f);},_setFilterOptionsAttr:function(_1790){this._set("filterOptions",_1790);var _1791=!!_1790&&this.model.get("isEnabled");_177a(this.filterNode,_1791);if(!_1790){return;}_1790=lang.clone(_1790);var _1792=this.model.get("selectedLanguage")||"";_1790.forEach(function(_1793){if(!_1793.isValid&&this.model.get("showValidations")){_1793.label+=this.languageWarningTemplate;}_1793.selected=_1792===_1793.value;},this);this.languageFilter.set("options",_1790);this.languageFilter.set("value",_1792);},_goToInheritedSequence:function(){this.model.goToInheritedSequence();},_updateStatus:function(_1794){var _1795;switch(_1794){case _1771.definitionStatus.inherited:_1795=this._confirmInherit();break;case _1771.definitionStatus.enabled:this.model.enable();_1795=new _176d().resolve();break;case _1771.definitionStatus.disabled:_1795=this._confirmDisable();break;}_1795.otherwise(this.set.bind(this,"status",this.status));},_updateDemandDeclineComment:function(e){var _1796=e.target.checked;this.model.set("isDeclineCommentRequired",_1796);this.demandDeclineCommentButton.set("checked",_1796);},_updateDemandApproveComment:function(e){var _1797=e.target.checked;this.model.set("isApproveCommentRequired",_1797);this.demandApproveCommentButton.set("checked",_1797);},_updateDemandStartComment:function(e){var _1798=e.target.checked;this.model.set("isStartCommentRequired",_1798);this.demandStartCommentButton.set("checked",_1798);},_updateSelfApprove:function(e){var _1799=e.target.checked;this.model.set("selfApprove",!_1799);this.preventSelfApproveButton.set("checked",_1799);},_confirmDisable:function(){var _179a={title:this.resources.disable.title,description:this.resources.disable.description,confirmActionText:_1779.disable,cancelActionText:_1779.cancel};return _176f.confirmation(_179a).then(this.model.disable.bind(this.model));},_confirmInherit:function(){var _179b={title:this.resources.inherit.title,description:this.resources.inherit.description,confirmActionText:this.resources.inherit.okbutton,cancelActionText:_1779.cancel,setFocusOnConfirmButton:false};return _176f.confirmation(_179b).then(this.model.inheritDefinition.bind(this.model));}});});},"epi-cms/content-approval/viewmodels/ContentApprovalViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/DialogService","epi/shell/TypeDescriptorManager","epi-cms/content-approval/ApprovalEnums","epi-cms/content-approval/viewmodels/ApprovalStepViewModel","epi/shell/command/withConditionalConfirmation","dojo/Stateful","epi/shell/DestroyableByKey","epi/shell/_ContextMixin","epi-cms/content-approval/command/SaveApprovalDefinition","epi-cms/content-approval/command/CancelChanges","epi/shell/store/SortableMemory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval","epi/i18n!epi/nls/episerver.cms.languageselector","epi/i18n!epi/nls/episerver.shared.action"],function(_179c,lang,on,when,epi,_179d,_179e,_179f,_17a0,_17a1,_17a2,_17a3,_17a4,_17a5,_17a6,_17a7,_17a8,_17a9,_17aa,_17ab,_17ac){return _179c([_17a3,_17a4,_17a5],{approvalSteps:null,approvalService:null,userStore:null,commands:null,isDirty:false,isDeclineCommentRequired:false,isApproveCommentRequired:false,isStartCommentRequired:false,selfApprove:true,isEnabled:false,isInherited:false,selectedLanguage:null,approvalLink:null,content:null,isValid:true,isReadOnly:false,isOptionsEnabled:true,languages:null,filterOptions:null,approvalInheritedFrom:null,languageOptions:null,showValidations:false,status:_17a0.definitionStatus.inherited,_approvalStepsQuery:null,_originalDefinition:null,_validationMessageIds:[],_contextService:null,_messageService:null,constructor:function(_17ad,_17ae,_17af,_17b0,_17b1,_17b2,_17b3){this.approvalService=_17ae||_179d.resolve("epi.cms.ApprovalService");this._contextService=_17af||_179d.resolve("epi.shell.ContextService");this._messageService=_17b0||_179d.resolve("epi.shell.MessageService");this.userStore=_17b1||_179d.resolve("epi.storeregistry").get("epi.cms.notification.users");this._contentStore=_17b2||_179d.resolve("epi.storeregistry").get("epi.cms.content.light");this._typeDescriptorManager=_17b3||_179f;},postscript:function(){this.inherited(arguments);when(this.getCurrentContext()).then(this.contextChanged.bind(this));},destroy:function(){this.inherited(arguments);this._removeEventListeners();},contextChanged:function(_17b4){this.set("approvalLink",_17b4.id);this.approvalService.getDefinition(_17b4.id).then(this.loadApprovalDefinition.bind(this)).then(function(){this._contentStore.get(_17b4.id).then(this.set.bind(this,"content"));}.bind(this));},createApprovalStep:function(_17b5){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_17b6=steps.getSibling(_17b5),_17b7;_17b7=new _17a1({languages:this.languages,reviewers:[],userStore:this.userStore,showValidations:this.showValidations});this._addEventListeners(_17b7);steps.add(_17b7,{before:_17b6});},getWarningMessage:function(){if(this.get("isInherited")&&this.approvalInheritedFrom){var text=this.get("isEnabled")?_17aa.component.inheritedenabled:_17aa.component.inheriteddisabled;return lang.replace(text,{name:this.approvalInheritedFrom.name});}else{if(!this.get("isEnabled")){return _17aa.component.disabledwarning;}}},goToInheritedSequence:function(){this.approvalService.navigateToDefinition(this.get("approvalInheritedFrom").contentLink);},inheritDefinition:function(){var _17b8=this.get("approvalLink"),_17b9=this.status;this.set("status",_17a0.definitionStatus.inherited);return this.approvalService.inheritDefinition(_17b8).then(this.loadApprovalDefinition.bind(this)).otherwise(this.set.bind(this,"status",_17b9));},moveApprovalStep:function(_17ba,up){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_17bb=steps.getSibling(_17ba,up);if(!_17bb){return;}if(!up){_17bb=steps.getSibling(_17bb);}steps.put(_17ba,{before:_17bb});},removeApprovalStep:function(_17bc){if(!this._canEditApprovalSteps()){return;}if(_17bc.canBeDeleted){this.approvalSteps.remove(_17bc.id);}},loadApprovalDefinition:function(_17bd){this._originalDefinition=null;this.set({approvalInheritedFrom:_17bd.approvalInheritedFrom,languages:_17bd.languages,status:_17bd.status,isReadOnly:_17bd.isReadOnly,isDeclineCommentRequired:_17bd.isDeclineCommentRequired,isApproveCommentRequired:_17bd.isApproveCommentRequired,isStartCommentRequired:_17bd.isStartCommentRequired,selfApprove:_17bd.selfApprove,showValidations:false});this._createApprovalSteps(_17bd.approvalSteps);this._originalDefinition=this.serialize();},saveApprovalDefinition:function(){var _17be=this.serialize();return this.approvalService.saveDefinition(_17be).then(this.loadApprovalDefinition.bind(this));},serialize:function(){var _17bf=this.approvalSteps.data.map(function(step){return step.serialize();});return {contentLink:this.get("approvalLink"),approvalSteps:_17bf,isDeclineCommentRequired:this.isDeclineCommentRequired,isApproveCommentRequired:this.isApproveCommentRequired,isStartCommentRequired:this.isStartCommentRequired,selfApprove:this.selfApprove,status:this.status};},validate:function(){var _17c0=null;this.approvalSteps.data.forEach(function(step){step.validate();});if(this._hasErrors()){_17c0={level:"error",dialog:{description:_17aa.validationmessage.notenoughreviewersmessage.description}};}else{if(this._hasWarnings()){_17c0={level:"warning",dialog:{title:_17aa.validationmessage.stephaswarnings.title,description:_17aa.validationmessage.stephaswarnings.description,confirmActionText:_17aa.action.saveanyway,cancelActionText:_17ac.cancel}};}}return _17c0;},enable:function(){this.set("status",_17a0.definitionStatus.enabled);this._updateIsSequenceEnabled();},disable:function(){this.set("showValidations",false);this.set("status",_17a0.definitionStatus.disabled);this._updateApprovalSteps();this._updateIsSequenceEnabled();return this.saveApprovalDefinition().otherwise(function(){this.set("showValidations",true);this.enable();}.bind(this));},iconClass:function(){return this.content?this._typeDescriptorManager.getValue(this.content.typeIdentifier,"iconClass"):null;},_createApprovalSteps:function(steps){var _17c1=(steps||[this._createEmptyStep()]).map(this._createStepViewModel.bind(this)),store=_17a9(new _17a8({data:_17c1}));this.set("approvalSteps",store);this.set("isDirty",false);this._approvalStepsQuery=store.query();this._updateApprovalSteps();this.destroyByKey("observeHandle");this.ownByKey("observeHandle",this._approvalStepsQuery.observe(function(){this._updateApprovalSteps();}.bind(this)));},_createEmptyStep:function(){return {reviewers:[]};},_createStepViewModel:function(step,index){step=lang.clone(step);var _17c2=new _17a1({id:index,languages:this.languages,selfApprove:this.selfApprove,reviewers:step.reviewers,name:step.name,userStore:this.userStore});this._addEventListeners(_17c2);return _17c2;},_updateApprovalSteps:function(){var _17c3=this._approvalStepsQuery;if(_17c3){var _17c4=_17c3.length>1,_17c5=!this._canEditApprovalSteps(),_17c6=this.selectedLanguage,_17c7=this.selfApprove;_17c3.forEach(function(step){step.set({canBeDeleted:_17c4,isReadOnly:_17c5,selfApprove:_17c7});step.filterReviewers(_17c6);});this._onApprovalStepsChanged();}},_resetValidationMessageIds:function(){this._validationMessageIds.forEach(function(_17c8){this._messageService.remove({id:_17c8});}.bind(this));this._validationMessageIds=[];if(this.showValidations){this._approvalStepsQuery.forEach(function(step){if(!step.isValid){step.validationMessages.forEach(function(_17c9){var _17ca;if(_17c9.level==="error"){_17ca="error";}else{if(_17c9.level==="warning"){_17ca="warn";}}var _17cb=this._messageService.put(_17ca,_17c9.value,"epi.cms.approval",this.get("approvalLink"));this._validationMessageIds.push(_17cb);},this);}},this);}},_onApprovalStepsChanged:function(){this._resetValidationMessageIds();this._validateFilterOptions();var _17cc=this.serialize();var equal=epi.areEqual(_17cc,this._originalDefinition);this._originalDefinition&&this.set("isDirty",!equal);},_addEventListeners:function(step){this.own(step.on("create-step",this.createApprovalStep.bind(this)),step.on("remove-step",this.removeApprovalStep.bind(this)),step.on("change",this._onApprovalStepsChanged.bind(this)),step.watch("isValid",this._onApprovalStepsChanged.bind(this)));},_canEditApprovalSteps:function(){return !this.isReadOnly&&this.status===_17a0.definitionStatus.enabled;},_commandsGetter:function(){if(this.commands===null){this.commands=[new _17a6({model:this,order:10}),new _17a7({model:this,order:20})];}return this.commands;},_createLanguageOptions:function(_17cd){if(!_17cd){this.set("languageOptions",null);this.set("filterOptions",null);return;}var _17ce=_17cd.map(function(_17cf){return {label:_17cf.text,value:_17cf.value};});this.set("languageOptions",_17ce);var _17d0=lang.clone(_17ce);_17d0.unshift(this._getDefaultLanguageOption());this.set("filterOptions",_17d0);},_getDefaultLanguageOption:function(){return {label:_17ab.alllanguages,value:"",selected:true};},_validateFilterOptions:function(){if(!this.filterOptions){return;}var _17d1=this._stepsMissingLanguageReviewer();this.filterOptions.forEach(function(_17d2){_17d2.isValid=_17d1.every(function(step){return step.get("validationMessages").every(function(_17d3){if(!_17d3.languages){return true;}return _17d3.languages.indexOf(_17d2.value)===-1;});});});this.set("filterOptions",this.filterOptions);},_hasErrors:function(){return this.approvalSteps.data.some(function(step){return !step.isValid&&step.hasErrors();});},_hasWarnings:function(){return this.approvalSteps.data.some(function(step){return !step.isValid&&step.hasWarnings();});},_stepsMissingLanguageReviewer:function(){return this.approvalSteps.data.filter(function(step){return !step.isValid&&step.validationMessages.some(function(_17d4){return _17d4.languages;});});},_isDeclineCommentRequiredSetter:function(_17d5){this.isDeclineCommentRequired=_17d5;this._updateApprovalSteps();},_isApproveCommentRequiredSetter:function(_17d6){this.isApproveCommentRequired=_17d6;this._updateApprovalSteps();},_isStartCommentRequiredSetter:function(_17d7){this.isStartCommentRequired=_17d7;this._updateApprovalSteps();},_selfApproveSetter:function(_17d8){this.selfApprove=_17d8;this._updateApprovalSteps();},_isDirtySetter:function(_17d9){this.isDirty=_17d9;if(!_17d9){this._removeEventListeners();return;}if(this._interceptor){return;}this._beforeUnloadHandler=on(window,"beforeunload",function(e){var _17da=_17aa.command.cancelchanges.description;e.returnValue=_17da;return _17da;});this._interceptor=this._contextService.registerRequestInterceptor(function(){var _17db={title:_17aa.command.cancelchanges.title,description:_17aa.command.cancelchanges.description};return _179e.confirmation(_17db).then(this._removeEventListeners.bind(this));}.bind(this));},_isReadOnlySetter:function(value){this.isReadOnly=value;this._updateApprovalSteps();this._updateIsSequenceEnabled();},_languagesSetter:function(value){this.languages=value;this._createLanguageOptions(this.languages);this._updateApprovalSteps();},_selectedLanguageSetter:function(_17dc){this.selectedLanguage=!_17dc?null:_17dc;this._updateApprovalSteps();},_showValidationsSetter:function(_17dd){this.showValidations=_17dd;if(this.approvalSteps&&this.approvalSteps.data){this.approvalSteps.data.forEach(function(step){step.set("showValidations",_17dd);});}},_updateIsSequenceEnabled:function(){this.set("isOptionsEnabled",this._canEditApprovalSteps());},_statusSetter:function(_17de){this.status=_17de;this._updateApprovalSteps();},_isInheritedGetter:function(){return this.get("status")===_17a0.definitionStatus.inherited;},_isEnabledGetter:function(){if(this.get("status")===_17a0.definitionStatus.inherited){return this.approvalInheritedFrom&&this.approvalInheritedFrom.isEnabled;}return this.get("status")===_17a0.definitionStatus.enabled;},_removeEventListeners:function(){this._interceptor&&this._interceptor.remove();this._interceptor=null;this._beforeUnloadHandler&&this._beforeUnloadHandler.remove();this._beforeUnloadHandler=null;}});});},"epi-cms/content-approval/viewmodels/ApprovalStepViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/content-approval/viewmodels/ReviewerViewModel","dojo/Stateful","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/content-approval/command/AddApprovalStep","epi-cms/content-approval/command/RemoveApprovalStep","epi-cms/content-approval/ApprovalEnums","dojo/store/Memory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval"],function(_17df,lang,_17e0,_17e1,_17e2,_17e3,_17e4,_17e5,_17e6,_17e7,_17e8,_17e9){return _17df([_17e1,_17e3,_17e2],{reviewers:null,commands:null,userStore:null,canBeDeleted:true,selfApprove:true,isReadOnly:false,name:"",isValid:true,validationMessages:[],languages:null,showValidations:false,addReviewer:function(_17ea){_17ea.languages=_17ea.languages||[];this.reviewers.add(this._createReviewer(_17ea));},filterOutExistingUsers:function(users){var _17eb=this.get("reviewers").query();return users=users.filter(function(user){return !_17eb.some(function(_17ec){return (user.name.toLowerCase()===_17ec.name.toLowerCase()&&user.reviewerType===_17ec.reviewerType);});},this);},filterReviewers:function(_17ed){this.reviewers.query().forEach(function(_17ee){if(_17ed===null||_17ee.languages.length===0){_17ee.set("canApprove",true);return;}var _17ef=_17ee.languages.some(function(_17f0){return _17f0===_17ed;});_17ee.set("canApprove",_17ef);});},createApprovalStep:function(){this.emit("create-step",this);},removeApprovalStep:function(){this.emit("remove-step",this);},removeReviewer:function(_17f1){if(this.isReadOnly){return;}this.reviewers.remove(this._getReviewerId(_17f1));},serialize:function(){var _17f2=this.reviewers.data.map(function(_17f3){return _17f3.serialize();});return {name:this.name,reviewers:_17f2};},validate:function(){if(!this.reviewers){return;}var _17f4=[],_17f5=this.reviewers.query(),_17f6=this._validateReviewers(_17f5);if(_17f6){_17f4.push(_17f6);}_17f6=this._validateLanguages(_17f5);if(_17f6){_17f4.push(_17f6);}_17f6=this._validateSelfApprove(_17f5);if(_17f6){_17f4.push(_17f6);}_17f6=this._validateRoles(_17f5);if(_17f6){_17f4.push(_17f6);}this.set("validationMessages",_17f4);this.set("isValid",_17f4.length===0);},hasErrors:function(){return this.validationMessages.some(function(_17f7){return _17f7.level==="error";});},hasWarnings:function(){return this.validationMessages.some(function(_17f8){return _17f8.level==="warning";});},_createReviewer:function(_17f9){var _17fa=new _17e0(_17f9);_17fa.id=this._getReviewerId(_17f9);this.own(_17fa.watch("languages",function(){this.validate();this.emit("change");}.bind(this)));this.validate();return _17fa;},_getReviewerId:function(_17fb){return _17fb.name.toLowerCase()+":"+_17fb.reviewerType;},_nameSetter:function(value){value=value||"";if(value===this.name){return;}this.name=value;this.emit("change");},_nameGetter:function(){return this.name||_17e9.step.header.placeholder;},_reviewersSetter:function(_17fc){var _17fd=_17fc.map(function(_17fe){return this._createReviewer(_17fe);},this);this.reviewers=_17e8(new _17e7({data:_17fd}));this.destroyByKey("reviewersObserveHandle");this.ownByKey("reviewersObserveHandle",this.reviewers.query().observe(function(){this.validate();this.emit("change");}.bind(this)));this.validate();},_selfApproveSetter:function(_17ff){this.selfApprove=_17ff;this.validate();},_commandsGetter:function(){if(this.commands===null){this.commands=[new _17e4({model:this}),new _17e5({model:this})];}return this.commands;},_validateLanguages:function(_1800){var _1801=null;if(!this.languages||_1800.length===0){return _1801;}var _1802=[];this.languages.forEach(function(_1803){var _1804=_1800.some(function(_1805){if(_1805.languages.length===0){return true;}return _1805.languages.some(function(_1806){return _1806===_1803.value;});});if(!_1804){if(_1801){_1801.languages.push(_1803.value);}else{_1801={languages:[_1803.value],level:"warning"};}_1802.push(_1803.text);}});if(_1801){_1801.value=lang.replace(_17e9.validationmessage.notenoughlanguagesmessage.title,{languages:_1802.join(", ")});}return _1801;},_validateSelfApprove:function(_1807){if(this.selfApprove!==false){return null;}if(!this.languages){if(_1807.length===1&&_1807[0].reviewerType===_17e6.reviewerType.user){return {value:_17e9.validationmessage.onlyonereviewer.title,languages:null,level:"warning"};}return null;}var _1808=this.languages.filter(function(_1809){var _180a=0;_1807.forEach(function(_180b){if(_180b.languages.length===0||_180b.languages.indexOf(_1809.value)!==-1){if(_180b.reviewerType===_17e6.reviewerType.user){_180a++;}else{if(_180b.reviewerType===_17e6.reviewerType.role){_180a+=2;}}}});return _180a<2;});if(_1808.length>0){return {value:lang.replace(_17e9.validationmessage.onlyonelanguagereviewer.title,{languages:_1808.map(function(_180c){return _180c.text;}).join(", ")}),languages:_1808.map(function(_180d){return _180d.value;}),level:"warning"};}return null;},_validateRoles:function(_180e){if(_180e.length===0){return null;}var _180f=[];_180e.forEach(function(_1810){if(_1810.reviewerType===_17e6.reviewerType.role&&_1810.numberOfRoleUsersExceededMax){_180f.push(_1810.displayName);}});if(_180f.length===0){return null;}var text=lang.replace(_17e9.validationmessage.roleusersexceededmaxmessage.description,{rolenames:_180f.join(", ")});return {value:text,languages:null,level:"warning"};},_validateReviewers:function(_1811){var _1812=null;if(_1811.length===0){_1812={value:_17e9.validationmessage.notenoughreviewersmessage.title,languages:null,level:"error"};}return _1812;}});});},"epi-cms/content-approval/viewmodels/ReviewerViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojox/html/entities","epi-cms/content-approval/ApprovalEnums"],function(_1813,_1814,_1815,_1816){return _1813([_1814],{displayName:null,name:null,reviewerType:_1816.reviewerType.user,numberOfUsers:0,numberOfRoleUsersExceededMax:false,roleFirstUsersNames:[],postscript:function(){this.inherited(arguments);if(this.roleInfo!=null){this.set("numberOfUsers",this.roleInfo.totalNumberOfUsers);this.set("roleFirstUsersNames",this.roleInfo.userNames);this.set("numberOfRoleUsersExceededMax",this.roleInfo.numberOfRoleUsersExceededMax);this.set("displayNameUsersLimit",this.roleInfo.displayNameUsersLimit);}},_numberOfOtherUsersGetter:function(){if(!this.roleFirstUsersNames){return this.numberOfUsers;}return this.numberOfUsers-this.roleFirstUsersNames.length;},_displayNameGetter:function(){var _1817=this.displayName;if(this.reviewerType===_1816.reviewerType.role){_1817+=" ("+this.displayNameUsersLimit;if(this.numberOfRoleUsersExceededMax){_1817+="+";}_1817+=")";}return _1815.encode(_1817);},_roleFirstUsersNamesGetter:function(){if(!this.roleFirstUsersNames||this.roleFirstUsersNames.length===0){return [];}return this.roleFirstUsersNames.map(function(_1818){return _1815.encode(_1818);});},languages:null,canApprove:true,serialize:function(){return {name:this.name,displayName:this.displayName,languages:this.languages,reviewerType:this.reviewerType};},_iconGetter:function(){return this.reviewerType===_1816.reviewerType.role?"epi-iconUsers":"epi-iconUser";}});});},"epi-cms/content-approval/command/AddApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_1819,_181a,_181b){return _1819([_181b],{label:_181a.add,iconClass:"epi-icon--inverted epi-iconPlus",category:"add",propertiesToWatch:["isReadOnly"],_execute:function(){this.model.createApprovalStep();},_onPropertyChanged:function(){var _181c=!this.model.isReadOnly;this.set({canExecute:_181c,isAvailable:_181c});}});});},"epi-cms/content-approval/command/RemoveApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.removeapprovalstep","epi/shell/command/_PropertyWatchCommand"],function(_181d,_181e,_181f){return _181d([_181f],{label:_181e.label,iconClass:"epi-iconClose",category:"remove",propertiesToWatch:["canBeDeleted","isReadOnly"],_execute:function(){this.model.removeApprovalStep();},_onPropertyChanged:function(){var model=this.model,_1820=!model.isReadOnly&&model.canBeDeleted;this.set({canExecute:_1820,isAvailable:_1820});}});});},"epi/shell/command/withConditionalConfirmation":function(){define("epi/shell/command/withConditionalConfirmation",["dojo/Deferred","dojo/when","epi/shell/DialogService"],function(_1821,when,_1822){return function(_1823,_1824){var _1825=_1823._execute,_1826=_1824.property||"requiresConfirmation";_1823._execute=function(){var _1827=_1823[_1826]?_1822.confirmation(_1824):new _1821().resolve();return _1827.then(function(){return when(_1825.apply(_1823,arguments));});};return _1823;};});},"epi-cms/content-approval/command/SaveApprovalDefinition":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/DialogService","epi/shell/command/_PropertyWatchCommand"],function(_1828,_1829,_182a,_182b){return _1828([_182b],{label:_1829.save,isAvailable:true,canExecute:false,propertiesToWatch:["isDirty","isValid","isReadOnly"],_execute:function(){this.model.set("showValidations",true);var _182c=this.model.validate();if(!_182c){this.model.saveApprovalDefinition();return;}switch(_182c.level){case "error":_182a.alert(_182c.dialog);break;case "warning":_182a.confirmation(_182c.dialog).then(function(){this.model.saveApprovalDefinition();}.bind(this));break;}},_onPropertyChanged:function(){this.set("isAvailable",!this.model.isReadOnly);this.set("canExecute",this.model.isDirty&&this.model.isValid);this.set("label",this.model.isDirty?_1829.save:_1829.saved);}});});},"epi-cms/content-approval/command/CancelChanges":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_182d,_182e,_182f,_1830){return _182d([_1830],{label:_182f.cancel,canExecute:true,propertiesToWatch:["isDirty"],contextHistory:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_182e.resolve("epi.cms.BackContextHistory");},_execute:function(){this.contextHistory.closeAndNavigateBack(this);},_onPropertyChanged:function(){var _1831=!!this.model.isDirty;this.set("label",_1831?_182f.cancel:_182f.close);}});});},"epi/shell/store/SortableMemory":function(){define("epi/shell/store/SortableMemory",["dojo/_base/declare","epi/shell/store/queryUtils","dojo/store/Memory"],function(_1832,_1833,_1834){return _1832(_1834,{getSibling:function(_1835,_1836){var data=this.data,index=this.index,id=this.getIdentity(_1835);if(!(id in index)){throw new Error("Object specified in options.before does not exist");}var delta=_1836?-1:1,pos=index[id]+delta;if(pos<0||pos>=data.length){return null;}return data[pos];},put:function(_1837,_1838){var data=this.data,_1839=this.idProperty;var id=_1837[_1839]=(_1838&&"id" in _1838)?_1838.id:_1839 in _1837?_1837[_1839]:Math.random();var _183a=false;if(id in this.index){_183a=true;}if(_1838){if(_1838.overwrite===false){if(_183a){throw new Error("Object already exists");}}if(_1838.before||(_1838.hasOwnProperty("before")&&_183a)){var _183b=this.index[id],_183c=data.length;if(_1838.before){var _183d=this.getIdentity(_1838.before);_183c=this.index[_183d];}if(_183b<_183c){--_183c;}if(_183c!==undefined){if(_183a){this.remove(id);}data.splice(_183c,0,_1837);this.setData(data);return id;}else{throw new Error("Object specified in options.before does not exist");}}}if(_183a){data[this.index[id]]=_1837;}else{this.index[id]=data.push(_1837)-1;}return id;},queryEngine:function(query,_183e){query=_1833.createFilter(query,_183e);function _183f(){return this.data.filter(query);};_183f.matches=query;return _183f.bind(this);}});});},"url:epi-cms/content-approval/templates/ApprovalComponent.html":"<div class=\"epi-content-approval\">\r\n    <div class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"dijit/Toolbar\">\r\n        <div class=\"epi-toolbarGroupContainer\">\r\n            <div class=\"epi-toolbarGroup epi-toolbarLeading\">\r\n                <div data-dojo-attach-point=\"breadcrumb\" data-dojo-type=\"epi-cms/content-approval/Breadcrumb\" data-dojo-props=\"displayAsText:false, showCurrentNode:false\"></div>\r\n                <div data-dojo-attach-point=\"breadcrumbCurrentItem\" data-dojo-type=\"epi-cms/widget/BreadcrumbCurrentItem\"></div>\r\n            </div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarTrailing\" data-dojo-attach-point=\"commandNode\">\r\n                <div data-dojo-attach-point=\"validation\" data-dojo-type=\"epi-cms/widget/NotificationStatusBar\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"epi-content-approval__container\">\r\n        <div class=\"epi-content-approval__header\">\r\n            <hgroup class=\"epi-heading-group\">\r\n                <h1 class=\"epi-heading\"><span class=\"epi-heading-icon\" data-dojo-attach-point=\"contentIcon\"></span> <span data-dojo-attach-point=\"contentName\"></span></h1>\r\n                <h2 class=\"epi-heading\">${resources.title}</h2>\r\n            </hgroup>\r\n            <p>${resources.instructions.reviewers}</p>\r\n            <p>${resources.instructions.steps}</p>\r\n            <div class=\"epi-content-approval__settings clearfix\" data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\">\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"enable-approval\" data-dojo-attach-point=\"enableButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.enabled}\">\r\n                    <label class=\"dijitInline\" for=\"enable-approval\">${resources.states.enabled}</label>\r\n                </span>\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"inherit-approval\" data-dojo-attach-point=\"inheritButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.inherited}\">\r\n                    <label class=\"dijitInline\" for=\"inherit-approval\">${resources.states.inherited}</label>\r\n                </span>\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"disabled-approval\" data-dojo-attach-point=\"disableButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.disabled}\">\r\n                    <label class=\"dijitInline\" for=\"disabled-approval\">${resources.states.disabled}</label>\r\n                </span>\r\n                <fieldset class=\"dijitInline\" data-dojo-attach-point=\"demandCommentFieldsetNode\">\r\n                    <div>\r\n                        <input id=\"demandcomment-start\" data-dojo-attach-point=\"demandStartCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-start\">${resources.demandcomment.start}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"demandcomment-approve-approval\" data-dojo-attach-point=\"demandApproveCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-approve-approval\">${resources.demandcomment.label} ${resources.demandcomment.approve}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"demandcomment-approval\" data-dojo-attach-point=\"demandDeclineCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-approval\">${resources.demandcomment.label} ${resources.demandcomment.decline}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"prevent-self-approve\" data-dojo-attach-point=\"preventSelfApproveButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"prevent-self-approve\">${resources.preventselfapprove}</label>\r\n                    </div>\r\n                </fieldset>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-content-approval__disabled-warning\" data-dojo-attach-point=\"warningNode\">\r\n            <span data-dojo-attach-point=\"warningMessage\"></span><a class=\"epi-visibleLink\" data-dojo-attach-point=\"goToInheritedSequence\" data-dojo-attach-event=\"onclick:_goToInheritedSequence\">${resources.gotoinheritedsequence}</a>\r\n        </div>\r\n        <div class=\"epi-content-approval__filter\" data-dojo-attach-point=\"filterNode\">\r\n            <span class=\"dijitInline\">${resources.languagefilter.description}</span>\r\n            <div data-dojo-attach-point=\"languageFilter\" data-dojo-type=\"dijit/form/Select\" class=\"epi-chromeless epi-chromeless--with-arrow epi-visibleLink\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"stepList\" data-dojo-type=\"epi-cms/content-approval/ApprovalStepList\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/content-approval/Breadcrumb":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi-cms/widget/Breadcrumb"],function(_1840,topic,_1841,_1842){return _1840([_1842],{postscript:function(){this.inherited(arguments);this.approvalService=this.approvalService||_1841.resolve("epi.cms.ApprovalService");},onNodeClick:function(e,_1843){e.preventDefault();this.approvalService.navigateToDefinition(_1843.contentLink);}});});},"epi-cms/content-approval/ApprovalStepList":function(){define(["dojo/_base/declare","dojo/keys","epi-cms/content-approval/ApprovalStep","dijit/_WidgetBase","dijit/_TemplatedMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","dgrid/Keyboard","dgrid/extensions/DijitRegistry","dgrid/extensions/DnD","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/WidgetRow","dojo/text!./templates/ApprovalStepList.html","epi/i18n!epi/nls/episerver.cms.contentapproval.steplist"],function(_1844,keys,_1845,_1846,_1847,_1848,List,_1849,_184a,DnD,_184b,_184c,_184d,_184e){var _184f=_1844([List,_184b,DnD,_1849,_184a,_184c]);return _1844([_1846,_1847,_1848],{model:null,modelBindingMap:{approvalSteps:["approvalSteps"]},templateString:_184d,resources:_184e,buildRendering:function(){this.inherited(arguments);this.list=new _184f({className:"epi-chromeless",dndParams:{withHandles:true,creator:this._createAvatar.bind(this),skipForm:true},maintainOddEven:false,renderRow:this._renderRow.bind(this),selectionMode:"single",sort:"default"},this.listNode);this.own(this.list.addKeyHandler(keys.DELETE,this._removeStep.bind(this)),this.list.addKeyHandler(keys.DOWN_ARROW,this._moveStep.bind(this,false)),this.list.addKeyHandler(keys.UP_ARROW,this._moveStep.bind(this,true)),this.list.on(".dgrid-row:keypress",this._createStep.bind(this)));},startup:function(){this.inherited(arguments);this.list.startup();},_createAvatar:function(item){var step=new _1845({model:item});step.startup();var node=step.domNode.cloneNode(true);step.destroyRecursive();return {node:node,type:this.list.dndSourceType,data:item};},_createStep:function(event){if(!event.ctrlKey&&String.fromCharCode(event.which)==="+"){var row=this.list.row(event);this.model.createApprovalStep(row.data);}},_moveStep:function(_1850,event){if(event.ctrlKey){var row=this.list.row(event);this.list.focus(row);this.model.moveApprovalStep(row.data,_1850);}},_removeStep:function(event){var row=this.list.row(event);this.model.removeApprovalStep(row.data);},_renderRow:function(_1851){var _1852=this.model.get("languageOptions");var step=new _1845({model:_1851,languageOptions:_1852});return step.domNode;},_setApprovalStepsAttr:function(_1853){this._set("approvalSteps",_1853);this.list.set("store",_1853);}});});},"epi-cms/content-approval/ApprovalStep":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","epi-cms/content-approval/viewmodels/ReviewerViewModel","./ApprovalEnums","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/Formatter","dgrid/Keyboard","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","dijit/form/ComboBox","./Reviewer","dojo/text!./templates/ApprovalStep.html","epi/i18n!epi/nls/episerver.cms.contentapproval.step","dijit/form/TextBox"],function(_1854,lang,_1855,_1856,keys,_1857,_1858,_1859,_185a,_185b,_185c,_185d,_185e,List,_185f,_1860,_1861,_1862,_1863,_1864,_1865,_1866,_1867,_1868){var _1869=_1854([List,_1861,_1862,_1860,_185f,_1863]);var _186a=_1854([_1864],{labelType:"html",_onKey:function(evt){if(evt.keyCode===keys.UP_ARROW&&!this._opened){this.onMoveUp(evt);return;}if(evt.keyCode===keys.ENTER&&this._hasSuggestions()&&this._hasNoItemSelected()){this.set("item",this.dropDown.items[0]);}this.inherited(arguments);},labelFunc:function(item){var _186b="<span class=\"dijitInline dijitIcon {icon}\"></span>{displayName}";var _186c=new _1859(item);return lang.replace(_186b,{icon:_186c.get("icon"),displayName:_186c.get("displayName")});},onMoveUp:function(){},_hasSuggestions:function(){return this._opened&&!!this.get("value")&&this.dropDown.items.length>0;},_hasNoItemSelected:function(){return !this.item;}});return _1854([_185b,_185c,_185d,_185e],{model:null,modelBindingMap:{isReadOnly:["isReadOnly"],isValid:["isValid"]},templateString:_1866,resources:_1867,buildRendering:function(){this.inherited(arguments);var store=this.model.get("reviewers");this.headerTextbox.set("value",this.model.name);this.list=new _1869({className:"epi-chromeless",maintainOddEven:false,store:store,sort:"default",renderRow:this._renderReviewer.bind(this)},this.listNode);this.own(this.list.addKeyHandler(keys.DOWN_ARROW,function(evt){evt.stopPropagation();if(evt.target===evt.currentTarget.lastElementChild){this.searchBox.focus();}}.bind(this)),this.list.addKeyHandler(keys.UP_ARROW,function(evt){evt.stopPropagation();}),this.headerTextbox.on("change",function(value){this.model.set("name",value);}.bind(this)));var _186d={"class":"epi-approval-step__add-step__button",showLabel:false,tabIndex:-1},_186e=new _1857({settings:_186d}),_186f=[{category:"add",builder:_186e,target:this.arrowNode},{category:"remove",builder:_186e,target:this.removeNode}];new _1858({configuration:_186f,commandSource:this});var _1870=this.model.get("userStore");this.searchBox=new _186a({labelAttr:"displayName",queryExpr:"${0}",query:{includeRoles:true},store:_1870,searchAttr:"name",autoComplete:false,maxHeight:294},this.searchNode);this.own(_1855.before(this.searchBox,"onSearch",this._searchBoxOnSearch.bind(this)),this.searchBox.on("change",this._searchBoxOnChange.bind(this)),this.searchBox.on("moveUp",function(evt){_1861.moveFocusEnd.call(this.list,evt);}.bind(this)),this.searchBox.on("keypress",function(evt){evt.stopPropagation();}));},_renderReviewer:function(model){var _1871=new _1865({model:model,languageOptions:this.languageOptions});this.own(_1871.on("remove-reviewer",function(_1872){this.model.removeReviewer(_1872);}.bind(this)));return _1871.domNode;},_searchBoxOnSearch:function(users,query,_1873){users=this.model.filterOutExistingUsers(users);return [users,query,_1873];},_searchBoxOnChange:function(value){if(!value||!this.searchBox.item){return;}this.model.addReviewer(this.searchBox.item);this.searchBox.set("value","");},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.searchBox.startup();this.list.contentNode.tabIndex=-1;},getCommands:function(){return this.model.get("commands");},_setIsReadOnlyAttr:function(_1874){this._set("isReadOnly",_1874);_1856.toggle(this.domNode,"epi-approval-step--read-only",_1874);this.headerTextbox.set({readOnly:_1874,tabIndex:_1874?-1:0});},_setIsValidAttr:function(_1875){this._set("isValid",_1875);var _1876=!_1875&&this.model.get("showValidations");var _1877=this.model.hasErrors();_1856.toggle(this.domNode,"epi-approval-step--error",_1876&&_1877);_1856.toggle(this.domNode,"epi-approval-step--warning",_1876&&(!_1877&&this.model.hasWarnings()));}});});},"epi/shell/dgrid/SingleQuery":function(){define("epi/shell/dgrid/SingleQuery",["dojo/_base/declare","dgrid/_StoreMixin"],function(_1878,_1879){return _1878(_1879,{refresh:function(){this.inherited(arguments);if(!this._started||!this.store){return;}return this._trackError(function(){var _187a=this.get("queryOptions"),_187b=this.store.query(this.query,_187a);return this.renderArray(_187b,null,_187a);}.bind(this));},renderArray:function(){var rows=this.inherited(arguments);this._lastCollection=null;return rows;}});});},"epi-cms/content-approval/Reviewer":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/store/Memory","dijit/_WidgetBase","dijit/Tooltip","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","./groupMembersListFormatter","./ApprovalEnums","dojo/text!./templates/Reviewer.html","epi/i18n!epi/nls/episerver.cms.contentapproval.reviewer","epi-cms/contentediting/editors/CheckboxListDropDown"],function(_187c,_187d,_187e,_187f,keys,_1880,_1881,_1882,_1883,_1884,_1885,_1886,_1887,_1888,_1889){return _187c([_1881,_1883,_1884,_1885],{model:null,modelBindingMap:{canApprove:["canApprove"]},templateString:_1888,resources:_1889,tooltip:null,postMixInProperties:function(){if(!this.model){throw new Error("An instance of ReviewerViewModel must be provided in order to create an Reviewer component.");}},buildRendering:function(){this.inherited(arguments);if(this.model.reviewerType===_1887.reviewerType.role){this.own(this.tooltip=new _1882({connectId:[this.selectedReviewerNode],label:this._formatMembersTooltipLabel(),position:["below-centered","above-centered"]}));}this.set("displayName",this.model.get("displayName"));var store=new _1880({idProperty:"value",data:this.languageOptions||[]});this.languageSelector.set("store",store);if(this.model.languages){this.languageSelector.set("value",this.model.languages,false);}_187d.toggle(this.languageSelector.domNode,"dijitHidden",!this.languageOptions);_187d.add(this.reviewerIcon,this.model.get("icon"));this.own(this.on(".epi-reviewer__remove-button:click",this._removeReviewer.bind(this)),this.on("keydown",this._removeReviewer.bind(this)),this.languageSelector.on("change",function(_188a){this.model.set("languages",_188a);this._renderSelectedLanguages();}.bind(this)));this._renderSelectedLanguages();},_formatMembersTooltipLabel:function(){var _188b=this.model.get("roleFirstUsersNames");if(!_188b||_188b.length===0){return _1889.nogroupmembers;}var _188c="<div class='epi-approval-group-tooltip'>"+_1886.renderList(_188b);var _188d=this.model.get("numberOfOtherUsers");if(_188d>0){_188c+="<div>+"+_188d+"</div>";}_188c+="</div>";return _188c;},_removeReviewer:function(evt){if(evt.type==="click"||evt.keyCode===keys.DELETE){evt.stopPropagation();this.emit("remove-reviewer",this.model);}},_renderSelectedLanguages:function(){_187e.empty(this.languageSettingsNode);if(!this.languageOptions){return;}var self=this;function _188e(_188f){var _1890=self.languageSelector.store.get(_188f),_1891="dijitInline epi-lozenge";if(!_1890&&self.model.languages.length>0){_1891+=" epi-lozenge--inactive";}var _1892={innerHTML:_188f,"class":_1891,title:_1890?_1890.label:_188f};_187e.create("span",_1892,self.languageSettingsNode);};if(this.model.languages){if(this.model.languages.length<1){_188e(_1889.alllanguages);return;}this.model.languages.forEach(_188e);}},_setDisplayNameAttr:{node:"userDisplayNameNode",type:"innerHTML"},_setCanApproveAttr:function(_1893){this._set("canApprove",_1893);_187f.set(this.domNode,"display",_1893?"":"none");}});});},"epi-cms/content-approval/groupMembersListFormatter":function(){define(["dojo/_base/lang"],function(lang){var _1894="<span class='epi-reviewer__name'>{name}</span></span>";var _1895={renderList:function(users){var res=[];users.forEach(function(u){res.push(lang.replace(_1894,{name:u}));});return res.join(" ");}};return _1895;});},"url:epi-cms/content-approval/templates/Reviewer.html":"<div class=\"epi-reviewer\">\r\n    <button class=\"epi-button--round epi-reviewer__remove-button\"\r\n            tabindex=\"-1\"\r\n            data-dojo-type=\"dijit/form/Button\"\r\n            type=\"button\">\r\n        <span class=\"dijitInline dijitIcon dijitReset epi-iconMinus epi-icon--inverted\"></span>\r\n    </button>\r\n    <span data-dojo-attach-point=\"selectedReviewerNode\">\r\n        <span data-dojo-attach-point=\"reviewerIcon\" class=\"dijitInline dijitIcon\"></span>\r\n        <span class=\"dijitInline epi-reviewer__name\" data-dojo-attach-point=\"userDisplayNameNode\"></span>\r\n    </span>\r\n    <span class=\"epi-reviewer__language-selector epi-chromeless epi-chromeless--icon-only epi-chromeless--with-arrow\"\r\n          data-dojo-attach-point=\"languageSelector\"\r\n          data-dojo-type=\"epi-cms/contentediting/editors/CheckboxListDropDown\"\r\n          data-dojo-props=\"iconClass: 'epi-iconWebsite', header: '${resources.selectlanguage}', selectAllText: '${resources.anylanguage}'\"></span>\r\n    <span class=\"dijitInline\" data-dojo-attach-point=\"languageSettingsNode\"></span>\r\n</div>\r\n","epi-cms/contentediting/editors/CheckboxListDropDown":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojox/html/entities","epi/epi","epi/i18n!epi/nls/episerver.shared.action","./CheckboxList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_1896,lang,on,_1897,epi,_1898,_1899,_189a,_189b){return _1896([_189b,_189a],{value:null,store:null,sort:null,query:null,enableSelectAll:true,selectAllText:_1898.selectall,header:_1898.select,buildRendering:function(){this.own(this.dropDown=new _1899({baseClass:"dijitMenu",header:this.header,enableSelectAll:this.enableSelectAll,selectAllText:this.selectAllText,onExecute:function(){}}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);}),true));this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableSelectAll&&!this.value){this.set("value",null);}},compare:function(_189c,_189d){return epi.areEqual(_189c,_189d)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _189e=this.dropDown.refresh();return _189e.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableSelectAll){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_1897.encode(value||"")]);},_setValueAttr:function(value,_189f){!_189f&&this.dropDown&&this.dropDown.set("selectedItems",value);this.inherited(arguments);}});});},"epi-cms/contentediting/editors/CheckboxList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","epi/epi","dojo/text!./templates/CheckboxList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.action","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer"],function(_18a0,lang,keys,when,_18a1,_18a2,epi,_18a3,_18a4,_18a5,_18a6,_18a7,_18a8,mouse,put,_18a9,_18aa,_18ab,_18ac,_18ad){return _18a0([_18aa,_18ab,_18ac,_18ad],{templateString:_18a3,store:null,query:null,enableSelectAll:true,selectAllText:_18a4.selectall,header:_18a4.select,_setHeaderAttr:{node:"headerNode",type:"innerText"},buildRendering:function(){this.inherited(arguments);this.list=new (_18a0([_18a5,_18a6,_18a8,_18a7,_18a9]))({className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionEvents:"click",selectionMode:"toggle",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.list.on("change",function(e){e.stopPropagation();});this.own(this.list,this.list.on("dgrid-select,dgrid-deselect",lang.hitch(this,"_itemsSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(mouse.enterRow,lang.hitch(this,"_listMouseover")),this.selectAll.on("click",lang.hitch(this,"_selectAllSelected")),this.selectAll.on("keypress",lang.hitch(this,"_selectAllKeypress")),this.selectAll.on("mouseover",lang.hitch(this,"_selectAllMouseover")));if(this.enableSelectAll){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_18a1.add(this.selectAll.domNode,"dijitHidden");}this.selectAll.set({iconClass:"dijitCheckBoxIcon",label:_18a2.encode(this.selectAllText),title:this.selectAllText});},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.list.set("store",this.store);},focus:function(){if(this.enableSelectAll){this.selectAll.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_18ae){var _18af=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitCheckBox"));var label=put("label.epi-selector-list__title.dojoxEllipsis","span",{title:item.label,textContent:item.label});return put("div",[_18af,label]);},refresh:function(){if(!this._started){return;}return this.list.refresh();},_itemsSelected:function(e){var _18b0=[];Object.keys(e.grid.selection).forEach(function(key){_18b0.push(key);});if(!epi.areEqual(_18b0,this.get("selectedItems"))){this.set("selectedItems",_18b0,true);this.emit("change",{value:_18b0});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(total){this.emit("loaded");_18a1.toggle(this.separatorNode,"dijitHidden",!total||!this.enableSelectAll);}));},_selectAllSelected:function(){this.set("selectedItems",null);},_selectAllKeypress:function(e){var _18b1;switch(e.keyCode){case keys.DOWN_ARROW:_18b1=_18a7.moveFocusHome;break;case keys.PAGE_DOWN:_18b1=_18a7.moveFocusPageDown;break;case keys.END:_18b1=_18a7.moveFocusEnd;break;default:return;}_18b1.apply(this.list,[e]);},_selectAllMouseover:function(){this.selectAll.focus();},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_18b2=list.up(row,1,true);if(row.id===_18b2.id){this.selectAll.focus();}},_listNavigateHome:function(){this.selectAll.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_setSelectedItemsAttr:function(_18b3,_18b4){this._set("selectedItems",_18b3);if(!_18b4){this.list.clearSelection();if(_18b3){_18b3.forEach(function(item){this.list.select(item);}.bind(this));}}this._updateView();},_updateView:function(){this.selectAll.set("checked",!this.selectedItems||this.selectedItems.length===0);}});});},"url:epi-cms/contentediting/editors/templates/CheckboxList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\"></span><div class=\"dijitTooltipConnector\"></div>\r\n        </div>\r\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"selectAll\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitcheckboxicon'\"></button>\r\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","url:epi-cms/content-approval/templates/ApprovalStep.html":"<div class=\"epi-approval-step\">\r\n    <div class=\"epi-approval-step__header\">\r\n        <div class=\"dijitInline dojoDndHandle\">\r\n            <span class=\"dijitInline epi-iconDnD\"></span>\r\n        </div>\r\n        <div placeholder=\"${resources.header.placeholder}\" title=\"${resources.header.tooltip}\" data-dojo-attach-point=\"headerTextbox\" data-dojo-type=\"dijit/form/TextBox\"></div>\r\n        <div class=\"dijitInline\" data-dojo-attach-point=\"removeNode\"></div>\r\n    </div>\r\n    <div class=\"epi-approval-step__container\">\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n        <div class=\"epi-reviewer__add\">\r\n            <span class=\"dijitInline dijitIcon epi-iconUser\"></span>\r\n            <div class=\"dijitInline\" data-dojo-attach-point=\"searchNode\"></div>\r\n        </div>\r\n    </div>\r\n    <div class=\"epi-approval-step__add-step\" data-dojo-attach-point=\"arrowNode\"></div>\r\n</div>\r\n","dgrid/extensions/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/on","dojo/topic","dojo/has","dojo/dnd/Source","dojo/dnd/Manager","dojo/_base/NodeList","put-selector/put","../Selection","dojo/has!touch?../util/touch","dojo/has!touch?./_DnD-touch-autoscroll","xstyle/css!dojo/resources/dnd.css"],function(_18b5,lang,_18b6,_18b7,_18b8,on,topic,has,_18b9,_18ba,_18bb,put,_18bc,_18bd){var _18be=_18b5(_18b9,{grid:null,getObject:function(node){var grid=this.grid;return grid.store.get(node.id.slice(grid.id.length+5));},_legalMouseDown:function(evt){var legal=this.inherited(arguments);return legal&&evt.target!=this.grid.bodyNode;},onDrop:function(_18bf,nodes,copy){var _18c0=this,_18c1=this._targetAnchor=this.targetAnchor,grid=this.grid,store=grid.store;if(!this.before&&_18c1){_18c1=_18c1.nextSibling;}_18c1=_18c1&&grid.row(_18c1);_18b7.when(_18c1&&store.get(_18c1.id),function(_18c2){if(_18c0!=_18bf){_18c0.onDropExternal(_18bf,nodes,copy,_18c2);}else{_18c0.onDropInternal(nodes,copy,_18c2);}});},onDropInternal:function(nodes,copy,_18c3){var grid=this.grid,store=grid.store,_18c4=this,_18c5=_18c4._targetAnchor,_18c6,_18c7;if(_18c5){_18c6=this.before?_18c5.previousSibling:_18c5.nextSibling;}_18c7=grid.row(nodes[0]);if(!copy&&(_18c6===nodes[0]||(!_18c3&&_18c7&&grid.down(_18c7).element==nodes[0]))){return;}nodes.forEach(function(node){_18b7.when(_18c4.getObject(node),function(_18c8){var id=store.getIdentity(_18c8);store[copy&&store.copy?"copy":"put"](_18c8,{before:_18c3});if(_18c4._selectedNodes[id]){_18c4._selectedNodes[id]=grid.row(id).element;}});});},onDropExternal:function(_18c9,nodes,copy,_18ca){var store=this.grid.store,_18cb=_18c9.grid;nodes.forEach(function(node,i){_18b7.when(_18c9.getObject(node),function(_18cc){if(!copy){if(_18cb){_18b7.when(_18cb.store.getIdentity(_18cc),function(id){!i&&_18c9.selectNone();_18c9.delItem(node.id);_18cb.store.remove(id);});}else{_18c9.deleteSelectedNodes();}}store[store.copy?"copy":"put"](_18cc,{before:_18ca});});});},onDndStart:function(_18cd,nodes,copy){this.inherited(arguments);if(_18cd==this){if(this.grid.cancelTouchScroll){this.grid.cancelTouchScroll();}_18ba.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px";}},onMouseDown:function(evt){if(has("touch")&&this.isDragging&&_18bd.countCurrentTouches(evt,this.grid.touchNode)>1){topic.publish("/dnd/cancel");_18ba.manager().stopDrag();}else{this.inherited(arguments);}},onMouseMove:function(evt){if(!has("touch")||_18bd.countCurrentTouches(evt,this.grid.touchNode)<=1){this.inherited(arguments);}},checkAcceptance:function(_18ce,nodes){return _18ce.getObject&&_18b9.prototype.checkAcceptance.apply(this,arguments);},getSelectedNodes:function(){if(!this.grid.selection){return this.inherited(arguments);}var t=new _18bb(),id;for(id in this.grid.selection){t.push(this._selectedNodes[id]);}return t;}});var DnD=_18b5(_18bc,{dndSourceType:"dgrid-row",dndParams:null,dndConstructor:_18be,postMixInProperties:function(){this.inherited(arguments);this.dndParams=lang.mixin({accept:[this.dndSourceType]},this.dndParams);},postCreate:function(){this.inherited(arguments);this.dndSource=new (this.dndConstructor||_18be)(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));var _18cf=this.dndSource._selectedNodes={};function _18d0(row){_18cf[row.id]=row.element;};function _18d1(row){delete _18cf[row.id];put(row.element,"!dojoDndItemSelected!dojoDndItemAnchor");};this.on("dgrid-select",function(event){_18b6.forEach(event.rows,_18d0);});this.on("dgrid-deselect",function(event){_18b6.forEach(event.rows,_18d1);});_18b8.after(this,"destroy",function(){delete this.dndSource._selectedNodes;_18cf=null;this.dndSource.destroy();},true);},insertRow:function(_18d2){var row=this.inherited(arguments),type=typeof this.getObjectDndType=="function"?this.getObjectDndType(_18d2):[this.dndSourceType];put(row,".dojoDndItem");this.dndSource.setItem(row.id,{data:_18d2,type:type instanceof Array?type:[type]});return row;},removeRow:function(_18d3){this.dndSource.delItem(this.row(_18d3));this.inherited(arguments);}});DnD.GridSource=_18be;return DnD;});},"url:epi-cms/content-approval/templates/ApprovalStepList.html":"<div class=\"epi-approval-step-list\">\r\n    <div class=\"epi-approval-step-list__status\">\r\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--review\"></span><h2 class=\"dijitInline\">${resources.readytoreview}</h2>\r\n    </div>\r\n    <div data-dojo-attach-point=\"listNode\"></div>\r\n\r\n    <div class=\"epi-approval-step-list__status\">\r\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--publish\"></span><h2 class=\"dijitInline\">${resources.readytopublish}</h2>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,array,_18d4,lang,url,win,_18d5,_18d6,on,topic,_18d7,_18d8,_18d9,epi,_18da,_18db,_18dc,res,_18dd){return _18d4([_18d8,_18d7,_18d9,_18da],{templateString:_18dd,_setContentTypeNameAttr:function(value){this.typeNode.textContent=value;this.typeNode.title=value;},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_18de){this.languagesNode.innerHTML="";array.forEach(_18de,function(item,idx){var elm,_18df=idx===_18de.length-1;if(item.isCurrentLanguage){elm=_18d6.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_18d6.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_18d6.place(elm,this.languagesNode);if(!_18df){_18d6.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_18e0){this.visibleToNode.innerHTML=_18e0?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(value){_18d5.set(this.manageAccessRightsButton.domNode,"display",value?"":"none");},resources:null,modelBindingMap:{contentTypeName:["contentTypeName"],contentId:["contentId"],existingLanguages:["existingLanguages"],visibleToEveryOne:["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _18e1=new _18db();this._menuAssembler=new _18dc({configuration:[{builder:_18e1,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(value){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<ul class=\"epi-form-container__section\">\r\n    <ul data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></ul>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.visibleto.title}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span data-dojo-attach-point=\"visibleToNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.existinglanguages}</label>\r\n        <span data-dojo-attach-point=\"languagesNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.idandtypename}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\">\r\n                <span data-dojo-attach-point=\"idNode\"></span>, <span data-dojo-attach-point=\"typeNode\"></span>\r\n            </span>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label></label>\r\n        <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n            <span>${resources.toolsbutton.label}</span>\r\n            <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n        </div>\r\n    </li>\r\n</ul>","epi-cms/contentediting/ContentPreview":function(){define(["dojo/_base/declare","epi-cms/contentediting/_View"],function(_18e2,_18e3){return _18e2([_18e3],{noPreview:true,constructor:function(){this.defaultQueryParameters={};},startup:function(){this.inherited(arguments);this.overlay.set("enabled",true);this.iframeWithOverlay.set("previewClass","epi-editorViewport-preview--previewing");},destroy:function(){this.iframeWithOverlay.set("previewClass","");this.inherited(arguments);}});});},"epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/DialogService","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_18e4,lang,_18e5,_18e6,_18e7,topic,when,_18e8,_18e9,_18ea,_18eb,_18ec,_18ed,_18ee,_18ef,_18f0,_18f1,_18f2,_18f3,_18f4,_18f5,_18f6,_18f7,_18f8,_18f9){return _18e4([_18eb,_18e8,_18e9,_18f0],{templateString:_18f8,sharedResources:_18f9,modelType:_18f3,_contextService:null,_beingSuspended:null,modelBindingMap:{parent:["parent"],requestedType:["requestedType"],metadata:["metadata"],isContentTypeSelected:["isContentTypeSelected"],headingText:["headingText"],createAsLocalAssetHelpText:["createAsLocalAssetHelpText"],contentName:["contentName"],contentNameHelpText:["contentNameHelpText"],wizardStep:["wizardStep"],showAllProperties:["showAllProperties"],createAsLocalAsset:["createAsLocalAsset"],seamlessTopPanel:["seamlessTopPanel"],namePanelIsVisible:["namePanelIsVisible"],headingPanelIsVisible:["headingPanelIsVisible"],saveButtonIsVisible:["saveButtonIsVisible"],saveButtonDisabled:["saveButtonDisabled"],showCurrentNodeOnBreadcrumb:["showCurrentNodeOnBreadcrumb"],notificationContext:["notificationContext"],actualParentLink:["actualParentLink"],propertyFilter:["propertyFilter"],allowedTypes:["allowedTypes"],restrictedTypes:["restrictedTypes"]},_setParentAttr:function(_18fa){if(_18fa){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_18fa.name,dataType:_18fa.typeIdentifier});}},_setPropertyFilterAttr:function(_18fb){this._set("propertyFilter",_18fb);this.propertiesForm.propertyFilter=_18fb;},_setAllowedTypesAttr:function(value){this.contentTypeList.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this.contentTypeList.set("restrictedTypes",value);},_setRequestedTypeAttr:function(_18fc){this.contentTypeList.set("requestedType",_18fc);},_setMetadataAttr:function(_18fd){if(_18fd){this.propertiesForm.set("metadata",_18fd);}},_setHeadingTextAttr:function(_18fe){this.headingTextNode.textContent=this.subHeadingTextNode.textContent=_18fe;},_setContentNameHelpTextAttr:{node:"contentNameHelpTextNode",type:"innerText"},_setCreateAsLocalAssetAttr:function(_18ff){this._set("createAsLocalAsset",_18ff);var _1900=this.model.get("parent");if(_1900){this.toolbar.setItemProperty("breadcrumbs","contentLink",_18ff?_1900.assetsFolderLink:_1900.contentLink);}this.contentTypeList.set("localAsset",_18ff);},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_1901){this.nameTextBox.set("value",_1901);},_setWizardStepAttr:function(_1902){var _1903;var child;if(_1902<0||_1902===this.wizardStep){return;}_1903=this.stackContainer.getChildren();if(_1902<_1903.length){child=_1903[_1902];this.stackContainer.selectChild(child);this._set("wizardStep",_1902);}},_setShowAllPropertiesAttr:function(_1904){this._set("showAllProperties",_1904);this.propertiesForm.set("showAllProperties",_1904);},_setSeamlessTopPanelAttr:function(value){_18e7.toggle(this.topPanel.domNode,"epi-listingTopContainer",value);},_setNamePanelIsVisibleAttr:function(_1905){_18e6.set(this.namePanel,"display",_1905?"":"none");},_setHeadingPanelIsVisibleAttr:function(_1906){_18e6.set(this.headingPanel,"display",_1906?"":"none");_18e6.set(this.subHeadingPanel,"display",_1906?"none":"");},_setSaveButtonIsVisibleAttr:function(_1907){this.toolbar.setItemVisibility("saveButton",_1907);},_setSaveButtonDisabledAttr:function(_1908){this.toolbar.setItemProperty("saveButton","disabled",_1908);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_1909){this.toolbar.setItemProperty("notificationCenter","notificationContext",_1909);},_setActualParentLinkAttr:function(_190a){this.contentTypeList.set("parentLink",_190a);},_setContentTypeNameAttr:{type:"innerHTML",node:"contentTypeNameNode"},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_18ef.resolve("epi.shell.ContextService");this._setupToolbar();},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_18e7.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){if(data&&((data.parent&&data.requestedType)||(data.contentData&&data.languageBranch))){this.view=data.view;this._setCreateMode();this._beingSuspended=false;this.set("contentTypeName","");when(this.model.update(data),lang.hitch(this,function(){this.layout();if(this.nameTextBox){this.nameTextBox.focus();this.nameTextBox.textbox.select();}}),function(err){});}},_onSaveSuccess:function(_190b){this._clearCreateMode();this._beingSuspended=true;if(_190b.changeContext){this._changeContext(_190b.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){topic.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();topic.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_190c){var _190d=new _18f2({defaultContentName:_190c});_18f1.dialog({defaultActionsVisible:false,autofocus:true,content:_190d,title:_190d.title}).then(function(){var name=_190d.get("value");if(name===_190c){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}.bind(this)).otherwise(function(){if(this.contentTypeList.shouldSkipContentTypeSelection){this._cancel();}else{this.model.set("isContentTypeSelected",false);}}.bind(this));},_onContentTypeSelected:function(item){if(!this.isContentTypeSelected){this.model.set("contentTypeId",item.id);this.set("contentTypeName",item.localizedName);}},_onPropertyValidStateChange:function(_190e,error){if(error){this.model.addInvalidProperty(_190e,error);}else{this.model.removeInvalidProperty(_190e);}},_onBlurVerifyContent:function(){if(this.nameTextBox.get("value")===""){this.nameTextBox.set("value",this.model.defaultName);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _190f=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1910=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_18f9.action.create,label:_18f9.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-button--bold epi-primary"}},{parent:"trailing",name:"cancelButton",title:_18f9.action.cancel,label:_18f9.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-button--bold"}}];when(this.toolbar.add(_190f),lang.hitch(this,function(){this.toolbar.add(_1910);}));},_changeContext:function(_1911){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1911},{sender:this,viewName:this.view,forceContextChange:true,forceReload:true});},_backToCurrentContext:function(){topic.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"create"});topic.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_18e7.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{currentMode:undefined});topic.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/keys","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_1912,lang,_1913,keys,_1914,_1915,_1916,_1917,_1918,epi,_1919,_191a,_191b,_191c,res){return _1912([_1915,_1916,_1917,_191b,_1919,_1914],{templateString:_191c,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _191d=this.contentNameTextbox.isValid();if(evt.keyCode===keys.ENTER&&_191d){this.executeDialog();}}));this.on("focus",lang.hitch(this,function(){this.contentNameTextbox.textbox.select();}));},_getValueAttr:function(){return this.contentNameTextbox.get("value");},_onBlurVerifyContent:function(){if(this.contentNameTextbox.get("value")===""){this.contentNameTextbox.set("value",this.defaultContentName);}},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-attach-point=\"messageNode\"></div>\r\n    <br />\r\n    <div>\r\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\r\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                data-dojo-props=\"required: true, trim:true, selectOnClick: true\"\r\n                data-dojo-attach-event=\"onBlur: _onBlurVerifyContent\"\r\n                missingMessage: \"${res.errormessage.missingmessage}\" />\r\n    </div>\r\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/shell/ui/nls/episerver.shared.messages","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(array,_191e,lang,json,_191f,_1920,when,_1921,_1922,_1923,_1924,_1925,_1926,_1927){return _191e([_191f,_1921],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",contentDataStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,autoPublish:false,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,contentNameHelpText:"",createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,actualParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);if(!this.contentDataStore){var _1928=_1922.resolve("epi.storeregistry");this.contentDataStore=_1928.get("epi.cms.contentdata");}this.metadataManager=this.metadataManager||_1922.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_1922.resolve("epi.cms.ProjectService");this.validator=this.validator||new _1925({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_1929){this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);this.set("isContentTypeSelected",false);this.set("namePanelIsVisible",true);this.set("headingPanelIsVisible",true);this.set("showCurrentNodeOnBreadcrumb",true);this.set("seamlessTopPanel",true);if(_1929){array.forEach(["allowedTypes","restrictedTypes","requestedType","parent","createAsLocalAsset","autoPublish","addToDestination","contentTypeId"],function(_192a){this.set(_192a,_1929[_192a]);},this);}if(this.parent){var _192b=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_192b);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_192b});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){var _192c=this.contentName;if(this.metadata&&this.metadata.additionalValues&&this.metadata.additionalValues.modelTypeIdentifier){_192c=_1923.getResourceValue(this.metadata.additionalValues.modelTypeIdentifier,"newitemdefaultname");}this._emitSaveEvent("invalidContentName",_192c);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_192d){if(_192d){this._emitSaveEvent("validationError");return;}var _192e=this.buildContentObject();this.projectService.getCurrentProjectId().then(function(_192f){_192e.autoPublish=_192e.autoPublish&&!_192f;this.contentDataStore.put(_192e).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}.bind(this));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_1930,_1931){this.set("saveButtonDisabled",false);this.emit(_1930,_1931);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_1932,_1933){var _1934=_1933.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_1933.originalGroupName!=="Advanced";var _1935=this._isRequiredProperty(_1932,_1933);if(this.showAllProperties){return _1934||_1935;}else{return _1935;}},_saveSuccessHandler:function(_1936){var ref=new _1924(_1936),_1937=ref.createVersionUnspecificReference(),_1938=lang.hitch(this,function(_1939){this._emitSaveEvent("saveSuccess",{newContentLink:_1939,changeContext:true});});when(this.contentDataStore.refresh(_1936),lang.hitch(this,function(_193a){if(this.addToDestination){this.addToDestination.save({contentLink:_1937.toString(),name:_193a.name,typeIdentifier:_193a.typeIdentifier});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_1938(_1937.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _193b=json.fromJson(err.responseText);array.forEach(_193b,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:_1920.trim(this.contentName+""),parentLink:this._getParentLink(),contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset,autoPublish:this.autoPublish};},addInvalidProperty:function(_193c,_193d){this.validator.setPropertyErrors(_193c,[{severity:this.validator.severity.error,errorMessage:_193d}],this.validator.validationSource.client);},removeInvalidProperty:function(_193e){this.validator.clearPropertyErrors(_193e);},_contentTypeIdSetter:function(_193f){this.contentTypeId=_193f;if(_193f&&this.parent){this.set("isContentTypeSelected",true);this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this._getMetadata(this.parent.contentLink,_193f),lang.hitch(this,function(_1940){_1940=this._regroupProperties(_1940);this.set("metadata",_1940);if(this.autoPublish||this._hasRequiredProperties(_1940)){this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}),lang.hitch(this,function(){this.set("isContentTypeSelected",false);this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:_1926.unexpectederror}],this.validator.validationSource.server);}));}},_createAsLocalAssetSetter:function(_1941){this.createAsLocalAsset=_1941;if(this.parent){this.set("actualParentLink",this._getParentLink());}},_autoPublishSetter:function(_1942){this.set("showAllProperties",_1942);this.autoPublish=_1942;},_parentSetter:function(_1943){this.parent=_1943;var _1944=this.parent.typeIdentifier,_1945=_1923.getResourceValue(this.requestedType,"name"),_1946=_1923.getResourceValue(_1944,"name"),_1947=_1923.getResourceValue(_1944,"createaslocalassethelptext");if(_1945&&_1946){_1947=lang.replace(_1947,[_1945.toLowerCase(),_1946.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_1947);},_requestedTypeSetter:function(_1948){var _1949=_1923.getResourceValue(_1948,"create"),_194a=_1923.getResourceValue(_1948,"newitemdefaultname");this.defaultName=_194a;this.set("headingText",_1949);this.set("contentName",_194a);this.requestedType=_1948;},_getParentLink:function(){if(!this.parent){return null;}if(this.createAsLocalAsset){return this.parent.ownerContentLink?this.parent.ownerContentLink:this.parent.contentLink;}return this.parent.contentLink;},_hasRequiredProperties:function(_194b){return array.some(_194b.properties,function(_194c){return this._isRequiredProperty(_194b,_194c);},this);},_isRequired:function(_194d){return _194d.settings&&_194d.settings.required;},_isRequiredProperty:function(_194e,_194f){var _1950=!_194f.additionalValues.hasValue;var _1951=_194f.showForEdit&&array.every(_194e.groups,function(group){return (group.name!==_194f.groupName&&group.name!==_194f.originalGroupName)||group.displayUI;});var _1952=array.some(_194f.properties,function(_1953){return this._isRequiredProperty(_194f,_1953);},this);return (this._isRequired(_194f)||_1952)&&_1950&&_1951&&(_194f.name!=="icontent_name");},_regroupProperties:function(_1954){_1954=lang.clone(_1954);_1954.layoutType=this._topLevelContainerType;array.forEach(_1954.properties,function(prop){var _1955=this._isRequiredProperty(_1954,prop);prop.originalGroupName=prop.groupName;prop.groupName=_1955?"required":"additional";},this);_1954.groups=[{name:"required",displayUI:true,title:_1927.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_1927.groups.additional,uiType:this._groupContainerType}];return _1954;},_getMetadata:function(_1956,_1957){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_1956,contentTypeId:_1957});}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi-cms/widget/viewmodel/ContentTypeListViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(_1958,_1959,all,when,_195a,_195b,_195c,_195d,i18n){return _1958([_195a],{parentLink:null,requestedType:null,shouldSkipContentTypeSelection:null,allowedTypes:null,restrictedTypes:null,postMixInProperties:function(){this.inherited(arguments);this.model=new _195d();this.own(this.model);},buildRendering:function(){this.inherited(arguments);var _195e=new _195c();this.connect(_195e,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_195e);this._suggestedContentTypes=_195e;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this.model.getSortedSuggestedContentTypes(),groups:this.model.getSortedGroupContentTypes()})).then(function(_195f){var types=_195f.types,_1960=_195f.groups,_1961=_1960.grouped,_1962=_1960.contentTypes;if(types.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_1959.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",types);this._suggestedContentTypes.setVisibility(true);}var key,group;for(key in _1961){group=this._getOrCreateGroup(key);group.set("contentTypes",_1961[key]);}if(_1962 instanceof Array&&_1962.length===1){this.setVisibility(false);this.set("shouldSkipContentTypeSelection",true);this.onContentTypeSelected(_1962[0]);}else{this.set("shouldSkipContentTypeSelection",false);}}.bind(this));},setVisibility:function(_1963){this.getChildren().forEach(function(group){group.setVisibility(_1963);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_195b.getResourceValue(this.requestedType,"suggestedtypes");this.model.otherTypesTitle=_195b.getResourceValue(this.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();this.model.clear();},_getOrCreateGroup:function(name){var group=this.model.groups[name];if(!group){group=new _195c({title:name});this.connect(group,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(group);this.model.groups[name]=group;}return group;},_setLocalAssetAttr:function(_1964){this._set("localAsset",_1964);this.model.set("localAsset",_1964);if(this.requestedType&&this.parentLink){this.refresh();}},_setParentLinkAttr:function(value){this._set("parentLink",value);this.model.set("parentLink",value);if(this.requestedType){this.refresh();}},_setRequestedTypeAttr:function(value){this._set("requestedType",value);this.model.set("requestedType",value);},_setAllowedTypesAttr:function(value){this._set("allowedTypes",value);this.model.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this._set("restrictedTypes",value);this.model.set("restrictedTypes",value);},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_1965,lang,array,_1966,_1967,_1968,_1969,_196a,keys,_196b){return _1965([_1969,_1968,_196b],{title:"",contentTypes:null,templateString:_1967,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();array.forEach(this.contentTypes,function(type){var child=new _196a({contentType:type});this.connect(child,"onSelect",this.onSelect);this.addChild(child);},this);},clear:function(){array.forEach(this.getChildren(),function(child){this.removeChild(child);child.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(value){this._set("contentTypes",value);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_196c){var value=(_196c?"block":"none");_1966.set(this.domNode,"display",value);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\r\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\r\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\r\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_196d,_196e,focus,_196f,_1970,i18n,_1971){return dojo.declare([_196f,_1970],{templateString:_1971,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_196e.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(value){this._set("contentType",value);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(value){this._set("icon",value);this.iconNode.innerHTML=value?_196e.substitute(this.iconTemplate,[value,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_196d.add(this.focusNode,"epi-advancedListingItemActive");focus.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_196d.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_196d.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_196d.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\r\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\r\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\r\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\r\n</li>","epi-cms/widget/viewmodel/ContentTypeListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/when","dojo/Stateful","epi/dependency"],function(array,_1972,_1973,all,when,_1974,_1975){return _1972([_1974],{store:null,parentLink:null,groups:null,requestedType:null,allowedTypes:null,restrictedTypes:null,contentTypeService:null,localAsset:false,otherTypesTitle:null,postscript:function(){this.inherited(arguments);this.groups={};this.contentTypeService=this.contentTypeService||_1975.resolve("epi.cms.ContentTypeService");if(!this.store){var _1976=_1975.resolve("epi.storeregistry");this.store=_1976.get("epi.cms.contenttype");}},getSortedSuggestedContentTypes:function(){return when(this._getSuggestedContentTypes(this.requestedType)).then(function(types){if(types.length>1){this._sortContentTypes(types);}return types;}.bind(this));},getSortedGroupContentTypes:function(){return when(this._groupContentTypes()).then(function(_1977){var _1978=_1977.grouped;for(var key in _1978){this._sortContentTypes(_1978[key]);}return _1977;}.bind(this));},clear:function(){for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getAvailableContentTypes:function(type){return this.contentTypeService.getAcceptedChildTypes(this.parentLink,this.localAsset,[type],this.allowedTypes,this.restrictedTypes);},_getSuggestedContentTypes:function(type){var _1979=this.store.query({query:"getsuggestedcontenttypes",localAsset:this.localAsset,parentReference:this.parentLink,requestedTypes:[type]});return this.contentTypeService.filterQueryResult(_1979,this.allowedTypes,this.restrictedTypes);},_groupContentTypes:function(){var _197a={},_197b=new _1973(),_197c=this.otherTypesTitle;when(this._getAvailableContentTypes(this.requestedType)).then(function(_197d){var count=_197d.length;array.forEach(_197d,function(item){when(item,function(type){var _197e=type.groupName||_197c,group=_197a[_197e]||[];group.push(type);_197a[_197e]=group;count--;if(count===0){_197b.resolve({grouped:_197a,contentTypes:_197d});}});});}.bind(this));return _197b;},_sortContentTypes:function(types){if(types&&types.length>1){types.sort(function(a,b){return a.localizedName<=b.localizedName?-1:1;});}}});});},"epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(array,_197f,lang,when,_1980,_1981){return _197f([_1980],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(value){this._set("metadata",value);setTimeout(lang.hitch(this,function(){this._setupForm();}),0);},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _1981({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_1982,_1983){this.own(_1983.watch("state",lang.hitch(this,function(name,_1984,value){if(_1984==="Error"&&value!=="Error"){this.onPropertyValidStateChange(_1982);}else{if(_1984!=="Error"&&value==="Error"){this.onPropertyValidStateChange(_1982,_1983.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.domNode.scrollTop=0;this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_1985,_1986){},_getValueAttr:function(){return this._form.get("value");}});});},"url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\r\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\r\n            <div data-dojo-attach-point=\"headingPanel\">\r\n                <h1><span data-dojo-attach-point=\"headingTextNode\"></span>:&nbsp;<span data-dojo-attach-point=\"contentTypeNameNode\"></span></h1>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\r\n            <div data-dojo-attach-point=\"namePanel\">\r\n                <label>${sharedResources.header.name}</label>\r\n                <input data-dojo-attach-point=\"nameTextBox\"\r\n                       data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                       data-dojo-props=\"selectOnClick: true, required: true, trim:true\"\r\n                       data-dojo-attach-event=\"onChange: _onContentNameChange, onBlur: _onBlurVerifyContent\"\r\n                       maxlength=\"255\" />\r\n                <span data-dojo-attach-point=\"contentNameHelpTextNode\" class=\"dijitInline dgrid-no-data\"></span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\" data-dojo-attach-event=\"onContentTypeSelected: _onContentTypeSelected\">\r\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\r\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\r\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_1987,lang,_1988,_1989){return _1987([_1988],{modelType:_1989,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createpage.translate"],function(_198a,lang,when,_198b,_198c,res){return _198a([_198c],{languageBranch:null,masterLanguageVersionId:null,contentNameHelpText:res.namehelptext,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);this._languageStore=this._languageStore||_198b.resolve("epi.storeregistry").get("epi.cms.language");},update:function(_198d){var _198e=_198d.contentData;var _198f=_198d.languageBranch;this.set("contentNameHelpText",_198e.publicUrl?res.namehelptext:"");var self=this;return when(this.contentDataStore.get(_198e.parentLink)).then(function(_1990){var _1991=_198c.prototype.update.apply(self,[{requestedType:_198e.typeIdentifier,parent:_1990,contentTypeId:_198e.contentTypeID}]);self.set("languageBranch",_198f);self.set("masterLanguageVersionId",_198e.contentLink);self.set("contentName",_198e.name);return _1991;}).then(function(_1992){return when(self._languageStore.get(self.languageBranch)).then(function(_1993){self.set("headingText",lang.replace(res.namelabel,[_1993.name]));return _1992;});});},_hasRequiredProperties:function(){return true;},_isRequired:function(_1994){return this.inherited(arguments)&&(!this.languageBranch||_1994.settings.isLanguageSpecific===true);},buildContentObject:function(){var _1995=this.inherited(arguments);lang.mixin(_1995,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _1995;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_1996,_1997,lang,_1998,_1999,_199a,_199b,_199c,_199d,_199e,_199f){return _1997([_199b,_199c,_199d,_199e],{templateString:_199a,value:null,resources:_199f,postCreate:function(){this.inherited(arguments);this.own(this.dateTimeSelector.watch("value",lang.hitch(this,function(value,_19a0,_19a1){this._set("value",_19a1);this.onChange(_19a1);})));},onChange:function(_19a2){this.validate();},validate:function(){var _19a3=this.inherited(arguments);if(_19a3){var value=this.get("value");_19a3=this.disabled||!value||!this.minimumValue||value>this.minimumValue;this._set("state",_19a3?"":"Error");if(_19a3){this.hideMessage();}else{this.displayMessage(this.minimumValueMessage);}}return _19a3;},_setValueAttr:function(value){this.dateTimeSelector.set("value",value);this._set("value",value);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.dateTimeSelector.set("readOnly",value);_1998.set(this.expireNowNode,"display",value?"none":"");}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div>\r\n    <a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-point=\"expireNowNode\"\r\n       data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\r\n</div>\r\n","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_19a4,_19a5){return dojo.declare([_19a4],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _19a6=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_19a6["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_19a6);}var ew=this.editorWidget;var _19a7=new _19a5({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth",destroyOnHide:false});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_19a7,"onHide",this._onHide);this.connect(_19a7,"onCancel",this._onCancel);this._dialog=_19a7;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode===dojo.keys.ENTER&&e.target.tagName==="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(title){if(this._dialog){this._dialog.set("title",title);}this._set("title",title);}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojox/html/entities","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_19a8,lang,_19a9,on,_19aa,_19ab,_19ac,_19ad,_19ae,_19af){return _19a8([_19ad,_19ac,_19af],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _19b0;while((_19b0=this._checkboxes.pop())){_19b0.destroyRecursive();}var _19b1;while((_19b1=this._labelClickHandles.pop())){_19b1.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_19ab.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _19b2=[];var _19b3=this.valueIsInclusive;array.forEach(this._checkboxes,function(_19b4){if(_19b3===_19b4.checked){_19b2.push(_19b4.value);}});this._set("value",this.valueIsCsv?_19b2.join(","):_19b2);},_setValueAttr:function(value){this._set("value",value);var _19b5=[];if(value){_19b5=this.valueIsCsv?value.split(","):value;}var _19b6=this.valueIsInclusive;var _19b7=this._compareCheckboxValue;array.forEach(this._checkboxes,function(_19b8){_19b8.set("checked",_19b6===array.some(_19b5,function(v){return _19b7(_19b8,v);}));});},_compareCheckboxValue:function(_19b9,value){var _19ba=_19b9.value;if(_19ba===undefined||_19ba===null){return false;}return _19ba.toString()===value.toString();},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _19bb=_19a9.create("div",{"class":"epi-checkboxContainer"},this.domNode);var _19bc=new _19ae({value:item.value});_19bc.placeAt(_19bb);this.own(on(_19bc,"change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);})));_19bc.set("readOnly",!!this.readOnly);this._checkboxes.push(_19bc);var label=_19a9.create("label",{"for":_19bc.id},_19bb);label.textContent=item.text;this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_19ab.focus(_19bc.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_19bd,lang,_19be,_19bf,_19c0,json,on,_19c1,when,_19c2,_19c3,_19c4,_19c5,_19c6,_19c7,_19c8,put,_19c9,_19ca,_19cb,_19cc,_19cd,_19ce,_19cf,_19d0,DnD,_19d1,_19d2,_19d3,_19d4,_19d5,_19d6){return _19bd([_19c3,_19c2,_19ca,_19d4],{templateString:_19d5,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_19ce,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_19bd([_19c5,_19c9,_19c6,_19c4,DnD,_19c7,_19c8,_19d2]),gridAssemblerType:_19d3,gridSettings:null,itemModelType:null,itemEditorType:_19cb,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_19d6.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.dialogParams=lang.mixin(this.dialogParams,{"class":this.baseClass+"--dialog"});this.itemModelType=this.itemModelType||_19cf;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(this.model);this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){if(this._destroyed){return;}this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var node=_19bf.create("div");return {node:node,type:this.allowedDndTypes,data:item};},_setupGrid:function(){var _19d7=this._getGridDefinition();var _19d8=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_19d7,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_19d9){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_19d9);})});this.own(this.grid=_19d8.build(this.gridNode,this.commandTargetNode));_19c0.add(this.gridNode,"epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_19be.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_19da,_19db,nodes,copy){var i;if(this.grid.dndSource===_19db){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_19da.length;i++){this._addItem(_19da[i]);if(_19db&&_19db.grid&&_19db.grid.consumer&&_19db.grid.consumer!==this){_19db.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_19dc){this.model.addItem(_19dc,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _19dd=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_19dd);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){if(this.readOnly){return;}var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onCancelDialog:function(){this.inherited(arguments);this._onBlur();},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);}},_renderNoDataMessage:function(){if(this.grid.noDataNode){return;}this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;}});});},"dgrid/extensions/ColumnReorder":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_19de,_19df,on,query,_19e0,put){var _19e1=/(\d+)(?:-(\d+))?$/;function _19e2(grid,match){var _19e3=match[2],_19e4=grid[_19e3?"columnSets":"subRows"][match[1]];return _19e3?_19e4[match[2]]:_19e4;};function _19e5(grid,match,_19e6){if(match[2]){grid.columnSets[match[1]][match[2]]=_19e6;}else{grid.subRows[match[1]]=_19e6;}};function _19e7(_19e8){return "dgrid-"+_19e8+"-";};function _19e9(_19ea,_19eb){return _19eb.slice(_19e7(_19ea).length);};var _19ec=_19de(_19e0,{copyState:function(){return false;},checkAcceptance:function(_19ed,nodes){return _19ed==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_19e1.exec(_19e9(grid.id,nodes[0].getAttribute("dndType"))),_19ee=match[2]?"columnSets":"subRows",_19ef=_19e2(grid,match),_19f0=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _19f1=_19df.map(nodes[0].parentNode.childNodes,function(col){return _19f0[col.columnId];}),_19f2;_19e5(grid,match,_19f1);_19f2={grid:grid,subRow:_19f1,column:_19f0[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_19f2[_19ee]=grid[_19ee];if(on.emit(grid.domNode,"dgrid-columnreorder",_19f2)){grid.set(_19ee,grid[_19ee]);}else{_19e5(grid,match,_19ef);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _19f3=_19de(null,{columnDndConstructor:_19ec,_initSubRowDnd:function(_19f4,_19f5){var _19f6,c,len,col,th;for(c=0,len=_19f4.length;c<len;c++){col=_19f4[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_19f5+"]");if(!_19f6){_19f6=th.parentNode;}}if(_19f6){this._columnDndSources.push(new this.columnDndConstructor(_19f6,{horizontal:true,grid:this}));}},renderHeader:function(){var _19f7=_19e7(this.id),_19f8,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_19f8=this.columnSets.length;cs<_19f8;cs++){_19df.forEach(this.columnSets[cs],function(_19f9,sr){this._initSubRowDnd(_19f9,_19f7+cs+"-"+sr);},this);}}else{_19df.forEach(this.subRows,function(_19fa,sr){this._initSubRowDnd(_19fa,_19f7+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_19df.forEach(this._columnDndSources,function(_19fb){_19fb.destroy();});}this.inherited(arguments);}});_19f3.ColumnDndSource=_19ec;return _19f3;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_19fc,lang,_19fd,_19fe,_19ff,_1a00,when,all,_1a01,_1a02,_1a03,_1a04,_1a05,_1a06,_1a07,_1a08){var _1a09={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _1a0a=_19fc([_1a00,_19ff,_1a01],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_1a03.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_1a06;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_1a0b){this.set("itemMetadata",_1a0b);return this._initData();}));},_initData:function(){this._itemModels=new _1a02([]);this.own(_19fd.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true)));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _1a0c=array.map(this.data,function(item){var _1a0d=new this.itemModelType();return when(_1a0d.fromItemData(item,this.itemType),function(){return _1a0d;});},this);return when(all(_1a0c),lang.hitch(this,function(_1a0e){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_1a0e));}));},getListCommands:function(_1a0f){return [new _1a05({name:"add",tooltip:_1a08.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_1a09.add,_1a0f),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_1a10,_1a11){return [new _1a05({name:"edit",category:_1a11,label:_1a08.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_1a09.edit,_1a10),delegate:lang.hitch(this,this.editItemDelegate)}),new _1a05({name:"moveUp",category:_1a11,label:_1a08.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_1a09.moveUp,_1a10),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _1a05({name:"moveDown",category:_1a11,label:_1a08.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_1a09.moveDown,_1a10),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _1a05({name:"remove",category:_1a11,label:_1a08.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_1a09.remove,_1a10),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_1a12,_1a13){_1a13=_1a13||this.availableCommands;return !!(_1a12&_1a13);},generateColumnsDefinition:function(_1a14){var _1a15={};array.forEach(array.filter(this.itemMetadata.properties,function(_1a16){return array.every(_1a14,function(col){return col!==_1a16.name;});}),function(_1a17){var _1a18=_1a04.pascalToCamel(_1a17.name);_1a15[_1a18]={label:_1a17.displayName||_1a17.name};});return _1a15;},generateFormatters:function(_1a19){for(var _1a1a in _1a19){array.some(this.itemMetadata.properties,function(_1a1b){if(_1a1a===_1a04.pascalToCamel(_1a1b.name)){this._setTypeFormatter(_1a1b,_1a19[_1a1a]);this._setSelectionFactoryFormatter(_1a1b,_1a19[_1a1a]);this._setWrappingFormatter(_1a19[_1a1a]);return true;}},this);}return _1a19;},_typeFormatterMap:{"System.DateTime":_1a07.localizedDate,"System.Boolean":_1a07.friendlyBoolean},_wrappingFormatterMap:{SecondaryText:function(_1a1c){if(_1a1c){return function(value){return _1a07.secondaryText(_1a1c(value),true);};}return function(value){return _1a07.secondaryText(value);};},VisibleLink:function(_1a1d){if(_1a1d){return function(value){return _1a07.visibleLink(_1a1d(value),true);};}return function(value){return _1a07.visibleLink(value);};}},_setTypeFormatter:function(_1a1e,_1a1f){for(var _1a20 in this._typeFormatterMap){if(_1a1e.modelType.indexOf(_1a20)>-1){_1a1f.formatter=this._typeFormatterMap[_1a20];break;}}},_setSelectionFactoryFormatter:function(_1a21,_1a22){function _1a23(value){var _1a24=value;_1a21.selections.forEach(function(_1a25){if(_1a25.value==value){_1a24=_1a25.text;}});return _1a24;};if(_1a21.selections&&_1a21.selections.length>0){if(_1a22){var _1a26=_1a21.uiType==="epi-cms/contentediting/editors/CheckBoxListEditor";if(_1a26){_1a22.formatter=function(value){if(!value){return value;}return value.split(",").map(_1a23).join(", ");};}else{_1a22.formatter=_1a23;}}}},_setWrappingFormatter:function(_1a27){if(_1a27.wrappingFormatter&&this._wrappingFormatterMap[_1a27.wrappingFormatter]){_1a27.formatter=this._wrappingFormatterMap[_1a27.wrappingFormatter](_1a27.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_1a09.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1a28=index-1;if(_1a28>=0){this.moveItem(item,this._itemModels[_1a28],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1a29=index+1;if(_1a29<this._itemModels.length){this.moveItem(item,this._itemModels[_1a29],false);}},saveItem:function(item,index){var _1a2a=new this.itemModelType();return when(_1a2a.fromItemData(item,this.itemType),lang.hitch(this,function(){this._itemModels.splice(index,1,_1a2a);}));},addItem:function(item,_1a2b,_1a2c){var _1a2d=new this.itemModelType();return when(_1a2d.fromItemData(item,this.itemType),lang.hitch(this,function(){var _1a2e;if(!_1a2b){_1a2e=this._itemModels.length;}else{_1a2e=this._itemModels.indexOf(_1a2b);if(!_1a2c){_1a2e++;}}this._itemModels.splice(_1a2e,0,_1a2d);}));},moveItem:function(item,_1a2f,_1a30){this._itemsUnchanged=true;var _1a31=this._itemModels.indexOf(item);this._itemModels.splice(_1a31,1);var _1a32=this._itemModels.indexOf(_1a2f);var _1a33=_1a30?_1a32:_1a32+1;_1a33=_1a32===-1?_1a31:_1a33;this._itemModels.splice(_1a33,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_1a34){return _1a34.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_1a0a.commandMask=_1a09;return _1a0a;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_1a35){function _1a36(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _1a37=function(a){var array=lang._toArray(a||[]);var ctor=_1a37;ctor._meta={bases:[_1a35]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _1a36([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _1a36([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_1a38=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_1a38,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_1a38.length+adds.length);}return _1a38;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _1a37([].concat.apply(this,arguments));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _1a37(slice);},watchElements:function(_1a39){var _1a3a=this._watchElementCallbacks,_1a3b=this;if(!_1a3a){_1a3a=this._watchElementCallbacks=function(idx,_1a3c,adds){for(var list=[].concat(_1a3a.list),i=0;i<list.length;i++){list[i].call(_1a3b,idx,_1a3c,adds);}};_1a3a.list=[];}_1a3a.list.push(_1a39);var h={};h.unwatch=h.remove=function(){for(var list=_1a3a.list,i=0;i<list.length;i++){if(list[i]==_1a39){list.splice(i,1);break;}}};return h;}},_1a35.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _1a3d=this.length;_1a35.prototype.set.call(this,name,value);if(_1a3d!=this.length){_1a35.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_1a37);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_1a3e,_1a3f){return _1a3e([_1a3f],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(array,_1a40,lang,_1a41){return _1a40([_1a41],{_itemDataPropertyNames:null,_nameGetter:function(){return this.name||this.text||"*";},fromItemData:function(_1a42,_1a43){lang.mixin(this,_1a42);this._itemDataPropertyNames=[];for(var _1a44 in _1a42){if(_1a42.hasOwnProperty(_1a44)){this._itemDataPropertyNames.push(_1a44);}}this.typeIdentifier=_1a43&&_1a43.toLowerCase();},toItemData:function(){var _1a45={};array.forEach(this._itemDataPropertyNames,function(_1a46){_1a45[_1a46]=this.get(_1a46);},this);return _1a45;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_1a47,lang,json,_1a48,epi,_1a49,_1a4a,_1a4b){var _1a4c=_1a47([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_1a4d){lang.mixin(this,_1a4d);},build:function(_1a4e,_1a4f){},instantiateGrid:function(_1a50,_1a51,_1a52,node){return new _1a50(lang.mixin(_1a51,{columns:_1a52,className:"epi-plain-grid epi-grid-height--auto"}),node);}});return _1a47([_1a4c],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_1a53,_1a54){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_1a55){var _1a56=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _1a48({commands:_1a56});this.renderActionMenu(item,node,_1a56);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_1a53);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_1a54);return grid;},renderActionMenu:function(item,node,_1a57){node.innerHTML=_1a57&&_1a57.length>0?_1a4b.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _1a58=this.itemCommandsFactory(item,"context");array.some(_1a58,function(_1a59){if(_1a59.name==="remove"&&this.gridSettings.useDeleteWithConfirmation){_1a59=_1a4a(_1a59,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _1a58;},_setupCommands:function(_1a5a,_1a5b){var _1a5c=this.getListCommandBuilder();array.forEach(_1a5a,function(_1a5d){_1a5c.create(_1a5d,_1a5b);},this);},getListCommandBuilder:function(){return new _1a49({settings:{showLabel:true},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_1a5e,lang,on,_1a5f,_1a60,_1a61,_1a62,_1a63){return _1a5e([_1a5f,_1a61],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){this.onFocus();this._setupItemEditor();this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this._itemEditor=this._createItemEditor();this.own(this._dialog=new _1a60(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor},this.dialogParams)));this._dialog.own(this._itemEditor,this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),on(this._dialog,"execute",lang.hitch(this,this._onDialogExecute)),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_1a64){this._dialog.set("title",this._getDialogTitleText(_1a64));},_getDialogTitleText:function(_1a65){return _1a62.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},_onDialogExecute:function(){if(this.validate()){this.onExecuteDialog();}},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_1a66){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_1a66));},_getDialogConfirmActionText:function(_1a67){return _1a67?_1a63.action.ok:_1a63.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_1a68,lang,_1a69,dom,_1a6a,popup){return _1a68([_1a6a],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){if(!this._started){this.own(_1a69.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true),_1a69.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true));}this.inherited(arguments);},_onPopupOpen:function(_1a6b){var popup=_1a6b.popup;if(popup&&popup.popupParent){return;}var _1a6c=popup&&popup.currentTarget;if(_1a6c&&dom.isDescendant(_1a6c,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._destroyed){return;}if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\">\r\n    <div class=\"command-area\"><div data-dojo-attach-point=\"commandTargetNode\"></div></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1a6d,lang,_1a6e,_1a6f,_1a70,on,topic,when,_1a71,_1a72,_1a73,_1a74,_1a75,_1a76,_1a77,_1a78,_1a79,_1a7a,_1a7b,_1a7c,_1a7d,_1a7e,_1a7f,_1a80,_1a81,_1a82,_1a83,_1a84,_1a85,_1a86,_1a87,_1a88,_1a89,_1a8a,_1a8b){return _1a6d([_1a72,_1a73,_1a75,_1a74,_1a7f,_1a7b,_1a77,_1a82,_1a7a],{baseClass:"epi-content-area-editor",res:_1a8b,templateString:_1a8a,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_preventOnBlur:false,_dndTarget:null,allowedTypes:null,restrictedTypes:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.tree&&this.model.get("value").length>0){this._focusManager.focus(this.tree.domNode);}else{if(this.textWithLinks){this.textWithLinks.focus();}}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _1a84(),new _1a89(),new _1a85(),new _1a86(),new _1a83()];if(!_1a7c.limitUI){this.commands.splice(2,0,new _1a88({category:null}),new _1a87());}this.commands.forEach(function(_1a8c){this.own(_1a8c);},this);this.own(this.model=this.model||new _1a7d(),this.treeModel=this.treeModel||new _1a79({model:this.model}),this.model.watch("selectedItem",lang.hitch(this,function(name,_1a8d,_1a8e){this.updateCommandModel(_1a8e);})),on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));this.allowedDndTypes.push("personalizationarea");},buildRendering:function(){this.inherited(arguments);this.contextMenu=new _1a7e();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.own(this._dndTarget=new _1a76(this.actionsContainer,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,isSource:false,alwaysCopy:false,allowMultipleItems:true,insertNodes:function(){}}));this.own(_1a6e.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1a8f,_1a90,nodes,copy){_1a8f.forEach(function(_1a91){this.model.modify(lang.hitch(this,function(){this.model.addChild(_1a91.data);}));},this);if(!this.tree){this._createTree();}}),true));this.own(_1a6e.after(this._dndTarget,"onDrop",lang.hitch(this,"focus")));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_1a8b.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.tree&&this.tree.startup();this.contextMenu.startup();},destroy:function(){this.tree&&this.tree.destroyRecursive();this.inherited(arguments);},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},executeAction:function(_1a92){if(_1a92==="createnewblock"){this._preventOnBlur=true;this.validate(false);var _1a93=new _1a81({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_1a93.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.parent.set("editing",true);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;this.onBlur();})});_1a93.execute();}},isValid:function(_1a94){return (this._preventOnBlur||!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_1a95){this._set("readOnly",_1a95);_1a70.set(this.actionsContainer,"display",_1a95?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_1a95);}this.tree&&this.tree.set("readOnly",_1a95);},_checkAcceptance:function(_1a96,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_1a96,nodes);},_createTree:function(){this.tree=new _1a78({accept:this.allowedDndTypes,reject:this.restrictedDndTypes,contextMenu:this.contextMenu,model:this.treeModel,readOnly:this.readOnly}).placeAt(this.domNode,"first");this.tree.own(_1a6e.after(this.tree.dndController,"onDndEnd",lang.hitch(this,"focus")));},_selectFromOverlay:function(_1a97){var child=_1a97&&_1a97.selectedItem&&_1a97.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_1a97.selectedItem.ensurePersonalization);this.tree&&this.tree.set("path",path);},_startDrag:function(_1a98,nodes,copy){var _1a99=this._dndTarget.accept&&this._dndTarget.checkAcceptance(_1a98,nodes);_1a6f.toggle(this.domNode,"dojoDndTargetDisabled",!_1a99);var _1a9a=_1a71.getEnclosingWidget(nodes[0]);if(_1a9a&&_1a9a.isInstanceOf(_1a80)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}},_setValueAttr:function(value){this.tree&&this.tree.destroyRecursive();this._set("value",value||[]);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;this._createTree();}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_1a9b,_1a9c,event,array,lang,_1a9d,_1a9e,_1a9f,_1aa0,_1aa1,_1aa2,Tree,_1aa3,_1aa4,_1aa5,_1aa6){return _1a9b([Tree],{persist:false,showRoot:false,dndController:_1aa1,betweenThreshold:8,_typeDescriptorManager:null,postMixInProperties:function(){this.inherited(arguments);this._typeDescriptorManager=this._typeDescriptorManager||_1aa2;this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_1a9d.add(this.domNode,"epi-tree-mngr");this.own(_1a9c.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_1aa7){if(_1aa7[0]&&_1aa7[0].data){this.model.deleteItem(_1aa7[0].data);}}),true));this.own(_1a9c.after(this,"_onItemChildrenChange",lang.hitch(this,function(_1aa8,_1aa9){array.forEach(_1aa9,function(child){var _1aaa=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_1aaa[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_1aaa[0].showPersonalizationSelector();}},this);}),true));},getTooltip:function(item){return item.tooltip||item.label||"";},_setReadOnlyAttr:function(_1aab){this._set("readOnly",_1aab);if(this.dndController){this.dndController.isSource=!_1aab;}},getItemType:function(item){if(item.typeIdentifier){var _1aac=this._typeDescriptorManager.getAndConcatenateValues(item.typeIdentifier,"dndTypes");return _1aac;}else{if(item.contentGroup!==undefined){return ["personalizationarea"];}}return this.accept;},checkItemAcceptance:function(_1aad,_1aae,_1aaf,copy){if(this.tree.readOnly){return false;}var _1ab0=_1a9e.getEnclosingWidget(_1aad);var _1ab1=_1ab0.item;var _1ab2=true;_1aae.forInSelectedItems(function(item){_1ab2=this.tree.model.checkItemAcceptance(_1ab1,item.data.item,_1aaf);},this);return _1ab2;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _1aa4){node=new _1aa6(model);}else{if(model.item instanceof _1aa3){node=new _1aa5(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _1aa6){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1ab3,lang,when,all,_1ab4,epi,_1ab5,_1ab6,_1ab7,_1ab8,_1ab9,_1aba){return _1ab3([_1ab7,_1ab6],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},roles:null,contentGroup:null,name:null,contentTypeName:null,roleIdentities:null,typeIdentifier:null,attributes:null,constructor:function(){this.roleIdentities=this.roleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _1abb=_1ab5.resolve("epi.storeregistry");this.store=_1abb.get("epi.cms.visitorgroup");}this.contentTypeName=this.contentTypeName||(this.typeIdentifier&&_1ab9.getResourceValue(this.typeIdentifier,"name"));this.set("label",this.name);this.set("tooltip",_1ab8.title(this.name,this.contentLink,this.contentTypeName));this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_1abc){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_1abc)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_1abd,_1abe){var _1abf=(this.roles||[]).map(function(role){return role.id;});var index=_1abf.indexOf(_1abd);if(index>=0){if(!_1abe){_1abf.splice(index,1);}}else{if(_1abe){_1abf.push(_1abd);}}this.set("roleIdentities",_1abf);},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1ac0){this.attributes[this.settings.displayOptionsAttributeName]=_1ac0;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1ac1){this.roleIdentities=_1ac1||[];this._reloadRoles();},_parentSetter:function(_1ac2){this.parent=_1ac2;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_1ac3){this.contentGroup=_1ac3||"";this.attributes[this.settings.contentGroupAttributeName]=this.contentGroup;this._reloadRoles();},_reloadRoles:function(){var store=this.store;if(!store){return;}var _1ac4=all(this.roleIdentities.map(function(id){return when(store.get(id)).otherwise(function(){console.warn("Could not load visitor group with id: "+id);});}));_1ac4.then(lang.hitch(this,"set","roles"));return _1ac4;},_hasSiblingsSetter:function(_1ac5){this.hasSiblings=_1ac5;this._updateRolesString();},_selectedSetter:function(_1ac6){this.selected=_1ac6;if(_1ac6){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===null){this.set("rolesString","");return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_1aba.everyoneelsesee);}else{this.set("rolesString",_1aba.everyonesees);}return;}if(!this.roles.length){this.set("rolesString",_1aba.groupcannotsees);return;}var _1ac7=this.roles.map(function(r){return "<em>"+_1ab4.encode(r.name)+"</em>";}).sort().join(", ");var names=_1ac7.replace(/, (?=[^,]+$)/," "+_1aba.groupsand);var _1ac8="";if(this.roles.length>1){_1ac8=lang.replace(_1aba.groupssee,{groupNames:names});}else{_1ac8=lang.replace(_1aba.groupsees,{groupName:names});}this.set("rolesString",_1ac8);},_rolesSetter:function(roles){this.roles=roles.filter(function(role){return !!role;});this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_1ac9,_1aca,_1acb,_1acc){return _1ac9([_1aca,_1acb,_1acc],{modify:function(_1acd,scope,_1ace){this._isBeingModified=true;if(scope){_1acd.apply(scope);}else{_1acd();}this._isBeingModified=false;if(_1ace||_1ace===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_1acf,lang,_1ad0,_1ad1){return _1acf([_1ad0],{name:null,label:_1ad1.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this.ownByKey(child.id,child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed")));},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_1ad2){this.selected=_1ad2;if(_1ad2){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","epi/shell/DestroyableByKey","./_ViewModelMixin"],function(array,_1ad3,_1ad4,_1ad5){return _1ad3([_1ad5,_1ad4],{constructor:function(){this._data=[];},destroy:function(){this.inherited(arguments);this._data.forEach(function(item){if(item.destroy){item.destroy();}});},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);child.id=this._hash(child);if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _1ad6=this._data;for(var i=_1ad6.length-1;i>=0;i--){if(_1ad6[i].equals(item)){return _1ad6[i];}}return null;},getChildById:function(id){var _1ad7=this._data;for(var i=_1ad7.length-1;i>=0;i--){if(_1ad7[i].id===id){return _1ad7[i];}}return null;},getChildByIndex:function(index){return this._data[index];},getChildren:function(){return this._data;},removeChild:function(child,_1ad8){var index=this.indexOf(child);if(index<0){if(_1ad8){this.getChildren().slice().forEach(function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_1ad8);}});}return;}child=this.getChildByIndex(index);this.destroyByKey(child.id);child.destroy();this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _1ad9=this.indexOf(child);this._data.splice(_1ad9,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){var _1ada=this._data.indexOf(child);if(_1ada>=0||!child||typeof child.id==="undefined"){return _1ada;}for(var i=0;i<this._data.length;i++){if(this._data[i].id===child.id){return i;}}return -1;},_hash:function(child){},_readOnlySetter:function(_1adb){this.readOnly=_1adb;array.forEach(this.getChildren(),function(child){child.set("readOnly",_1adb);},this);},_emitChildrenChanged:function(_1adc){var _1add=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_1add-1));child.set("canMovePrevious",index>0&&index<=(_1add-1));child.set("hasSiblings",_1add>1);});this.set("count",_1add||0);this.emit("childrenChanged",_1adc?_1adc:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_1ade,lang,keys,_1adf,Tree,_1ae0,_1ae1,_1ae2,_1ae3,_1ae4,_1ae5,_1ae6,_1ae7){return _1ade([Tree._TreeNode,_1ae4,_1ae1],{templateString:_1ae7,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_1ae5,_1ae6),buildRendering:function(){this.inherited(arguments);this.dropDown=new _1ae2({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_1adf.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var _1ae8=_1ae3.contentIconClass(this.item.typeIdentifier);_1adf.add(this.iconNode,_1ae8);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_1ae9,_1aea,_1aeb){node.innerHTML=_1aeb;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_1aec,_1aed){this.inherited(arguments);this.item.set("selected",_1aec);_1adf.toggle(this.iconNodeMenu,this._contextMenuClass,_1aec);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1ae0.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode===keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_1aee,lang,_1aef,when,_1af0,_1af1,_1af2,_1af3,_1af4,_1af5,_1af6,_1af7){return _1aee([_1af1,_1af2,_1af3],{templateString:_1af6,model:null,resources:_1af7,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1af8=_1af5.resolve("epi.storeregistry");this.store=_1af8.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(!this.rdEveryone.checked&&this.model.roleIdentities&&this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_1af9){if(!this._destroyed){this.set("visitorGroups",_1af9);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);this.model.modify(function(){this.model.resetRoleIdentities();},this);},_setVisitorGroupsAttr:function(_1afa){this._set("visitorGroups",_1afa);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_1afa,function(group){var item=new _1af4({label:_1af0.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_1afb,_1afc,_1afd){this.model.modify(function(){this.model.selectRole(group.id,_1afd);},this);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div class=\"epi-menu--inverted\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\r\n            <div class=\"epi-menuSeparator\" tabindex=\"-1\"></div>\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\r\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_1afe,array,_1aff,_1b00,_1b01){return _1afe([_1b00],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_1b01,_onClick:function(e){if(!this.checked){this._resetState();this.inherited(arguments);}},_resetState:function(){array.forEach(this._getChildren(),function(child,index){child.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_1b02){this._set("iconClass",_1b02);_1aff.add(this.labelIconNode,_1b02);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_1b03,lang,on,_1b04,event,_1b05){return _1b03([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_1b06){this._unBindContextMenu();this._set("contextMenu",_1b06);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_1b05.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\r\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\r\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\r\n                </span>\r\n                <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1b07,array,_1b08,lang,_1b09,_1b0a,Tree,_1b0b,_1b0c,_1b0d){return _1b08([Tree._TreeNode,_1b0b],{templateString:_1b0c,_contextMenuClass:"epi-iconContextMenu",resources:_1b0d,buildRendering:function(){this.inherited(arguments);_1b09.remove(this.iconNode,"dijitFolderClosed");this.own(_1b07.after(this,"expand",lang.hitch(this,function(_1b0e){_1b0e.then(lang.hitch(this,function(){if(this._destroyed){return;}_1b09.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_1b0f){var child=_1b0f.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_1b0f.showPersonalizationSelector();}},this);}));return _1b0e;})));this.own(_1b07.after(this,"collapse",lang.hitch(this,function(_1b10){_1b10.then(lang.hitch(this,function(){_1b09.remove(this.domNode,"epi-treeNodeOpen");}));return _1b10;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_1b11,_1b12,_1b13){this.set("count",_1b13);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_1b14){this.inherited(arguments);this.item.set("selected",_1b14);_1b09.remove(this.rowNode,"dijitTreeRowSelected");_1b09.toggle(this.domNode,"dijitTreeRowSelected",_1b14);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_1b0a.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\r\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\r\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <hr />\r\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_1b15,lang,_1b16,_1b17,_1b18){return _1b15([_1b16],{model:null,root:{id:"root",name:"root"},constructor:function(_1b19){_1b15.safeMixin(this,_1b19);},pasteItem:function(_1b1a,_1b1b,_1b1c,bCopy,_1b1d,_1b1e){var _1b1f=_1b1b.id==="root"?this.model:this.model.getChildById(_1b1b.id);var child=_1b1f.getChildById(_1b1a.id);var _1b20=_1b1c.id==="root"?this.model:this.model.getChildById(_1b1c.id);if(child instanceof _1b17&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_1b1f===_1b20){this.model.modify(function(){_1b20.move(child,_1b1d);});return;}this.model.modify(function(){_1b1f.removeChild(child);_1b20.addChild(child,_1b1d);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_1b21,_1b22,_1b23){if(args.dndData&&args.dndData.data){var _1b24=_1b21.id==="root"?this.model:this.model.getChildById(_1b21.id);var item=args.dndData.data;if(!(item instanceof _1b17)&&!(item instanceof _1b18)){item=new _1b17(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_1b24.addChild(item,_1b22);});}},checkItemAcceptance:function(_1b25,item,_1b26){if(_1b26==="over"){if(!(_1b25 instanceof _1b18)){return false;}if(!(item instanceof _1b17)){return false;}}if(_1b25 instanceof _1b17&&item instanceof _1b18&&_1b25.contentGroup){return false;}return true;},getRoot:function(_1b27){_1b27(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_1b28,_1b29){var _1b2a;if(_1b28.id==="root"){_1b2a=this.model.getChildren();_1b29(_1b2a);this.model.on("childrenChanged",lang.hitch(this,function(index,_1b2b,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_1b28.id);if(model&&typeof model.getChildren=="function"){_1b2a=model.getChildren();_1b29(_1b2a);model.on("childrenChanged",lang.hitch(this,function(index,_1b2c,adds){this.onChildrenChange(_1b28,model.getChildren());}));}else{_1b29([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_1b2d){return _1b2d("dijit.tree.model",null,{destroy:function(){},getRoot:function(_1b2e){},mayHaveChildren:function(item){},getChildren:function(_1b2f,_1b30){},isItem:function(_1b31){},fetchItemByIdentity:function(_1b32){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_1b33,_1b34,_1b35){},pasteItem:function(_1b36,_1b37,_1b38,bCopy,_1b39,_1b3a){},onChange:function(item){},onChildrenChange:function(_1b3b,_1b3c){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_1b3d,lang,_1b3e,on,when,_1b3f,_1b40){return _1b3d(null,{textWithLinks:null,actionsResource:_1b40,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _1b41=new _1b3e();var _1b42=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_1b43){var _1b44=_1b43?_1b42.template:_1b42.templatewithoutcreate;_1b41.resolve({templateString:_1b44,actions:_1b42.actions});});return _1b41.promise;},setupActionLinks:function(_1b45){when(this.getTemplateString(),lang.hitch(this,function(_1b46){if(!_1b46){return;}this.textWithLinks=new _1b3f({contentString:_1b46.templateString,namedActions:_1b46.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_1b45){this.textWithLinks.placeAt(_1b45);}}));},executeAction:function(_1b47){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_1b48,event,lang,_1b49,on,query,_1b4a,_1b4b,_1b4c,_1b4d){return _1b48([_1b4a,_1b4b,_1b49],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _1b4e={};var _1b4f=this.contentString;var _1b50;var id=0;if(this.namedActions){for(var _1b51 in this.namedActions){_1b50=_1b4d.encode(this.namedActions[_1b51]);_1b4e[_1b51]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_1b50+"</a>";this._actionMap.push(_1b51);}_1b4f=lang.replace(_1b4f,_1b4e);}this.templateString=lang.replace(this.templateString,[this.tagName,_1b4f]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_1b52,id){var link=this["action"+id];if(link){var _1b53=on(link,"click",(function(_1b54,_1b55){return function(evt){event.stop(evt);_1b54.emit("onActionClick",_1b55);};})(this,_1b52));this._eventHandlers.push(_1b53);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_1b56){_1b56.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_1b4c.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojox/uuid/generateRandomUuid","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi-cms/_ContentContextMixin"],function(array,_1b57,lang,all,when,_1b58,_1b59,_1b5a,_1b5b,_1b5c,_1b5d,_1b5e){return _1b57([_1b5d,_1b5e],{selectedItem:null,postscript:function(){this.inherited(arguments);this.contentTypeService=this.contentTypeService||_1b59.resolve("epi.cms.ContentTypeService");if(!this._contentTypeStore){var _1b5f=_1b59.resolve("epi.storeregistry");this._contentTypeStore=_1b5f.get("epi.cms.contenttype");}},addChild:function(child){var _1b60=[];if(!(child instanceof _1b5a)&&!(child instanceof _1b5b)){var model=new _1b5a(child);if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _1b5b){_1b60.push(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);this._emitChanged();}})));}else{if(child instanceof _1b5a){child.resetRoleIdentities();}}}_1b60.push(child.on("changed",this._emitChanged.bind(this)));this.inherited(arguments);_1b60.push(child.on("selected",lang.hitch(this,"set","selectedItem")));_1b60.forEach(function(_1b61){this.ownByKey(child.id,_1b61);},this);},canCreateBlock:function(_1b62,_1b63){var _1b64=this.contentTypeService;return all([this.getCurrentContext(),this.getCurrentContent()]).then(function(_1b65){var _1b66=_1b65[0],_1b67=_1b65[1];if(!_1b66||!_1b67){return false;}var _1b68=_1b5c.isActionAvailable(_1b67,_1b5c.action.Create,_1b5c.providerCapabilities.Create,true);if(!_1b68||!_1b66.capabilities.resourceable||_1b66.currentMode==="create"||_1b66.currentMode==="translate"){return false;}return when(_1b64.getAcceptedChildTypes(_1b67.contentLink,true,["episerver.core.blockdata"],_1b62,_1b63)).then(function(_1b69){return !!_1b69.length;});});},moveVisible:function(child,_1b6a){var _1b6b=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_1b6a?1:-1,_1b6c=array.indexOf(_1b6b,child)+delta,index=this.indexOf(_1b6b[_1b6c]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _1b5b({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _1b6d=this.getChildren();for(var i=_1b6d.length-1;i>=0;i--){this.removeChild(_1b6d[i]);}this._groups={};array.forEach(value,function(child){var model=new _1b5a(child);if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_emitChanged:function(){this.emit("changed");},_createGroup:function(name){var group=new _1b5b({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+_1b58();}});});},"dojox/uuid/generateRandomUuid":function(){define("dojox/uuid/generateRandomUuid",["./_base"],function(){dojox.uuid.generateRandomUuid=function(){var _1b6e=16;function _1b6f(){var _1b70=Math.floor((Math.random()%1)*Math.pow(2,32));var _1b71=_1b70.toString(_1b6e);while(_1b71.length<8){_1b71="0"+_1b71;}return _1b71;};var _1b72="-";var _1b73="4";var _1b74="8";var a=_1b6f();var b=_1b6f();b=b.substring(0,4)+_1b72+_1b73+b.substring(5,8);var c=_1b6f();c=_1b74+c.substring(1,4)+_1b72+c.substring(4,8);var d=_1b6f();var _1b75=a+_1b72+b+_1b72+c+d;_1b75=_1b75.toLowerCase();return _1b75;};return dojox.uuid.generateRandomUuid;});},"dojox/uuid/_base":function(){define("dojox/uuid/_base",["dojo/_base/kernel","dojo/_base/lang"],function(dojo){dojo.getObject("uuid",true,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(_1b76,_1b77){if(!_1b76){if(!_1b77){_1b77="An assert statement failed.\n"+"The method dojox.uuid.assert() was called with a 'false' value.\n";}throw new Error(_1b77);}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID;};dojox.uuid.isValid=function(_1b78){_1b78=_1b78.toString();var valid=(dojo.isString(_1b78)&&(_1b78.length==36)&&(_1b78==_1b78.toLowerCase()));if(valid){var _1b79=_1b78.split("-");valid=((_1b79.length==5)&&(_1b79[0].length==8)&&(_1b79[1].length==4)&&(_1b79[2].length==4)&&(_1b79[3].length==4)&&(_1b79[4].length==12));var _1b7a=16;for(var i in _1b79){var part=_1b79[i];var _1b7b=parseInt(part,_1b7a);valid=valid&&isFinite(_1b7b);}}return valid;};dojox.uuid.getVariant=function(_1b7c){if(!dojox.uuid._ourVariantLookupTable){var _1b7d=dojox.uuid.variant;var _1b7e=[];_1b7e[0]=_1b7d.NCS;_1b7e[1]=_1b7d.NCS;_1b7e[2]=_1b7d.NCS;_1b7e[3]=_1b7d.NCS;_1b7e[4]=_1b7d.NCS;_1b7e[5]=_1b7d.NCS;_1b7e[6]=_1b7d.NCS;_1b7e[7]=_1b7d.NCS;_1b7e[8]=_1b7d.DCE;_1b7e[9]=_1b7d.DCE;_1b7e[10]=_1b7d.DCE;_1b7e[11]=_1b7d.DCE;_1b7e[12]=_1b7d.MICROSOFT;_1b7e[13]=_1b7d.MICROSOFT;_1b7e[14]=_1b7d.UNKNOWN;_1b7e[15]=_1b7d.UNKNOWN;dojox.uuid._ourVariantLookupTable=_1b7e;}_1b7c=_1b7c.toString();var _1b7f=_1b7c.charAt(19);var _1b80=16;var _1b81=parseInt(_1b7f,_1b80);dojox.uuid.assert((_1b81>=0)&&(_1b81<=16));return dojox.uuid._ourVariantLookupTable[_1b81];};dojox.uuid.getVersion=function(_1b82){var _1b83="dojox.uuid.getVersion() was not passed a DCE Variant UUID.";dojox.uuid.assert(dojox.uuid.getVariant(_1b82)==dojox.uuid.variant.DCE,_1b83);_1b82=_1b82.toString();var _1b84=_1b82.charAt(14);var _1b85=16;var _1b86=parseInt(_1b84,_1b85);return _1b86;};dojox.uuid.getNode=function(_1b87){var _1b88="dojox.uuid.getNode() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1b87)==dojox.uuid.version.TIME_BASED,_1b88);_1b87=_1b87.toString();var _1b89=_1b87.split("-");var _1b8a=_1b89[4];return _1b8a;};dojox.uuid.getTimestamp=function(_1b8b,_1b8c){var _1b8d="dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1b8b)==dojox.uuid.version.TIME_BASED,_1b8d);_1b8b=_1b8b.toString();if(!_1b8c){_1b8c=null;}switch(_1b8c){case "string":case String:return dojox.uuid.getTimestamp(_1b8b,Date).toUTCString();break;case "hex":var _1b8e=_1b8b.split("-");var _1b8f=_1b8e[0];var _1b90=_1b8e[1];var _1b91=_1b8e[2];_1b91=_1b91.slice(1);var _1b92=_1b91+_1b90+_1b8f;dojox.uuid.assert(_1b92.length==15);return _1b92;break;case null:case "date":case Date:var _1b93=3394248;var _1b94=16;var _1b95=_1b8b.split("-");var _1b96=parseInt(_1b95[0],_1b94);var _1b97=parseInt(_1b95[1],_1b94);var _1b98=parseInt(_1b95[2],_1b94);var _1b99=_1b98&4095;_1b99<<=16;_1b99+=_1b97;_1b99*=4294967296;_1b99+=_1b96;var _1b9a=_1b99/10000;var _1b9b=60*60;var _1b9c=_1b93;var _1b9d=_1b9c*_1b9b;var _1b9e=_1b9d*1000;var _1b9f=_1b9a-_1b9e;var _1ba0=new Date(_1b9f);return _1ba0;break;default:dojox.uuid.assert(false,"dojox.uuid.getTimestamp was not passed a valid returnType: "+_1b8c);break;}};return dojox.uuid;});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_1ba1,event,lang,_1ba2,_1ba3,on,when,_1ba4,_1ba5,_1ba6,_1ba7,_1ba8,_1ba9,_1baa,_1bab){return _1ba1([_1ba4,_1ba5,_1ba6,_1ba7],{templateString:_1bab,res:_1baa,_setMissingRendererAttr:function(value){_1ba2.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_1ba3.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.own(this.commandProvider=this.commandProvider||new _1ba8({model:this.viewModel}),this.viewModel.watch("statusMessage",lang.hitch(this,function(_1bac,_1bad,_1bae){when(_1ba9.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_1baf){_1ba3.set(this.warningIcon,"display",_1baf?"":"none");}));_1ba3.set(this.iconsContainer,"display",this.viewModel.contentGroup||_1bae?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")),on(this.domNode,"mouseout",lang.hitch(this,function(e){if(this.contextMenu&&this.contextMenu.isShowingNow){event.stop(e);}})));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_1bb0=_1ba3.get(node,"display"),_1bb1=/inline|inline-block/.test(_1bb0)?"-inline":"";_1ba2.add(node,"epi-injected-minSize"+_1bb1);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1bb2,lang,_1bb3,on,when,mouse,_1bb4,_1bb5,_1bb6){return _1bb2(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1bb7,_1bb8,_1bb9){this.set("statusMessage",_1bb9);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1bba){var _1bbb=this.get("overlayItemInfo");if(!_1bbb){return;}_1bbb.set("statusIcon",_1bba);},_setStatusMessageAttr:function(_1bbc){var _1bbd=this.get("overlayItemInfo");if(!_1bbd){return;}_1bbd.set("statusMessage",_1bbc);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _1bb5();_1bb3.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _1bbe,_1bbf,_1bc0,_1bc1;_1bbe=this.get("overlayItemInfo");_1bbe.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _1bc2=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_1bc2){_1bbf=_1bb4.getValue(_1bc2,"useIconOnBlock");_1bc0=_1bb4.getValue(_1bc2,"iconClass");_1bc1=_1bb4.getValue(_1bc2,"description");if(_1bbf){_1bbe.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_1bc0);this.set("statusMessage",_1bc1);}}},_showStatusMessage:function(_1bc3){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_1bc3);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_1bc4,lang,_1bc5,_1bc6,_1bc7,_1bc8,_1bc9,_1bca,_1bcb,_1bcc,_1bcd){return _1bc4([_1bc8,_1bc9],{templateString:_1bcd,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_1bce){if(this._tooltip){_1bce?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_1bcf){var _1bd0=lang.isArray(_1bcf);if(_1bd0){array.forEach(_1bcf,function(_1bd1){_1bc5.add(this.highlightArea,_1bd1);},this);}else{_1bc5.add(this.highlightArea,_1bcf);}},_setStatusMessageAttr:function(_1bd2){if(!_1bd2){return;}var _1bd3=lang.isArray(_1bd2);if(this._tooltip){if(_1bd3){this._tooltip.tooltipRows=_1bd2;}else{this._tooltip.label=_1bca.encode(_1bd2);}}else{var _1bd4=_1bc6.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1bcb.toHTML(_1bca.encode(_1bd2))}),_1bd5=_1bd3?{tooltipRows:_1bd2}:{label:_1bd4.outerHTML};this._tooltip=new _1bcc(_1bd5);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dijit/Destroyable","epi-cms/ApplicationSettings","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_1bd6,_1bd7,_1bd8,_1bd9,_1bda,Edit,_1bdb,_1bdc,_1bdd,_1bde){return _1bd6([_1bd7,_1bd8],{commands:null,constructor:function(){this.commands=[new Edit(),new _1bde(),new _1bdb(),new _1bdc(),new _1bda()];if(!_1bd9.limitUI){this.commands.splice(2,0,new _1bdd());}this.commands.forEach(function(_1bdf){this.own(_1bdf);},this);},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_1be0){_1be0.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1be1,epi,_1be2){return _1be1([_1be2],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_1be3,lang,_1be4){return _1be3([_1be4],{_onModelChange:function(){var model=this.model;this._destroyModelHandles();if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},destroy:function(){this._destroyModelHandles();this.inherited(arguments);},_destroyModelHandles:function(){if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];},_watch:function(_1be5,_1be6,scope){if(scope){this._handles.push(this.model.watch(_1be5,lang.hitch(scope,_1be6)));}else{this._handles.push(this.model.watch(_1be5,_1be6));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _1be7=function(item){if(item.parent){return _1be7(item.parent);}return item;};return _1be7(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1be8,lang,topic,when,epi,_1be9,_1bea,_1beb,_1bec){return _1be8([_1bea],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_1beb;var _1bed=_1be9.resolve("epi.storeregistry");this._store=_1bed.get("epi.cms.content.light");},_execute:function(){var _1bee=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1bee},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _1bef=item&&this._store.get(item.contentLink);when(_1bef,lang.hitch(this,function(_1bf0){this.set("canExecute",_1bf0&&!_1bf0.isDeleted);if(_1bf0&&_1bf0.accessMask){if(this.contentActionSupport.hasAccess(_1bf0.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_1bec.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1bec.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_1bf1,_1bf2){return _1bf1([_1bf2],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1bf3=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1bf3,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1bf4,epi,_1bf5){return _1bf4([_1bf5],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_1bf6,_1bf7){return _1bf6([_1bf7],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1bf8=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1bf8,this._getItem());this.set("canExecute",index!==-1&&index<_1bf8.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1bf9,epi,_1bfa){return _1bf9([_1bfa],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1bfb,_1bfc,_1bfd,_1bfe){return _1bfb([_1bfd],{label:_1bfe.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_1bff,lang,when,_1c00,_1c01,_1c02,_1c03,_1c04){return _1bff([_1c01],{label:_1c04.label,category:"popup",_labelAutomatic:lang.replace(_1c04.label,[_1c04.automatic]),constructor:function(){this.popup=new _1c03();},postscript:function(){this.inherited(arguments);if(!this.store){var _1c05=_1c00.resolve("epi.storeregistry");this.store=_1c05.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_1c06){this._setCommandAvailable(_1c06);this.popup.set("displayOptions",_1c06);}));},destroy:function(){this.inherited(arguments);this.popup&&this.popup.destroyRecursive();},_onModelChange:function(){this.inherited(arguments);var _1c07=this.popup.displayOptions,_1c08=this.model.get("displayOption"),_1c09=_1c07&&_1c07.length>0;_1c09=_1c09&&(this.model instanceof _1c02);this._setCommandAvailable(_1c07);if(!_1c09){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_1c08){this.set("label",this._labelAutomatic);}else{this._setLabel(_1c08);}this._watch("displayOption",function(_1c0a,_1c0b,_1c0c){if(!_1c0c){this.set("label",this._labelAutomatic);}else{this._setLabel(_1c0c);}},this);},_setCommandAvailable:function(_1c0d){this.set("isAvailable",_1c0d&&_1c0d.length>0&&this.model instanceof _1c02);},_setLabel:function(_1c0e){when(this.store.get(_1c0e),lang.hitch(this,function(_1c0f){this.set("label",lang.replace(_1c04.label,[_1c0f.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi/shell/DestroyableByKey","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_1c10,lang,when,_1c11,_1c12,_1c13,_1c14,_1c15){return _1c10([_1c13,_1c12],{model:null,headingText:_1c14.title,_rdAutomatic:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _1c15({label:_1c14.automatic,value:""}));this.addChild(this._rdAutomatic);this.own(this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault)));},destroy:function(){this._removeMenuItems();this.inherited(arguments);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_1c16){this._set("displayOptions",_1c16);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _1c17=this.model.get("displayOption");array.forEach(this.displayOptions,function(_1c18){var item=new _1c15({label:_1c18.name,iconClass:_1c18.iconClass,displayOptionId:_1c18.id,checked:_1c17===_1c18.id,title:_1c18.description});this.ownByKey("items",item.watch("checked",lang.hitch(this,function(_1c19,_1c1a,_1c1b){if(!_1c1b){return;}this.model.modify(function(){this.model.set("displayOption",_1c18.id);},this);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_1c17);},_removeMenuItems:function(){var items=this.getChildren();this.destroyByKey("items");items.forEach(function(item){if(item===this._rdAutomatic){return;}this.removeChild(item);item.destroy();},this);}});});},"url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\r\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\r\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\r\n        <span class=\"epi-overlayControls epi-mediumButton \">\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\r\n        </span>\r\n    </span>\r\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\r\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\r\n    </button>\r\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1c1c,_1c1d,_1c1e){return _1c1c([_1c1d],{label:_1c1e.moveoutsidegroup,tooltip:_1c1e.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"treeNode\"></div>\r\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/mouse","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_1c1f,lang,event,_1c20,_1c21,_1c22,_1c23,_1c24,keys,mouse,on,query,topic,when,_1c25,_1c26,_1c27,_1c28,_1c29,_1c2a,_1c2b,_1c2c,_1c2d,_1c2e,_1c2f,_1c30,DnD,_1c31,_1c32,_1c33,_1c34,_1c35,_1c36,_1c37,_1c38){return _1c1f([_1c27,_1c25,_1c26,_1c2a,_1c35,_1c36],{baseClass:"epi-item-collection-editor",multiple:true,res:_1c38,actionsResource:_1c38,templateString:_1c37,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_1c34,_newItemCommand:null,_gridClass:_1c1f([_1c2e,_1c28,_1c2f,DnD,_1c2d]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _1c33(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _1c29(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _1c2b();this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions});this.contextMenu.addProvider(this.commandProvider);this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _1c32({model:this.model,dialogContentParams:this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_1c39=function(data,_1c3a,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_1c3b={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_1c30.contentItemFactory("text","title","typeIdentifier",menu),_1c39],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator),isSource:!this.readOnly},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_1c3c=function(_1c3d){var types=_1c2c.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_1c3b._getDndType=_1c3c;}this.own(this.grid=new this._gridClass(_1c3b,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_1c3e=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_1c3e(".dgrid-row",mouse.enter),function(e){_1c21.add(self,self._mouseOverClass);}),self.grid.on(_1c3e(".dgrid-row",mouse.leave),function(e){_1c21.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_1c3e(".dgrid-row",_1c31.keys.del),function(e){self.model.remove();}),self.grid.on(_1c3e(".dgrid-row",_1c31.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_1c3e(".dgrid-row",_1c31.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_1c20.around(self.grid.dndSource,"checkAcceptance",function(_1c3f){return function(_1c40,nodes){return !self.readOnly&&_1c3f.apply(self.grid.dndSource,arguments);};}),_1c20.after(self.grid.dndSource,"onDropData",function(_1c41,_1c42,nodes,copy){var i;if(self.grid.dndSource===_1c42){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{for(i=0;i<_1c41.length;i++){when(_1c41[i].data,lang.hitch(this,function(_1c43){self.model.addTo(_1c43,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_1c42&&_1c42.grid&&_1c42.grid.consumer&&_1c42.grid.consumer!==self){_1c42.grid.consumer.model.set("selectedItem",_1c43);_1c42.grid.consumer.model.remove();}}));}}},true),_1c20.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_1c20.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_1c44,nodes,copy){var _1c45=this.grid.dndSource,_1c46=_1c45.accept&&_1c45.checkAcceptance(_1c44,nodes);_1c21[_1c46?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_1c20.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1c47,_1c48,nodes,copy){for(var i=0;i<_1c47.length;i++){when(_1c47[i].data,lang.hitch(this,function(_1c49){this.model.addTo(_1c49,null,false);if(_1c48&&_1c48.grid&&_1c48.grid.consumer&&_1c48.grid.consumer!==this){_1c48.grid.consumer.model.set("selectedItem",_1c49);_1c48.grid.consumer.model.remove();}}));}this.focus();}),true));var _1c4a=this.commandProvider.commands.concat(this._newItemCommand);_1c4a.forEach(function(_1c4b){this.own(_1c20.after(_1c4b,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_1c20.after(_1c4b,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_1c4c){if(_1c4c==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _1c4d=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_1c4d){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1c4d;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.grid&&this.value&&this.value.length>0){this.grid.focus();if(this.model){var _1c4e=this.model.get("selectedItem"),_1c4f=this.model.getItemIndex(_1c4e);if(_1c4e){this.grid.focus(this.grid.row(_1c4f).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _1c33(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_1c50){this._set("readOnly",_1c50);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_1c50);}},_dndNodeCreator:function(item,hint){var _1c51=this.allowedDndTypes,node=_1c22.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_1c51=_1c2c.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {node:node,type:_1c51,data:item};},_aroundInsertRow:function(_1c52){return lang.hitch(this,function(_1c53,_1c54,_1c55,i,_1c56){var row=_1c52.apply(this.grid,arguments);var _1c57=this.model.get("selectedItem");if(_1c57&&_1c57.id===_1c53.id){this.select(_1c57);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){if(this.readOnly){return;}var _1c58=this.model.get("selectedItem"),_1c59=this.model.getItemIndex(_1c58);if(_1c58){event.stop(e);this.contextMenu.scheduleOpen(this,null,_1c24.position(query(".epi-iconContextMenu",this.grid.row(_1c59).element)[0],true));}},_displayActionsContainer:function(){_1c23.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1c5a,_1c5b,_1c5c,_1c5d){return _1c5a([_1c5b,_1c5c],{dialogContentClass:_1c5d,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel","epi-cms/widget/HyperLinkSelector"],function(array,_1c5e,lang,_1c5f,_1c60,_1c61,epi,_1c62,_1c63,_1c64,_1c65,_1c66,_1c67,_1c68){return _1c5e([_1c64,_1c65,_1c63,_1c61,_1c66],{_metadataManager:null,modelClassName:_1c67,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_1c62.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _1c69=_1c5e(this.modelClassName);this.model=new _1c69();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_1c6a){_1c6a.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_1c6b){array.forEach(this.form._getDescendantFormWidgets(),function(_1c6c){if(this.hiddenFields&&this.hiddenFields.indexOf(_1c6c.name)>-1){var _1c6d=this._getAncestorNode(_1c6c.domNode,"epi-form-container__section__row");_1c5f.set(_1c6d,{display:"none"});_1c6c.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_1c6e){var _1c6f=array.filter(this.form._getDescendantFormWidgets(),function(_1c70){return _1c70&&_1c70.name===_1c6e;},this);return _1c6f?_1c6f[0]:null;},_getAncestorNode:function(node,_1c71){var _1c72=node?node.parentNode:null;if(!_1c72){return null;}if(!_1c60.contains(_1c72,_1c71)){return this._getAncestorNode(_1c72,_1c71);}return _1c72;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_1c73){return _1c73.get("required")?!!_1c73.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/dependency"],function(array,_1c74,_1c75,lang,_1c76,topic,_1c77,when,_1c78){return _1c74([_1c77],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","dijit/form/ValidationTextBox","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(array,_1c79,lang,_1c7a,_1c7b,_1c7c,_1c7d,when,all,_1c7e,_1c7f,_1c80,_1c81,_1c82,Url,_1c83,_1c84,_1c85,_1c86,_1c87,_1c88,_1c89){return _1c79([_1c7f,_1c80,_1c83],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_1c86,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _1c8a=_1c79(this.modelClassName);this.model=new _1c8a({providers:this.providers});}this._languageStore=this._languageStore||_1c82.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();this._createRemainingUrlInput();},startup:function(){this.inherited(arguments);this._languageSelector.startup();this._remainingUrl.startup();var self=this,_1c8b=this._languageSelector;when(this._languageStore.get(),function(_1c8c){if(self.get("showLanguageSelector")){if(_1c8c.length<=1){self._toggleLanguageSelector(false);}else{self._toggleLanguageSelector(true);}}var _1c8d=_1c8c.map(function(_1c8e){return {text:_1c8e.name,value:_1c8e.languageId};});_1c8d.splice(0,0,{text:_1c88.automaticlanguage,value:""});_1c8b.set("selections",_1c8d);_1c8b.set("value","");return self._createInputWrappers();}).then(function(){_1c7d.place(this._remainingUrlWrapperNode,this.domNode,"last");}.bind(this));},onSelectorsCreated:function(_1c8f){},_setShowLanguageSelectorAttr:function(value){this._set("showLanguageSelector",value);this._toggleLanguageSelector(value);},_setSelectedWrapperAttr:function(_1c90){if(!_1c90){return;}array.forEach(this.wrappers,function(_1c91){_1c91.set("selected",false);});_1c90.set("selected",true);this._languageSelector.set("disabled",!_1c90.settings.isContentLink);_1c7c.toggle(this._remainingUrlWrapperNode,"dijitHidden",!_1c90.settings.isContentLink);},_createLanguageSelector:function(){this.own(this._languageSelector=new _1c85());this._languageSelectorWrapperNode=_1c7d.toDom(_1c7e.substitute(_1c89,{id:this._languageSelector.id,label:_1c88.language,title:""}));_1c7d.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_createRemainingUrlInput:function(){this.own(this._remainingUrl=new _1c81({}));this._remainingUrlWrapperNode=_1c7d.toDom(_1c7e.substitute(_1c89,{id:this._remainingUrl.id,label:_1c88.remainingurl,title:_1c88.remainingurltitle}));this._remainingUrl.placeAt(this._remainingUrlWrapperNode,"last");},_toggleLanguageSelector:function(_1c92){_1c7c.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_1c92);},_createInputWrappers:function(){var _1c93=this.model.wrapperSettings,_1c94=[],self=this;_1c93.forEach(function(_1c95){var def=new _1c7a();_1c94.push(def.promise);require([_1c95.widgetType],function(ctor){var _1c96=new _1c84(lang.mixin(_1c95,{groupName:_1c95.groupName+this.id,inputWidgetCtor:ctor,required:self.required}));self.own(_1c96.on("radioButtonChange",lang.hitch(this,function(){self.set("selectedWrapper",_1c96);_1c96.focus();})));if(_1c95.invisible){_1c7b.set(_1c96.domNode,{display:"none"});}def.resolve(_1c96);});},this);return when(all(_1c94),function(_1c97){if(_1c97.length===0){return;}_1c97.forEach(function(_1c98){self.addChild(_1c98);});self.set("wrappers",_1c97);var value=self.get("value");if(value){self._setValueForWidgets(value);}else{self.set("selectedWrapper",_1c97[0]);}self.onSelectorsCreated(self);});},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_1c99){return _1c99.get("selected");})[0];},_getValueAttr:function(){var _1c9a=this._getSelectedWrapper();if(_1c9a){if(_1c9a.inputWidget&&_1c9a.settings.isContentLink){return this.model.getUrlValue(_1c9a.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this._remainingUrl.get("value"),this.value);}else{return _1c9a.get("value");}}return this.value;},_setValueAttr:function(value){var _1c9b=function(value){this._set("value",value);this._remainingUrl.set("value",this.model.getRemainingUrl(value));this._setValueForWidgets(value);};if(value){this.model.getPermanentLink(value).then(_1c9b.bind(this));}else{_1c9b.call(this,value);}},_setValueForWidgets:function(value){var _1c9c=this.get("wrappers");if(!_1c9c){return;}array.forEach(_1c9c,function(_1c9d){_1c9d.set("value",null);});if(!value){return;}var url=new Url(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));when(this.model.getContentData(value),lang.hitch(this,function(_1c9e){if(_1c9e){array.every(_1c9c,function(_1c9f){if(_1c9f&&_1c9f.settings.isContentLink){if(array.some(_1c9f.settings.allowedTypes,lang.hitch(this,function(_1ca0){return this.model.isBaseTypeIdentifier(_1c9e.typeIdentifier,_1ca0);}))){_1c9f.set("value",_1c9e.contentLink);this.set("selectedWrapper",_1c9f);return false;}}return true;},this);}else{array.every(_1c9c,function(_1ca1){if(_1ca1&&!_1ca1.settings.isContentLink){var _1ca2=_1ca1.inputWidget;if(_1ca2&&this._isValidEditorWidget(value,_1ca2)&&_1ca2.validator(value,_1ca2.constraints)){_1ca1.set("value",value);this.set("selectedWrapper",_1ca1);return false;}}return true;},this);}}));},_isValidEditorWidget:function(value,_1ca3){if(_1ca3 instanceof _1c87){return Url(value).scheme==="mailto";}return true;},validate:function(){var _1ca4=this._getSelectedWrapper();if(_1ca4){_1ca4._hasBeenBlurred=this._hasBeenBlurred;return _1ca4.validate();}return false;},focus:function(){var _1ca5=this._getSelectedWrapper();if(_1ca5){_1ca5.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Contained","epi/string","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_1ca6,lang,_1ca7,_1ca8,_1ca9,_1caa,_1cab){return _1ca6([_1ca7,_1ca9,_1ca8],{templateString:_1cab,inputWidget:null,inputWidgetCtor:null,settings:null,_hasBeenBlurred:false,buildRendering:function(){this.inherited(arguments);var _1cac=lang.mixin({value:this.get("value")||null},this.settings);this.own(this.inputWidget=new this.inputWidgetCtor(_1cac).placeAt(this.domNode));},_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_1cad,evt){},validate:function(){if(this.inputWidget){this.inputWidget._hasBeenBlurred=this._hasBeenBlurred;return this.inputWidget.validate();}return true;},_setValueAttr:function(value){this._set("value",value);if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){if(this._started&&this.inputWidget){return this.inputWidget.get("value");}return this.value;},_setRequiredAttr:function(val){this._set("required",val);if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){this._set("selected",value);if(this.inputWidget){this.inputWidget.set("disabled",!value);if(!value){this.inputWidget.set("state","");}}this.radioNode.checked=value;},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){this._set("showAllLanguages",val);if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}_${name}\">\r\n        <input type=\"radio\" name=\"${groupname}\" id=\"${id}_${name}\" value=\"${name}\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-attach-event=\"onchange:_onRadioButtonChange\" data-dojo-attach-point=\"radioNode\" />\r\n        ${displayName}\r\n    </label>\r\n</div>","epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dojox/html/entities","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_1cae,lang,_1caf,on,_1cb0,_1cb1,_1cb2,_1cb3,_1cb4,_1cb5){return _1cae([_1cb4,_1cb1,_1cb5],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1cb6){this.set("options",array.map(_1cb6,function(item){return {label:_1cb0.encode(item.text),value:item.value,selected:(item.value===this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);this.own(on(this,"change",lang.hitch(this,function(){if(!this.disabled){this.validate();}this.onLayoutChanged();})));},_getMenuItemForOption:function(_1cb7){var item=null;if(_1cb7.type==="separator"){item=new _1cb3();}else{var click=lang.hitch(this,"_setValueAttr",_1cb7);item=new _1cb2({option:_1cb7,label:_1cb7.label||this.emptyLabel,onClick:click,disabled:_1cb7.disabled||false});item.focusNode.setAttribute("role","listitem");}this.own(item);return item;},_getValueFromOpts:function(){var _1cb8=this.getOptions()||[];if(!this.multiple&&_1cb8.length){var _1cb9=array.filter(_1cb8,function(i){return i.selected;})[0];if(_1cb9&&_1cb9.value!==undefined){return _1cb9.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1cb8,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_1cba){var _1cbb=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_1cbb,function(i){return (i.value===value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _1cbc=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_1cbc;this.actualValue=_1cbc;}array.forEach(_1cbb,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_1cba);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _1cbd=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_1cbd);},this);}},validator:function(value,flags){}});});},"epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/Url","epi/shell/TypeDescriptorManager","epi-cms/core/PermanentLinkHelper"],function(array,_1cbe,lang,_1cbf,_1cc0,_1cc1,_1cc2,when,_1cc3,Url,_1cc4,_1cc5){return _1cbe([_1cbf],{_providersSetter:function(_1cc6){var _1cc7=[];array.forEach(_1cc6,lang.hitch(this,function(_1cc8){_1cc7.push({name:_1cc8.name,displayName:_1cc8.displayName?_1cc8.displayName:_1cc8.name,title:_1cc8.title?_1cc8.title:"",groupname:"hyperLink_",widgetType:_1cc8.widgetType,invisible:_1cc8.invisible,settings:lang.mixin({roots:_1cc8.roots,allowedTypes:_1cc8.linkableTypes,isContentLink:(_1cc8.linkableTypes&&_1cc8.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null,searchArea:_1cc8.searchArea},_1cc8.widgetSettings)});}));this.set("wrapperSettings",_1cc7);},getContentData:function(value){if(value){return _1cc5.getContent(value,{allLanguages:true});}return null;},isBaseTypeIdentifier:function(type,base){return _1cc4.isBaseTypeIdentifier(type,base);},getPermanentLink:function(href){return _1cc5.getPermanentLink(href);},getUrlValue:function(_1cc9,_1cca,_1ccb,_1ccc){if(!_1cc9){return "";}var url=new Url(_1cc9);if(_1ccc){var _1ccd=new Url(_1ccc);if(this._areEqual(_1ccd,url)){url.query=lang.mixin(_1ccd.query,url.query);}}if(_1cca===""){delete url.query.epslanguage;}else{url.query.epslanguage=_1cca;}if(_1ccb){var rUrl=new Url(_1ccb);if(rUrl.path){url.query["epsremainingpath"]=rUrl.path;}if(rUrl.fragment){url.fragment=rUrl.fragment;}Object.keys(rUrl.query).forEach(function(key){url.query[key]=rUrl.query[key];});}return url.toString();},getRemainingUrl:function(value){if(!value){return "";}value=value.replace(/\+/g,"%20");var url=new Url(value);url.authority="";url.scheme="";delete url.query["epslanguage"];delete url.query["epieditmode"];if(url.query.epsremainingpath){url.path=url.query.epsremainingpath;}else{url.path="";}delete url.query["epsremainingpath"];return url.toString();},_areEqual:function(url1,url2){return url1.scheme===url2.scheme&&url1.authority===url2.authority&&url1.path===url2.path&&url1.fragment===url2.fragment;}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/lang","dojo/when","epi/dependency","epi/shell/XhrWrapper","epi/routes"],function(lang,when,_1cce,_1ccf,_1cd0){var xhr=new _1ccf();return {getContent:function(link,_1cd1){if(!link){return null;}var _1cd2=_1cce.resolve("epi.storeregistry"),store=_1cd2.get("epi.cms.content.light"),query=lang.mixin({query:"getcontentbypermanentlink",permanentLink:link},_1cd1||{});return when(store.query(query)).then(function(_1cd3){return _1cd3&&_1cd3 instanceof Array?_1cd3[0]:_1cd3;});},getPermanentLink:function(href){var route=_1cd0.getActionPath({moduleArea:"CMS",controller:"Links",action:"GetPermanentLink"});return xhr.xhrGet({url:route,content:{href:href}});}};});},"epi-cms/form/EmailValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/ValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.form.emailvalidation"],function(_1cd4,lang,_1cd5,res){var _1cd6=_1cd4([_1cd5],{invalidMessage:res.invalidmessage,addMailTo:false,validator:function(value,_1cd7){value=value||"";if(!this.required&&this._isEmpty(value)){return true;}value=value.replace(/\\.{1}/g,"replaced").replace(/".*?"/g,"replaced");return _1cd6.validationRegex.test(value);},_getValueAttr:function(){var value=this.inherited(arguments);if(this.addMailTo){value=value?lang.trim(value):"";if(value&&value.indexOf("mailto:")!==0){value="mailto:"+value;}}return value;},_setValueAttr:function(value){value=value?value.replace("mailto:",""):"";this.inherited(arguments,[value]);}});_1cd6.validationRegex=/.+@.+\..+/i;return _1cd6;});},"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}\" title=\"${title}\">${label}</label>\r\n</div>","epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin","epi-cms/contentediting/viewmodel/LinkItemModel"],function(_1cd8,lang,_1cd9,all,when,_1cda,_1cdb){return _1cd8([_1cda],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_1cdc){_1cd8.safeMixin(this,_1cdc);},postscript:function(data){require([this.itemModelType],lang.hitch(this,function(_1cdd){this.itemModelClass=_1cdd;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1cde,item,_1cdf){if(!_1cde){return false;}if(this.getItemIndex(_1cde)>=0){this.moveTo(_1cde,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1cde),function(model){if(!item){self._data.push(model);}else{var _1ce0=self.getItemIndex(item)+(_1cdf?0:1);self._data.splice(_1ce0,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_1ce1,item,_1ce2){if(!_1ce1&&!this._selectedItem){return false;}this.set("selectedItem",_1ce1||this._selectedItem);var _1ce3=this.getItemIndex(this._selectedItem);this._data.splice(_1ce3,1);var _1ce4=(item?this.getItemIndex(item):(this._data.length-1))+(_1ce2?0:1);this._data.splice(_1ce4,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_1ce5,_1ce6){if(!this._data[_1ce5]||!this._data[_1ce6]){return false;}var temp=this._data[_1ce5];this._data[_1ce5]=this._data[_1ce6];this._data[_1ce6]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_1ce7;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_1ce7=data.map(function(item){return this._createItemModel(item);},this);all(_1ce7).then(function(_1ce8){self._data=_1ce8;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _1ce9=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _1cd9();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _1ce9){model=lang.mixin(lang.clone(item),id);}else{model=new _1ce9(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_1cea){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_1cea);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_1ceb,lang,_1cec,when,Url,_1ced,_1cee){return _1ceb([_1ced],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1cef=new Url(url);if(!_1cef.scheme){_1cef=new Url("",{scheme:window.location.protocol,authority:window.location.hostname,path:url});}return _1cef.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1cee.getContent(this.href),lang.hitch(this,function(_1cf0){if(_1cf0){this._parseFromContent(_1cf0);}}));}},_parseFromContent:function(_1cf1){if(_1cf1){this.typeIdentifier=_1cf1.typeIdentifier;this.publicUrl=this._buildPublicUrl(_1cf1.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1cf2,_1cf3){return _1cf2([_1cf3],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_1cf4){if(_1cf4){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_1cf5,_1cf6){if(_1cf5===_1cf6){return this[_1cf5];}return this.get(_1cf5);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_1cf7,_1cf8,Edit,_1cf9,_1cfa,_1cfb){return _1cf7([_1cfb],{constructor:function(_1cfc){var _1cfd=_1cfc?_1cfc.commandOptions:{};this.commands=[new Edit(_1cfd),new _1cf9(_1cfd),new _1cfa(_1cfd),new _1cf8(_1cfd)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1cfe,_1cff,_1d00,_1d01){return _1cfe([_1cff,_1d00],{dialogContentClass:_1d01,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_1d02){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_1d02&&_1d02.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\r\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\r\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\r\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_1d03,_1d04,_1d05,_1d06){return _1d03([_1d06],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _1d05({datePackage:null});this.inherited(arguments);},_setLabelValueAttr:function(value){this.inherited(arguments,[_1d04.toUserFriendlyHtml(value)]);},_setValueAttr:function(value){if(value&&value instanceof Date){value=new Date(value.getFullYear(),value.getMonth(),value.getDate(),value.getHours(),value.getMinutes());}this.inherited(arguments,[value]);}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_1d07,lang,_1d08,_1d09,dijit,_1d0a,_1d0b,_1d0c,_1d0d,_1d0e,epi,_1d0f,_1d10){return _1d07([_1d0b,_1d0a,_1d0c,_1d0d],{value:null,changeLabel:epi.resources.action.change,templateString:_1d0f,control:null,controlParams:[],state:"",_setLabelValueAttr:function(value){this._set("labelValue",value);if(this._isHtml(value)){this.labelNode.innerHTML=value;}else{this.labelNode.title=value;this.labelNode.textContent=value;}},_setIsEmptyAttr:function(_1d11){this._set("isEmpty",_1d11);if(_1d11){_1d08.add(this.domNode,"epi-state-empty");}else{_1d08.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_1d10.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1d0e();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_1d12){this.control.set(_1d12,this.get(_1d12));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_1d13){if(!_1d13&&!this.validate()){return;}this.showControl=_1d13;_1d09.set(this.labelNode,"display",_1d13?"none":"");_1d09.set(this.control.domNode,"display",_1d13?"":"none");if(!this.readOnly){_1d09.set(this.changeNode,"display",_1d13?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_1d10.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_1d14){this._set("readOnly",_1d14);_1d09.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();},_isHtml:function(text){return text!==_1d10.encode(text);}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-previewableTextBox-link epi-functionLink\">${changeLabel}</a>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_1d15,_1d16,_1d17,_1d18){return _1d15([_1d18],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/DialogService","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_1d19,lang,_1d1a,_1d1b,_1d1c,_1d1d,_1d1e,_1d1f,epi,_1d20,_1d21,_1d22,_1d23,_1d24,_1d25){return _1d19([_1d1c,_1d1d,_1d1e,_1d23],{templateString:"<div class=\"dijitInline\">                            <span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink\" data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div>                          </div>",resources:epi.resources,value:null,contentLink:null,metadata:null,destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _1d26=new _1d21({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _1d22({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});_1d20.dialog({defaultActionsVisible:false,confirmActionText:_1d25.action.save,content:_1d26,title:_1d24.dialogtitle}).then(function(){var value=_1d26.get("value");this.set("value",value);this.onChange(value);}.bind(this)).always(function(){this.isShowingChildDialog=false;}.bind(this));this.isShowingChildDialog=true;},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1d1b.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","dojox/validate/regexp","epi-cms/widget/Breadcrumb","epi-cms/contentediting/PageShortcutTypeSupport","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/nls/episerver.shared"],function(_1d27,lang,_1d28,_1d29,html,_1d2a,_1d2b,_1d2c,_1d2d,_1d2e,_1d2f,_1d30,_1d31,_1d32,_1d33){return _1d27([_1d2f,_1d31,_1d2e,_1d2a,_1d30],{templateString:_1d32,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],enableSaveButton:["enableSaveButton"],enableShortcutLink:["enableShortcutLink"],enableExternalLink:["enableExternalLink"],clearExternalLink:["clearExternalLink"],enableOpenIn:["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _1d34=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-form-container__section__row");if(_1d34){_1d28.set(_1d34,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _1d35=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-form-container__section__row");if(_1d35){_1d28.set(_1d35,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _1d36=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-form-container__section__row");if(_1d36){_1d28.set(_1d36,"display",value?"":"none");}}},_getAncestorNode:function(node,_1d37){var _1d38=node?node.parentNode:null;if(!_1d38){return null;}if(!_1d29.contains(_1d38,_1d37)){return this._getAncestorNode(_1d38,_1d37);}return _1d38;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_1d39,_1d3a){switch(_1d39){case "pageLinkURL":this._externalLinkWidget=_1d3a;this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "contentShortcutLink":this._shortcutLinkWidget=_1d3a;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_1d3a;break;case "pageTargetFrame":this._targetFrameWidget=_1d3a;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{pageShortcutTypeName:this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));var _1d3b=this._shortcutTypeWidget&&this._shortcutTypeWidget.get("value");if(_1d3b===_1d2d.pageShortcutTypes.Shortcut){this._shortcutLinkWidget&&this._shortcutLinkWidget.set("canSelectOwnerContent",false);}},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_1d33.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_1d33.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_1d3c,dojox){var _1d3d=lang.getObject("validate.regexp",true,dojox);_1d3d=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _1d3e="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _1d3f="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _1d40="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _1d41="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _1d42="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _1d43="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_1d3e);}if(flags.allowDottedHex){a.push(_1d3f);}if(flags.allowDottedOctal){a.push(_1d40);}if(flags.allowDecimal){a.push(_1d41);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_1d42);}if(flags.allowHybrid){a.push(_1d43);}var _1d44="";if(a.length>0){_1d44="("+a.join("|")+")";}return _1d44;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _1d45="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _1d46="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _1d47=flags.allowPort?"(\\:\\d+)?":"";var _1d48="((?:"+_1d45+"\\.)+"+_1d46+"\\.?)";if(flags.allowIP){_1d48+="|"+_1d3d.ipAddress(flags);}if(flags.allowLocal){_1d48+="|localhost";}if(flags.allowNamed){_1d48+="|^[^-][a-zA-Z0-9_-]*";}return "("+_1d48+")"+_1d47;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _1d49=_1d3c.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _1d4a="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _1d49+_1d3d.host(flags)+_1d4a;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _1d4b="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _1d4c=_1d4b+"@"+_1d3d.host(flags);if(flags.allowCruft){_1d4c="<?(mailto\\:)?"+_1d4c+">?";}return _1d4c;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _1d4d=_1d3d.emailAddress(flags);var _1d4e="("+_1d4d+"\\s*["+flags.listSeparator+"]\\s*)*"+_1d4d+"\\s*["+flags.listSeparator+"]?\\s*";return _1d4e;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _1d4f=function(_1d50){return _1d3c.escapeString(_1d50,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _1d3c.buildGroupRE(flags.format,_1d4f);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _1d51="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _1d52="AS|FM|GU|MH|MP|PW|PR|VI";var _1d53="AA|AE|AP";if(flags.allowTerritories){_1d51+="|"+_1d52;}if(flags.allowMilitary){_1d51+="|"+_1d53;}return "("+_1d51+")";}}};return _1d3d;});},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(dojo){return dojo.dojox;});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-form-container\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi"],function(_1d54,_1d55,_1d56,_1d57,epi){return _1d54([_1d55],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_intermediateValueSetter:function(value){this.intermediateValue=value;this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType===_1d57.pageShortcutTypes.Shortcut||value.pageShortcutType===_1d57.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType===_1d57.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType===_1d57.pageShortcutTypes.External&&this.savedValue.pageShortcutType!==_1d57.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&value.pageShortcutType!==_1d57.pageShortcutTypes.Inactive);},_savedValueSetter:function(value){this.savedValue=value;this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1d58,_1d59,_1d5a,topic,_1d5b,_1d5c,_1d5d,_1d5e){return _1d58([_1d5e],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var self=this;this.own(topic.subscribe("/epi/shell/context/request",function(_1d5f,_1d60){if(!_1d60.contextIdSyncChange){self.tryToStopEditing(false);self.set("editing",false);self._destroyDialog();}}),topic.subscribe("/epi/shell/action/changeview",function(){self.set("editing",false);self._removeEditingFeatures();}));},destroy:function(){this.tryToStopEditing(false);this._destroyDialog();this.inherited(arguments);},startEdit:function(_1d61){this.editorParams=Object.assign(this.editorParams||{},_1d61);var self=this;self._destroyDialog();return self._setupDialog().then(function(){self.own(_1d59.after(self._dialog,"onAfterShow",function(){self._startEdit(_1d61);self._onTryToStopWithInvalidValue();}));return self._dialog.show();});},_createDialog:function(_1d62){return new _1d5d({title:this.propertyDisplayName,content:_1d62,duration:350,snapToNode:this.get("overlayItem").domNode,positioner:_1d5c.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(node){this.inherited(arguments);var _1d63=this._dialog;if(_1d63){_1d63.set("snapToNode",node);}},_setupDialog:function(){var _1d64={};var _1d65=function(_1d66,_1d67){_1d64[_1d66]=_1d67;};var _1d68=function(_1d69){for(var _1d6a in _1d64){var _1d6b=_1d64[_1d6a];_1d6b.set("parent",this);}_1d64=null;}.bind(this);var _1d6c=Object.assign({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){_1d6c=Object.assign(_1d6c,{onFieldCreated:_1d65,onFormCreated:_1d68,doLayout:false});}var _1d6d=new _1d5a();require([this.editorWidgetType],function(_1d6e){var _1d6f=new _1d6e(_1d6c);this.editorWidget=_1d6f;var _1d70=this._createDialog(_1d6f);this._handlers=[this.connect(_1d70,"onButtonClose",this._onButtonClose),this.connect(_1d70,"onCancel",this._onDialogCancel),this.connect(_1d70.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1d6f,"onChange",this._onChange),this.connect(_1d6f,"onKeyPress","_onEditorKeyPress")];this._dialog=_1d70;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1d6d.resolve();}.bind(this));return _1d6d.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_1d71){_1d71.remove();});this._handlers=null;if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}if(this._dialog){this._dialog.destroy();this._dialog=null;}},_removeEditingFeatures:function(){var _1d72=this._dialog;if(_1d72&&_1d72.open){_1d72.hide();}},_onTryToStopWithInvalidValue:function(){_1d5b.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/has","dijit/focus","dijit/DialogUnderlay","dijit/Dialog","epi/shell/widget/dialog/_DialogMixin","dijit/_WidgetsInTemplateMixin","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/LightWeight.html"],function(_1d73,lang,_1d74,_1d75,_1d76,has,focus,_1d77,_1d78,_1d79,_1d7a,_1d7b,_1d7c){return _1d73([_1d78,_1d79,_1d7a],{templateString:_1d7c,buttonCloseText:_1d7b.action.close,buttonDoneText:_1d7b.action.done,buttonLearnMoreText:_1d7b.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,showButtonContainer:true,destroy:function(){this._interval&&clearInterval(this._interval);this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){var _1d7d=this._relativePosition&&this._relativePosition.id;_1d76.set(this.containerNode,"overflow","visible");this.inherited(arguments);_1d76.set(this.containerNode,"overflow","auto");if(this.positioner){var obj={snapTo:this.snapToNode,transformIndex:_1d7d};this._relativePosition=this.positioner.findPosition(this.domNode,obj);}},resize:function(){this._size();this._position();},_onAfterShow:function(){function _1d7e(){var _1d7f=_1d75.position(this.domNode),_1d80=this._relativePosition;if(_1d80&&(Math.abs(_1d80.w-_1d7f.w)>8||Math.abs(_1d80.h-_1d7f.h)>8)){this.resize();}};if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.own(_1d74.after(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay)),_1d74.after(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay)));this._attachedContentResizeEvents=true;}}this._interval=setInterval(lang.hitch(this,_1d7e),250);this.onAfterShow();},_createUnderlay:function(){var _1d81=this.containerNode,_1d82=_1d76.get(_1d81,"width");if(has("trident")){var _1d83=_1d81.offsetWidth-_1d81.clientWidth;_1d82+=_1d75.getPadBorderExtents(_1d81).w+_1d83;}_1d76.set(_1d81,{width:_1d82+"px"});if(this._glassUnderlay){this._glassUnderlay.show();}else{this.own(this._glassUnderlay=new _1d77());this._glassUnderlay.show();var _1d84=_1d76.get(this.domNode,"zIndex");_1d76.set(this._glassUnderlay.domNode,"zIndex",_1d84-1);_1d76.set(this._glassUnderlay.domNode,"opacity","0");}},_endDrag:function(){this.inherited(arguments);this._relativePosition.id=this.positioner.userSetTransformId;},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},_setSnapToNodeAttr:function(node){this.snapToNode=null;this._set("snapToNode",node);},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){this._interval&&clearInterval(this._interval);this._interval=null;return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1d76.get(this._glassUnderlay.domNode,"display")!=="none"){this._glassUnderlay.layout();}var _1d85=_1d77._singleton;var _1d86=_1d85?_1d76.get(_1d85.domNode,"display"):null;this.inherited(arguments);if(_1d85){_1d76.set(_1d85.domNode,"display",_1d86);}},_setShowButtonContainerAttr:function(_1d87){this._set("showButtonContainer",_1d87);_1d76.set(this.buttonContainerNode,"display",_1d87?"":"none");},_checkIfSingleChild:function(){this._singleChild=null;}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_1d88,lang,on,_1d89,_1d8a){return _1d88([_1d8a],{destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onEditorResize:function(_1d8b){},_onEditorResizeFinished:function(_1d8c){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _1d8d=null,_1d8e=this.overlayItem;while(_1d8e){if(_1d8e instanceof _1d89){_1d8d=_1d8e;break;}_1d8e=_1d8e.getParent();}return this._iframeWithOverlay=_1d8d;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1d8f,_1d90,lang,_1d91,_1d92,_1d93,_1d94,_1d95,_1d96,_1d97){return _1d90([_1d97],{_eventHandlers:null,constructor:function(){this._eventHandlers=[];},_createDialog:function(_1d98){var _1d99=function(_1d9a){if(!this.open||!_1d9a){return;}this._containerNodeCS=this._containerNodeCS||_1d93.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1d92.getMarginBox(this.domNode).h-_1d92.getMarginBox(this.containerNode).h;}_1d92.setMarginBox(this.containerNode,{h:_1d9a.h-this._chromeHeight},this._containerNodeCS);_1d93.set(this.domNode,{top:_1d9a.t+"px",left:_1d9a.l+"px"});};var _1d9b=new _1d96({title:this.propertyDisplayName,content:_1d98,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_1d99,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1d91.add(_1d9b.domNode,"epi-floatingEditorWrapperDialog");_1d91.remove(_1d9b.domNode,"epi-lfw-dialog--dark");_1d9b.placeAt(this.get("iframeWithOverlay"));_1d93.set(_1d9b.domNode,{top:"-10000px"});return _1d9b;},_disconnectLocal:function(_1d9c){if(lang.isArray(_1d9c)){var _1d9d;while((_1d9d=_1d9c.pop())){_1d8f.disconnect(_1d9d);}}},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1d9e,event,lang,_1d9f,_1da0,on,when,_1da1){return _1d9e([_1da1],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},tryToStopEditing:function(){var _1da2=this.getEditorWidget();if(_1da2&&_1da2.isEditing()){_1da2.onEditorBlur();}this.inherited(arguments,[true]);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _1da3=new _1da0();var _1da4=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_1da4.style=this._computeStyling();}require([this.editorWidgetType],lang.hitch(this,function(_1da5){var _1da6=this.editorWidget=new _1da5(_1da4);_1da6.placeAt(this.get("overlayItem").domNode);this.own(on(_1da6.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_1da6,"onClick",event.stop),this.connect(_1da6,"onEditorResizing",this._onEditorResizing),this.connect(_1da6,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_1da6,"onChange","_onEditorChange"));this._handlers.push(this.connect(_1da6,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_1da3.resolve(_1da6);}));return _1da3;},_computeStyling:function(){var _1da7=_1d9f.getComputedStyle(this.blockDisplayNode),_1da8="line-height:"+_1da7.lineHeight+";",_1da9=_1d9f.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _1daa=_1da7["font"+prop],_1dab=_1da9["font"+prop];if(_1dab!==_1daa){_1da8+="font-"+prop+":"+_1da7["font"+prop]+";";}},this);var width=this.width;if(width==="100%"){_1da8+="width:100%;";}else{_1da8+="width:"+(width+(Number(width)===width?"px":""))+";";}_1da8+="position: absolute; left: 0px; top: 0px;";return _1da8;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_1dac){},_onEditorResized:function(_1dad){},_onEditorStateChanged:function(_1dae){var _1daf=this.get("overlayItem");_1daf&&_1daf.set("error",_1dae==="Error");},startEdit:function(){var _1db0=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_1db1){this._blockDisplayNodeOpacity=_1d9f.get(this.blockDisplayNode,"opacity");_1d9f.set(_1db1.domNode,{display:""});_1d9f.set(this.blockDisplayNode,{opacity:0.5});_1db0.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_1db2){_1db2.remove();});},_onTryToStopWithInvalidValue:function(){},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_1d9f.set(this.blockDisplayNode,{opacity:this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_1d9f.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_1db3){var _1db4=this.get("overlayItem");if(!_1db4){return;}var _1db5=this.getEditorWidget();if(!_1db5||!_1db5.supportCustomDnd){return;}if(_1db3===true){_1db4.transferDndControlTo(_1db5);}else{_1db4.transferDndControlTo(_1db4);}},_toggleOverlayItemZIndex:function(_1db6){var _1db7=this.get("overlayItem");if(!_1db7||!_1db7.item){return;}var _1db8=parseInt(_1d9f.get(_1db7.item,"zIndex"),10);_1d9f.set(_1db7.item,{zIndex:_1db6===true?++_1db8:--_1db8});}});});},"epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1db9,lang,array,_1dba,when,_1dbb,_1dbc,_1dbd,_1dbe,_1dbf,_1dc0,_1dc1,_1dc2){return _1db9([_1dbf,_1dbc,_1dbd,_1dbe],{templateString:_1dc2,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _1dc3=this.detailsWidgetIdentifier;var _1dc4=this.detailsModelIdentifier;var _1dc5=new _1dba();var _1dc6=new _1dba();require([_1dc3,_1dc4],lang.hitch(this,function(_1dc7,_1dc8){var _1dc9=new _1dc7({},this.contentDetails);this.own(_1dc9);var model=new _1dc8();this.own(model);_1dc9.set("model",model);_1dc9.startup();this.contentDetails=_1dc9;_1dc5.resolve(_1dc9);_1dc6.resolve(model);}));this._contentDetailsDef=_1dc5;this._contentDetailsModelDef=_1dc6;},_setContentViewModelAttr:function(_1dca){this._set("contentViewModel",_1dca);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1dca);});},addChild:function(w){if(this.detailsWidgetProperties){var _1dcb=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName===w.name;});if(_1dcb.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1dcc){_1dcc.addChild(w,_1dcb[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <div data-dojo-attach-point=\"contentDetails\"></div>\r\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_1dcd,_1dce,_1dcf){return _1dcd([_1dcf],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_1dce.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_1dce.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _1dd0="";var _1dd1=this.disabled||this.isValid(true);if(_1dd1){this._maskValidSubsetError=true;}var _1dd2=this._isEmpty(this.textbox.value);var _1dd3=!_1dd1&&this._isValidSubset();this._set("state",_1dd1?(this._isValidWhenTyping()?"":"Incomplete"):(((_1dd2||_1dd3)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_1dd1?"false":"true");if(this.state==="Error"){this._maskValidSubsetError=_1dd3;_1dd0=this.getErrorMessage(true);}else{if(this.state==="Incomplete"){_1dd0=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_1dd2){_1dd0=this.getPromptMessage(true);}}}this.set("message",_1dd0);return _1dd1;}});});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_1dd4,lang,when,epi,_1dd5,_1dd6,_1dd7,_1dd8,_1dd9,_1dda,_1ddb,_1ddc,_1ddd,_1dde){return _1dd4([_1dde,_1dda,_1ddb],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,expirationCommand:null,constructor:function(_1ddf){_1dd4.safeMixin(this,_1ddf);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=this.accessRightsCommand||new _1dd8();this.languageSettingsCommand=this.languageSettingsCommand||new _1dd9();if(!this.expirationCommand){var _1de0=_1dd6.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_1de0.manageExpiration;}if(!this.store){var _1de1=_1dd6.resolve("epi.storeregistry");this.store=_1de1.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.inherited(arguments);},_dataModelSetter:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_1de2,value){var _1de3=this.dataModel.contentData,_1de4=new _1ddd(_1de3.contentLink);this.set("contentId",_1de4.id);this.set("existingLanguages",array.map(_1de3.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_1de3.currentLanguageBranch&&item.languageId===_1de3.currentLanguageBranch.languageId,contentLink:new _1ddd(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_1de3.visibleToEveryOne);when(this.store.get(_1de3.contentTypeID),lang.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _1de5=this.inherited(arguments);return [this.languageSettingsCommand,this.expirationCommand].concat(_1de5);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/DialogService","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights","epi/i18n!epi/shell/nls/admin.security","epi/i18n!epi/shell/nls/edit.editsecurity","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","epi/i18n!epi/shell/nls/button","epi/i18n!epi/nls/episerver.shared","xstyle/css!epi-cms/contentediting/AdminWidgets.css"],function(_1de6,lang,_1de7,_1de8,_1de9,_1dea,_1deb,_1dec,_1ded,_1dee,_1def,_1df0,_1df1,_1df2){function _1df3(store){return {searchEntities:function(_1df4){return store.query({includeRoles:true,includeVisitorGroups:true,name:_1df4}).then(function(_1df5){return _1df5.map(function(x){return {key:x.name,entityType:x.reviewerType};});});}};};return _1de6([_1de9],{name:"AccessRights",label:_1dec.label,tooltip:_1dec.tooltip,store:null,userNotificationsStore:null,constructor:function(_1df6){_1de6.safeMixin(this,_1df6);this.store=this.store||_1de7.resolve("epi.storeregistry").get("epi.cms.accessrights");this.userNotificationsStore=this.userNotificationsStore||_1de7.resolve("epi.storeregistry").get("epi.cms.notification.users");},_execute:function(){require(["epi-cms/contentediting/AdminWidgets"],function(_1df7){var _1df8=Object.assign({},_1ded,_1dee,_1df1,_1def,_1df0,{heading:lang.replace(_1dee.heading,[this.model.contentData.name]),user:lang.replace(_1dee.user,[_1deb.userName])});var model=_1df3(this.userNotificationsStore);this.store.get(this.model.contentData.contentLink).then(function(_1df9){var _1dfa=new _1df7.ContentAccessRights({model:model,resources:_1df8,helpLink:_1deb.userGuideUrl+"#editsecurity",entries:_1df9.entries,isInherited:_1df9.isInherited,isInheritedEnabled:_1df9.isInheritedEnabled,userGroups:_1df9.userGroups});_1dea.dialog({dialogClass:"epi-dialog-portrait epi-dialog-portrait__autosize epi-dialog--wide",defaultActionsVisible:true,confirmActionText:_1df2.action.save,content:_1dfa,title:_1dee.title}).then(function(){this.store.executeMethod("Save",this.model.contentData.contentLink,{entries:model.entries,id:this.model.contentData.contentLink,isInherited:model.isInherited});}.bind(this));}.bind(this));}.bind(this));},_onModelChange:function(){var _1dfb=this.model.contentData,_1dfc=_1de8.hasAccess(_1dfb.accessMask,_1de8.accessLevel.Administer);this.set("canExecute",_1dfb.capabilities.securable&&_1dfc);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/DialogService","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings","epi/i18n!epi/shell/nls/edit.languagesettings","epi/i18n!epi/shell/nls/button","epi/i18n!epi/nls/episerver.shared","xstyle/css!epi-cms/contentediting/AdminWidgets.css"],function(_1dfd,lang,when,_1dfe,_1dff,_1e00,_1e01,_1e02,_1e03,_1e04,_1e05,_1e06){function _1e07(store,_1e08){return {getLanguageSettings:function(){return store.get(_1e08);},saveInheritSettings:function(_1e09){return store.executeMethod("UpdateInheritSettings",_1e08,{inheritSettings:_1e09,id:_1e08});},saveAvailableLanguages:function(_1e0a){return store.executeMethod("UpdateAvailableLanguages",_1e08,{availableLanguages:_1e0a,id:_1e08,inheritSettingsAvailable:false,inheritSettings:false,languages:null,replacementLanguages:null,fallbackLanguages:null});},saveFallbackLanguages:function(_1e0b){return store.executeMethod("UpdateFallbackLanguages",_1e08,{fallbackLanguages:_1e0b,id:_1e08});},saveReplacementLanguages:function(_1e0c){return store.executeMethod("UpdateReplacementLanguages",_1e08,{replacementLanguages:_1e0c,id:_1e08});}};};return _1dfd([_1e00],{name:"LanguageSettings",label:_1e03.label,tooltip:_1e03.tooltip,store:null,constructor:function(){this.store=_1dfe.resolve("epi.storeregistry").get("epi.cms.languagesettings");this.contentStore=_1dfe.resolve("epi.storeregistry").get("epi.cms.content.light");},_execute:function(){require(["epi-cms/contentediting/AdminWidgets"],function(_1e0d){when(this.contentStore.get(this.model.contentData.parentLink)).then(function(_1e0e){var _1e0f=Object.assign({},_1e04,{heading:lang.replace(_1e04.heading,[this.model.contentData.name]),inheritsettings:_1e0e?lang.replace(_1e04.inheritsettings,[_1e0e.name]):_1e04.inheritsettings,change:_1e05.change,save:_1e05.save,ok:_1e05.ok,cancel:_1e05.cancel});var model=_1e07(this.store,this.model.contentData.contentLink);model.getLanguageSettings().then(function(_1e10){var _1e11=new _1e0d.LanguageSettings({model:model,resources:_1e0f,defaultSettings:_1e10,helpLink:_1e02.userGuideUrl+"#languagesettings"});_1e01.dialog({dialogClass:"epi-dialog-portrait epi-dialog-portrait__autosize epi-dialog--wide",defaultActionsVisible:false,confirmActionText:_1e06.action.save,content:_1e11,title:_1e03.label});});}.bind(this));}.bind(this));},_onModelChange:function(){var _1e12=this.model.contentData;var _1e13=_1dff.hasAccess(_1e12.accessMask,_1dff.accessLevel.Administer);this.set("canExecute",_1e12.capabilities.languageSettings&&_1e13);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_1e14){return _1e14(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_1e15){_1e15.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_1e16,_1e17,data){if(_1e16===this.sourceDataType&&_1e17===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_1e18,_1e19,_1e1a){return _1e18([_1e1a],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/when","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_1e1b,_1e1c,when,_1e1d,_1e1e,_1e1f){return _1e1b([_1e1d],{templateString:_1e1f,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_1e20,index){if(this._destroyed){return;}if(_1e20.region==="top"){this.own(_1e20.placeAt(this.topPaneContainerNode));}else{this.inherited(arguments);}},removeChild:function(_1e21){if(_1e21.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _1e22=_1e1e.findWidgets(this.topPaneContainerNode);array.forEach(_1e22,function(_1e23){_1e23.resize();});return this.inherited(arguments);},selectChild:function(_1e24){if(_1e24.region==="top"){return;}else{return when(this.inherited(arguments)).then(function(_1e25){this.layout();return _1e25;}.bind(this));}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\r\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\r\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\r\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\r\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>\r\n","epi-cms/project/Overview":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/_ContextMixin","./_ProjectView","./viewmodels/OverviewViewModel","dojo/text!./templates/Overview.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/Toolbar","dijit/form/Button","dijit/form/DropDownButton","dijit/layout/TabContainer","epi-cms/activity/ActivityFeed","epi-cms/project/ProjectItemList","epi-cms/project/PublishMenu"],function(_1e26,lang,_1e27,on,when,_1e28,_1e29,_1e2a,_1e2b,res){return _1e26([_1e29],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],dndEnabled:["dndEnabled"],isActivitiesVisible:["isActivitiesVisible"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"],projectItemCountMessage:["projectItemCountMessage"],projectName:["projectName"]},res:res,templateString:_1e2b,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"refresh-activities",this.activityFeed.refresh.bind(this.activityFeed)));},_createViewModel:function(){return new _1e2a();},layout:function(){if(!this._started){return;}var _1e2c=_1e27.getMarginBox(this.toolbar),size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1e2c.h});this.tabs.resize(size);},_onShow:function(){this.model.set("isProjectOverviewActive",true);},onHide:function(){this.model.set("isProjectOverviewActive",false);},_close:function(){this.model.requestPreviousContext();},_setIsActivitiesVisibleAttr:function(_1e2d){this.itemList.toggleActivities(_1e2d);},_setProjectNameAttr:{node:"projectNameNode",type:"innerText"},_setProjectItemCountMessageAttr:{node:"toolbarTextNode",type:"innerText"}});});},"epi-cms/project/_ProjectView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/_ModelBindingMixin","./CreateNewDraftConfirmationDialog","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_1e2e,lang,_1e2f,_1e30,_1e31,on,when,_1e32,_1e33,_1e34,_1e35,_1e36,_1e37,_1e38,res){return _1e2e([_1e34,_1e32,_1e33,_1e37],{model:null,commandProvider:null,res:res,_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=this.commandProvider=this._createViewModel());}},_createViewModel:function(){},buildRendering:function(){this.inherited(arguments);this._setupList();this._setupProjectMenu();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();},_setupList:function(){var model=this.model,_1e39=this.itemList;function _1e3a(_1e3b){if(_1e3b.existingProjectItems.length!==0){new _1e38({projectItems:_1e3b.existingProjectItems,contentReferences:_1e3b.contentReferences,onAction:function(_1e3c){if(_1e3c){model.addProjectItems(_1e3b.contentReferencesToAdd).then(_1e39.setSelection.bind(_1e39));}}}).show();}else{if(_1e3b.contentReferencesToAdd.length>0){model.addProjectItems(_1e3b.contentReferencesToAdd);}}};this.own(on(this.model,"refresh",_1e39.refresh.bind(_1e39)),on(this.model,"selected-project-items-updated",function(_1e3d){_1e39.selectItems(_1e3d);}),on(this.domNode,"selection-changed",function(e){model.updateActivityFeed(e.items);}),on(this.domNode,"active-items-changed",function(e){model.set("selectedProjectItems",e.items);}),on(this.domNode,"itemaction",function(e){model.namedCommands.editProjectItem.execute();}),on(this.domNode,"itemremove",function(){model.namedCommands.removeProjectItem.execute();}),on(this.domNode,"itemsdropped",function(e){model.canAddContent(e.items).then(_1e3a);}),on(this.model,"clear-selection",function(){_1e39.clearSelection();}),on(this.model,"item-removed",function(){_1e39.clearSelection();_1e39.focus();}));},_setupProjectMenu:function(){this.own(this._menuAssembler=new _1e35({configuration:[{builder:new _1e36({settings:{"class":"epi-disabledDropdownArrow",showLabel:false}}),category:"projectButton",target:this.toolbarGroupNode},{builder:new _1e36({settings:{"class":"epi-floatRight",showLabel:false}}),category:"project-comments",target:this.projectCommentsToolbar},{builder:new _1e36(),category:"project-activities",target:this.toolbarGroupNode}],commandSource:this.model}));},_publishMenuClickHandler:function(){this.model.refreshProject(false);},_setCreatedAttr:{node:"createdNode",type:"innerText"},_setCreatedByAttr:{node:"createdByNode",type:"innerText"},_setDndEnabledAttr:function(value){this.itemList.set("dndEnabled",value);},_setProjectItemQueryAttr:function(value){var store=value?this.model.projectItemStore:null;this.itemList.updateQuery(store,value);},_setProjectItemSortOrderAttr:function(value){this.itemList.set("sortOrder",value);},_setNotificationMessageAttr:function(value){this.itemList.set("notificationMessage",value);},_setProjectStatusAttr:function(value){this.projectStatusMessageNode.textContent=value;_1e30.toggle(this.projectStatusMessageNode,"dijitHidden",!value);},_setContentLanguageAttr:function(value){this.itemList.set("contentLanguage",value);}});});},"epi-cms/project/CreateNewDraftConfirmationDialog":function(){define(["dojo/_base/declare","dojo/string","dgrid/Grid","epi/shell/widget/dialog/Confirmation","epi/string","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/episerver.cms.components.project.newdraftconfirmation"],function(_1e3e,_1e3f,Grid,_1e40,_1e41,_1e42,_1e43,_1e44,_1e45){return _1e3e([_1e40],{projectItems:null,contentReferences:null,title:_1e45.allreadypartofproject,cancelActionText:_1e44.action.cancel,dialogClass:"epi-dialog-contentReferences epi-contentReferences",setFocusOnConfirmButton:false,buildRendering:function(){this.inherited(arguments);var _1e46={showHeader:true,"class":"epi-plain-grid epi-plain-grid--no-border",columns:{name:{sortable:false,label:_1e44.header.name,className:"epi-grid--30 epi-cursor--default",renderCell:function(_1e47,value,node,_1e48){var title=_1e47.name+", ID: "+_1e47.contentLink;node.innerHTML=_1e42.statusFormatter(_1e43.contentItem(_1e47.typeIdentifier,"",value,title),_1e47,node,_1e48);}},path:{sortable:false,label:_1e45.path,className:"epi-grid--40 epi-cursor--default",formatter:_1e43.path},projectName:{sortable:false,className:"epi-grid--30 epi-cursor--default",label:_1e45.project,renderCell:function(_1e49,value,node,_1e4a){node.textContent=_1e49.projectName;}}}};this.own(this.content=new _1e3e([Grid])(_1e46));this.content.renderArray(this.projectItems);this.set("description",_1e3f.substitute(_1e45.confirmationtext,[this.projectItems.length,this.contentReferences.length]));this.set("confirmActionText",this.projectItems.length===1?_1e45.addnewdraft:_1e45.addnewdrafts);},_size:function(){this.inherited(arguments);this.content.resize();}});});},"epi-cms/dgrid/listItemFormatters":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.project","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/ListItem.html"],function(_1e4b,_1e4c,_1e4d,_1e4e,_1e4f,res,_1e50,_1e51,_1e52){var _1e53;function _1e54(item){return item.path?item.path.join(" > "):item.name;};function _1e55(item){if(!item.contentLanguage){return null;}return item.contentLanguage!==_1e53.contentLanguage?{language:item.contentLanguage}:null;};function _1e56(value,_1e57,node){var _1e58=_1e4e.accessLevel,_1e59="epi-statusIndicatorIcon epi-statusIndicator"+_1e57.status,title=_1e4e.versionLocalizations[_1e57.status]||"";if(_1e57.isDeleted){_1e59="epi-iconWarning epi-icon--warning";title=_1e50.versionnotfound;_1e4b.add(node,"epi-content--deleted");}else{if(!_1e4e.hasAccess(_1e57.accessMask,_1e58.Read)){_1e59="epi-iconLock";title=res.status.message.noreadaccess;_1e4b.add(node,"epi-content--no-access");}else{if(!_1e4e.hasAccess(_1e57.accessMask,_1e58.Publish)){_1e59="epi-iconWarning epi-icon--warning";title=res.status.message.nopublishaccess;}}}return "<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon "+_1e59+"\" title=\""+title+"\"></span>"+value;};function _1e5a(_1e5b){return function formatter(value,_1e5c,node,_1e5d){var _1e5e=_1e55(_1e5c),name=value.name||"",_1e5f=_1e4c.substitute(res.list.card.modifiedbyuser,{modified:_1e4f.localizedDate(_1e5c.modified),userName:_1e4f.userName(_1e5c.userName)}),_1e60=(_1e4e.versionLocalizations[_1e5c.status]||"")+(_1e5c.delayPublishUntil?" "+_1e4f.localizedDate(_1e5c.delayPublishUntil):""),map,_1e61=_1e5c.typeIdentifier;if(!_1e4e.hasAccess(_1e5c.accessMask,_1e4e.accessLevel.Read)){name=res.status.message.notavailable;_1e60=res.status.message.insufficient;_1e5f="";_1e61="";}if(_1e5c.isDeleted){_1e60=_1e50.versionnotfound;}map={iconResizer:_1e5c.thumbnailUrl?"epi-card__icon epi-card__icon--thumbnailresizer":"epi-card__icon",icon:_1e5c.thumbnailUrl?_1e4f.thumbnail(_1e5c.thumbnailUrl):_1e61&&_1e4f.contentIcon(_1e61," epi-icon--large")||"",name:_1e4d.encode(name,_1e4d.html),nameTooltip:_1e4d.encode(_1e54(_1e5c)||"",_1e4d.html),statusIcon:_1e56("",_1e5c,node,_1e5d),status:_1e60,menu:_1e4f.menu({title:_1e51.action.options}),cardTitle:_1e5f,cardTitleTooltip:res.list.card.lastmodified,contentTypeDescription:_1e4f.contentTypeDescription(_1e61)||"",languageBranch:_1e5e&&_1e5e.language||"",languageBranchClass:_1e5e&&_1e5e.language?"epi-card__language-branch":"epi-card__language-branch--hidden",commentsClass:_1e5c.hasComments?"":"dijitHidden",commentsTooltip:res.list.card.hascomments};_1e4b.add(node,_1e5b);return _1e4c.substitute(_1e52,map);};};_1e53={contentLanguage:null,languageSelector:_1e55,titleSelector:_1e54,statusFormatter:_1e56,card:[_1e5a("epi-card")],"card-compact":[_1e5a("epi-card epi-card--compact")]};return _1e53;});},"url:epi-cms/dgrid/templates/ListItem.html":"<div class=\"epi-mo\">\r\n    <div class=\"epi-mo--img\">\r\n        <div class=\"dijitIcon ${iconResizer}\">${icon}</div>\r\n    </div>\r\n    <div class=\"epi-mo--body\">\r\n        <div class=\"epi-card__menu\">\r\n            ${menu}\r\n        </div>\r\n        <span class=\"epi-secondaryText dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\r\n        <div class=\"epi-card__info\">\r\n            <div class=\"dijitInline\">\r\n                <span class=\"epi-card__title\" title=\"${cardTitleTooltip}\">${cardTitle}</span>\r\n                <span class=\"epi-secondaryText\">\r\n                    ${contentTypeDescription}\r\n                    <span class=\"dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <div class=\"dijitInline epi-card__title--ellipsis-wrapper\">\r\n            <div>\r\n                <span class=\"dijitInline epi-card__title dojoxEllipsis\" title=\"${nameTooltip}\">${name}</span>\r\n            </div>\r\n            ${statusIcon}<span class=\"epi-secondaryText\">${status}</span>\r\n            <span class=\"dijitInline dijitIcon epi-iconBubble epi-icon--warning ${commentsClass}\" title=\"${commentsTooltip}\"></span>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/project/viewmodels/OverviewViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/project/command/RefreshProjectItems","epi-cms/project/command/ToggleProjectActivities","./_ProjectViewModel","./ActivityFeedViewModel","./ProjectCommentViewModel","epi/i18n!epi/nls/episerver.cms.components.project.overview.eventfeed"],function(_1e62,lang,topic,when,_1e63,_1e64,_1e65,_1e66,_1e67,_1e68,_1e69){return _1e62([_1e66],{contextHistory:null,isProjectOverviewActive:false,_sortOrderProfileKey:"epi.project-overview-sort-order",_isActivitiesVisibleProfileKey:"epi.project-overview-is-activities-visible",postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_1e63.resolve("epi.cms.BackContextHistory");this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this.projectOverviewChanged)));this.activityFeedModel=new _1e67({noQueryMessage:_1e69.noquerymessage,noAccessMessage:_1e69.noaccessmessage,activitiesStore:this.activitiesStore});this.projectCommentFeedModel=new _1e68({noQueryMessage:_1e69.noquerymessage,activitiesStore:this.activitiesStore});},contextChanged:function(_1e6a,_1e6b){this.inherited(arguments);if(_1e6a&&_1e6a.type==="epi.cms.project"){var _1e6c=parseInt(_1e6a.id,10);when(this.projectStore.refresh(_1e6c)).then(this.set.bind(this,"selectedProject"));}else{this.set("selectedProject",null);}},projectOverviewChanged:function(_1e6d){var _1e6e=this.get("isProjectOverviewActive"),_1e6f;if(_1e6e){if(_1e6d&&_1e6d.id){_1e6f="epi.cms.project:///"+_1e6d.id;topic.publish("/epi/shell/context/request",{uri:_1e6f},{sender:this});}else{this.requestPreviousContext();}}},requestPreviousContext:function(){this.contextHistory.closeAndNavigateBack(this);},_createProjectCommands:function(){var _1e70=this.inherited(arguments);_1e70.refreshProject=new _1e64({model:this,category:"project-comments",order:120});return _1e70;},_createProjectItemCommands:function(){var _1e71=this.inherited(arguments);_1e71.toggleProjectActivities=new _1e65({model:this,order:100});return _1e71;},updateActivityFeed:function(_1e72){this.activityFeedModel.set({selectedProjectId:this.selectedProject&&this.selectedProject.id,selectedProjectItems:_1e72});},_selectedProjectSetter:function(_1e73){this.inherited(arguments);this._updateProjectFeedViewModel(_1e73);},_updateSelectedProjectDependencies:function(_1e74){this.inherited(arguments);this._updateProjectFeedViewModel(_1e74);},_updateProjectFeedViewModel:function(_1e75){this.projectCommentFeedModel.set({placeholderName:_1e75&&_1e75.name,selectedProjectId:_1e75&&_1e75.id});}});});},"epi-cms/project/command/RefreshProjectItems":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1e76,_1e77,res){return _1e76([_1e77],{label:res.refresh,iconClass:"epi-iconReload",category:"projectButton",canExecute:true,_execute:function(){this.model.refreshProject();this.model.refreshActivities();}});});},"epi-cms/project/command/_ProjectCommand":function(){define(["dojo/_base/declare","epi/shell/command/_PropertyWatchCommand"],function(_1e78,_1e79){return _1e78([_1e79],{propertiesToWatch:["selectedProject"],_onPropertyChanged:function(){}});});},"epi-cms/project/viewmodels/_ProjectViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/dom-class","dojo/promise/all","dojo/when","dojo/string","dijit/Destroyable","epi/epi","epi/datetime","epi/dependency","epi/username","epi/shell/_ContextMixin","epi/shell/xhr/errorHandler","epi-cms/plugin-area/project-overview","../../contentediting/ContentActionSupport","epi/shell/command/withConfirmation","../command/AddProject","../command/PublishProject","../command/EditProjectItem","../command/ReadyForReviewProjectItem","../command/ReadyToPublishProjectItem","../command/RefreshProjectItems","../command/RemoveProject","../command/RemoveProjectItem","../command/RemoveProjectScheduling","../command/RenameProject","../command/SortProjectItems","../command/ScheduleProject","epi/i18n!epi/nls/episerver.cms.components.project","epi/i18n!epi/nls/episerver.shared.action"],function(_1e7a,lang,_1e7b,_1e7c,_1e7d,_1e7e,topic,_1e7f,all,when,_1e80,_1e81,epi,_1e82,_1e83,_1e84,_1e85,_1e86,_1e87,_1e88,_1e89,_1e8a,_1e8b,_1e8c,_1e8d,_1e8e,_1e8f,_1e90,_1e91,_1e92,_1e93,_1e94,_1e95,res,_1e96){return _1e7a([_1e7e,_1e81,_1e7d,_1e85],{commands:null,namedCommands:null,created:"",createdBy:"",profile:null,contentLanguage:"",dndEnabled:false,isActivitiesVisible:false,projectStore:null,projectSortOrder:null,projectItemStore:null,projectItemQuery:null,activitiesStore:null,projectItemSortOrder:null,projectStatus:"",projectName:"",notificationMessage:"",selectedProject:null,selectedProjectItems:null,projectItemCountMessage:"",placeholderState:"noProjects",_sortOrderProfileKey:"epi.project-sort-order",_isActivitiesVisibleProfileKey:"epi.project-is-activities-visible",_messages:null,constructor:function(){this.projectItemSortOrder=[];this.projectSortOrder=[{attribute:"created",descending:true}];this.selectedProjectItems=[];this.own(_1e87.on("added, removed",this._updateCommands.bind(this)));},postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1e83.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1e83.resolve("epi.storeregistry").get("epi.cms.project");this.projectItemStore=this.projectItemStore||_1e83.resolve("epi.storeregistry").get("epi.cms.project.item");this.activitiesStore=this.activitiesStore||_1e83.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_1e83.resolve("epi.shell.Profile");this._messages=this.isProjectModeEnabled()?res.status.message:lang.mixin({},res.status.message,res.status["messagelegacy"]);this._createCommands();this.own(this.projectService.on("project-item-updated",lang.hitch(this,this._updateSelectedItems)),this.projectService.on("project-updated",lang.hitch(this,this._projectUpdated)));},initialize:function(){return all(when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _1e97=this._findSortOption("key",sort)||this.namedCommands.sortProjectItems.options[0];this._changeAttrValue("projectItemSortOrder",_1e97.value);})),when(this._loadSelectedProject(),lang.hitch(this,function(_1e98){this._updateSelectedProjectDependencies(_1e98);this._changeAttrValue("selectedProject",_1e98);})),when(this.profile.getContentLanguage(),lang.hitch(this,function(_1e99){this.set("contentLanguage",_1e99);})),when(this.profile.get(this._isActivitiesVisibleProfileKey),lang.hitch(this,function(_1e9a){if(typeof _1e9a==="boolean"){this.set("isActivitiesVisible",_1e9a);}})));},isProjectModeEnabled:function(){return this.projectService.isProjectModeEnabled;},getCommands:function(){return this.commands;},addProject:function(_1e9b){this.projectStore.add(_1e9b).then(lang.hitch(this,function(value){this.set("selectedProject",value);})).otherwise(_1e86.forXhr);},getProject:function(){return this.get("selectedProject");},updateProject:function(_1e9c){this.projectStore.put(_1e9c).then(lang.hitch(this,"set","selectedProject")).otherwise(_1e86.forXhr);},publishProject:function(_1e9d,_1e9e){var self=this;return this.projectService.publishProject(_1e9d,_1e9e).then(function(_1e9f){return self._updateSelectedProjectAndRefreshContextRequest(_1e9f).then(function(){return _1e9f;});});},reactivateProject:function(_1ea0){var self=this;if(isNaN(_1ea0)){throw new Error("The given project ID is not a number.");}return this.projectService.reactivateProject(_1ea0).then(function(_1ea1){return self._updateSelectedProjectAndRefreshContextRequest(_1ea1).then(function(){return _1ea1;});});},refreshActivities:function(){this.emit("refresh-activities");},refreshProject:function(_1ea2){var self=this;if(_1ea2===undefined){_1ea2=true;}if(this.selectedProject){return this.projectStore.refresh(this.selectedProject.id).then(function(value){self.set("selectedProject",value);if(_1ea2){self.emit("refresh");}return value;},function(ex){self.set("selectedProject",null);});}if(_1ea2){this.emit("refresh");}},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1e7c().resolve();}return store.remove(this.selectedProject.id).then(function(){self.set("selectedProject",null);});},canAddContent:function(_1ea3){var _1ea4=this.get("selectedProject").id;return this.projectService.canAddContent(_1ea4,_1ea3);},canPublishProject:function(_1ea5){var _1ea6;function _1ea7(){return Object.keys(_1ea6).some(function(key){if(key.indexOf("nopublishaccess")>-1){if(_1ea6[key]>0){return true;}}});};function _1ea8(state){return _1ea6[state]>0;};_1ea5=_1ea5||this.selectedProject;_1ea6=_1ea5&&_1ea5.itemStatusCount;if(this.isProjectModeEnabled()){return !!_1ea5&&_1ea5.itemStatusCount.checkedin>0;}else{return !!_1ea5&&(_1ea5.status==="active"||_1ea5.status==="publishfailed")&&!_1ea7()&&!_1ea8("notcreated")&&!_1ea8("rejected")&&!_1ea8("checkedout")&&(_1ea8("checkedin")||_1ea8("published")||_1ea8("previouslypublished")||_1ea8("delayedpublish"));}},addProjectItems:function(_1ea9,_1eaa){var _1eab=this.get("selectedProject");_1eaa=_1eaa||(_1eab&&_1eab.id);if(!_1eaa){throw new Error("If no projectId is provided a selectedProject must be set in the context");}return this.projectService.addProjectItems(_1eaa,_1ea9);},removeSelectedProjectItems:function(){var _1eac=this.projectService.removeProjectItems(this.selectedProjectItems);_1eac.then(function(){this.emit("item-removed");}.bind(this));return _1eac;},markProjectItemsAsReadyForReview:function(_1ead){return this._setStatusOnProjectItems("markAsReadyForReview",{comment:_1ead});},markProjectItemsAsReadyToPublish:function(){this._setStatusOnProjectItems("markAsReadyToPublish");},_setStatusOnProjectItems:function(_1eae,_1eaf){if(!this.selectedProjectItems.length){return new _1e7c().resolve();}var self=this;var _1eb0=this.selectedProjectItems.map(function(item){return item.id;});return this.projectService[_1eae](_1eb0,_1eaf).then(function(){return when(self.getCurrentContext());}).then(function(ctx){var _1eb1;self.selectedProjectItems.some(function(item){if(item.contentLink===ctx.id){_1eb1=item;return true;}});if(_1eb1){self.requestContextChange(_1eb1.contentLink);}});},requestContextChange:function(_1eb2){var _1eb3=_1eb2.uri?_1eb2:{uri:"epi.cms.contentdata:///"+_1eb2};topic.publish("/epi/shell/context/request",_1eb3,{sender:this});},updateActivityFeed:function(_1eb4){},_projectUpdated:function(_1eb5){if(this.selectedProject&&this.selectedProject.id===_1eb5.id){this.set("selectedProject",_1eb5);}},_updateSelectedItems:function(item){var _1eb6=this.selectedProjectItems.length;for(var i=0;i<_1eb6;i++){if(this.selectedProjectItems[i].id===item.id){this.selectedProjectItems[i]=item;this.set("selectedProjectItems",this.selectedProjectItems);this.emit("selected-project-items-updated",this.selectedProjectItems);break;}}},onCommandsChanged:function(name,_1eb7,added){},_updateCommands:function(){var _1eb8=this.commands;this._createCommands();this.onCommandsChanged("commands",_1eb8,this.commands);},_createCommands:function(){var _1eb9=this._getOrCreateNamedCommands();var _1eba=Object.keys(_1eb9).map(function(key){return _1eb9[key];});_1e87.get().forEach(function(_1ebb){this.own(_1ebb);_1eba.push(_1ebb);}.bind(this));_1eba=_1eba.sort(function(a,b){return a.order-b.order;});this.set("commands",_1eba);},_getOrCreateNamedCommands:function(){if(this.namedCommands){return this.namedCommands;}var _1ebc=Object.assign(this._createProjectCommands(),this._createProjectItemCommands());this.own.apply(this,_1ebc);this.set("namedCommands",_1ebc);return _1ebc;},_createProjectCommands:function(){return {addProject:new _1e8a({model:this,order:10}),renameProject:new _1e93({model:this,order:20}),removeProject:new _1e90({model:this,order:30,store:this.projectStore}),publishProject:new _1e8b({model:this,order:40}),scheduleProject:new _1e95({model:this,order:50}),removeProjectScheduling:_1e89(new _1e92({model:this,order:60}),null,{title:res.command.removeschedulingprojectitem.title,description:res.command.removeschedulingprojectitem.confirmation,confirmActionText:_1e96.remove,cancelActionText:_1e96.cancel})};},_createProjectItemCommands:function(){return {readyForReviewProjectItem:new _1e8d({model:this,order:90}),readyToPublishProjectItem:new _1e8e({model:this,order:100}),editProjectItem:new _1e8c({model:this,order:110}),removeProjectItem:_1e89(new _1e91({model:this,order:120}),null,{title:res.command.removeprojectitem.label,description:res.command.removeprojectitem.confirmation,confirmActionText:_1e96.remove,cancelActionText:_1e96.cancel}),sortProjectItems:new _1e94({model:this,order:130}),refreshProjectItems:new _1e8f({model:this,order:140})};},_loadSelectedProject:function(){return this.projectService.getCurrentProject();},_persistSelectedProject:function(_1ebd){this.profile.set(this._selectedProjectProfileKey,_1ebd&&_1ebd.id,{location:"server"});},_persistSortOrder:function(_1ebe){var _1ebf=this._findSortOption("value",_1ebe),key=_1ebf&&_1ebf.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_persistIsActivitiesPanelVisible:function(_1ec0){this.profile.set(this._isActivitiesVisibleProfileKey,_1ec0,{location:"server"});},_findSortOption:function(key,term){var _1ec1=this.namedCommands.sortProjectItems.options,_1ec2=null;term&&_1ec1.some(function(item){if(term===item[key]){_1ec2=item;return true;}});return _1ec2;},_updateSelectedProjectDependencies:function(_1ec3){var _1ec4="",_1ec5="",_1ec6="",_1ec7=false,_1ec8="",_1ec9=null,_1eca="",_1ecb="",_1ecc=this.isProjectModeEnabled();if(_1ec3){_1ec4=_1e82.toUserFriendlyString(new Date(_1ec3.created));_1ec5=_1e84.toUserFriendlyString(_1ec3.createdBy,null,true);_1ec7=(_1ecc&&_1ec3.status!=="publishing")||_1ec3.status==="active"||_1ec3.status==="publishfailed";_1ec9={projectId:_1ec3.id};_1ecb=_1ec3.name;if(!this.canPublishProject(_1ec3)||_1ecc){_1eca=this._messages[_1ec3.status]||"";if(_1ec3.status==="delayedpublished"&&!_1ecc){_1ec6=_1e82.toUserFriendlyString(_1ec3.delayPublishUntil);_1eca=lang.replace(_1eca,{date:_1ec6});_1ec8=lang.replace(res.status.state.delayedpublished,{delayPublishUntil:_1ec6});}}if(_1ec3.status==="publishfailed"){_1ec8=this._getProjectFailedMessage(_1ec3);}}this.set({created:_1ec4,createdBy:_1ec5,dndEnabled:_1ec7,notificationMessage:_1ec8,projectItemQuery:_1ec9,projectStatus:_1eca,projectName:_1ecb});},_getProjectFailedMessage:function(_1ecd){var _1ece=0,_1ecf="",_1ed0=res.notifications.publishfailed;_1ece=this._getUnpublishedItems(_1ecd.itemStatusCount);if(_1ece>0){_1ecf=lang.replace(_1ece>1?_1ed0.notificationtextmultipleitems:_1ed0.notificationtextsingleitem,{failedItemsCount:_1ece});}return _1ecf;},_getUnpublishedItems:function(_1ed1){var count=0;Object.keys(_1ed1).forEach(function(key){if(key.indexOf("checkedin")===0){count+=_1ed1[key];}});return count;},_isActivitiesVisibleSetter:function(_1ed2){if(_1ed2===this.isActivitiesVisible){return;}this.isActivitiesVisible=_1ed2;this._persistIsActivitiesPanelVisible(_1ed2);},_selectedProjectSetter:function(_1ed3){_1ed3=lang.clone(_1ed3);if(epi.areEqual(this.selectedProject,_1ed3)){return;}if(this.selectedProject&&(!_1ed3||this.selectedProject.id!==_1ed3.id)){this.emit("clear-selection");}this.selectedProject=_1ed3;this._updateSelectedProjectDependencies(_1ed3);},_projectItemSortOrderSetter:function(_1ed4){if(_1ed4&&_1ed4===this.projectItemSortOrder){return;}this.projectItemSortOrder=_1ed4;this._persistSortOrder(_1ed4);},_updateSelectedProjectAndRefreshContextRequest:function(_1ed5){var self=this;self.set("selectedProject",_1ed5);return when(this.getCurrentContext()).then(function(_1ed6){self.requestContextChange(_1ed6);return _1ed6;});},_selectedProjectItemsSetter:function(_1ed7){this.selectedProjectItems=_1ed7;this._updateProjectCountMessage(_1ed7);},_updateProjectCountMessage:function(_1ed8){var items=_1ed8&&_1ed8.length>0?_1ed8.length:null,_1ed9="";function _1eda(count,_1edb){_1ed9=_1e80.substitute(res.notifications.selecteditems[_1edb],{count:count});};if(items){if(items===1){_1eda(items,"singular");}else{if(items>1){_1eda(items,"plural");}}}this.set("projectItemCountMessage",_1ed9);}});});},"epi-cms/plugin-area/project-overview":function(){define(["epi/PluginArea"],function(_1edc){var _1edd=new _1edc("epi-cms/project-overview/commands[]");return _1edd;});},"epi-cms/project/command/AddProject":function(){define(["dojo/_base/declare","./_ProjectCommand","epi-cms/project/ProjectDialogContent","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.newproject"],function(_1ede,_1edf,_1ee0,_1ee1,res){return _1ede([_1edf,_1ee1],{label:res.label,title:res.label,canExecute:true,iconClass:"epi-iconPlus",defaultActionsVisible:true,dialogClass:"epi-dialog-landscape",dialogContentClass:_1ee0,onDialogExecute:function(){this.model.addProject(this.dialogContent.get("value"));},_execute:function(){this.showDialog();}});});},"epi-cms/project/ProjectDialogContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","epi/dependency","epi/shell/widget/FormContainer","epi/shell/widget/dialog/_DialogContentMixin"],function(_1ee2,lang,keys,_1ee3,_1ee4,_1ee5){return _1ee2([_1ee4,_1ee5],{_metadataManager:null,postMixInProperties:function(){this.inherited(arguments);if(!this.metadata){var _1ee6=this._metadataManager||_1ee3.resolve("epi.shell.MetadataManager");this.metadata=_1ee6.getMetadataForType("EPiServer.Cms.Shell.UI.Rest.Projects.Internal.Models.ProjectViewModel");}},postCreate:function(){this.inherited(arguments);this.on("keypress",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&this.isValid()){this.executeDialog();}}));}});});},"epi-cms/project/command/PublishProject":function(){define(["dojo/_base/declare","dojo/string","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.publishproject"],function(_1ee7,_1ee8,_1ee9,res){return _1ee7([_1ee9],{category:"publishmenu-primary",label:res.label,isExecuting:false,_execute:function(){var model=this.model,self=this;self.set("isExecuting",true);model.publishProject(this.model.selectedProject.id).then(function(){self.set("isExecuting",false);},function(){self.set("isExecuting",false);});},_onPropertyChanged:function(){var _1eea=this.model.selectedProject,_1eeb=_1eea&&_1eea.status,_1eec=this.model.canPublishProject(_1eea),_1eed=this.model.isProjectModeEnabled();this.set({canExecute:_1eec,isAvailable:_1eed||(_1eeb!=="published"&&_1eeb!=="delayedpublished"),isExecuting:_1eeb==="publishing"});},_updateLabel:function(){var _1eee=this.model&&this.model.selectedProject,_1eef=(_1eee&&_1eee.itemStatusCount.checkedin)||0,data={count:_1eef>0?_1eef+" ":""},label;if(this.isExecuting){label=_1eef===1?res.labelexecuting.singular:res.labelexecuting.plural;}else{if(!this.isAvailable){label=res.labelexecuted;}else{label=_1eef===1?res.label.singular:res.label.plural;}}this.set("label",_1ee8.substitute(label,data));},_isExecutingSetter:function(value){this.isExecuting=value;this._updateLabel();}});});},"epi-cms/project/command/EditProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1ef0,_1ef1,_1ef2,_1ef3){return _1ef0([_1ef2],{category:"menuWithSeparator",iconClass:"epi-iconPen",label:_1ef3.edit,propertiesToWatch:["selectedProjectItems"],_execute:function(){var _1ef4=this.model.selectedProjectItems[0];this.model.requestContextChange(_1ef4.contentLink);},_onPropertyChanged:function(){var _1ef5=false,_1ef6;var items=this.model&&this.model.selectedProjectItems;this.set("label",_1ef3.edit);this.set("iconClass","epi-iconPen");if(items&&items.length===1){_1ef6=_1ef1.getPermissionMap(items[0].accessMask);if(_1ef6.Read&&!_1ef6.Edit){_1ef5=_1ef6.Read;this.set("label",_1ef3.view);this.set("iconClass","epi-iconSearch");}else{_1ef5=_1ef6.Edit;}}this.set("canExecute",!!_1ef5);}});});},"epi-cms/project/command/ReadyForReviewProjectItem":function(){define(["dojo/_base/declare","dojo/Deferred","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readyforreviewprojectitem","epi-cms/content-approval/command/ReadyForReview"],function(_1ef7,_1ef8,_1ef9,_1efa,_1efb){return _1ef7([_1efb],{category:"itemContext",label:_1efa.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){var _1efc=this.model.selectedProjectItems.some(function(item){return item.isStartCommentRequired;});if(_1efc){this._executeDeferred=new _1ef8();this.showDialog();return this._executeDeferred.promise;}else{return this._executeServiceMethod();}},_executeServiceMethod:function(_1efd){return this.model.markProjectItemsAsReadyForReview(_1efd);},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1efe=_1ef9.versionStatus,_1eff=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&item.hasApprovalDefinition&&(item.status===_1efe.CheckedOut||item.status===_1efe.Rejected)&&_1ef9.hasAccess(item.accessMask,_1ef9.accessLevel.Edit);});this.set("canExecute",!!_1eff);}});});},"epi-cms/project/command/ReadyToPublishProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readytopublishprojectitem","epi-cms/project/command/_ProjectCommand"],function(_1f00,_1f01,_1f02,_1f03){return _1f00([_1f03],{category:"menuWithSeparator",label:_1f02.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.markProjectItemsAsReadyToPublish();},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1f04=_1f01.versionStatus,_1f05=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&!item.hasApprovalDefinition&&(item.status===_1f04.CheckedOut||item.status===_1f04.Rejected)&&_1f01.hasAccess(item.accessMask,_1f01.accessLevel.Edit);});this.set("canExecute",!!_1f05);}});});},"epi-cms/project/command/RemoveProject":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","./RemoveProjectConfirmation","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","./_ProjectCommand"],function(_1f06,lang,on,when,_1f07,res,_1f08){return _1f06([_1f08],{category:"context",label:res.label,iconClass:"epi-iconTrash",_execute:function(){var _1f09=this.model.getProject();this.model.projectService.hasScheduledProjectItems(_1f09.id).then(this._createRemoveProjectConfirmationDialog.bind(this));},_createRemoveProjectConfirmationDialog:function(_1f0a){var _1f0b=this.model.getProject().status==="delayedpublished",_1f0c=new _1f07({isScheduledProject:_1f0a&&_1f0b});on.once(_1f0c,"execute",lang.hitch(this,"_removeProject"));_1f0c.show();},_removeProject:function(_1f0d){var model=this.model,_1f0e=model.getProject(),_1f0f=!_1f0d&&model.reactivateProject(_1f0e.id);when(_1f0f).then(function(){return model.removeProject();}).otherwise(function(error){console.error("An error occured while removing the project.",error);});},_onPropertyChanged:function(){var _1f10=this.model.getProject();this.set("canExecute",!!_1f10&&!_1f10.isDeleted);}});});},"epi-cms/project/command/RemoveProjectConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","epi/i18n!epi/nls/episerver.shared.action","epi/shell/widget/dialog/Confirmation"],function(_1f11,lang,_1f12,_1f13,_1f14){return _1f11([_1f14],{isScheduledProject:false,dialogClass:"epi-dialog-confirm epi-dialog--wide",postMixInProperties:function(){this.inherited(arguments);this.title=this.isScheduledProject?_1f12.scheduledlabel:_1f12.label;this.description=this.isScheduledProject?_1f12.scheduledconfirmation:_1f12.confirmation;},getActions:function(){var _1f15={name:"keepScheduling",label:this.isScheduledProject?_1f12.deleteandkeepscheduling:_1f13.deletelabel,action:lang.hitch(this,"onExecute",true)},_1f16={name:"removeScheduling",label:_1f12.deleteandremovescheduling,action:lang.hitch(this,"onExecute",false)},_1f17={name:"cancel",label:_1f13.cancel,action:lang.hitch(this,this.onCancel),settings:{"class":"Salt",firstFocusable:true}};return this.isScheduledProject?[_1f15,_1f16,_1f17]:[_1f15,_1f17];}});});},"epi-cms/project/command/RemoveProjectItem":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.removeprojectitem"],function(_1f18,_1f19,res){return _1f18([_1f19],{category:"itemContext",label:res.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.removeSelectedProjectItems();},_onPropertyChanged:function(){var self=this,model=this.model,_1f1a=model&&model.selectedProjectItems&&model.selectedProjectItems.length,_1f1b=model.selectedProject;this.set("canExecute",false);this.model.projectService.getCurrentProject().then(function(_1f1c){var _1f1d=_1f1b&&(_1f1b.status==="active"||_1f1b.status==="publishfailed"||_1f1c);self.set("canExecute",!!(_1f1a&&_1f1d));});}});});},"epi-cms/project/command/RemoveProjectScheduling":function(){define(["dojo/_base/declare","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1f1e,_1f1f,res){return _1f1e([_1f1f],{category:"publishmenu",iconClass:"epi-iconClose",label:res.removeschedulingprojectitem.label,postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.removeschedulingproject.label);}},_execute:function(){var model=this.model;return model.reactivateProject(model.selectedProject.id);},_onPropertyChanged:function(){var _1f20=this.model.selectedProject,_1f21;_1f21=!!_1f20&&(this.model.isProjectModeEnabled()?_1f20.itemStatusCount.delayedpublish>0:_1f20.status==="delayedpublished");this.set("canExecute",_1f21);this.set("isAvailable",_1f21);}});});},"epi-cms/project/command/RenameProject":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/project/ProjectDialogContent","epi-cms/project/command/_ProjectCommand","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.renameproject"],function(_1f22,lang,_1f23,_1f24,_1f25,_1f26){return _1f22([_1f24,_1f25],{category:"context",dialogClass:"epi-dialog-landscape",dialogContentClass:_1f23,label:_1f26.label,title:_1f26.label,iconClass:"epi-iconRename",onDialogExecute:function(){var value=lang.mixin(this.value,this.dialogContent.get("value"));this.model.updateProject(value);},_execute:function(){this.showDialog();},_onPropertyChanged:function(){var _1f27=this.model.getProject();this.set("canExecute",!!_1f27&&!_1f27.isDeleted);this.set("value",lang.clone(_1f27));}});});},"epi-cms/project/command/SortProjectItems":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort","epi/shell/command/OptionCommand"],function(_1f28,_1f29,_1f2a){return _1f28([_1f2a],{category:"projectButton",iconClass:"epi-iconSort",label:_1f29.label,options:null,property:"projectItemSortOrder",constructor:function(){this.options=[{label:_1f29.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_1f29.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_1f29.status,key:"+Status",value:[{attribute:"status",descending:false},{attribute:"name",descending:false}]},{label:_1f29.type,key:"+PrimaryTypeIdentifier",value:[{attribute:"primaryTypeIdentifier",descending:false},{attribute:"name",descending:false}]},{label:_1f29.modifieddescending,key:"-Modified",value:[{attribute:"modified",descending:true},{attribute:"name",descending:false}]},{label:_1f29.modifiedascending,key:"+Modified",value:[{attribute:"modified",descending:false},{attribute:"name",descending:false}]}];}});});},"epi-cms/project/command/ScheduleProject":function(){define(["dojo/_base/declare","./_ProjectCommand","../ProjectSchedulingDialog","../ProjectSchedulingDialogViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1f2b,_1f2c,_1f2d,_1f2e,res){return _1f2b([_1f2c],{category:"publishmenu",label:res.scheduleprojectitem.label,iconClass:"epi-iconClock",postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.scheduleproject.label);}},_execute:function(){var model=this.model,_1f2f=model.selectedProject,_1f30=new _1f2e({title:_1f2f.name,query:{projectId:_1f2f.id,scheduled:true}}),_1f31=new _1f2d({model:_1f30});_1f31.on("execute",function(){model.publishProject(_1f2f.id,_1f30.dateValue);});_1f31.show();},_onPropertyChanged:function(){this.set("canExecute",this.model.canPublishProject());this._updateIsAvailable();},_updateIsAvailable:function(){var _1f32,_1f33=this.model.selectedProject,_1f34=_1f33&&_1f33.status;if(this.model.isProjectModeEnabled()){_1f32=true;}else{_1f32=_1f34!=="published"&&_1f34!=="delayedpublished";}this.set("isAvailable",_1f32);}});});},"epi-cms/project/ProjectSchedulingDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","epi-cms/contentediting/ScheduledPublishSelector","epi/shell/widget/DelayableStandby","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject"],function(_1f35,lang,_1f36,on,_1f37,_1f38,_1f39,res){return _1f35([_1f39],{dialogClass:"epi-dialog-contentReferences",title:res.label,defaultActionsVisible:false,_contentLoaded:null,constructor:function(){this._contentLoaded=new _1f36();},buildRendering:function(){this.inherited(arguments);this.own(this.content=new _1f37({model:this.model}),this._standby=new _1f38({target:document.body,zIndex:999}).placeAt(document.body),on.once(this.content,"contentreferencegrid-loading-complete",this._contentLoaded.resolve));},show:function(){var _1f3a=arguments;if(!this._started){this.startup();}this._standby.show();return this._contentLoaded.then(lang.hitch(this,function(){this._standby.hide();return this.inherited(_1f3a);}));}});});},"epi-cms/project/ProjectSchedulingDialogViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/dependency","dojo/topic","epi-cms/dgrid/formatters","./ContentReferenceGridModel","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject","epi/i18n!epi/cms/nls/episerver.cms.components.project.contentreferencelist","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_1f3b,lang,_1f3c,topic,_1f3d,_1f3e,_1f3f,_1f40,_1f41,_1f42,res){return _1f3b([_1f3e,_1f3f],{dateLabel:res.publishchangeson,notificationText:res.alreadyscheduleditems,_totalItemsSetter:function(value){this.totalItems=value;if(value){var _1f43=(value===1?_1f41.itemintotal:_1f41.itemsintotal);this.set("resultSummary",lang.replace(_1f43,[value]));}},onItemClicked:function(item){topic.publish("/epi/shell/context/request",{uri:item.contentUri});},postscript:function(){this.inherited(arguments);this.store=this.store||_1f3c.resolve("epi.storeregistry").get("epi.cms.project.item");this.columns={primaryTypeIdentifier:{label:"",className:"epi-grid-column--snug epi-cursor--default",formatter:_1f3d.contentIcon},name:{label:"",className:"epi-grid--30 epi-cursor--default"},path:{label:"",formatter:_1f3d.path,className:"epi-grid--35 epi-cursor--default"},delayPublishUntil:{label:"",formatter:_1f3d.localizedDate,className:"epi-grid--25 epi-grid-column--centered epi-cursor--default dgrid-column-treePath"},contentUri:{formatter:function(){return "<a class=\"epi-visibleLink\">"+_1f42.view+"</a>";},className:"dgrid-column-view"}};}});});},"epi-cms/project/ContentReferenceGridModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_1f44,_1f45){return _1f44([_1f45],{onItemClicked:function(item){},resultSummary:"",notificationText:"",store:null,query:null,columns:null,totalItems:null});});},"epi-cms/project/viewmodels/ActivityFeedViewModel":function(){define(["dojo/_base/declare","./_ProjectFeedViewModel"],function(_1f46,_1f47){return _1f46([_1f47],{_contentLink:null,postscript:function(){this.inherited(arguments);this.set("noDataMessage",this.noQueryMessage);},_selectedProjectItemsSetter:function(_1f48){_1f48=_1f48||[];var _1f49=_1f48.filter(function(item){return !!item.contentLink;});var _1f4a=_1f48.length===1&&_1f49.length===1;this.set("isSingleItemSelected",_1f4a);var _1f4b=_1f4a?_1f49[0].name:"";this.set("placeholderName",_1f4b);this._contentLink=_1f4a?_1f49[0].contentLink:null;this.set("noDataMessage",_1f48.length?this.noAccessMessage:this.noQueryMessage);this.set("store",_1f49.length?this.activitiesStore:null);var query={contentReferences:_1f49.map(function(item){return item.contentLink;}),projectId:this.selectedProjectId};this.set("query",_1f49.length?query:null);}});});},"epi-cms/project/viewmodels/ProjectCommentViewModel":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.activities.commentfeed","./_ProjectFeedViewModel"],function(_1f4c,_1f4d,_1f4e){return _1f4c([_1f4e],{isSingleItemSelected:true,noDataMessage:_1f4d.nodatamessage,_selectedProjectIdSetter:function(_1f4f){this.selectedProjectId=_1f4f;this.set("store",_1f4f?this.activitiesStore:null);this.set("query",{projectId:_1f4f,activityType:"ProjectMessageActivity"});}});});},"url:epi-cms/project/templates/Overview.html":"<div class=\"epi-project-overview\">\r\n    <div data-dojo-attach-point=\"toolbar\" class=\"epi-project-overview__toolbar epi-viewHeaderContainer epi-editToolbarMedium\">\r\n        <h2 class=\"dijitInline\">\r\n            <div class=\"dijitInline epi-iconObjectProject epi-icon--large\"></div>\r\n            <span data-dojo-attach-point=\"projectNameNode\"></span>\r\n        </h2>\r\n        <div class=\"epi-project-overview__toolbar__trailing\">\r\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\r\n                 data-dojo-attach-point=\"publishContainer\"\r\n                 data-dojo-props=\"showLabel: true, label: this.res.overview.publishdropdown.label\"\r\n                 data-dojo-attach-event=\"onClick:_publishMenuClickHandler\"\r\n                 class=\"epi-mediumButton epi-button--bold\">\r\n                <span></span>\r\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\r\n                     data-dojo-attach-point=\"publishMenu\"\r\n                     data-dojo-props=\"commandSource: this.model\">\r\n                    <section data-epi-section=\"primarySection\">\r\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\r\n                    </section>\r\n                    <section data-epi-section=\"statusSection\">\r\n                        <ul>\r\n                            <li>\r\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\r\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\r\n                            </li>\r\n                        </ul>\r\n                    </section>\r\n                </div>\r\n            </div>\r\n            <button data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-point=\"closeButton\"\r\n                    data-dojo-attach-event=\"onClick:_close\"\r\n                    data-dojo-props=\"showLabel: true, label: this.res.overview.closebutton.label\"\r\n                    class=\"epi-mediumButton epi-button--bold\"></button>\r\n        </div>\r\n    </div>\r\n\r\n    <div data-dojo-attach-point=\"tabs\" data-dojo-type=\"dijit/layout/TabContainer\">\r\n        <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n             data-dojo-attach-point=\"itemList\"\r\n             data-dojo-props=\"title: this.res.overview.title, commandSource: this.model, res: this.res.overview\">\r\n\r\n                <section data-epi-section=\"toolbarSection\">\r\n                    <div data-dojo-attach-point=\"toolbarTextNode\" class=\"epi-project-item-list__item-count-message-node\"></div>\r\n                    <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n                </section>\r\n                <section data-epi-section=\"activitySection\">\r\n                    <div data-dojo-type=\"epi-cms/activity/ActivityFeed\"\r\n                         data-dojo-attach-point=\"activityFeed\"\r\n                         data-dojo-props=\"model: this.model.activityFeedModel\"></div>\r\n                </section>\r\n        </div>\r\n\r\n        <div data-dojo-type=\"epi-cms/activity/ActivityFeed\"\r\n             data-dojo-attach-point=\"projectComments\"\r\n             data-dojo-props=\"title: this.res.comments.title, model: this.model.projectCommentFeedModel\"\r\n             class=\"epi-project-comment-feed\">\r\n            <div data-dojo-type=\"dijit/Toolbar\"\r\n                 data-dojo-attach-point=\"projectCommentsToolbar\"\r\n                 class=\"epi-project-item-list__toolbar epi-flatToolbar\">\r\n            </div>\r\n         </div>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectItemList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-class","dojo/keys","dojo/on","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/_CssStateMixin","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dgrid/extensions/DijitRegistry","epi","epi/shell/dnd/Target","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi/shell/dgrid/Responsive","epi/shell/widget/_FocusableMixin","epi/shell/widget/_SectionedTemplatedMixin","epi-cms/extension/events","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/WithContextMenu","epi/i18n!epi/cms/nls/episerver.cms.components.project","dojo/text!./templates/ProjectItemList.html"],function(_1f50,lang,_1f51,_1f52,_1f53,keys,on,_1f54,_1f55,_1f56,_1f57,_1f58,_1f59,_1f5a,epi,_1f5b,_1f5c,_1f5d,_1f5e,_1f5f,_1f60,_1f61,_1f62,_1f63,res,_1f64){return _1f50([_1f55,_1f60,_1f54,_1f56,_1f5f],{contentLanguage:null,commandProvider:null,dndEnabled:false,sections:["toolbarSection","listContainer","activitySection"],templateString:_1f64,listItemType:"card",res:res,_listClass:_1f50([_1f58,_1f5d,_1f59,_1f57,_1f63,_1f5a,_1f5c,_1f5e]),_list:null,_noDataMessageWrapper:"<span class=\"dgrid-no-data__content\">{0}</span>",buildRendering:function(){this.inherited(arguments);this._setupList();},focus:function(){if(this._list){this._list.focus();}},layout:function(){var _1f65,size;if(!this._contentBox){return;}_1f65=_1f52.getMarginBox(this.toolbar.domNode).h+_1f52.getMarginBox(this.notificationBarNode).h;size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1f65});_1f52.setMarginBox(this.listContainer,size);this._list.resize();},clearSelection:function(){this._list.clearSelection();this.emit("selection-changed",{items:[]});},refresh:function(){this._list.refresh({keepScrollPosition:true});},setSelection:function(_1f66){this.selectItems(_1f66);this.emit("selection-changed",{items:_1f66});},selectItems:function(_1f67){this._list.clearSelection();_1f67.forEach(function(item){this._list.select(item);},this);},toggleActivities:function(_1f68){_1f53.toggle(this.domNode,"epi-project-item-list--activities-visible",_1f68);},updateQuery:function(store,query){var _1f69=!query&&this.res.noquery?this.res.noquery:this.res.nodata,_1f6a=lang.replace(this._noDataMessageWrapper,[_1f69]);this._list.set("noDataMessage",_1f6a);if(this._list.store!==store||!epi.areEqual(this._list.query,query)){this._list.set("store",store,query);}},_setupList:function(){var list,_1f6b;_1f62.contentLanguage=this.contentLanguage;list=new this._listClass({formatters:_1f62[this.listItemType],cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,refocusOnRefresh:true,responsiveMap:{"epi-card-list--narrow":570}},this.itemListNode);list.contextMenu.addProvider(this.commandSource);this.own(this._list=list,list.on("dgrid-cellfocusin, .dgrid-content:click",lang.hitch(this,function(evt){if(evt.target===list.contentNode){this.clearSelection();}var items=this._getSelectedItems(list);this.emit("selection-changed",{items:items});})),list.on("dgrid-select, dgrid-deselect",lang.hitch(this,function(evt){var items=this._getSelectedItems(list);this.emit("active-items-changed",{items:items});})),list.on(".dgrid-row:dblclick",lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.addKeyHandler(keys.ENTER,lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.on(on.selector(".dgrid-row",_1f61.keys.del),lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemremove",{item:item});})),_1f6b=new _1f5b(this.overlayNode,{createItemOnDrop:false,allowMultipleItems:true,accept:["episerver.core.icontentdata.reference"]}),_1f51.after(_1f6b,"onDropData",lang.hitch(this,this._onDropData),true));},_getSelectedItems:function(list){var items=[];Object.keys(list.selection).forEach(function(key){if(list.selection[key]){var item=list.row(key).data;items.push(item);}});return items;},_onDropData:function(_1f6c){var items=_1f6c.map(function(item){return item.data;});this.emit("itemsdropped",{items:items});},_setDndEnabledAttr:function(value){this._set("dndEnabled",value);_1f53.toggle(this.overlayNode,"dijitHidden",!value);},_setNotificationMessageAttr:function(value){this.notificationTextNode.textContent=value;_1f53.toggle(this.notificationBarNode,"dijitHidden",!value);this.layout();},_setSortOrderAttr:function(value){if(this._list.get("sort")!==value){this._list.set("sort",value);}},_setContentLanguageAttr:function(value){this._set("contentLanguage",value);_1f62.contentLanguage=value;}});});},"epi/shell/dgrid/Responsive":function(){define("epi/shell/dgrid/Responsive",["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry"],function(_1f6d,_1f6e,_1f6f){return _1f6d([],{currentResponsiveClass:"",responsiveMap:null,resize:function(){this.inherited(arguments);var _1f70=Infinity,_1f71=_1f6f.getContentBox(this.domNode).w,_1f72="",_1f73=this.responsiveMap;if(_1f73){Object.keys(_1f73).forEach(function(key){var _1f74=_1f73[key];if(_1f71<=_1f74&&_1f74<_1f70){_1f70=_1f74;_1f72=key;}});_1f6e.replace(this.domNode,_1f72,this.currentResponsiveClass);this.currentResponsiveClass=_1f72;}}});});},"epi/shell/widget/_SectionedTemplatedMixin":function(){define("epi/shell/widget/_SectionedTemplatedMixin",["dojo/_base/declare","dojo/query","dojo/string","dijit/_TemplatedMixin"],function(_1f75,query,_1f76,_1f77){return _1f75([_1f77],{sections:[],_fillContent:function(_1f78){this.sections.forEach(function(_1f79){var _1f7a=this[_1f79],_1f7b=query(_1f76.substitute("[data-epi-section=${0}]",[_1f79]),_1f78);_1f7b.forEach(function(_1f7c){while(_1f7c.childNodes.length>0){_1f7a.appendChild(_1f7c.childNodes[0]);}});},this);}});});},"url:epi-cms/project/templates/ProjectItemList.html":"<div class=\"epi-project-item-list\">\r\n    <div data-dojo-type=\"dijit/Toolbar\"\r\n         data-dojo-attach-point=\"toolbar\"\r\n         class=\"epi-project-item-list__toolbar epi-flatToolbar\">\r\n        <span data-dojo-attach-point=\"toolbarSection\"></span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"listContainer\" class=\"epi-project-item-list__container\">\r\n        <div data-dojo-attach-point=\"notificationBarNode\" class=\"epi-notificationBar dijitHidden\">\r\n            <div class=\"epi-notificationBarItem\">\r\n                <div class=\"epi-notificationBarText\">\r\n                    <p data-dojo-attach-point=\"notificationTextNode\"></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"overlayNode\"\r\n             class=\"epi-project-item-list__dnd-area epi-visible-dnd-area epi-project-list-area__dnd-area--empty-list dijitHidden\">\r\n            <span class=\"epi-project-item-list__dnd-area-content\">${res.droptoadditems}</span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"itemListNode\"\r\n             class=\"epi-card-list dgrid--centered-no-data-message\"></div\r\n        ><div data-dojo-attach-point=\"activitySection\"\r\n              class=\"epi-activity-section\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/project/PublishMenu":function(){define(["dojo/_base/declare","dojo/on","dijit/DropDownMenu","dijit/registry","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/widget/_SectionedTemplatedMixin","./command/PublishMenuButtonBuilder","dojo/text!./templates/PublishMenu.html"],function(_1f7d,on,_1f7e,_1f7f,_1f80,_1f81,_1f82,_1f83,_1f84){return _1f7d([_1f7e,_1f82],{sections:["primarySection","statusSection"],templateString:_1f84,buildRendering:function(){this.inherited(arguments);var _1f85=[{builder:new _1f83({settings:{"class":"epi-button--bold epi-button--full-width epi-success",isExecutingClass:"epi-loading"},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),category:"publishmenu-primary",target:this.publishMenuNode},{builder:new _1f81(),category:"publishmenu",target:this.projectActionMenu}];this.own(this._menuAssembler=new _1f80({configuration:_1f85}));this.own(on(this.domNode,"beforeFocusedButtonRemoved",this.domNode.focus));},childSelector:function(node){var _1f86=_1f7f.byNode(node);return _1f86&&_1f86.focus&&(node.parentNode===this.projectActionMenu);},getChildren:function(){return [].concat(_1f7f.findWidgets(this.publishMenuNode),_1f7f.findWidgets(this.projectActionMenu));},_setCommandSourceAttr:function(_1f87){this._menuAssembler.set("commandSource",_1f87);},_getCommandSourceAttr:function(){return this._menuAssembler.get("commandSource");}});});},"epi-cms/project/command/PublishMenuButtonBuilder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/form/Button","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/ButtonBuilder"],function(_1f88,lang,on,_1f89,_1f8a,_1f8b){return _1f88([_1f8b],{_buttonClass:_1f88([_1f89,_1f8a],{_setSelected:function(){},_setIsAvailableAttr:function(_1f8c){if(!_1f8c&&this.get("focused")){on.emit(this.domNode,"beforeFocusedButtonRemoved",{bubbles:true});}this.inherited(arguments);}})});});},"url:epi-cms/project/templates/PublishMenu.html":"<div tabIndex=\"${tabIndex}\" role=\"menu\" class=\"epi-invertedTooltip epi-publishActionMenu\" data-dojo-attach-point=\"containerNode\" data-dojo-attach-event=\"onkeypress:_onKeyPress\">\r\n    <div class=\"epi-tooltipDialogTop\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"primarySection\" class=\"epi-projectStatusMessage\"></li>\r\n            <li data-dojo-attach-point=\"publishMenuNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <div data-dojo-attach-point=\"statusSection\" class=\"epi-tooltipDialogInfo\"></div>\r\n    <table class=\"epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n        <tbody data-dojo-attach-point=\"projectActionMenu\"></tbody>\r\n    </table>\r\n</div>\r\n","epi-cms/project/ProjectChangesComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectChangesComponentViewModel","dojo/text!./templates/ProjectChangesComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.changes","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList"],function(_1f8d,lang,_1f8e,_1f8f,_1f90,on,when,_1f91,_1f92,_1f93,_1f94,res){return _1f8d([_1f92,_1f91],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],dndEnabled:["dndEnabled"],contentLanguage:["contentLanguage"]},res:res,templateString:_1f94,"class":"epi-project-changes-component",layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1f93();}});});},"epi-cms/project/viewmodels/ProjectChangesComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./_ProjectViewModel"],function(_1f95,lang,_1f96){return _1f95([_1f96],{_sortOrderProfileKey:"epi.project-changes-sort-order",postscript:function(){this.inherited(arguments);this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this._projectChanged)));},refreshProject:function(){if(!this.selectedProject){this._updateHasProject();}this.inherited(arguments);},_createProjectCommands:function(){return {};},_createProjectItemCommands:function(){var _1f97=this.inherited(arguments),_1f98={};Object.keys(_1f97).forEach(function(key){var _1f99=_1f97[key];switch(key){case "refreshProjectItems":break;case "sortProjectItems":_1f99.set({category:"projectButton",iconClass:"epi-iconSort"});break;case "readyToPublishProjectItem":_1f98.primaryReadyToPublishProjectItem=lang.delegate(_1f99,{iconClass:"epi-iconCheckmark",category:null});break;default:_1f98[key+"_context"]=lang.delegate(_1f99,{category:"context"});}});return lang.mixin(_1f97,_1f98);},_projectChanged:function(_1f9a){this.set("selectedProject",_1f9a);},_updateSelectedProjectDependencies:function(_1f9b){var _1f9c=false,_1f9d=null,_1f9e=this.isProjectModeEnabled();if(_1f9b){_1f9c=(_1f9e&&_1f9b.status!=="publishing")||_1f9b.status==="active"||_1f9b.status==="publishfailed";_1f9d={projectId:_1f9b.id};}this.set({dndEnabled:_1f9c,projectItemQuery:_1f9d});}});});},"url:epi-cms/project/templates/ProjectChangesComponent.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n         data-dojo-attach-point=\"itemList\"\r\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact', res: this.res\">\r\n        <section data-epi-section=\"toolbarSection\">\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </section>\r\n        <section data-epi-section=\"listContainer\">\r\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\"></div>\r\n        </section>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectComponentViewModel","dojo/text!./templates/ProjectComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList","./ProjectSelector","./PublishMenu"],function(_1f9f,lang,_1fa0,_1fa1,_1fa2,on,when,_1fa3,_1fa4,_1fa5,_1fa6,res){function show(list){list.forEach(function(node){_1fa1.remove(node,"dijitHidden");});};function hide(list){list.forEach(function(node){_1fa1.add(node,"dijitHidden");});};lang.delegate(_1fa4.prototype.modelBindingMap,{placeHolder:["placeHolder"]});return _1f9f([_1fa4,_1fa3],{"class":"epi-project-component",modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],createProjectInfo:["createProjectInfo"],dndEnabled:["dndEnabled"],placeholderState:["placeholderState"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"]},res:res,templateString:_1fa6,layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1fa5();},_projectSelectorSortChanged:function(_1fa7){this.model.set("projectSortOrder",_1fa7);},_projectSelectorChange:function(_1fa8){this.model.set("selectedProject",_1fa8);},_newProjectButtonClickHandler:function(){this.model.namedCommands.addProject.execute();},_setCreateProjectInfoAttr:{node:"createProjectInfoNode",type:"innerText"},_setSelectedProjectAttr:function(value){this.projectSelector.set("value",value);},_setPlaceholderStateAttr:function(value){if(this.get("_placeholderState")===value){return;}this._set("_placeholderState",value);switch(value){case "noProjects":show([this.placeholderNode]);hide([this.projectSelector.domNode,this.publishContainer.domNode]);break;case "noSelectedProject":show([this.projectSelector.domNode,this.placeholderNode]);hide([this.publishContainer.domNode]);break;default:show([this.projectSelector.domNode,this.publishContainer.domNode]);hide([this.placeholderNode]);}}});});},"epi-cms/project/viewmodels/ProjectComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","./_ProjectViewModel","epi/i18n!epi/nls/episerver.cms.components.project"],function(_1fa9,lang,_1faa,when,_1fab,res){return _1fa9([_1fab],{createProjectInfo:"",hasProject:false,_selectedProjectProfileKey:"epi.selected-project-id",initialize:function(){this._updateHasProject();return this.inherited(arguments);},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1faa().resolve();}return store.remove(this.selectedProject.id).then(function(){self._selectNextProject();});},_loadSelectedProject:function(){var _1fac=this.projectStore;return when(this.profile.get(this._selectedProjectProfileKey),function(_1fad){if(!_1fad){return null;}return when(_1fac.get(_1fad)).then(function(_1fae){var _1faf=!!_1fae||undefined;return this._updateHasProject(_1faf).then(function(){return _1fae;});}.bind(this)).otherwise(function(ex){return null;});}.bind(this));},_updatePlaceholderState:function(){var _1fb0=this.get("hasProject"),_1fb1=!!this.get("selectedProject"),state="";if(!_1fb0){state="noProjects";this.set("createProjectInfo",res.placeholder.noprojectscreated);}else{if(_1fb0&&!_1fb1){state="noSelectedProject";this.set("createProjectInfo",res.placeholder.noprojectselected);}}this.set("placeholderState",state);},_getProjects:function(start,count,sort){return this.projectStore.query(null,{start:start,count:count,sort:sort});},_updateHasProject:function(_1fb2){return when(_1fb2===true?[_1fb2]:this._getProjects(0,1)).then(function(_1fb3){var _1fb4=_1fb3.length>0;this.set("hasProject",_1fb4);return _1fb4;}.bind(this));},_selectNextProject:function(){when(this._getProjects(0,1,this.get("projectSortOrder")),lang.hitch(this,function(_1fb5){var value=_1fb5.length>0?_1fb5[0]:null;this.set("selectedProject",value);this.set("hasProject",_1fb5.length>0);}));},_hasProjectSetter:function(value){this.hasProject=value;this._updatePlaceholderState();},_selectedProjectSetter:function(_1fb6){this.inherited(arguments);if(!this.hasProject&&_1fb6){this.set("hasProject",true);}else{this._updatePlaceholderState();}this.profile.set(this._selectedProjectProfileKey,_1fb6&&_1fb6.id,{location:"server"});}});});},"url:epi-cms/project/templates/ProjectComponent.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n         data-dojo-attach-point=\"itemList\"\r\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact'\">\r\n        <section data-epi-section=\"toolbarSection\">\r\n            <span data-dojo-type=\"epi-cms/project/ProjectSelector\"\r\n                  data-dojo-attach-point=\"projectSelector\"\r\n                  data-dojo-props=\"store:this.model.projectStore\"\r\n                  data-dojo-attach-event=\"onSortChanged:_projectSelectorSortChanged, onChange:_projectSelectorChange\"></span>\r\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\r\n                 data-dojo-attach-point=\"publishContainer\"\r\n                 data-dojo-props=\"iconClass: 'epi-iconPublishProject', showLabel: false, label: this.res.publishdropdown.label\"\r\n                 data-dojo-attach-event=\"openDropDown:_publishMenuClickHandler\"\r\n                 class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\">\r\n                <span></span>\r\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\r\n                     data-dojo-attach-point=\"publishMenu\"\r\n                     data-dojo-props=\"commandSource: this.model\">\r\n                    <section data-epi-section=\"primarySection\">\r\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\r\n                    </section>\r\n                    <section data-epi-section=\"statusSection\">\r\n                        <ul>\r\n                            <li>\r\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\r\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\r\n                            </li>\r\n                        </ul>\r\n                    </section>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </section>\r\n\r\n        <section data-epi-section=\"listContainer\">\r\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\">\r\n                <div class=\"epi-project-gadget__placeholder-content\">\r\n                    <button data-dojo-type=\"dijit/form/Button\" type=\"button\"\r\n                            data-dojo-props=\"iconClass: 'epi-iconPlus'\"\r\n                            data-dojo-attach-event=\"onClick:_newProjectButtonClickHandler\"\r\n                            class=\"epi-flat epi-chromeless\">${res.command.newproject.label}</button>\r\n                    <div data-dojo-attach-point=\"createProjectInfoNode\" class=\"epi-project-gadget__placeholder-info\"></div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/on","dojo/Deferred","dojox/html/entities","epi","dojo/text!dijit/form/templates/Select.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","./ProjectSelectorList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_1fb7,lang,_1fb8,_1fb9,on,_1fba,_1fbb,epi,_1fbc,_1fbd,_1fbe,_1fbf,_1fc0,_1fc1){return _1fb7([_1fc1,_1fc0],{"class":"epi-project-selector epi-chromeless epi-chromeless--with-arrow epi-flat",iconClass:"epi-iconProject",value:null,store:null,sort:null,query:null,enableDefaultValue:false,defaultValueText:_1fbe.preview.defaultoption,header:_1fbe.selector.title,buildRendering:function(){this.inherited(arguments);this.own(this.dropDown=new _1fbf({baseClass:"dijitMenu",header:this.header,enableDefaultValue:this.enableDefaultValue,defaultValueText:this.defaultValueText}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);this.closeDropDown(true);}),true));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableDefaultValue&&!this.value){this.set("value",null);}},compare:function(_1fc2,_1fc3){return epi.areEqual(_1fc2,_1fc3)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _1fc4=this.dropDown.refresh();return _1fc4.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableDefaultValue){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_1fbb.encode(value||"")]);},_setValueAttr:function(value,_1fc5){this.set("label",value&&value.name);if(this.enableDefaultValue&&!value){this.set("label",this.defaultValueText);}!_1fc5&&this.dropDown&&this.dropDown.set("selectedProject",value);this.inherited(arguments);}});});},"epi-cms/project/ProjectModeToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/on","dojo/dom-style","dojo/dom-class","dojo/string","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/form/Button","epi/shell/DialogService","epi/shell/widget/_ModelBindingMixin","./ProjectSelector","./viewmodels/ProjectModeToolbarViewModel","epi/dependency","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","dojo/text!./templates/ProjectModeToolbar.html","dojo/text!./templates/CurrentProjectDoesNotExistsWarning.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.toolbar"],function(_1fc6,lang,has,on,_1fc7,_1fc8,_1fc9,_1fca,_1fcb,_1fcc,_1fcd,_1fce,_1fcf,_1fd0,_1fd1,_1fd2,_1fd3,_1fd4,_1fd5,_1fd6,_1fd7){return _1fc6([_1fcc,_1fca,_1fcb,_1fcf],{templateString:_1fd5,localizations:_1fd7,_projectDoesNotExistWarning:"",postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1fd2.resolve("epi.cms.ProjectService");},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _1fd1());}this._projectDoesNotExistWarning=_1fc9.substitute(_1fd6,{warning:_1fd7.projectdoesnotexists.alert.warning,description:_1fd7.projectdoesnotexists.alert.description});},buildRendering:function(){this.inherited(arguments);this._setupContextMenu();var _1fd8=this._projectDoesNotExistWarning;this.own(this.projectOverviewButton=new _1fcd({showLabel:true,"class":"dijitHidden epi-chromeless",label:_1fd7.overview.label},this.projectOverviewButtonNode),this.projectOverviewButton.on("click",lang.hitch(this,"_openProjectOverview")),this.projectSelector=new _1fd0({iconClass:"dijitNoIcon","class":"epi-chromeless epi-chromeless--inverted epi-chromeless--with-arrow epi-project-mode-toolbar__selector",enableDefaultValue:true,defaultValueText:_1fd7.defaultoption,store:this.model.projectStore},this.projectSelectorNode),this.model.on("currentProjectDoesNotExists",function(){_1fce.alert(_1fd8);}));},_toggleOverviewButton:function(_1fd9){var _1fda=this.projectOverviewButton.domNode;_1fc8.toggle(_1fda,"dijitHidden",!_1fd9);},startup:function(){this.inherited(arguments);this.own(this.model.watch("overviewButtonVisible",lang.hitch(this,function(_1fdb,_1fdc,_1fdd){this._toggleOverviewButton(_1fdd);})));var model=this.model;this.model.initialize().then(lang.hitch(this,function(){var _1fde=this.domNode;this.own(this.projectSelector.watch("value",lang.hitch(this,function(_1fdf,_1fe0,_1fe1){_1fc8.toggle(_1fde,"epi-project-mode-toolbar--project-selected",!!_1fe1);_1fc8.remove(_1fde,"epi-project-mode-toolbar--project-deleted");model.set("currentProject",_1fe1);})));this.projectSelector.set("value",model.get("currentProject"));}));this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,function(_1fe2){this.projectSelector.set("value",_1fe2);})));this.own(this.model.on("animateToolbar",lang.hitch(this,function(){_1fc8.add(this.domNode,"epi-project-mode-toolbar--flash");var _1fe3=on(this.domNode,"animationend",lang.hitch(this,function(){_1fc8.remove(this.domNode,"epi-project-mode-toolbar--flash");_1fe3.remove();}));})));this.own(this.model.watch("currentProject",lang.hitch(this,function(_1fe4,_1fe5,_1fe6){if(_1fe6&&_1fe6.isDeleted){_1fc8.add(this.domNode,"epi-project-mode-toolbar--project-deleted");}})));},_openProjectOverview:function(){var _1fe7=this.projectSelector.get("value");if(_1fe7){this.model.showProjectOverview(_1fe7.id);}},_setupContextMenu:function(){this.own(new _1fd4({configuration:[{builder:new _1fd3({settings:{"class":"epi-chromeless",iconClass:"epi-iconContextMenu",showLabel:false,label:_1fd7.contextmenu.label},optionClass:""}),category:"context",target:this.contextMenu}],commandSource:this.model}));}});});},"epi-cms/project/viewmodels/ProjectModeToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","epi/epi","epi/dependency","epi-cms/_ContentContextMixin","../command/AddProject","../command/RenameProject","../command/RemoveProject","epi/shell/xhr/errorHandler"],function(_1fe8,lang,_1fe9,_1fea,_1feb,_1fec,topic,when,_1fed,_1fee,epi,_1fef,_1ff0,_1ff1,_1ff2,_1ff3,_1ff4){return _1fe8([_1fec,_1fed,_1feb,_1ff0,_1fee],{projectStore:null,currentProject:null,overviewButtonVisible:false,postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1fef.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1fef.resolve("epi.storeregistry").get("epi.cms.project");this._createCommands();var _1ff5=function(id){if(this.currentProject&&this.currentProject.id===id){this._markCurentProjectAsDeleted();}}.bind(this);var _1ff6=function(_1ff7){if(this.currentProject&&this.currentProject.id===_1ff7.id){this.set("currentProject",_1ff7);}}.bind(this);this.own(this.projectService.on("project-removed",_1ff5),this.projectService.on("project-updated",_1ff6));when(this.getCurrentContext()).then(this.contextChanged.bind(this));},initialize:function(){return when(this.projectService.getCurrentProject()).then(lang.hitch(this,function(_1ff8){this._changeAttrValue("currentProject",_1ff8,false);this.set("overviewButtonVisible",!!_1ff8);}));},contentContextChanged:function(_1ff9,_1ffa){this.inherited(arguments);if(this.get("currentProject")){var self=this;this.projectService.exists(this.currentProject.id).then(function(_1ffb){if(!_1ffb){self.emit("currentProjectDoesNotExists");}});}},_markCurentProjectAsDeleted:function(){var _1ffc=lang.clone(this.currentProject);_1ffc.isDeleted=true;this.set("currentProject",_1ffc,false);this.set("overviewButtonVisible",false);},contextChanged:function(_1ffd,_1ffe){this.inherited(arguments);if(_1ffd&&_1ffd.type==="epi.cms.project"){var _1fff=parseInt(_1ffd.id,10);when(this.projectStore.get(_1fff)).then(lang.hitch(this,function(_2000){if(_1ffe&&_1ffe.sender&&_1ffe.sender._requestContext){this.emit("animateToolbar");}this.set("currentProject",_2000);}));}},_currentProjectSetter:function(_2001,_2002){if(epi.areEqual(this._clearProjectStats(this.currentProject),this._clearProjectStats(_2001))){return;}this.set("overviewButtonVisible",!!_2001);this.currentProject=_2001;var _2003=new _1fea().resolve();if(_2002||_2002===undefined){_2003=this.projectService.setCurrentProject(_2001);}_2003.then(lang.hitch(this,"getCurrentContext")).then(function(_2004){if(_2004.type!=="epi.cms.project"&&_2004.currentMode===undefined){topic.publish("/epi/shell/context/request",{uri:_2004.versionAgnosticUri},{sender:this});}});},_clearProjectStats:function(_2005){if(!_2005){return _2005;}return Object.assign({},_2005,{itemStatusCount:{}});},showProjectOverview:function(_2006){var _2007="epi.cms.project:///"+_2006;topic.publish("/epi/shell/context/request",{uri:_2007},{sender:this});},getCommands:function(){return this.commands;},addProject:function(_2008){this.projectStore.add(_2008).then(lang.hitch(this,function(value){this.set("currentProject",value);})).otherwise(_1ff4.forXhr);},getProject:function(){return this.get("currentProject");},updateProject:function(_2009){this.projectStore.put(_2009).then(lang.hitch(this,"set","currentProject")).otherwise(_1ff4.forXhr);},reactivateProject:function(){if(!this.currentProject){return new _1fea().resolve();}return this.projectService.reactivateProject(this.currentProject.id);},removeProject:function(){if(!this.currentProject){return new _1fea().resolve();}return this.projectStore.remove(this.currentProject.id).then(lang.hitch(this,function(){this.set("currentProject",null);}));},_createCommands:function(){var _200a={model:this,category:"context",propertiesToWatch:["currentProject"]},_200b=this.own(new _1ff1(_200a),new _1ff2(_200a),new _1ff3(_200a));this.set("commands",_200b);}});});},"url:epi-cms/project/templates/ProjectModeToolbar.html":"<div class=\"epi-project-mode-toolbar\">\r\n\t<span data-dojo-attach-point=\"projectIconNode\" class=\"dijitReset dijitInline epi-project-mode-toolbar__icon-node\">\r\n\t\t<span class=\"dijitReset dijitInline dijitIcon epi-iconProject\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"projectLabelNode\" class=\"dijitInline\">${localizations.label}</span>\r\n    <span data-dojo-attach-point=\"projectSelectorNode\"></span>\r\n    <span class=\"dijitInline epi-project-mode-toolbar__warning-label\">${localizations.projectdoesnotexists.currentprojectdoesnotexists}</span>\r\n    <span data-dojo-attach-point=\"contextMenu\" class=\"epi-project-mode-toolbar__contextmenu\"></span>\r\n    <span data-dojo-attach-point=\"projectOverviewButtonNode\"></span>\r\n</div>\r\n","url:epi-cms/project/templates/CurrentProjectDoesNotExistsWarning.html":"<div class=\"epi-project-mode-project-deleted-warning\">${warning}</div>\r\n<p>${description}</p>","epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/epi","epi/shell/widget/dialog/Dialog","./viewmodel/CategorySelectorViewModel","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_200c,lang,_200d,_200e,_200f,_2010,query,_2011,_2012,_2013,_2014,_2015,_2016,_2017,_2018,epi,_2019,_201a,_201b,res){return _200c([_2012,_2011,_2013,_2016,_2018],{templateString:_201b,localization:res,multiple:true,value:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.model=new _201a();this.own(this.model);},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _201c=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_201c);if(_201c.length>0){this._set("value",_201c);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this.model.get("categories"),value)){return;}this.model.set("categories",value);this.onChange(this.model.get("categories"));this._updateDisplayNode();},_getValueAttr:function(){return this.model.get("categories");},_setReadOnlyAttr:function(value){this._set("readOnly",value);_2010.set(this.button.domNode,"display",value?"none":"");_200e.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},isValid:function(){if(!this.required){return true;}var value=this.get("value");return value&&value.length>0;},_createCategoryButton:function(_201d){if(query("div[data-epi-category-id='"+_201d.id+"']",this.categoriesGroupContainer).length!==0){return;}var _201e=_200f.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _201f=_200f.create("div",{"class":"dijitInline epi-resourceName"});var _2020=_200f.create("div",{"class":"dojoxEllipsis",innerHTML:_201d.description});_200f.place(_2020,_201f);_200f.place(_201f,_201e);this._tooltip=new _2015({connectId:_2020,label:this._getCategoryPath(_201d)});var _2021=_200f.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_200d.set(_2021,"data-epi-category-id",_201d.id);var _2022=_2021.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_2021,_2022,lang.hitch(this,this._onRemoveClick));_200f.place(_2021,_201f);}else{_200f.place(_200f.create("span",{innerHTML:"&nbsp;"}),_201f);}_200f.place(_201e,this.categoriesGroupContainer);},_getCategoryPath:function(_2023){if(!_2023.parentsNameCollection||_2023.parentsNameCollection.length===1){return "";}var path=_2023.parentsNameCollection[1];for(var i=2;i<_2023.parentsNameCollection.length;i++){path=path+"/"+_2023.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){_200f.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";this.model.refreshCategories().then(function(_2024){if(!this.model.hasCategories()){this._createNoCategoriesChosenSpan();return;}_2024.forEach(function(_2025){this._createCategoryButton(_2025);},this);}.bind(this));},_onRemoveClick:function(arg){if(!this.model.get("categories")){return;}var _2026=parseInt(_200d.get(arg.target,"data-epi-category-id"),10);var _2027=this.model.get("categories").indexOf(_2026);if(_2027===-1){return;}var _2028=lang.clone(this.model.get("categories"));_2028.splice(_2027,1);this.set("value",_2028);},_getCategoriesParentsNameClone:function(){var _2029={};array.forEach(this.model.get("categories"),lang.hitch(this,function(_202a){_2029[_202a]=this.model.get("categoriesParentsName")[_202a];}));return _2029;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this.model.get("categories")));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _202b=this.categorySelectorDialog.get("value");this.set("value",_202b);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _2017({rootCategory:this.root});this.dialog=new _2019({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_202c,lang,_202d,_202e,_202f,_2030,epi,_2031,_2032){return _202c([_202e,_202d,_202f],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_2033,lang,Tree,epi,_2034,_2035){return _2033([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _2035({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _2034(args);},getTooltip:function(item){var _2036=this.model.getTooltip||this.model.getLabel;return _2036?_2036(item):this.inherited(arguments);},getNodeById:function(_2037){var nodes=this.getNodesByItem(_2037.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_2038,_2039,_203a){if(!_2038||!_2038.item||!_2038.item.hasChildren||!lang.isArray(_2039)||_2039.length===0||!_203a){return 0;}var _203b=0,_203c=[],_203d=[],_203e=lang.clone(_2038.item.parentsNameCollection);var _203f=function(_2040){if(lang.isArray(_2040)&&_2040.length>0){_2040.pop();}};_203e[_203e.length-1]=_2038.item.description;array.forEach(_2039,function(_2041){_203c=lang.clone(_203a[_2041]);_203f(_203c);_203d=lang.clone(_203c);lang.mixin(_203d,_203e);if(lang.isArray(_203c)&&epi.areEqual(_203c,_203d)){_203b++;}},this);return _203b;},_setTotalSelectedNodes:function(_2042){if(_2042){_2042.set("totalSelectedNodes",this._getTotalSelectedNodes(_2042,this.selectedNodeIds,this.selectedNodeData));array.forEach(_2042.getChildren(),function(_2043){if(_2043&&_2043.item&&_2043.item.hasChildren){if(_2043.isExpanded){this._setTotalSelectedNodes(_2043);}else{_2043.set("totalSelectedNodes",this._getTotalSelectedNodes(_2043,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_2044,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!==-1;if(_2044&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_2044&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_2045,_2046){if(!_2045||!lang.isArray(_2046)){return;}var _2047=false;array.forEach(_2045.getChildren(),function(_2048){if(_2048){_2047=_2046.indexOf(_2048.item.id)!==-1;_2048.set("checked",_2047);if(_2048.hasChildren()){this.set("toggleSelectNodes",_2048,_2046);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_2049,item){this._onNodeSelectChanged(_2049,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_204a,lang,_204b,_204c,keys,_204d,_204e,_204f,epi,_2050){return _204a([_2050,_204e],{templateString:_204d,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_204b.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _2051=_204c.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _2052=new _204f({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_2053){this.onNodeSelectChanged(_2053,this.item);})});_2052.placeAt(_2051);_204c.place(_2051,this.expandoNode,"after");return _2052;},onNodeSelectChanged:function(_2054,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode===keys.SPACE||evt.keyCode===keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_2055){if(!this._checkbox){return;}this._set("checked",_2055);this._checkbox.set("checked",_2055);},_setTotalSelectedNodesAttr:function(_2056){var _2057=this.tree.model.getLabel(this.item),_2058=!this.isExpanded&&_2056>0;this.labelNode.innerHTML=_2058?_2057+" ("+_2056+")":_2057;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\r\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\r\n            </span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi/routes"],function(_2059,lang,when,_205a,_205b,_205c){return _2059(null,{store:null,rootCategory:undefined,constructor:function(args){lang.mixin(this,args);if(!this.store){var _205d=_205b.resolve("epi.storeregistry");this.store=_205d.get("epi.cms.category");}},getRoot:function(_205e){when(this.store.get(this.rootCategory),_205e);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_205f,_2060){var id=this.getIdentity(_205f),_2061=this.store.query({id:id,query:"getchildren"});_2061.then(function(_2062){_205f.children=_2062;_2060(_2062);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return _205a.encode(item.description);}});});},"epi-cms/widget/viewmodel/CategorySelectorViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dijit/Destroyable","dojo/Stateful","dojo/when","dojo/promise/all","epi/dependency"],function(_2063,_2064,_2065,_2066,when,all,_2067){return _2063([_2066,_2065],{_categories:null,_categoriesParentsName:null,_updateDisplayPromise:null,store:null,constructor:function(_2068){if(_2068&&_2068.store){this.store=_2068.store;}else{var _2069=_2067.resolve("epi.storeregistry");this.store=_2069.get("epi.cms.category");}this._categoriesParentsName={};},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},refreshCategories:function(){var _206a=new _2064();this._categoriesParentsName={};if(!this.hasCategories()){_206a.resolve([]);return _206a.promise;}var _206b=[];var _206c=[];this._categories.forEach(function(_206d){var def=when(this.store.refresh(_206d)).then(function(_206e){if(!_206e||!_206e.visible){_206c.push(_206d);return null;}this._categoriesParentsName[_206e.id]=_206e.parentsNameCollection;return _206e;}.bind(this),function(){_206c.push(_206d);return null;}.bind(this));_206b.push(def);},this);this._updateDisplayPromise=all(_206b).then(function(_206f){this._updateDisplayPromise=null;_206c.forEach(function(c){var _2070=this._categories.indexOf(c);if(_2070!==-1){this._categories.splice(_2070,1);}}.bind(this),this);_206a.resolve(_206f.filter(function(c){return c!==null;}));}.bind(this));return _206a.promise;},hasCategories:function(){var _2071=this.get("categories");return !!_2071&&_2071.length>0;},hasCategory:function(_2072){return this.get("categories")&&this.get("categories").indexOf(_2072)!==-1;},_categoriesParentsNameGetter:function(){return this._categoriesParentsName;},_categoriesGetter:function(){return this._categories;},_categoriesSetter:function(value){this._categories=value;}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/string","dojo/when","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/_SelectorBase","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_2073,lang,_2074,_2075,_2076,_2077,when,_2078,_2079,_207a,_207b,_207c,_207d,_207e,_207f,_2080,_2081){return _2073([_2080],{roots:null,value:null,required:false,missingMessage:_2081.requiredmessage,tooltipPosition:[],contentLink:null,previewUrl:null,canSelectOwnerContent:false,accessLevel:_207e.accessLevel.Read,showAllLanguages:true,showSearchBox:true,searchArea:null,contentClass:null,dialogClass:"epi-dialog-portrait",_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},buildRendering:function(){var _2082=this.name?(this.name.replace(/"/g,"&quot;")):"";this.input=_2076.create("input",{type:"hidden",name:_2082});this.inherited(arguments);this.domNode.appendChild(this.input);},postMixInProperties:function(){this.inherited(arguments);var _2083=_207a.resolve("epi.storeregistry");this._store=_2083.get("epi.cms.content.light");var _2084=this.contentRepositoryDescriptors||_207a.resolve("epi.cms.contentRepositoryDescriptors");var _2085=_2084.get(this.repositoryKey);if(_2085&&!this.roots){this.roots=_2085.roots;}if(_2085&&!this.searchArea){this.searchArea=_2085.searchArea;}},postCreate:function(){this.inherited(arguments);if(!this.value){this._updateDisplayNode(null);}},destroy:function(){if(this.dialog){this.dialog.destroy();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);_2075.set(this.button.domNode,"display",value?"none":"");_2075.set(this.clearButton,"display",value?"none":"");_2074.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._setValueAndFireOnChange(value);},createDialogContent:function(){return new _207f({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes,showAllLanguages:this.showAllLanguages,showSearchBox:this.showSearchBox,searchArea:this.searchArea});},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_2081.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_207b.getResourceValue(this.allowedTypes[0],"name");if(name){title=_2077.substitute(_2081.format,[name]);}}this.contentSelectorDialog=this.createDialogContent();this.dialog=new _207c({title:title,dialogClass:this.dialogClass,contentClass:this.contentClass,content:this.contentSelectorDialog,destroyOnHide:false});this.dialog.own(this.contentSelectorDialog);this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");this.connect(this.dialog,"onShow","_onDialogShow");return this.dialog;},_onDialogShow:function(){this.inherited(arguments);this._setDialogButtonState(this._convertValueToContentReference(this.value));},_isContentAllowed:function(_2086){var _2087=_207b.getValidAcceptedTypes([_2086],this.allowedTypes,this.restrictedTypes);return !!_2087.length;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_2088){this.canSelectOwnerContent=this.canSelectOwnerContent&&_2088&&this._isContentAllowed(_2088.typeIdentifier);var _2089=this._getDialog();this.isShowingChildDialog=true;var _208a;if(this.value){_208a=this._convertValueToContentReference(this.value);}if(_208a){_208a=_208a.createVersionUnspecificReference().toString();this.contentSelectorDialog.set("value",_208a);}else{this.setInitialValue();}_2089.show();}));},setInitialValue:function(){this.contentSelectorDialog.set("value",undefined);},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return value?new _207d(value):null;},_setValueAndFireOnChange:function(value){var _208b=value==="-"?this.contentLink:value;this.set("permanentLink",null);this.set("previewUrl",null);this._valueChangedPromise=when(this._getContentData(_208b),lang.hitch(this,function(_208c){if(this._destroyed){return;}this._valueChangedPromise=null;var _208d=this.value!==_208b;this.value=_208b;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_208c);if(_208d){this.onChange(_208b);}if(_208c){this.set("permanentLink",_208c.permanentLink);this.set("previewUrl",_208c.previewUrl);}}));},_getContentData:function(_208e){if(!_208e){return null;}return this._store.get(_208e);},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_2078.focus(this.button.focusNode);}catch(e){}}},_updateDisplayNode:function(_208f){this.inherited(arguments);if(_208f){this.set("selectedContentLink",new _207d(_208f.contentLink).id);}else{this.set("selectedContentName",_2081.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_2090){var self=this;if(!_2090){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",true);return;}when(self._store.get(_2090),function(_2091){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_207e.hasAccess(_2091.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/dom-prop","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_2092,lang,_2093,_2094,_2095,_2096,_2097,query,when,_2098,_2099,_209a,_209b,_209c,i18n,_209d,_209e,_209f,_20a0,_20a1){return _2092([_209a,_2099,_209b,_2098,_209f,_20a0,_209e,_209d],{templateString:_20a1,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_valueChangedPromise:null,_setSelectedContentNameAttr:function(value){_2097.set(this.selectedContentNameNode,"textContent",value);this._updateDisplayNodeTitle();},_setSelectedContentLinkAttr:function(value){_2097.set(this.selectedContentLinkNode,"innerHtml",value);this._updateDisplayNodeTitle();},_updateDisplayNodeTitle:function(){this.resourceName.title=this.resourceName.textContent.trim();},postCreate:function(){this.inherited(arguments);this.own(_2093.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_209c.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _20a2=this.contentRepositoryDescriptors.get(this.repositoryKey);this.roots=_20a2.roots;}},destroy:function(_20a3){this.inherited(arguments);if(this._valueChangedPromise){this._valueChangedPromise.cancel();this._valueChangedPromise=null;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_2096.set(this.button.domNode,"display",value?"none":"");_2096.set(this.clearButton,"display",value?"none":"");_2095.toggle(this.domNode,"dijitReadOnly",value);},_getDialog:function(){},_onButtonClick:function(){if(!this.dialog){this.dialog=this._getDialog();this.dialog.startup();this.own(_2093.after(this.dialog,"onExecute",lang.hitch(this,this._onDialogExecute)));this.own(_2093.after(this.dialog,"onShow",lang.hitch(this,this._onDialogShow)));this.own(_2093.after(this.dialog,"onHide",lang.hitch(this,this._onDialogHide)));this.own(this.dialog);}this.dialog.show();},_onDialogShow:function(){this.isShowingChildDialog=true;},_onDialogExecute:function(){},_onDialogHide:function(){this.isShowingChildDialog=false;this.focus();},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_20a4){if(_20a4){_2095.remove(this.domNode,"epi-noValue");_2095.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_20a4.name);}else{_2095.add(this.domNode,"epi-noValue");_2095.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_setDialogButtonState:function(_20a5){}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_20a6,lang,when,_20a7){return _20a6(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _20a8=this.own(new _20a7(this.dropAreaNode,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_20a8,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_20a9,_20aa,nodes,copy){var _20ab=_20a9?(_20a9.length?_20a9[0]:_20a9):null;if(_20ab){this.onDropping();when(_20ab.data,lang.hitch(this,function(_20ac){var value;if(this.dndSourcePropertyName){value=_20ac[this.dndSourcePropertyName];}else{value=_20ac;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _20ad=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_20ad,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}this.focus();var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\" >\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dijit/_Container","dijit/registry","epi","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/core/ContentReference","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_20ae,lang,_20af,_20b0,_20b1,_20b2,_20b3,_20b4,json,on,query,_20b5,_20b6,epi,Item,_20b7,_20b8,_20b9,Block,_20ba,_20bb,_20bc,_20bd,_20be,_20bf){return _20ae([Item,_20b5,_20be],{templateString:_20bf,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_20bc,dndSourceClass:_20ae([_20b7,_20b8]),dndSourceSettings:null,allowedTypes:null,restrictedTypes:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.own(this.model);this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_20c0,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();})));this._pendingPersonalizations=[];this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _20b4.get(this.sourceItemNode,"minHeight");},onValueChange:function(_20c1){},updatePosition:function(_20c2){if(!this.canUpdatePosition()){return false;}var _20c3=this.inherited(arguments),_20c4,_20c5,_20c6,_20c7;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_20c6=this.get("minHeight");_20b4.set(this.sourceItemNode,"minHeight","");_20c4=Math.floor(_20b3.position(this.actionsNodeControls,false).h);_20c5=_20c4>0?_20c4:this.get("actionNodeHeight")||0;_20c7=Math.floor(_20b3.position(this.sourceItemNode,false).h);if(_20c5===0){if(_20c7!==0){this._clearPosition();return _20c3;}}_20c5&&(this.set("actionNodeHeight",_20c5));_20b4.set(this.sourceItemNode,"minHeight",(_20c7+_20c5)+"px");_20b4.set(this.actionsNodeControls,"marginTop",(_20c7)+"px");if(_20c6===_20c7+_20c5){return _20c3;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_20b2.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setDisabledAttr:function(){this.inherited(arguments);if(this.position){this.updatePosition(this.position);}},_setupDnd:function(){var _20c8=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,reject:this.restrictedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_20c8);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance);this.own(_20af.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_20af.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_20b2.create("div"),_20c9;if(typeof item.getNormalizedData=="function"){_20c9=item.getNormalizedData();}_20c9=_20c9?_20c9.data:item;return {node:node,type:this.allowedDndTypes,data:_20c9};},_setupBlocks:function(){var _20ca=this._getBlockNodes();array.forEach(_20ca,this._createBlock,this);this.set("hasChildren",_20ca.length>0);},_createBlock:function(node){var id=_20b1.get(node,"data-epi-block-id"),info=json.parse(_20b1.get(node,"data-epi-block-personalization")),_20cb=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_20cb){model=model.getChild({name:_20cb});}var _20cc=model&&model.getChild(lang.mixin({contentLink:new _20b9(id).createVersionUnspecificReference().toString()},info));if(!_20cc){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:_20cc,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=_20cc.watch("ensurePersonalization",lang.hitch(this,function(_20cd,_20ce,_20cf){var index=array.indexOf(this._pendingPersonalizations,_20cc);if(_20cf){if(index<0){this._pendingPersonalizations.push(_20cc);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));_20cc.set("visible",true);this._source.setItem(block.domNode.id,{name:_20cc.name,data:_20cc,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _20d0=this.getChildren(),_20d1=[],_20d2=this.get("position");array.forEach(_20d0,function(_20d3,i){var _20d4;if(!_20d1[i]){_20d1[i]=_20b3.position(_20d3.sourceItemNode,false);}_20d4=_20d1[i];_20d4.x-=_20d2.x;_20d4.y-=_20d2.y;_20d3.resize(_20d4);},this);},_checkAcceptance:function(_20d5,nodes){if(this.readOnly||nodes===undefined){return false;}var _20d6=_20b6.getEnclosingWidget(nodes[0]);if(_20d6.isInstanceOf(_20ba)){return false;}return this._source.defaultCheckAcceptance(_20d5,nodes);},_getBlockNodes:function(){if(!this.canUpdatePosition()){return [];}var _20d7=query("[data-epi-block-id]",this.sourceItemNode);var _20d8=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_20d7,function(node){return _20d8.indexOf(node)===-1;});},_setupDirectionality:function(){var _20d9;if(/vertical|horizontal/.test(this.layout)){_20d9=this.layout==="horizontal";}else{_20d9=array.some(this._getBlockNodes(),function(node){var style=_20b4.getComputedStyle(node),_20da=/left|right/.test(style.cssFloat),_20db=/inline|inline-block/.test(style.display);return _20da||_20db;});}this._source.setHorizontal(_20d9);},executeAction:function(_20dc){if(_20dc==="createnewblock"){var _20dd=new _20bb({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,treatAsSecondaryView:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_20dd.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_20dd.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_20de,nodes,_20df){var model=this.model,_20e0=this._source;if(_20e0.anchor===_20e0.targetAnchor){return;}var index=array.indexOf(_20e0.getAllNodes(),_20e0.targetAnchor)+(_20e0.before?-1:1),_20e1=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_20e1[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_20e0===_20de&&!_20df){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _20bd(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/has","dojo/dnd/Manager","dojo/dnd/Source","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_20e2,has,_20e3,_20e4,_20e5,_20e6,_20e7,_20e8){return _20e2(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_20e6.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_20e9){_20e5.toggle(this.node,"dojoDndHorizontal",_20e9);this.horizontal=_20e9;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState==="Disabled"){return;}_20e4.superclass.onMouseMove.call(this,e);var m=_20e3.manager();var _20ea=has("mac")?"metaKey":"ctrlKey";if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(e[_20ea],true));}}}if(this.isDragging){var _20eb=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!==this.current){this.targetBox=_20e7.position(this.current,true);}if(this.horizontal){_20eb=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_20eb=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_20eb=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!==this.targetAnchor||_20eb!==this.before){this._markTargetAnchor(_20eb);m.canDrop(!this.current||m.source!==this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _20ec=[],_20ed,_20ee;function _20ef(_20f0,_20f1){function _20f2(value){return value*value;};return Math.sqrt(_20f2(_20f0.x-_20f1.x)+_20f2(_20f0.y-_20f1.y));};this.getAllNodes().forEach(function(node){var pos=_20e7.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_20ec.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_20ec.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_20ec,function(value){value.distance=_20ef(point,value);if(!_20ed||value.distance<_20ee){_20ed=value;_20ee=value.distance;}},this);if(_20ed){this.current=_20ed.node;this._calculatedCurrent=true;return _20ed.before;}return false;},_markTargetAnchor:function(_20f3){var _20f4=true,_20f5=true;if(this.current===this.targetAnchor&&this.before===_20f3){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_20f3;if(this.targetAnchor){this.targetAnchorSibling=_20f3?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_20e5.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_20f4=!(this.targetAnchor.id in this.selection);_20f5=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_20f4&&_20f5){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_20f4&&_20f5){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_20f4&&_20f5);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_20f6){var _20f7=this._markerNode,_20f8,_20f9,_20fa,style,top,left,_20fb,width,gap=-1;if(_20f6){_20f8=_20e7.position(this.targetAnchor,false);_20f9=this.targetAnchorSibling?_20e7.position(this.targetAnchorSibling,false):{h:0,w:0};_20fa=_20e7.position(this.node,false);if(this.horizontal){if(this.before){left=_20f8.x-_20fa.x;if(this.targetAnchorSibling){gap=(_20f8.x-_20f9.x-_20f9.w)/2;}if(gap>=0){left-=gap;}}else{left=_20f8.x+_20f8.w-_20fa.x;if(this.targetAnchorSibling){gap=(_20f9.x-_20f8.x-_20f8.w)/2;}if(gap>=0){left+=gap;}}_20fb=gap>=0?Math.max(_20f8.h,_20f9.h):_20f8.h;style={display:"block",top:_20f8.y-_20fa.y+"px",left:left+"px",height:_20fb+"px"};}else{if(this.before){top=_20f8.y-_20fa.y;if(this.targetAnchorSibling){gap=(_20f8.y-_20f9.y-_20f9.h)/2;}if(gap>=0){top-=gap;}}else{top=_20f8.y+_20f8.h-_20fa.y;if(this.targetAnchorSibling){gap=(_20f9.x-_20f8.x-_20f8.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_20f8.w,_20f9.w):_20f8.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_20f7){_20f7=this._markerNode=_20e6.place(this.markerTemplateString,this.node);_20e8.set(_20f7,style);}else{setTimeout(function(){_20e8.set(_20f7,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_20fc,_20fd,event,_20fe,_20ff,_2100,html,_2101,query,_2102,_2103,pm,_2104,_2105,_2106,res,_2107){return _20fc([_2102,_2103,_2105],{templateString:_2107,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{contentLink:["contentLink"],name:["name"],contentGroup:["contentGroup"],roleIdentities:["roleIdentities"],selected:["selected"]},_setSelectedAttr:function(_2108){this.inherited(arguments);_20ff.toggle(this.itemNode,"epi-content-block-editor-node-selected",_2108);_2100.set(this.iconNodeMenu,"visibility",_2108?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_20fe.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _2106(this.modelData);},_setIsDraggableAttr:function(_2109){this._set("isDraggable",_2109);if(this.isDraggable){_20ff.add(this.domNode,"dojoDndItem");}else{_20ff.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_210a,lang,_210b,_210c){return _210a([_210b,_210c],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\r\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\r\n            </span>\r\n        </span>\r\n    </a>\r\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\r\n\t<div class=\"epi-overlay-item-container\">\r\n        <span data-dojo-attach-point=\"informationNode\" class=\"epi-overlay-item-info\"></span>\r\n        <div class=\"epi-overlay-bracket\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\r\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\r\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\r\n\t</div>\r\n</div>\r\n","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property"],function(_210d,lang,_210e,_210f){return _210d([_210f],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_2110,_2111){this.model.set("data",_2111);})));},onDrop:function(_2112,value){this.model.addTo(value,null,false);},_setupModel:function(data){require([this.modelType],lang.hitch(this,function(_2113){this.model=new _2113(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_2114){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _2115=this.modelParams.itemConverterKey,_2116=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_2115){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_2115;});}if(_2116){this.allowedDndTypes.unshift(_2116);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_2117,_2118,_2119,_211a,_211b){return _2117([_2118,_2119],{templateString:_211b,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_211a.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"valueNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\r\n</div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","epi-cms/widget/ContentSelector","epi-cms/widget/_UrlSelectorMixin"],function(_211c,_211d,_211e){return _211c([_211d,_211e],{});});},"epi-cms/widget/_UrlSelectorMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper"],function(_211f,_2120,lang,when,epi,Url,_2121,_2122){return _211f(null,{_contentData:null,_setValueAndFireOnChange:function(value){var _2123;if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}this.set("permanentLink",null);this.set("previewUrl",null);if(!value){this._updateDisplayNode(null);_2123=this.value!==value;this.value=value;this._contentData=null;if(_2123){this.onChange(value);}this._started&&this.validate();return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_2124){this._updateDisplayNode(_2124);var _2125=_2124.permanentLink;this._started&&this.validate();_2123=!epi.areEqual(this.value,_2125);this.value=_2125;if(_2123){this.onChange(_2125);}if(_2124){this.set("permanentLink",_2124.permanentLink);this.set("previewUrl",_2124.previewUrl);}}));},_convertValueToContentReference:function(value){if(this._contentData){return new _2121(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}this._valueChangedPromise=new _2120();when(_2122.getContent(value,{allLanguages:true}),lang.hitch(this,function(_2126){this._contentData=_2126;if(this._valueChangedPromise){this._valueChangedPromise.resolve(_2126);}}));return this._valueChangedPromise.promise;}});});},"epi-cms/widget/UrlMediaSelector":function(){define(["dojo/_base/declare","epi-cms/widget/MediaSelector","epi-cms/widget/_UrlSelectorMixin"],function(_2127,_2128,_2129){return _2127([_2128,_2129],{});});},"epi-cms/widget/MediaSelector":function(){define(["dojo/_base/declare","dojo/on","dojo/when","epi-cms/widget/ContentSelector","epi-cms/widget/SelectableMediaComponent"],function(_212a,on,when,_212b,_212c){return _212a([_212b],{contentClass:"epi-wrapped epi-mediaSelector",dialogClass:null,createDialogContent:function(){var _212d=new _212c({repositoryKey:this.repositoryKey,allowedTypes:this.allowedTypes});this.own(on(_212d,"data-changed",function(_212e){this._setDialogButtonState(_212e);}.bind(this)));return _212d;},setInitialValue:function(){this.contentSelectorDialog.setInitialValue();}});});},"epi-cms/widget/SelectableMediaComponent":function(){define(["dojo/_base/declare","dojo/dom-style","dojo/Evented","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/component/Media"],function(_212f,_2130,_2131,topic,when,_2132,_2133,_2134,_2135,Media){return _212f([Media,_2133,_2131],{componentId:"SelectableMediaComponent",root:_2135.rootPage,additionalTreeClass:"",postMixInProperties:function(){this.inherited(arguments);this.model.containedTypes=this.allowedTypes;this.model.changeContextOnItemSelection=false;this.model.treeStoreModel.forThisFolderEnabled=this._currentContext.currentMode!=="create";this.own(topic.subscribe("/epi/cms/upload",this._focusGrid.bind(this)));},postCreate:function(){this.inherited(arguments);this.list.set("selectionMode","single");this.searchResultList.set("selectionMode","single");this.resize({h:370,w:680,l:0,t:0});this.tree.set({region:"left",splitter:true});_2130.set(this.tree.domNode,"width","250px");this.listContainer.set({region:"center",splitter:false});this.own(this.model.selection.watch("data",this._dataChanged.bind(this)));},setInitialValue:function(){when(this.getCurrentContent()).then(function(_2136){var _2137;if(this._currentContext.currentMode==="create"){_2137=_2135.globalAssetsFolder;}else{_2137=new _2134(_2136.assetsFolderLink).createVersionUnspecificReference().toString();}this.set("value",_2137);}.bind(this));},_getValueAttr:function(){return this.model.selection.data[0].data.contentLink;},_setValueAttr:function(value){this._set("value",value);if(value){this.model.selectItemsByContentReference(value,true);this._focusGrid();}else{this.model.set("treePaths",null);}},_focusGrid:function(){this._focusManager.focus(this.list.grid.domNode);},_dataChanged:function(name,_2138,_2139){if(!_2139||_2139.length!==1||!_2139[0].data||!this.allowedTypes.some(function(_213a){return _2132.isBaseTypeIdentifier(_2139[0].data.typeIdentifier,_213a);})){this.emit("data-changed",null);return;}var _213b=_2139[0].data.contentLink;this.emit("data-changed",_213b);},contextChanged:function(){this.emit("close-diaog");}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","dojo/aspect","dojo/Deferred","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi/Url","epi-cms/widget/LinkEditor","epi-cms/widget/_SelectorBase","epi-cms/core/PermanentLinkHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink"],function(_213c,lang,_213d,_213e,when,_213f,_2140,_2141,_2142,Url,_2143,_2144,_2145,res){return _213c([_2144,_2141],{resource:res,linkHelper:_2145,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _2146=_213c(this.modelClassName);this.model=new _2146();}},startup:function(){if(this._started){return;}this.inherited(arguments);!this.value&&this.set("value",null);},isValid:function(){return (!this.required||(!this.get("isEmpty")));},_onDialogShow:function(){this.inherited(arguments);var link=this.get("value");this.dialogContent.set("value",{href:link});},_onDialogExecute:function(){var _2147=this.dialogContent.get("value");this.set("value",_2147.href);},_getDialog:function(){this.dialogContent=new _2143({modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target","language"]});this.own(this.dialogContent);return new _2142({title:this._getTitle(),dialogClass:"epi-dialog-portrait",content:this.dialogContent,destroyOnHide:false,defaultActionsVisible:false});},_setValueAttr:function(value){if(!value){this.set("isEmpty",true);this._setValueAndFireOnChange(null);return;}this.set("isEmpty",false);this._setValueAndFireOnChange(value);},_setValueAndFireOnChange:function(value){var _2148=this.get("value");this._set("value",value);var _2149=true;if(!_2148&&!value){_2149=false;}else{if(value&&value===_2148){_2149=false;}}if(_2149){this.onChange(value);}if(this._valueChangedPromise){this._valueChangedPromise.cancel("");}if(value){this._valueChangedPromise=this._getLinkName(value);this._valueChangedPromise.then(lang.hitch(this,this._updateDisplayNode));}else{this._updateDisplayNode(null);}},_getLinkName:function(value){var def=new _2140();when(this.linkHelper.getContent(value,{allLanguages:true}),lang.hitch(this,function(_214a){var _214b={name:_214a?_214a.name:value};if(!def.isCanceled()){def.resolve(_214b);}}));return def.promise;},_getTitle:function(){return lang.replace(this.value?this.resource.title.template.edit:this.resource.title.template.create,this.resource.title.action);}});});}}});