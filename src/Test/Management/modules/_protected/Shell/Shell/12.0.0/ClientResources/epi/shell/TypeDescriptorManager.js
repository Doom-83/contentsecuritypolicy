//>>built
define("epi/shell/TypeDescriptorManager",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi/dependency","epi/i18n!epi/shell/ui/nls/contenttypes"],function(_1,_2,_3,_4,_5,_6,_7){return {_uiDescriptors:{},resources:_7,store:null,initialize:function(){this.store=this.store||_6.resolve("epi.storeregistry").get("epi.shell.uidescriptor");return _5(this.store.query()).then(this.registerTypeSettings.bind(this));},clear:function(){this._uiDescriptors={};},registerTypeSettings:function(_8){var _9=this._uiDescriptors={};function _a(_b){var _c=_9[_b],_d=_c.descriptor,_e=_d.baseTypes||[];if(_c.ctor){return _c.ctor;}if(_c.visited){throw new Error("Cyclic dependency detected in descriptor: "+_b);}_c.visited=true;_c.ctor=_2(_e.map(_a),_d);_c.instance=new _c.ctor();return _c.ctor;};_8.forEach(function(_f){_9[_f.typeIdentifier]=this._prepareDescriptor(_f);},this);Object.keys(_9).forEach(_a);return _9;},registerTypeSetting:function(_10,_11){_11.typeIdentifier=_10;this.registerTypeSettings([_11]);},getValue:function(_12,_13){var _14=this._uiDescriptors[_12];return _14?_14.instance[_13]:undefined;},getResourceValue:function(_15,_16,_17){var _18=this._uiDescriptors[_15];return _18?_18.instance.getResource(_16,_17):undefined;},getAndConcatenateValues:function(_19,_1a){var _1b=[],_1c=this._uiDescriptors[_19];_1c&&_1c.instance.getRecursive(_1a,_1b);return _1b;},getInheritanceChain:function(_1d){var _1e=[],_1f=this._uiDescriptors[_1d];if(!_1f){return _1e;}_1f.instance.constructor._meta.bases.forEach(function(_20){_1e.push(_20._meta.hidden.typeIdentifier);});return _1e;},isBaseTypeIdentifier:function(_21,_22){_21=this._uiDescriptors[_21];_22=this._uiDescriptors[_22];if(!_21||!_22){return false;}return _21.instance.isInstanceOf(_22.ctor);},removeIntersectingTypes:function(_23,_24){var _25=[];if(_23){_23.forEach(function(_26){if(_1.indexOf(_24,_26)===-1&&_1.some(_24,function(_27){return this.isBaseTypeIdentifier(_26,_27);},this)===false){_25.push(_26);}},this);}return _25;},getValidAcceptedTypes:function(_28,_29,_2a){var _2b=_29||[];var _2c=_2a||[];var _2d=_28||[];if(_2b.length===0&&_2c.length===0){return _2d;}var _2e=function(_2f,_30){return _1.some(_30,function(_31){return this.isBaseTypeIdentifier(_2f,_31);},this);};var _32=_1.filter(_2d,function(_33){return (!(_2e.call(this,_33,_2c))&&_2e.call(this,_33,_2b));},this);return _32;},_prepareDescriptor:function(_34){var _35,_36=_34.languageKey;Object.keys(_34).forEach(function(key){var _37=_34[key];if(_37===null||_37===undefined){delete _34[key];}});if(_36){_35=this.resources[_36];}_3.mixin(_34,{getRecursive:function(key,_38){var _39=_34[key];if(_39){if(_39 instanceof Array){_39.forEach(function(v){_38.push(v);});}else{_38.push(_39);}}this.inherited(arguments);},getResource:function(key,_3a){var _3b=_34.resource,_35;if(_3b){if(!_3a||(_3a&&_34.isPrimaryType)){try{_35=_3.getObject(key,false,_3b);}catch(error){}if(_35!==undefined){return _35;}}}return this.inherited(arguments);},resource:_35});return {instance:null,ctor:null,descriptor:_34,visited:false};}};});