//>>built
define("epi/shell/widget/Iframe",["dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-style","dojo/Deferred","dojo/io-query","dojo/on","dojo/sniff","dijit/_TemplatedMixin","dijit/_Widget","dijit/focus","epi","epi/Url","epi/shell/applicationSettings","epi/shell/DestroyableByKey","epi/shell/postMessage","epi/routes"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10){return _1([_9,_8,_e],{autoFit:false,isLoading:false,name:"",responseTimeout:15000,templateString:"<iframe data-dojo-attach-point=\"iframe\" class=\"dijitReset\" name=\"${name}\" src=\"${url}\" role=\"presentation\" frameborder=\"0\" style=\"width:100%; user-select: none;\"></iframe>",visible:true,url:"about:blank",_isInspectable:null,_loadDeferred:null,_triggeredExternally:false,onLoading:function(url){this._set("isLoading",true);},onUnload:function(url){this._set("isLoading",true);},onLoad:function(url,_11){this._set("isLoading",false);},buildRendering:function(){this.inherited(arguments);if(_d.previewTimeout){this.set("responseTimeout",_d.previewTimeout);}this.own(on(this.iframe,"load",function(){this._onIframeLoad();}.bind(this)),_f.subscribe(this.name+"/site/load",function(_12){this._onIframeLoad(_12.url);}.bind(this)),_f.subscribe(this.name+"/site/mouseup",function(){if(!this.isInspectable()){on.emit(this.domNode,"mouseup",{bubbles:true,cancelable:true});}}.bind(this)));},resize:function(_13){if(this.autoFit){return;}if(_13){_4.set(this.iframe,{width:_13.w+"px",height:_13.h+"px"});}},getDocument:function(){if(!this.isInspectable()){return null;}try{return this.iframe.contentWindow?this.iframe.contentWindow.document:null;}catch(ex){return null;}},getWindow:function(){return this.iframe.contentWindow;},_setVisibleAttr:function(_14){this._set("visible",_14);_4.set(this.domNode,"display",_14?"block":"none");},_onIframeLoad:function(url){var _15=this.isInspectable(true);if(!this.isLoading&&_15){return;}this.destroyByKey("loading");if(_15){url=url||this.getLocation().href;this.ownByKey("loaded",on(this.getWindow(),"unload",this._onUnload.bind(this,url)),_a.registerIframe(this.iframe),this.connect(this.getDocument(),"onmousedown",function(){on.emit(this.domNode,"mousedown",{bubbles:true,cancelable:true});}),this.connect(this.getDocument(),"onmouseup",function(){on.emit(this.domNode,"mouseup",{bubbles:true,cancelable:true});}));}this._set("url",url);if(url!=="about:blank"){if(this._loadDeferred){this._loadDeferred.resolve();this._loadDeferred=null;}this.onLoad(this.url,this._triggeredExternally);}if(this.url){this._triggeredExternally=false;}if(this.autoFit){this._adjustSize(this._calculateActualSize());}},_onUnload:function(url){this.destroyByKey("loaded");this.set("_isInspectable",false);this.onUnload(url);},isInspectable:function(_16){if(!_16&&this._isInspectable!==null){return this._isInspectable;}try{return this._isInspectable=!!this.getLocation().href;}catch(ex){}return this._isInspectable=false;},load:function(url,_17,_18,_19){var _1a=new _5(),_1b=new _c(this.url),_1c=new _c(url,_17,_18),_1d=window.location.protocol.replace(":",""),_1e=(_1c.scheme==="http"&&_1d==="https"),_1f=function(url,_20){function _21(){var url=_10.getActionPath({moduleArea:"Shell",controller:"PreviewUnavailable",action:"Timeout"});_1f(url,false);};if(_20){this.destroyByKey("loading");this.ownByKey("loading",this.defer(_21.bind(this),this.responseTimeout));}this.set("url",url.toString());}.bind(this);if(this._loadDeferred){this._loadDeferred.cancel();}if(!url){_1a.cancel();return _1a.promise;}this._loadDeferred=_1a;if(_1e){_1c=_10.getActionPath({moduleArea:"Shell",controller:"PreviewUnavailable"});}if(_19||!(_1c.path===_1b.path&&_b.areEqual(_1c.query,_1b.query))){_1f(_1c,true);}else{if(!this.isLoading){return _1a.resolve();}}return _1a.promise;},reload:function(){return this.load(this.get("url"),null,null,true);},getCurrentQuery:function(){return _6.queryToObject(this.getWindow().location.search.substring(1));},getLocation:function(){return this.getWindow().location;},_getUrlAttr:function(){return this.url;},_setUrlAttr:function(url){this._triggeredExternally=true;this.onLoading(url);if(this.iframe.contentWindow){this.iframe.contentWindow.location.replace(url);}else{this.iframe.src=url;}this._set("url",url);},_calculateActualSize:function(){var doc=this.getDocument();function _22(dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};return {h:_22("Height"),w:_22("Width")};},_adjustSize:function(_23){_4.set(this.iframe,"height",_23.h+"px");_4.set(this.getWindow().document.body,"height","auto");}});});