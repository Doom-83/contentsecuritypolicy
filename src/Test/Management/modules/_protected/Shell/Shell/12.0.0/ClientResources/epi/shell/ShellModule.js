//>>built
define("epi/shell/ShellModule",["epi/patch/patches","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dnd/Manager","epi","epi/_Module","epi/routes","epi/Url","epi/shell/applicationSettings","epi/shell/store/Registry","epi/shell/widget/Application","epi/shell/Profile","epi/shell/layout/PositioningUtility","epi/shell/ContextService","epi/shell/ContextHistory","epi/shell/HashWrapper","epi/shell/ViewContextHistory","epi/shell/widget/ComponentController","epi/shell/command/GlobalCommandRegistry","epi/shell/dnd/Avatar","epi/shell/MetadataManager","epi/shell/widget/WidgetFactory","epi/shell/MessageService","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi/shell/StickyViewSelector","epi/shell/socket/hub","epi/shell/customFocusIndicator","dojo/has!epi-socket-logging?epi/shell/socket/log"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,hub){return _2([_9],{_settings:null,_initializeHandle:null,constructor:function(_1e){this._settings=_1e;},initialize:function(){return _6(this.inherited(arguments),_3.hitch(this,function(){_2.safeMixin(_c,this._settings);_1d.disable();var _1f=new _d();this._initializeStores(_1f);if(this._settings.enableWebSockets){hub.start();}this.registerDependency("epi.storeregistry",_1f);this.registerDependency("epi.shell.Profile",new _f());this.registerDependency("epi.shell.MetadataManager",_18);this.registerDependency("epi.shell.widget.WidgetFactory",_19);this.registerDependency("epi.shell.MessageService",_1a);this.registerDependency("epi.shell.layout.PositioningUtility",_10);this.registerDependency("epi.globalcommandregistry",_16);var _20=new _13();var _21=new _14();this.registerDependency("epi.shell.controller.Components",new _15({moduleArea:"Shell"}));this.registerDependency("epi.shell.ContextService",new _11());this.registerDependency("epi.shell.ContextHistory",new _12());this.registerDependency("epi.shell.HashWrapper",_20);var _22=_7.manager();_22.makeAvatar=function(){return new _17(this);};_22.OFFSET_X=6;_22.OFFSET_Y=6;_4.after(_22,"stopDrag",function(_23){_5.publish("/dnd/stop",null);return _23;});this._initializeHandle=_5.subscribe("/epi/shell/application/initialized",_3.hitch(this,this._requestInitialContext,_20,_21));return _1b.initialize();}));},uninitialize:function(){if(this._requestFailedHandle){this._requestFailedHandle.remove();}this.inherited(arguments);},_initializeStores:function(_24){var _25=_a.getRestPath({moduleArea:"shell",storeName:"metadata"}),_26=_a.getRestPath({moduleArea:"shell",storeName:"context"}),_27=_a.getRestPath({moduleArea:"shell",storeName:"searchproviders"}),_28=_a.getRestPath({moduleArea:"shell",storeName:"searchresults"}),_29=_a.getRestPath({moduleArea:"shell",storeName:"componentcategory"}),_2a=_a.getRestPath({moduleArea:"shell",storeName:"componentdefinition"}),_2b=_a.getRestPath({moduleArea:"shell",storeName:"component"}),_2c=_a.getRestPath({moduleArea:"shell",storeName:"componentsortorder"}),_2d=_a.getRestPath({moduleArea:"shell",storeName:"licenseinformation"}),_2e=_a.getRestPath({moduleArea:"shell",storeName:"uidescriptor"});_24.create("epi.shell.metadata",_25,{idProperty:"modelType"});_24.create("epi.shell.context",_26,{idProperty:"uri"});_24.create("epi.shell.searchproviders",_27);_24.create("epi.shell.searchresults",_28);_24.create("epi.shell.componentcategory",_29,{idProperty:"name"});_24.create("epi.shell.componentdefinition",_2a);_24.create("epi.shell.component",_2b);_24.create("epi.shell.componentsortorder",_2c);_24.create("epi.shell.licenseinformation",_2d);_24.create("epi.shell.uidescriptor",_2e);},_requestInitialContext:function(_2f,_30){if(this._initializeHandle){this._initializeHandle.remove();}var _31=_3.hitch(this,function(_32){var _33=_32||_1c.settings.defaultContext;var _34=null;if(_33){this._requestFailedHandle=_5.subscribe("/epi/shell/context/requestfailed",_3.hitch(this,function(_35,_36,_37){if(_37&&_37.sender===this){this._requestFailedHandle.remove();_31(null);}}));_34={uri:_33};}_5.publish("/epi/shell/context/request",_34,{sender:this});});var _38=_2f.getHash();if(_38&&_38.context){_31(_38.context);return;}_6(_30.getLastContextForView(),function(_39){var _3a=null;if(_39&&_39.versionAgnosticUri){_3a=_39.versionAgnosticUri;}_31(_3a);});}});});