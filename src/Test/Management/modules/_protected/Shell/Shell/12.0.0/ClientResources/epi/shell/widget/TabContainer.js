//>>built
define("epi/shell/widget/TabContainer",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/dom-class","dijit/layout/ContentPane","dijit/layout/TabContainer","dijit/registry","epi","epi/dependency","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/TabController","epi/shell/widget/_ActionConsumerWidget","epi/shell/DialogService","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.TabContainer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,res){return _2([_8,_e],{controllerWidget:_d,_selectedPage:null,_componentsController:null,res:res,confirmationBeforeRemoval:true,startup:function(){if(this._started){return;}this.inherited(arguments);this.connect(this.tablist,"onLayoutChanged",this._changeLayout);this.connect(this.tablist,"onTabTitleChanged",this._changeName);this.connect(this.tablist,"onAddNewTab",this._createTab);this._componentsController=_b.resolve("epi.shell.controller.Components");if(this.getChildren().length<=0){this._createTab();}},postCreate:function(){this.inherited(arguments);_6.add(this.domNode,"epi-mainApplicationArea");},_makeController:function(){var _10=this.inherited(arguments);this.connect(_10,"onSelectChild",this._pageSelected);var _11=[{label:this.res.addgadget,onClick:_4.hitch(this,this._showComponentDialog)},{label:this.res.createtab,onClick:_4.hitch(this,this._createTab)},{label:this.res.rearrangegadget,onChange:_4.hitch(this,this._rearrangeGadgets),type:"checkedmenuitem",checked:false,rearrangeGadgets:function(_12){this.set("checked",_12);}}];_1.forEach(_11,_10.addAddMenuItem,_10);return _10;},_rearrangeGadgets:function(_13){if(this._selectedPage){this._selectedPage.changeLockButtonState(_13);}},_showComponentDialog:function(){if(this._selectedPage){this._selectedPage.showComponentSelector();}},_componentSelected:function(){var _14=this._selectedPage;_14.addComponent.apply(_14,arguments);},_pageSelected:function(_15){this._selectedPage=_15;},_createTab:function(){this._componentsController.getEmptyComponentDefinition("EPiServer.Shell.ViewComposition.Containers.ComponentContainer",_4.hitch(this,function(_16){var _17=_16[0];_17.settings.numberOfColumns=2;_17.settings.containerUnlocked=true;_17.settings.closable=true;this._componentsController.addComponent(this,_17,_4.hitch(this,function(_18){var _19=this.getChildren();this.selectChild(_19[_19.length-1]);}));}));},_changeName:function(_1a,_1b){if(this._isEmpty(_1b)){this._showMessageDialog(this.res.tabnamecannotbeemptymessage).then(function(){_1a.controlButton.tabName.innerHTML=_1a.controlButton.tabCurrentName;_1a.controlButton._setTabTitleEditable(true);});}else{var _1c=String(_1a.title);var _1d=this._componentsController.getComponentDefinition(_1a.id);_1a.title=_1b;_1a.tabCurrentName=_1b;if(_1d){_1d.settings.personalizableHeading=_1b;this._componentsController.saveComponents([_1d],function(){},_4.hitch(this,function(){this._showMessageDialog(this.res.tabnamecouldnotbesaved).then(function(){_1a.set("title",_1c);_1a.set("tabCurrentName",_1c);_1a.controlButton.revertTabTitleChanges(true,_1c,_1b);});}));}else{}}},_getNumberOfColumns:function(evt){if(!evt||!evt.target){return 1;}var _1e=_9.getEnclosingWidget(evt.target);if(!_1e||!_1e.column){return 1;}return _1e.column;},_changeLayout:function(_1f,evt){var _20=this._getNumberOfColumns(evt),_21=null;if(typeof _1f.setColumns=="function"){_1f.setColumns(_20);}_21=this._componentsController.getComponentDefinition(_1f.id);if(_21){_21.settings.numberOfColumns=_20;this._componentsController.saveComponents([_21]);}else{}},closeChild:function(_22){if(this.getChildren().length===1){return;}if(!this.confirmationBeforeRemoval){this.inherited(arguments);this._removeTab(_22);}else{return this._showRemovalConfirmationDialog().then(function(){_8.prototype.closeChild.apply(this,[_22]);this._removeTab(_22);}.bind(this));}},_removeTab:function(_23){var _24=this._componentsController.getComponentDefinition(_23.id);this._componentsController.removeComponent(_24.id);var _25=this.getChildren().length;if(_25===1){for(var _26 in this.tablist.pane2button){this.tablist.pane2button[_26].closeTabMenuItem.set("disabled",true);}}},_showRemovalConfirmationDialog:function(){return _f.confirmation({description:this.res.removetabquestion,title:_a.resources.header.episerver});},_showMessageDialog:function(_27){return _f.alert(_27);},_isEmpty:function(_28){return (_4.trim(_28)===""?true:false);}});});