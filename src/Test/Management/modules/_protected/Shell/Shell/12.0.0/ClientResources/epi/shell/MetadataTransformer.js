//>>built
define("epi/shell/MetadataTransformer",["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/TypeDescriptorManager"],function(_1,_2,_3,_4){return _1(null,{defaultGroupType:"epi/shell/layout/GroupContainer",defaultSingleGroupType:"epi/shell/layout/SimpleContainer",defaultParentType:"epi/shell/layout/ParentContainer",defaultGroupName:"defaultGroup",defaultGroupTitle:"",propertyFilter:null,constructor:function(_5){_1.safeMixin(this,_5);},toComponentDefinitions:function(_6,_7,_8,_9){var _a=this._filterProperties(_6);var _b=_2.getObject("additionalValues.modelTypeIdentifier",false,_6);return this._getComponentDefinitions(_a,_6.groups,_7,_8,_9,_b);},transformPropertySettings:function(_c,_d,_e,_f,_10){var _11=_2.mixin(_e?{value:_c.initialValue}:{},{_type:_c.hideSurroundingHtml?"hiddenfield":"field",name:_d+_3.pascalToCamel(_c.name),label:_c.displayName,selections:_c.selections,displayui:_c.displayui,readOnly:_f},_c.settings);this._setTranslatedLabelAndTooltip(_11,_10);return {settings:_11,widgetType:_c.uiType,widgetPackage:_c.uiPackage};},_filterProperties:function(_12){var _13=this.propertyFilter,_14=_12.properties;return _13?_14.filter(_2.hitch(this,function(_15){return _13(_12,_15);})):_14;},_getComponentDefinitions:function(_16,_17,_18,_19,_1a,_1b){var _1c=_2.clone(_16)||[],_1d,_1e={},_1f=_3.pascalToCamel(this.defaultGroupName),_20,_21=function(_22,_23){return (_22.displayOrder||0)-(_23.displayOrder||0);};_1d=(_17||[]).map(function createGroups(_24){var _25=this._createGroupContainer(_24,_1a);_1e[_25.settings.name]=_25;return _25;},this);_1d.sort(_21);_1d.unshift(_1e[_1f]=_20=this._createGroupContainer({name:_1f,title:this.defaultGroupTitle,displayUI:true},_1a));_1c.sort(_21);_1c.forEach(function createProperties(_26){if(!_26.showForEdit){return;}var _27=_3.pascalToCamel(_26.groupName||""),_28=_1e[_27]||_20;var _29=_26.uiType?this.transformPropertySettings(_26,_18,_19,_1a,_1b):this._createParentContainer(_26,_18,_19,_1a,_1b);_29 instanceof Array?Array.prototype.push.apply(_28.components,_29):_28.components.push(_29);},this);_1d=_1d.filter(function(_2a){return _2a.settings.displayui&&_2a.components.length;});if(_1d.length===1&&_1d[0].widgetType===this.defaultGroupType){_1d[0].widgetType=this.defaultSingleGroupType;}return _1d;},_createGroupContainer:function(_2b,_2c){var _2d={_type:"group",name:_3.pascalToCamel(_2b.name),title:_2b.title,readOnly:_2c,displayui:_2b.displayUI};return {displayOrder:_2b.displayOrder,settings:_2.mixin(_2d,_2b.options),widgetType:_2b.uiType||this.defaultGroupType,components:[]};},_createParentContainer:function(_2e,_2f,_30,_31,_32){var _33={_type:"parent",name:_2f+_3.pascalToCamel(_2e.name),title:_2e.displayName};this._setTranslatedLabelAndTooltip(_33,_32);var _34=this._filterProperties(_2e);return {settings:_2.mixin(_33,_2e.settings),widgetType:_2e.layoutType||this.defaultParentType,components:this._getComponentDefinitions(_34,_2e.groups,_33.name+".",_30,_31,_32)};},_setTranslatedLabelAndTooltip:function(_35,_36){var _37;var _38="properties."+_35.name.toLowerCase();if(!_36||!(_37=_4.getResourceValue(_36,_38))){return;}if(_37.caption){_35.label=_37.caption;if(_35.hasOwnProperty("title")){_35.title=_37.caption;}}if(!_35.tooltip&&_37.help){_35.tooltip=_37.help;}}});});